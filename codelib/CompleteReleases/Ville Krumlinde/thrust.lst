AS09 Assembler for M6809 [1.42].                                     Page    1
--------------------------------- thrust.asm ---------------------------------

15616 lines read, no errors in pass 1.
                             ; Vectrex Thrust main program
                             ; Copyright (C) 2004  Ville Krumlinde
                             
                             ;----------------------------------------
                             ; THRUST.ASM
                             ;----------------------------------------
                             
                               opt   ;optimizations on
                               include "def.asm"
                             ; Macros, defines and BSS.
                             ; Copyright (C) 2004  Ville Krumlinde
                             
                             
0100 =                       ScreenW equ 256
0100 =                       ScreenH equ 256
0008 =                       TileCountX equ 8   ;Must be power of 2
0008 =                       TileCountY equ 8   ;Must be power of 2
0020 =                       TileW equ ScreenW/TileCountX
0020 =                       TileH equ ScreenH/TileCountY
                             
0008 =                       ShipMaxVeloc equ 8      ;Max velocity of ship
                             
00f0 =                       EmptySpaceH = 240       ;Height of empty space ov
ff10 =                       WorldTopY = -EmptySpaceH
                             
0014 =                       DrawScale equ 20 ;15        ;Scale value used whe
                             
0000 =                       StartLevel = 1 - 1
                             
0002 =                       Fixed = 2               ;Nr of bits to use for fi
                             
                             ;normal setting all 0
0000 =                       Immortal = 0            ;Set to 1 to make ship im
0000 =                       Level1Only = 0          ;Set to 1 to only include
0000 =                       DemoRecord = 0          ;Set to 1 to record user 
                             
0040 =                       RefuelDistance = 64             ;Max Y distance f
003c =                       BeamLength = 60                 ;Length of tracto
                             
0008 =                       ShipArea = 8                    ;Hit area for shi
0018 =                       PlantArea = 24                  ;Hit area, shot a
0006 =                       PodArea = 6                     ;Hit area, carrie
0018 =                       FuelArea = 24                   ;Hit area, shots 
000e =                       GunArea = 14                    ;Hit area, ship s
000a =                       SwitchArea = 10                 ;Hit area, shot v
000e =                       StationaryPodArea = 14          ;Hit area, ship v
                             
                             ;B1 is lock, B2 is Tractor, B3 is Thrust, B4 is f
00d8 =                       DefaultButtonConfig = (3 << 6) | (1 << 4) | (2 <<
                             ;DefaultButtonConfig = (0 << 6) | (1 << 4) | (2 <
                             
0030 =                       WallIntensity = $30
                             
0000 =                         struct LevelEntry
0000 =                           db leSizeX          ;level width in tiles (mu
0001 =                           db leSizeY          ;level height in tiles
0002 =                           dw leTiles          ;address of tiles
0004 =                           dw leGuns           ;address to list of guns
0006 =                           dw leFuel           ;address to list of fuel 
0008 =                           dw leOrbX           ;X/Y coords of orb
000a =                           dw leOrbY
000c =                           dw lePowerX         ;X/Y coords of powerplant
000e =                           dw lePowerY
0010 =                           dw leRestart        ;pointer to list of resta
0012 =                           dw leDoors          ;pointer to list of doors
0014 =                           dw leSwitches       ;pointer to list of doors
                               end struct
                             
0000 =                         struct SpriteEntry
0000 =                           dw seLinesRel       ;address to vectorlist us
0002 =                           dw seLinesAbs       ;address to vectorlist us
                               end struct
                             
0000 =                         struct TileEntry
0000 =                           dw teLinesRel       ;address to vectorlist us
0002 =                           dw teLinesAbs       ;address to vectorlist us
0004 =                           dw teCollisionSub   ;address to subroutine fo
                               end struct
                             
                             
                             ;Returns an oscillating (sawtooth) value in a
                             ;Max must be power of 2
                             ;Max=4, returns 012210
                             mTicToc macro max
                               local l1
                               lda LoopCounterLow
                               anda #max-1
                               cmpa #max/2
                               bcc l1
                               eora #max-1
                             l1:
                               endm
                             
                             
                             ;Set the hi/lo part of a 16-bit register individu
                             mCombine macro reg,hival,loval
                               ld\1 #(lo hival)<<8 | (lo loval)
                               endm
                             
                             
                             ;Collision test point vs box.
                             ;size is width/height intersection test
                             ;miss_label is where to bransch if no intersectio
                             ;u and y points to x1,y1 and x2,y2 respectively
                             ;(x1>=x2 - (size/2)) && (x1<=x2 + (size/2)) &&  (
                             mPointVsArea macro size,miss_label, X1,Y1, X2,Y2
                               ldx     X1,u
                               ldd     X2,y
                               subd    #size/2
                               std -2,s
                               cmpx -2,s
                               lblt    miss_label
                               addd    #size
                               std -2,s
                               cmpx -2,s
                               lbgt    miss_label
                               ldx     Y1,u
                               ldd     Y2,y
                               subd    #size/2
                               std -2,s
                               cmpx -2,s
                               lblt    miss_label
                               addd    #size
                               std -2,s
                               cmpx -2,s
                               lbgt    miss_label
                               endm
                             
                             
                             ;Collision test point vs rectangle.
                             ;sizeW/H is width/height of rectangle
                             ;x1/y1 is point, x2/y2 is rectangle center
                             ;miss_label is where to branch if no intersection
                             ;u and y points to x1,y1 and x2,y2 respectively
                             ;(x1>=x2 - (sizeW/2)) && (x1<=x2 + (sizeW/2)) && 
                             mPointVsRect macro sizeW,sizeH,miss_label, X1,Y1,
                               ldx     X1,u
                               ldd     X2,y
                               subd    #sizeW/2
                               std -2,s
                               cmpx -2,s
                               blt    miss_label
                               addd    #sizeW
                               std -2,s
                               cmpx -2,s
                               bgt    miss_label
                               ldx     Y1,u
                               ldd     Y2,y
                               subd    #sizeH/2
                               std -2,s
                               cmpx -2,s
                               blt    miss_label
                               addd    #sizeH
                               std -2,s
                               cmpx -2,s
                               bgt    miss_label
                               endm
                             
                             
                             ;Collision test area vs area
                             ;xmin1,xmax1,ymin1,ymax1 are s-relative dimension
                             ;centerx2,centery2 are u-relative center-coords o
                             ;size2 is height/width of second rectangle
                             mTestAreaVsArea macro xmin1,xmax1,ymin1,ymax1,cen
                               ldx     centerx2,u
                             
                               leax    size2/2,x
                               cmpx    xmin1,s
                               blt    miss_label
                             
                               leax    -size2,x
                               cmpx    xmax1,s
                               bgt    miss_label
                             
                               ldx     centery2,u
                               leax    size2/2,x
                               cmpx    ymin1,s
                               blt    miss_label
                             
                               leax    -size2,x
                               cmpx    ymax1,s
                               bgt    miss_label
                               endm
                             
                             
                             ;Helper macro for mDecLocals
                             _mLocal macro s1,size,label
                              if s1>0
                                if size=1
                             LocalB\3 = FrameSize
                                endif
                                if size=2
                             LocalW\3 = FrameSize
                                endif
                             FrameSize=FrameSize + size
                             s1=s1-1
                              endif
                              endm
                             
                             ;Declare local stack frame.
                             ;  s1 nr of 1-byte locals,
                             ;  s2 nr of 2-byte locals
                             ;  bufsize is size of extra buffer (can be omitte
                             ;Locals are named Local1B etc for byte, Local1W f
                             mDecLocals macro s1,s2,bufsize
                               nolist
                             FrameSize=0
                             _aa=s1                  ;declare one byte locals
                               _mLocal _aa,1,1
                               _mLocal _aa,1,2
                               _mLocal _aa,1,3
                               _mLocal _aa,1,4
                               _mLocal _aa,1,5
                               _mLocal _aa,1,6
                               _mLocal _aa,1,7
                               ;7 B is max, add more if needed
                             _aa=s2                  ;declare two byte locals
                               _mLocal _aa,2,1
                               _mLocal _aa,2,2
                               _mLocal _aa,2,3
                               _mLocal _aa,2,4
                               _mLocal _aa,2,5
                               if \0=3              ;declare buffer
                             LocalBuffer = FrameSize
                             FrameSize = FrameSize + bufsize
                               endif
                               ;5 W is max, add more if needed
                               leas -FrameSize,s
                               list
                              endm
                             
                             ;Free local stack frame declared with mDecLocals
                             mFreeLocals macro
                               leas FrameSize,s
                              endm
                             
                             
                             mSetFlag macro flag
                               if 255>flag
                                 lda #flag
                                 ora GameFlags1
                                 sta GameFlags1
                               else
                                 lda #(flag)>>8
                                 ora GameFlags2
                                 sta GameFlags2
                               endif
                               endm
                             
                             mTestFlag macro flag
                               if 255>flag
                                 lda GameFlags1
                                 bita #flag
                               else
                                 lda GameFlags2
                                 bita #(flag)>>8
                               endif
                               endm
                             
                             mClearFlag macro flag
                               if 255>flag
                                 lda #~flag
                                 anda GameFlags1
                                 sta GameFlags1
                               else
                                 lda #~((flag)>>8)
                                 anda GameFlags2
                                 sta GameFlags2
                               endif
                               endm
                             
                             ;D0 directs -1, all d0 relative code is written w
                             mDptoD0 macro
                               lda   #0xD0
                               tfr   a,dp
                               direct -1
                               endm
                             
                             ;C8 always directs c8, all game variables are imp
                             mDptoC8 macro
                               lda   #0xC8
                               tfr   a,dp
                               direct $c8
                               endm
                             
                             
                             ;Returns a value in D between 0-255 if coord is o
                             ;Tests for world wrap-around
                             mGetScreenX macro xptr
                               local L143
                               if  \0 = 0    ;no param, X holds X-coord
                                 tfr x,y
                               endif
                               if  \0 = 1
                                 ldy     xptr
                               endif
                               if  \0 = 2   ;as09 treats "2,y" as two separate
                                 ldy     \1,\2
                               endif
                               ldx     ViewX
                               tfr     y,d
                               stx -2,s
                               subd -2,s
                               bge     L143
                               ldd     CurLevelEndX
                             ;  stx -2,s
                               subd -2,s
                               sty -2,s
                               addd -2,s
                             L143:
                               endm
                             
                             
                             ;Coordinates in game world are stored in fixed po
                             ;The integer part is in the first two bytes, the 
                             
                             ;Store d into three bytes in x
                             mStore_D_as_fixed macro
                               clr 2,x
                             
                               asra
                               rorb
                               ror 2,x
                             
                               asra
                               rorb
                               ror 2,x
                             
                               std ,x
                               endm
                             
                             
                             ;Read three bytes from x into d
                             mGet_D_from_fixed macro
                               ldd ,x
                             
                               asl 2,x
                               rolb
                               rola
                             
                               asl 2,x
                               rolb
                               rola
                               endm
                             
                             
                             
                             ;Update x-coordinate in sprite structure. Apply v
                             ;  u is pointer to sprite structure
                             ;  X_Offset is u-relative offset to 3 byte x-coor
                             ;  VelocX_Offset is u-relative offset to x-veloci
                             mUpdateXCoord macro X_Offset, VelocX_Offset
                               local CheckRightEdge,XOk
                               leax X_Offset,u               ;Update sprite X 
                               mGet_D_from_fixed
                               std -2,s
                               ldb VelocX_Offset,u
                               sex
                               addd -2,s
                               mStore_D_as_fixed
                               tsta                          ;Check for world 
                               bpl CheckRightEdge
                                 addd CurLevelEndX           ;Left end hit, wr
                                 std X_Offset,u
                                 bra XOk
                             CheckRightEdge:
                                 subd CurLevelEndX
                                 bmi XOk
                                 std X_Offset,u              ;Right edge hit
                             XOk:
                               endm
                             
                             
                             ;Update y-coordinate in sprite structure. Apply v
                             ;  u is pointer to sprite structure
                             ;  X_Offset is u-relative offset to 3 byte x-coor
                             ;  VelocX_Offset is u-relative offset to x-veloci
                             ;  HitTopLabel label where to jump if top of worl
                             mUpdateYCoord macro Y_Offset, VelocY_Offset, HitT
                               local NotHitTopOfWorld
                               leax Y_Offset,u               ;Update sprite Y 
                               mGet_D_from_fixed
                               std -2,s
                               ldb VelocY_Offset,u
                               sex
                               addd -2,s
                               cmpd #WorldTopY << Fixed
                               bgt NotHitTopOfWorld
                                 lbra HitTopLabel            ;Top of world hit
                             NotHitTopOfWorld:
                               mStore_D_as_fixed
                               endm
                             
                             
                             
                             
                             ;Clear bit A in address adddr.
                             ;  a holds the bit nr
                             ;  addr is the address of the byte where the bit 
                             mClearBitA macro addr
                               local lop
                               ldb #255                    ;start with all bit
                               andcc #$fe                  ;clear carry flag, 
                             lop:                          ;rotate a zero into
                               rolb
                               deca
                               bpl lop
                               andb addr                   ;b now has a hole i
                               stb addr
                               endm
                             
                             ;16 bit version of ClearBitA
                             mClearWordBitA macro addr
                               local lop
                               sta -1,s
                               ldd #$ffff                  ;start with all bit
                               andcc #$fe                  ;clear carry flag, 
                             lop:                          ;rotate a zero into
                               rolb
                               rola
                               dec -1,s
                               bpl lop
                               anda addr                  ;D now has a hole in
                               andb addr+1
                               std addr
                               endm
                             
                             mSetBitA macro addr
                               local lop,fin
                               ldb #1
                             lop:
                               deca
                               bmi fin
                               rolb
                               bra lop
                             fin:
                               orb addr
                               stb addr
                               endm
                             
                             mSetByte macro addr, value
                              if 0=value
                                clr addr
                              else
                                lda #value
                                sta addr
                              endif
                              endm
                             
                             mSetWord macro addr, value
                              if 0=value
                                clra
                                clrb
                              else
                                ldd #value
                              endif
                              std addr
                              endm
                             
                             
                             ;D = D div TileW
                             mDivTileW macro
                               if TileW > 32
                                 asra
                                 rorb
                               endif
                               if TileW > 16
                                 asra
                                 rorb
                               endif
                               if TileW > 8
                                 asra
                                 rorb
                               endif
                               if TileW > 4
                                 asra
                                 rorb
                               endif
                               if TileW > 2
                                 asra
                                 rorb
                               endif
                               if TileW > 1
                                 asra
                                 rorb
                               endif
                               endm
                             
                             ;D = D div TileH
                             mDivTileH macro
                               if TileH > 32
                                 asra
                                 rorb
                               endif
                               if TileH > 16
                                 asra
                                 rorb
                               endif
                               if TileH > 8
                                 asra
                                 rorb
                               endif
                               if TileH > 4
                                 asra
                                 rorb
                               endif
                               if TileH > 2
                                 asra
                                 rorb
                               endif
                               if TileH > 1
                                 asra
                                 rorb
                               endif
                               endm
                             
                             ;x,y is world coords, returns tile pointer in y
                             mGetLevelTile macro
                               ;calc tile pointer: x = tiles + (CurLevelSizeX 
                               tfr x,d               ;x
                               mDivTileW
                               ldx CurLevelEntry
                               ldx leTiles,x
                               abx
                               tfr y,d               ;y
                               mDivTileH
                               lda CurLevelSizeX
                               mul
                               leax d,x
                               endm
                             
                             
                             
                             
                             ;Get a random value to A
                             mRandomToA macro
                               jsr random                    ;call rom
                               endm
                             
                             ;Set pointer to three byte random seed in u, save
                             mSetRandomSeedToU macro oldptr
                               if \0=1
                                 ldd $c87b
                                 std oldptr,s
                               endif
                               stu $c87b
                               endm
                             
                             
                             mTestRangeD macro min,max,falselabel
                               cmpd #min
                               blt falselabel
                               cmpd #max
                               bgt falselabel
                               endm
                             
                             mSetIntensity macro intensity
                               if \0=1
                                 lda   #intensity            ;if argument exis
                               endif
                               if false
                                 sta   <01
                                 ;sta   $C827
                                 ldd   #$0504
                                 sta   <00
                                 stb   <00
                                 stb   <00
                                 ldb   #01
                                 stb   <00
                               endif
                               sta   <01
                               ldd   #$0401
                               sta   <00
                               stb   <00
                               endm
                             
                             
                             mSetScale macro scale
                               if \0=1
                                 lda #scale                  ;if argument exis
                               endif
                               sta <$04
                               endm
                             
                             
                             mDrawToD macro
                               local wait1
                               sta   <$01
                               clr   <$00
                             ;  leax  2,x
                               ;Ev. måste flera nop läggas till här för att ko
                               ;kommenterats bort
                             ;  nop
                               inc   <$00
                               stb   <$01
                               ldd   #$FF00
                               sta   <$0A
                               stb   <$05
                               lda   #$40
                             wait1:
                               bita  <$0D
                               beq   wait1
                             ;  nop
                               stb   <$0A
                               endm
                             
                             ;Move to d, without the extra wait that the ROM v
                             mMove_pen_d_Quick macro
                               local PF33D,PF33B,PF341
                               sta   <0x01
                               clr   <0x00
                               lda   #0xCE
                               sta   <0x0C
                               clr   <0x0A
                               inc   <0x00
                               stb   <0x01
                               clr   <0x05
                               ldb   #0x40
                             PF33D: bitb  <0x0D
                               beq   PF33D
                             ;PF33B: lda   #0x04
                             ;PF341: deca
                             ;  bne   PF341
                               endm
                             
                             ;move pen to d
                              if false
                             mMove_pen_d macro
                               local PF58B,PF592,PF33B,PF33D,PF341,PF345,exit
                               sta   <0x01
                               clr   <0x00
                               std -2,s
                               lda   #0xCE
                               sta   <0x0C
                               clr   <0x0A
                               inc   <0x00
                               stb   <0x01
                               clr   <0x05
                               ldd -2,s
                               ;inline convert ab to abs
                               ;the following is just to calc how long to wait
                               tsta
                               bpl   PF58B
                               nega
                               bvc   PF58B
                               deca
                             PF58B: tstb
                               bpl   PF592
                               negb
                               bvc   PF592
                               decb
                             PF592:  ;end inline
                               stb   -1,s
                               ora   -1,s
                               ldb   #0x40
                               cmpa  #0x40
                               bls   PF345
                               cmpa  #0x64
                               bls   PF33B
                               lda   #0x08
                               bra   PF33D
                             PF33B: lda   #0x04
                             PF33D: bitb  <0x0D
                               beq   PF33D
                             PF341: deca
                               bne   PF341
                               bra exit
                             PF345: bitb  <0x0D
                               beq   PF345
                             exit:
                              endm
                              endif
                             
                             mDot_at_current_position macro dot_dwell
                               ; From vectrex.txt
                               ;    "(WARNING! high intensity and long Vec_Dot
                               ;     your vectrex monitor, be carefull while e
                               local PF2CC
                                    lda   #0xFF
                                    sta   <0x0A
                             ;       ldb   #dot_dwell         ;dot_dwell is a 
                             ;PF2CC: decb                     ;dwell is not th
                             ;       bne   PF2CC
                                    clr   <0x0A
                              endm
                             
                             mGiveScore macro Score
                               lda #Score / 10
                               jsr GiveScoreA
                               endm
                             
                              if false  ;removed in 1.01
                             mVerifyCheckSum macro
                               local vcsLoop,vcsOk
                               ldx #CreditsText-20
                               leax 20,x
                               ldy #0
                               clra
                             vcsLoop:
                               ldb ,x+
                               pshs a
                               andb #7
                               anda #7
                               mul
                               leay d,y
                               puls a
                               inca
                               cmpx #CreditsTextEnd
                               bne vcsLoop
                               cmpy #CreditsTextCheckSum
                               beq vcsOk
                                 ;sty ,s      ;crash
                                 rts
                             vcsOk:
                              endm
                              endif
                             
                             ;System Executive Entry Points
f85e =                       convert_a_to_bcd_and_add  equ     $f85e
f87c =                       add_score_d             equ     $f87c
f256 =                       byte_2_sound_chip       equ $f256
f545 =                       clear_256_bytes         equ     $f545
f272 =                       clear_sound_chip        equ $f272
f8c7 =                       compare_scores          equ     $f8c7
f601 =                       convert_angle_to_rise_run equ     $F601
f27d =                       copy_bytes_2_sound_chip equ $f27d
f85e =                       covert_add_bcd          equ     $f85e
f495 =                       display_string          equ     $f495
f289 =                       do_sound                equ     $f289
f2c5 =                       dot_at_current_position equ  $F2C5
f2c3 =                       dot_at_d                equ     $f2c3
f2c3 =                       dot_d                   equ     $f2c3
f2c1 =                       dot_ix                  equ     $f2c1
f1af =                       dptoC8                  equ     $f1af
f1aa =                       dptoD0                  equ     $f1aa
f3df =                       draw_to_d               equ $f3df
f3da =                       draw_vl_a               equ     $f3da
f3ce =                       draw_vl_count4          equ     $f3ce
f40e =                       drawl1b                 equ     $f40e
f434 =                       dwp_with_count=$F434
f92e =                       explosion_snd           equ     $f92e
f584 =                       get_abs_val_ab          equ     $F584
f7a9 =                       get_pl_game             equ     $f7a9
f533 =                       init_music_buf          equ     $f533
f68d =                       init_sound              equ     $f68d
f687 =                       init_sound_chk          equ     $f687
f29d =                       intensity_to_1f         equ     $f29d
f2a1 =                       intensity_to_3f         equ     $f2a1
f2a5 =                       intensity_to_5f         equ     $f2a5
f2a9 =                       intensity_to_7f         equ     $f2a9
f2ab =                       intensity_to_A          equ     $f2ab
f1f5 =                       joy_analog              equ     $f1f5
f67f =                       move_block              equ     $f67f
f683 =                       move_block2             equ     $f683
f3b7 =                       move_draw_VL4           equ     $f3b7
f310 =                       move_pen                equ     $f310
f30c =                       move_pen7f              equ     $f30c
f2fc =                       move_pen7f_to_d         equ     $f2fc
f312 =                       move_pen_d              equ     $f312
f308 =                       move_penff              equ     $f308
f2fc =                       moveto_d_7f             equ     $F2FC
f8d8 =                       check_4_new_hi_score = $f8d8
f8ff =                       obj_hit                 equ     $f8ff
f373 =                       print_1_string          equ     $f373
f37a =                       print_at_d              equ     $f37a
f393 =                       print_ships             equ     $f393
f37a =                       print_str_d             equ     $f37a
f38a =                       printu2                 equ     $f38a
f511 =                       random                  equ     $f511
f1f8 =                       read_joystick           equ     $f1f8
f1b4 =                       read_switches           equ     $f1b4
f1ba =                       read_switches2          equ     $f1ba
f354 =                       reset0ref               equ     $f354
f61f =                       rot_vec_list1           equ     $f61f
f610 =                       rot_vec_list2           equ     $f610
f84f =                       set_dft_score           equ     $f84f
f192 =                       waitrecal               equ     $f192
                             
                             ;System RAM locations
c812 =                       stick1_button1 equ $c812
c813 =                       stick1_button2 equ $c813
c814 =                       stick1_button3 equ $c814
c815 =                       stick1_button4 equ $c815
c82a =                       _text_size              equ     $c82a
c81f =                       _stick1_mask            equ     $c81f
c820 =                       _stick2_mask            equ     $c820
c821 =                       _stick3_mask            equ     $c821
c822 =                       _stick4_mask            equ     $c822
c81a =                       _stick_res              equ     $c81a
c823 =                       _stick_type             equ     $c823
c81c =                       _pot_y                  equ     $c81c
c827 =                       _intensity              equ     $c827
c856 =                       _music_ready            equ     $c856
c83d =                       _refresh_time           equ     $c83d
                             
c825 =                       LoopCounterHigh = $C825
c826 =                       LoopCounterLow = $C826
c829 =                       Pattern = $C829
                             
                             
                             ;*****************************
                             ; BSS section.
                             ; Data declared here is not part of the binary im
                             ; The ORG line tells the assembler where to start
                             ; to the names defined in this section.
                             
                             ; Labels needs to be declared before use to let t
                             
                               bss
c880 =                         org $c880
                             
0007 =                       HighscoreEntry = (6+1)  ;score + end $80
                             
                             ;**************
                             ;EEPROM-buffer, loaded with eeprom content or def
                             ;Keep in sync with eeprom_format
c880 =                       eeprom_buffer           ;32 bytes
c880 =                       ButtonConfig:
c880 =                         ds 1                  ;Button configuration
c881 =                       BonusGameEnabled:
c881 =                         ds 1                  ;non-zero if bonus game i
c882 =                       Highscores:
c882 =                         ds HighscoreEntry*4   ;Highscores for each game
c89e =                         ds 31-(*-eeprom_buffer);pad to 32-bytes
c89f =                         ds 1                  ;last byte is checksum
                             ;End of EEPROM
                             ;**************
                             
                             
c8a0 =                       UserRamStart:
                             
                             ;Temps used by refreshdrawlist, and collision
c8a0 =                       TemporaryArea:
c8a0 =                       TempPosXStart: db 0
c8a1 =                       TempPosX: db 0  ;keep
c8a2 =                       TempPosY: db 0  ;together
c8a3 =                       TempTileWY: dw 0
c8a5 =                       TempTileWX: dw 0
c8a7 =                       TempTileWXStart: dw 0
c8a9 =                       TempTilePtr: ds 2
c8ab =                       TempAdjustX: ds 1
                             
                             
                             ;Represents the center point between ship and the
                             ;Fixed point 2 bits, 3 bytes
                             ;The fraction part is in the third byte, this mak
c8ac =                       CenterX: ds 3
c8af =                       CenterY: ds 3
                             
                             ;Current angle between ship and pod
                             ;8 bit fixed point, hi(Alpha) is 0..240 (unsigned
00f0 =                       ALPHA_MAX      = 240
c8b2 =                       Alpha: ds 2
c8b2 =                       AlphaHi: equ Alpha
                             
                             ;Amount to change alpha (spin speed)
c8b4 =                       AlphaDelta: ds 2
                             
c8b6 =                       ShipAngle: ds 1
c868 =                       LockedShipAngle = $C868         ;Angle when using
                             
c8b7 =                       ShipSpeedX: ds 2
c8b7 =                       ShipSpeedXHi: equ ShipSpeedX
c8b9 =                       ShipSpeedY: ds 2
c8b9 =                       ShipSpeedYHi: equ ShipSpeedY
                             
                             ; Ship coordinates.
                             ; Position in game world.
c8bb =                       ShipX: ds 2     ;keep
c8bd =                       ShipY: ds 2     ;together
                             
                             ; Pod (when carried by ship)
c8bf =                       PodX: ds 2      ;keep
c8c1 =                       PodY: ds 2      ;together
                             
                             ;Ship directions 0--32, 8=up.
                             ;Vectrex ROM direction 0--64, 0=up.
0020 =                       SHIP_DIRMAX       = 32
0040 =                       VEC_DIRMAX        = 64
                             
                             ;Conversion macro: ship angle -> vectrex angle
                             mShipAngleToVec macro reg
                              local l1
                              lsl\1
                              sub\1 #16
                              bpl l1
                                add\1 #VEC_DIRMAX
                             l1:
                              endm
                             
000a =                       ShipVectorCount equ 10
0003 =                       ThrustVectorCount = 3
                             
                             
                             ; Scrolling view
c8c3 =                       ScrollX: ds 1           ;0=no scroll, negative sc
c8c4 =                       ScrollY: ds 1           ;0=no scroll, negative sc
                             
                             
c8c5 =                       NeedRefresh:  db 0      ;1 if need refresh drawli
                             
                             ; Coordinate in game world for top left edge of s
                             ; This value is subtracted from sprite coord to p
c8c6 =                       ViewX: ds 2
c8c8 =                       ViewY: ds 2
                             
                             
                             ; Game mode = difficulty
0000 =                       NormalGame = 0
0001 =                       HardGame = 1
0002 =                       TimeAttackGame = 2
0003 =                       BonusGame = 3
0004 =                       DemoGame = 4
c87a =                       GameMode = $C87A   ;(rom game version)
                             
                             
                             ; Current level
c8ca =                       CurLevelEntry: ds 2
c8cc =                       CurLevelSizeX: ds 1
c8cd =                       CurLevelEndX:  ds 2
c8cf =                       CurLevelEndY:  ds 2     ;Actually highest ViewY (
c8d1 =                       CurLevel:      ds 1
                             
                             ; CLIP globals (same as viewx/y)
c8d2 =                       _clip_xmin:     ds   2
c8d4 =                       _clip_ymin:     ds   2
c8d6 =                       _clip_xmax:     ds   2
c8d8 =                       _clip_ymax:     ds   2
                             
                             
                             ; Status-display: Score and fuel
0006 =                       DigitCount = 6
c8da =                       PlayerScore: ds DigitCount
                             ;NOTE first byte after PlayerScore is overwritten
c8e0 =                       ShipLives: ds 1
c8e1 =                       ShipFuel: ds 2
                             
                             
                             ; Demo mode, use same RAM as playerscore, no scor
c8da =                       DemoBase = PlayerScore
c8da =                       DemoMode = DemoBase
c8db =                       DemoPtr = DemoBase+1
c8dd =                       DemoCounter = DemoBase+3
c86c =                       DemoSelected = $C86C            ;temp for which d
                             
                             ; Time attack
c8e3 =                       TimeAttackTime: ds 1            ;countdown in tim
                             
                             
                             ; Frame counter
                             ; This differs from the ROM loopcounter.
                             ; Two separate counters are combined in one byte,
                             ; non-power of two frame interval tests possible.
                             ; Thanks to Thomas Jentzsch.
0001 =                       FRAME2MASK      = %00000001
00c0 =                       FRAME3MASK      = %11000000
0003 =                       FRAME4MASK      = %00000011
00c1 =                       FRAME6MASK      = FRAME2MASK|FRAME3MASK     ; %11
0007 =                       FRAME8MASK      = %00000111
00c3 =                       FRAME12MASK     = FRAME4MASK|FRAME3MASK     ; %11
000f =                       FRAME16MASK     = %00001111
001f =                       FRAME32MASK     = %00011111
00cf =                       FRAME48MASK     = FRAME16MASK|FRAME3MASK    ; %11
003f =                       FRAME64MASK     = %00111111
00df =                       FRAME96MASK     = FRAME32MASK|FRAME3MASK    ; %11
00ff =                       FRAME192MASK    = FRAME64MASK|FRAME3MASK    ; %11
c8e4 =                       FrameCounter: ds 1
                             
                             
                             ;---------------------------------------
c8e5 =                       LevelClearLabel:        ;256 bytes from this labe
                             ;---------------------------------------
                             
                             
                             ; Flags
0001 =                       ShieldFlag = 1          ;ship shield is active
0002 =                       RefuelFlag = 2          ;ship is refueling
0004 =                       HasOrbFlag = 4          ;ship is carrying orb
0008 =                       PullFlag   = 8          ;ship is pulling orb from
0010 =                       InactiveFlag = 16       ;ship is invisible and ca
0020 =                       ThrustFlag   = 32       ;ship is thrusting
0040 =                       GameOverFlag = 64       ;set when game over
0080 =                       ReverseGravFlag = 128   ;Reverse gravity
0100 =                       NoLandscapeFlag = 256   ;Landscape is invisible
0200 =                       HomingGunShotsFlag = 512  ;Homing gunshots (hard 
0400 =                       LockedThrustFlag = 1024 ;Locked thrust angle acti
                             
c8e5 =                       GameFlags1: ds 1
c8e6 =                       GameFlags2: ds 1
                             
                             
                             ; Guns
0010 =                       MaxGunCount = 16
c8e7 =                       GunsActive: ds 2        ;Each bit is a activeflag
                             
0000 =                         struct GunEntry       ;Guns are stored in rom w
0000 =                           ds geGunX,2         ;x
0002 =                           ds geGunY,2         ;y
0004 =                           ds geGunSprite,1    ;sprite id
                               end struct
                             
                             
                             ; Fuel cells
0008 =                       MaxFuelCount = 8
c8e9 =                       FuelActive: ds 1                ;Each bit is a ac
c8ea =                       FuelAmounts: ds MaxFuelCount    ;Amount of fuel l
0010 =                       FullFuel = 16                   ;Amount of fuel i
                             
0000 =                         struct FuelEntry      ;Fuel cells are stored in
                                 ds 2                ;x
                                 ds 2                ;y
                               end struct
                             
                             
                             ; Doors and switches
                             
0020 =                       DoorSize = 32                   ;Opencounter for 
                             
0000 =                         struct DoorEntry
0000 =                           db deDoorDir                ;Direction door c
0001 =                           dw deDoorX
0003 =                           dw deDoorY
                               end struct
                             
0000 =                         struct SwitchEntry            ;Door switch
0000 =                           dw seSwitchX
0002 =                           dw seSwitchY
0004 =                           db seSwitchDir              ;0=left wall, 1=r
                               end struct
                             
                             
c8f2 =                       DoorCounter: ds 1               ;Counter used whe
                             
                             
                             ; Powerplant
c8f3 =                       PowerLife ds 1                  ;hitpoints. <0 = 
c8f4 =                       PowerShot ds 1                  ;>0 recently shot
                             
                             ; Perfect bonus
c8f5 =                       PerfectBonus: ds 1
                             
                             
                             ; Gun shots
c8f6 =                       GunShotActive: ds 1       ;Each bit is a activefl
0003 =                       MaxGunShots = 3
0007 =                       GunShotAllActive = %111   ;Must be in sync with m
                             
0000 =                         struct GunShotEntry
0000 =                           ds gsShotX,3          ;3 byte world coordinat
0003 =                           ds gsShotY,3          ;3 byte world coordinat
0006 =                           db gsShotVelocX       ;Velocity
0007 =                           db gsShotVelocY
                               end struct
c8f7 =                       GunShotTimer: ds 1        ;Delay timer for next s
c8f8 =                       GunShotMask: ds 1         ;Mask and delay for new
c8f9 =                       GunShotDelay: ds 1
c8fa =                       GunShotSpeed: ds 1
c8fb =                       GunShots: ds GunShotEntry * MaxGunShots
                             
                             
                             ; Fx
                             ; Each entry is three bytes:
                             ;    Time       8 bits: timeleft, 0=inactive
                             ;    TargetType 4 bits: ship,Pod,gun,fuel,switch,
                             ;    FxType     4 bits: explosion,teleportfx,250s
                             ;    Index      8 bits: fuel,switch etc index
0003 =                       MaxFx = 3
c913 =                       FxList: ds 3 * MaxFx
                             
                             
                             ; Ship shots.
                             
                             ; Max nr of shots active at one time. This value 
0004 =                       ShipShotCount = 4
                             
                             ; Structure holding info about one shot.
0000 =                         struct ShipShotEntry
0000 =                           db ssShotActive       ;Flag: is shot active?
0001 =                           ds ssShotX,3          ;3 byte world coordinat
0004 =                           ds ssShotY,3          ;3 byte world coordinat
0007 =                           db ssShotVelocX       ;Velocity
0008 =                           db ssShotVelocY
                               end struct
                             
                             ; Array with shots.
c91c =                       ShipShotList:
c91c =                         ds ShipShotEntry * ShipShotCount
                             
                             
                             ;Sound data, see Thrust_Sound.asm
                             ;Sound slot = Sound channel
0003 =                       SlotCount = 3
c940 =                       SoundSlots: ds SlotCount*2              ;contains
                             
                             
                             ; Cheat mode, if both are zero then cheat is not 
c86a =                       CheatLives = $C86A  ;rom unused, <>0 for infiniti
c86b =                       CheatLevel = $C86B  ;rom unused, <>0 for select s
c86a =                       Cheat = CheatLives
                             
                             
                             ; Dynamic length, keep at end of BSS-section
c946 =                       DrawList:
                             
                               code
0000 =                         org 0
                             
                               ;ROM-header
0000 : 6720                    db $67,$20
0002 : 47434520323030..        db "GCE 2004",$80
000b : fd0d                    dw $FD0D      ;ptr to execrom-music
000d : fc3072a8544852..        db $FC,$30,  $72,$A8,  "THRUST FOR VECTREX 1.2"
0028 : fc3060a8425920..        db $FC,$30,  $60,$A8,  "BY VILLE ",$6a,$80
0037 : 00                      db $0
                             
0038 :                       Boot:
0038 : bd7e99           [ 8]   jsr eeprom_load
                             
003b : cc0103           [ 3]   ldd #$0103            ;init joystick
003e : fdc81f           [ 6]   std $c81f
                             
                             ;  jsr Zzap_Start        ;uncomment while debuggi
                             
0041 :                       Start:
                               mDptoD0
0041 : 86d0             [ 2]>  lda   #0xD0
0043 : 1f8b             [ 6]>  tfr   a,dp
                            >  direct -1
                             
                             
0045 : bd7ec5           [ 8]   jsr eeprom_save       ;save to eeprom if change
0048 : bd5f3a           [ 8]   jsr ShowTitleScreen
                             
                               mDptoC8               ;Set DP to C8 for game lo
004b : 86c8             [ 2]>  lda   #0xC8
004d : 1f8b             [ 6]>  tfr   a,dp
                            >  direct $c8
                             
                             
004f : 4f               [ 2]   clra
0050 : bd296a           [ 8]   jsr InitNewGame
0053 : bd283d           [ 8]   jsr PrepareLevel
                             
0056 :                       MainLoop:
                               mDptoC8               ;Set DP to C8 for game lo
0056 : 86c8             [ 2]>  lda   #0xC8
0058 : 1f8b             [ 6]>  tfr   a,dp
                            >  direct $c8
                             
                             
005a : bd0a8e           [ 8]   jsr Ship_Update
005d : bd074e           [ 8]   jsr UpdateFx
0060 : bd1b49           [ 8]   jsr UpdateGuns
0063 : bd23df           [ 8]   jsr UpdateShipShots
0066 : bd1c29           [ 8]   jsr UpdateGunShots
0069 : bd1f7d           [ 8]   jsr UpdateDoors
006c : bd1b05           [ 8]   jsr AdjustFuel
006f : bd1a0e           [ 8]   jsr UpdateFrameCounter
0072 : bd049b           [ 8]   jsr UpdateSound
                             
                               mTestFlag GameOverFlag
                            >  if 255>GameOverFlag
0075 : 96e5             [ 4]>    lda GameFlags1
0077 : 8540             [ 2]>    bita #GameOverFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(GameOverFlag)>>8
                            >  endif
                             
0079 : 2635             [ 3]   bne GameOver
                             
007b : bd29c5           [ 8]   jsr SetView
007e : bd2b18           [ 8]   jsr RefreshDrawList
                             
                               ;Wait for screen sync
                               ;DP is D0 after call to waitrecal
                               ;Keep DP at D0 for draw vector code
0081 : bdf192           [ 8]   jsr waitrecal
                             
0084 : bdf289           [ 8]   jsr UpdateSoundChip
0087 : bd2a7a           [ 8]   jsr DrawLevel
008a : bd0f13           [ 8]   jsr Ship_Draw
008d : bd2654           [ 8]   jsr DrawShipShots
0090 : bd1f0c           [ 8]   jsr DrawGuns
0093 : bd1dfa           [ 8]   jsr DrawFuel
0096 : bd070c           [ 8]   jsr DrawFx
0099 : bd1d8b           [ 8]   jsr DrawGunShots
009c : bd1e28           [ 8]   jsr DrawOrb
009f : bd1e46           [ 8]   jsr DrawPowerplant
00a2 : bd2c90           [ 8]   jsr DrawStars
00a5 : bd1fa8           [ 8]   jsr DrawDoors
00a8 : bd1f4b           [ 8]   jsr DrawSwitches
00ab : bd1a27           [ 8]   jsr DrawDisplay
                             
00ae : 20a6             [ 3]   bra MainLoop
                             
00b0 :                       GameOver:
00b0 : 96da             [ 4]   lda DemoMode                  ;do not display '
00b2 : 2b03             [ 3]   bmi maiIsDemo
00b4 : bd5139           [ 8]     jsr Text_GameOver
00b7 :                       maiIsDemo:
                             
                               direct -1
00b7 : 2088             [ 3]   bra Start
                             
                             
                             
                               direct $c8
                               include "clip.asm"
                             ; Line-clipping subroutine
                             ; Copyright (C) 2004  Ville Krumlinde
                             
                             ; This code was originally written in C and compi
                             
                             ;**optimize:
                             ;  byt ut s++ mot -2,s.
                             ;  byt ut jmp mot bra
                             ;  byt ut lbxx mot bxx
                             
                             
00b9 :                       _CohenSutherlandClip:
                             ;;;-----------------------------------------
                             ;;;  PROLOGUE for CohenSutherlandClip
                             ;;;-----------------------------------------
00b9 : 32e8e2           [ 5]         leas    -(30),s ; allocate auto variables
00bc : 3470             [11]         pshs    x,y,u   ;save registers
                             ;;;END PROLOGUE
00be : 6fe818           [ 7]         clr     24,s    ;clrqi 24,s
00c1 : aee826           [ 6]         ldx     38,s    ;movhi: 38,s -> R:x
00c4 : e680             [ 6]         ldb     ,x+     ;extendqihi: ,x+ -> R:d
00c6 : 1d               [ 2]         sex
00c7 : 1f03             [ 6]         tfr     d,u     ;movhi: R:d -> R:u
00c9 : afe826           [ 6]         stx     38,s    ;movhi: R:x -> 38,s
00cc : 335f             [ 5]         leau    -1,u    ;addhi: R:u = R:u + #-1
00ce : 1183ffff         [ 5]         cmpu    #-1     ;cmphi:
00d2 : 1027035a         [ 6]         lbeq    L37
00d6 :                       L38:
00d6 : aee826           [ 6]         ldx     38,s    ;movhi: 38,s -> R:x
00d9 : e680             [ 6]         ldb     ,x+     ;movqi: ,x+ -> R:b
00db : e7e819           [ 5]         stb     25,s    ;movqi: R:b -> 25,s
00de : e680             [ 6]         ldb     ,x+     ;extendqihi: ,x+ -> R:d
00e0 : 1d               [ 2]         sex
00e1 : e3e82a           [ 7]         addd    42,s    ;addhi: R:d += 42,s
00e4 : ede822           [ 6]         std     34,s    ;movhi: R:d -> 34,s
00e7 : e680             [ 6]         ldb     ,x+     ;extendqihi: ,x+ -> R:d
00e9 : 1d               [ 2]         sex
00ea : afe826           [ 6]         stx     38,s    ;movhi: R:x -> 38,s
00ed : 10aee82c         [ 7]         ldy     44,s    ;movhi: 44,s -> R:y
00f1 : 30ab             [ 8]         leax    d,y     ;addhi: R:x = R:y + R:d
00f3 : afe820           [ 6]         stx     32,s    ;movhi: R:x -> 32,s
00f6 : 10aee826         [ 7]         ldy     38,s    ;movhi: 38,s -> R:y
00fa : e6a0             [ 6]         ldb     ,y+     ;extendqihi: ,y+ -> R:d
00fc : 1d               [ 2]         sex
00fd : e3e82a           [ 7]         addd    42,s    ;addhi: R:d += 42,s
0100 : ede81e           [ 6]         std     30,s    ;movhi: R:d -> 30,s
0103 : e6a0             [ 6]         ldb     ,y+     ;extendqihi: ,y+ -> R:d
0105 : 1d               [ 2]         sex
0106 : 10afe826         [ 7]         sty     38,s    ;movhi: R:y -> 38,s
010a : e3e82c           [ 7]         addd    44,s    ;addhi: R:d += 44,s
010d : ede81c           [ 6]         std     28,s    ;movhi: R:d -> 28,s
0110 : 5f               [ 2]         clrb            ;clrqi REG:b
0111 : 9cd8             [ 6]         cmpx    _clip_ymax      ;cmphi:
0113 : 2f04             [ 3]         ble    L39
0115 : c601             [ 2]         ldb     #1      ;movqi: #1 -> R:b
0117 : 2006             [ 3]         bra     L40
0119 :                       L39:
0119 : 9cd4             [ 6]         cmpx    _clip_ymin      ;cmphi:
011b : 2c02             [ 3]         bge    L40
011d : c602             [ 2]         ldb     #2      ;movqi: #2 -> R:b
011f :                       L40:
011f : aee822           [ 6]         ldx     34,s    ;movhi: 34,s -> R:x
0122 : 109ed6           [ 6]         ldy     _clip_xmax      ;movhi: _clip_xma
0125 : 3420             [ 7]         pshs    y       ;cmphi: R:y with R:x
0127 : ace1             [ 9]         cmpx    ,s++    ;cmphi:
0129 : 2f04             [ 3]         ble    L42
012b : ca04             [ 2]         orb     #4      ;iorqi: b |= #4
012d : 2006             [ 3]         bra     L43
012f :                       L42:
012f : 9cd2             [ 6]         cmpx    _clip_xmin      ;cmphi:
0131 : 2c02             [ 3]         bge    L43
0133 : ca08             [ 2]         orb     #8      ;iorqi: b |= #8
0135 :                       L43:
0135 : e7e81b           [ 5]         stb     27,s    ;movqi: R:b -> 27,s
0138 : 5f               [ 2]         clrb            ;clrqi REG:b
0139 : aee81c           [ 6]         ldx     28,s    ;movhi: 28,s -> R:x
013c : 9cd8             [ 6]         cmpx    _clip_ymax      ;cmphi:
013e : 2f04             [ 3]         ble    L46
0140 : c601             [ 2]         ldb     #1      ;movqi: #1 -> R:b
0142 : 2006             [ 3]         bra     L47
0144 :                       L46:
0144 : 9cd4             [ 6]         cmpx    _clip_ymin      ;cmphi:
0146 : 2c02             [ 3]         bge    L47
0148 : c602             [ 2]         ldb     #2      ;movqi: #2 -> R:b
014a :                       L47:
014a : aee81e           [ 6]         ldx     30,s    ;movhi: 30,s -> R:x
014d : 3420             [ 7]         pshs    y       ;cmphi: R:y with R:x
014f : ace1             [ 9]         cmpx    ,s++    ;cmphi:
0151 : 2f04             [ 3]         ble    L49
0153 : ca04             [ 2]         orb     #4      ;iorqi: b |= #4
0155 : 2006             [ 3]         bra     L50
0157 :                       L49:
0157 : 9cd2             [ 6]         cmpx    _clip_xmin      ;cmphi:
0159 : 2c02             [ 3]         bge    L50
015b : ca08             [ 2]         orb     #8      ;iorqi: b |= #8
015d :                       L50:
015d : e7e81a           [ 5]         stb     26,s    ;movqi: R:b -> 26,s
0160 : 305f             [ 5]         leax    -1,u    ;addhi: R:x = R:u + #-1
0162 : af66             [ 6]         stx     6,s     ;movhi: R:x -> 6,s
0164 : 7e03d3           [ 4]         jmp     L53
0167 :                       L56:
0167 : e6e81b           [ 5]         ldb     27,s    ;movqi: 27,s -> R:b
016a : e4e81a           [ 5]         andb    26,s    ;andqi: R:b &= 26,s
016d : 5d               [ 2]         tstb            ;tstqi: R:b
016e : 102602b4         [ 6]         lbne    L36
0172 : 6de81b           [ 7]         tst     27,s    ;tstqi: MEM:27,s
0175 : 10270133         [ 6]         lbeq    L58
0179 : 31e822           [ 5]         leay    34,s    ;addhi: R:y = R:s + #34
017c : 10afe812         [ 7]         sty     18,s    ;movhi: R:y -> 18,s
0180 : 30e820           [ 5]         leax    32,s    ;addhi: R:x = R:s + #32
0183 : afe810           [ 6]         stx     16,s    ;movhi: R:x -> 16,s
0186 : e6e819           [ 5]         ldb     25,s    ;movqi: 25,s -> R:b
0189 : c101             [ 2]         cmpb    #1      ;cmpqi:
018b : 272c             [ 3]         beq    L59
018d : 2e06             [ 3]         bgt    L60
018f : 5d               [ 2]         tstb            ;tstqi: R:b
0190 : 270d             [ 3]         beq    L61
0192 : 7e0280           [ 4]         jmp     L83
0195 :                       L60:
0195 : e6e819           [ 5]         ldb     25,s    ;movqi: 25,s -> R:b
0198 : c102             [ 2]         cmpb    #2      ;cmpqi:
019a : 2737             [ 3]         beq    L63
019c : 7e0280           [ 4]         jmp     L83
019f :                       L61:
019f : e6e81b           [ 5]         ldb     27,s    ;movqi: 27,s -> R:b
01a2 : c401             [ 2]         andb    #1      ;andqi: R:b &= #1
01a4 : 5d               [ 2]         tstb            ;tstqi: R:b
01a5 : 2706             [ 3]         beq    L64
01a7 : 109ed8           [ 6]         ldy     _clip_ymax      ;movhi: _clip_yma
01aa : 200412           [ 3]         jmp     L126
01ad :                       L64:
01ad : 109ed4           [ 6]         ldy     _clip_ymin      ;movhi: _clip_ymi
01b0 :                       L126:
01b0 : aee810           [ 6]         ldx     16,s    ;movhi: 16,s -> R:x
01b3 : 10af84           [ 6]         sty     ,x      ;movhi: R:y -> ,x
01b6 : 7e0280           [ 4]         jmp     L83
01b9 :                       L59:
01b9 : e6e81b           [ 5]         ldb     27,s    ;movqi: 27,s -> R:b
01bc : c404             [ 2]         andb    #4      ;andqi: R:b &= #4
01be : 5d               [ 2]         tstb            ;tstqi: R:b
01bf : 2706             [ 3]         beq    L66
01c1 : 109ed6           [ 6]         ldy     _clip_xmax      ;movhi: _clip_xma
01c4 : 200412           [ 3]         jmp     L127
01c7 :                       L66:
01c7 : 109ed2           [ 6]         ldy     _clip_xmin      ;movhi: _clip_xmi
01ca :                       L127:
01ca : aee812           [ 6]         ldx     18,s    ;movhi: 18,s -> R:x
01cd : 10af84           [ 6]         sty     ,x      ;movhi: R:y -> ,x
01d0 : 7e0280           [ 4]         jmp     L83
01d3 :                       L63:
01d3 : e6e81b           [ 5]         ldb     27,s    ;movqi: 27,s -> R:b
01d6 : c401             [ 2]         andb    #1      ;andqi: R:b &= #1
01d8 : 5d               [ 2]         tstb            ;tstqi: R:b
01d9 : 272e             [ 3]         beq    L68
01db : aee810           [ 6]         ldx     16,s    ;movhi: 16,s -> R:x
01de : ec84             [ 5]         ldd     ,x      ;movhi: ,x -> R:d
01e0 : ded8             [ 5]         ldu     _clip_ymax      ;movhi: _clip_yma
01e2 : 3440             [ 7]         pshs    u       ;subhi: R:d -= R:u
01e4 : a3e1             [ 9]         subd    ,s++
                                                     ;ashlhi: d by #1
01e6 : 58               [ 2]         aslb
01e7 : 49               [ 2]         rola
01e8 : 1f02             [ 6]         tfr     d,y     ;movhi: R:d -> R:y
01ea : aee812           [ 6]         ldx     18,s    ;movhi: 18,s -> R:x
01ed : ec84             [ 5]         ldd     ,x      ;movhi: ,x -> R:d
01ef : 30ab             [ 8]         leax    d,y     ;addhi: R:x = R:y + R:d
01f1 : 10a3e81e         [ 8]         cmpd    30,s    ;cmphi:
01f5 : 2d06             [ 3]         blt    L69
01f7 : 3420             [ 7]         pshs    y       ;subhi: R:d -= R:y
01f9 : a3e1             [ 9]         subd    ,s++
01fb : 1f01             [ 6]         tfr     d,x     ;movhi: R:d -> R:x
01fd :                       L69:
01fd : 10aee812         [ 7]         ldy     18,s    ;movhi: 18,s -> R:y
0201 : afa4             [ 5]         stx     ,y      ;movhi: R:x -> ,y
0203 : aee810           [ 6]         ldx     16,s    ;movhi: 16,s -> R:x
0206 : 207612           [ 3]         jmp     L128
0209 :                       L68:
0209 : e6e81b           [ 5]         ldb     27,s    ;movqi: 27,s -> R:b
020c : c402             [ 2]         andb    #2      ;andqi: R:b &= #2
020e : 5d               [ 2]         tstb            ;tstqi: R:b
020f : 272d             [ 3]         beq    L72
0211 : ded4             [ 5]         ldu     _clip_ymin      ;movhi: _clip_ymi
0213 : 1f30             [ 6]         tfr     u,d     ;movhi: R:u -> R:d
0215 : 10aee810         [ 7]         ldy     16,s    ;movhi: 16,s -> R:y
0219 : a3a4             [ 6]         subd    ,y      ;subhi: R:d -= ,y
                                                     ;ashlhi: d by #1
021b : 58               [ 2]         aslb
021c : 49               [ 2]         rola
021d : 1f02             [ 6]         tfr     d,y     ;movhi: R:d -> R:y
021f : aee812           [ 6]         ldx     18,s    ;movhi: 18,s -> R:x
0222 : ec84             [ 5]         ldd     ,x      ;movhi: ,x -> R:d
0224 : 30ab             [ 8]         leax    d,y     ;addhi: R:x = R:y + R:d
0226 : 10a3e81e         [ 8]         cmpd    30,s    ;cmphi:
022a : 2d06             [ 3]         blt    L73
022c : 3420             [ 7]         pshs    y       ;subhi: R:d -= R:y
022e : a3e1             [ 9]         subd    ,s++
0230 : 1f01             [ 6]         tfr     d,x     ;movhi: R:d -> R:x
0232 :                       L73:
0232 : 10aee812         [ 7]         ldy     18,s    ;movhi: 18,s -> R:y
0236 : afa4             [ 5]         stx     ,y      ;movhi: R:x -> ,y
0238 : aee810           [ 6]         ldx     16,s    ;movhi: 16,s -> R:x
023b : 204112           [ 3]         jmp     L128
023e :                       L72:
023e : e6e81b           [ 5]         ldb     27,s    ;movqi: 27,s -> R:b
0241 : c404             [ 2]         andb    #4      ;andqi: R:b &= #4
0243 : 5d               [ 2]         tstb            ;tstqi: R:b
0244 : 270e             [ 3]         beq    L75
0246 : 10aee812         [ 7]         ldy     18,s    ;movhi: 18,s -> R:y
024a : eca4             [ 5]         ldd     ,y      ;movhi: ,y -> R:d
024c : ded6             [ 5]         ldu     _clip_xmax      ;movhi: _clip_xma
024e : 3440             [ 7]         pshs    u       ;subhi: R:d -= R:u
0250 : a3e1             [ 9]         subd    ,s++
0252 : 200a             [ 3]         bra     L132
0254 :                       L75:
0254 : ded2             [ 5]         ldu     _clip_xmin      ;movhi: _clip_xmi
0256 : 1f30             [ 6]         tfr     u,d     ;movhi: R:u -> R:d
0258 : 10aee812         [ 7]         ldy     18,s    ;movhi: 18,s -> R:y
025c : a3a4             [ 6]         subd    ,y      ;subhi: R:d -= ,y
025e :                       L132:
                                                     ;ashrhi: d by #1
025e : 47               [ 2]         asra
025f : 56               [ 2]         rorb
0260 : 1f02             [ 6]         tfr     d,y     ;movhi: R:d -> R:y
0262 : aee810           [ 6]         ldx     16,s    ;movhi: 16,s -> R:x
0265 : ec84             [ 5]         ldd     ,x      ;movhi: ,x -> R:d
0267 : 30ab             [ 8]         leax    d,y     ;addhi: R:x = R:y + R:d
0269 : 10a3e81c         [ 8]         cmpd    28,s    ;cmphi:
026d : 2d06             [ 3]         blt    L78
026f : 3420             [ 7]         pshs    y       ;subhi: R:d -= R:y
0271 : a3e1             [ 9]         subd    ,s++
0273 : 1f01             [ 6]         tfr     d,x     ;movhi: R:d -> R:x
0275 :                       L78:
0275 : 10aee810         [ 7]         ldy     16,s    ;movhi: 16,s -> R:y
0279 : afa4             [ 5]         stx     ,y      ;movhi: R:x -> ,y
027b : aee812           [ 6]         ldx     18,s    ;movhi: 18,s -> R:x
027e :                       L128:
027e : ef84             [ 5]         stu     ,x      ;movhi: R:u -> ,x
0280 :                       L83:
0280 : 10aee822         [ 7]         ldy     34,s    ;movhi: 34,s -> R:y
0284 : aee820           [ 6]         ldx     32,s    ;movhi: 32,s -> R:x
0287 : 5f               [ 2]         clrb            ;clrqi REG:b
0288 : 9cd8             [ 6]         cmpx    _clip_ymax      ;cmphi:
028a : 2f04             [ 3]         ble    L84
028c : c601             [ 2]         ldb     #1      ;movqi: #1 -> R:b
028e : 2006             [ 3]         bra     L85
0290 :                       L84:
0290 : 9cd4             [ 6]         cmpx    _clip_ymin      ;cmphi:
0292 : 2c02             [ 3]         bge    L85
0294 : c602             [ 2]         ldb     #2      ;movqi: #2 -> R:b
0296 :                       L85:
0296 : 109cd6           [ 7]         cmpy    _clip_xmax      ;cmphi:
0299 : 2f04             [ 3]         ble    L87
029b : ca04             [ 2]         orb     #4      ;iorqi: b |= #4
029d : 2007             [ 3]         bra     L88
029f :                       L87:
029f : 109cd2           [ 7]         cmpy    _clip_xmin      ;cmphi:
02a2 : 2c02             [ 3]         bge    L88
02a4 : ca08             [ 2]         orb     #8      ;iorqi: b |= #8
02a6 :                       L88:
02a6 : e7e81b           [ 5]         stb     27,s    ;movqi: R:b -> 27,s
02a9 : 7e03d3           [ 4]         jmp     L53
02ac :                       L58:
02ac : 31e81e           [ 5]         leay    30,s    ;addhi: R:y = R:s + #30
02af : 10af6e           [ 7]         sty     14,s    ;movhi: R:y -> 14,s
02b2 : 30e81c           [ 5]         leax    28,s    ;addhi: R:x = R:s + #28
02b5 : af6c             [ 6]         stx     12,s    ;movhi: R:x -> 12,s
02b7 : 10aee822         [ 7]         ldy     34,s    ;movhi: 34,s -> R:y
02bb : 10af6a           [ 7]         sty     10,s    ;movhi: R:y -> 10,s
02be : ece820           [ 6]         ldd     32,s    ;movhi: 32,s -> R:d
02c1 : ed68             [ 6]         std     8,s     ;movhi: R:d -> 8,s
02c3 : e6e819           [ 5]         ldb     25,s    ;movqi: 25,s -> R:b
02c6 : c101             [ 2]         cmpb    #1      ;cmpqi:
02c8 : 272b             [ 3]         beq    L92
02ca : 2e06             [ 3]         bgt    L93
02cc : 5d               [ 2]         tstb            ;tstqi: R:b
02cd : 270d             [ 3]         beq    L94
02cf : 7e03aa           [ 4]         jmp     L116
02d2 :                       L93:
02d2 : e6e819           [ 5]         ldb     25,s    ;movqi: 25,s -> R:b
02d5 : c102             [ 2]         cmpb    #2      ;cmpqi:
02d7 : 2734             [ 3]         beq    L96
02d9 : 7e03aa           [ 4]         jmp     L116
02dc :                       L94:
02dc : e6e81a           [ 5]         ldb     26,s    ;movqi: 26,s -> R:b
02df : c401             [ 2]         andb    #1      ;andqi: R:b &= #1
02e1 : 5d               [ 2]         tstb            ;tstqi: R:b
02e2 : 2706             [ 3]         beq    L97
02e4 : 109ed8           [ 6]         ldy     _clip_ymax      ;movhi: _clip_yma
02e7 : 200412           [ 3]         jmp     L129
02ea :                       L97:
02ea : 109ed4           [ 6]         ldy     _clip_ymin      ;movhi: _clip_ymi
02ed :                       L129:
02ed : ae6c             [ 6]         ldx     12,s    ;movhi: 12,s -> R:x
02ef : 10af84           [ 6]         sty     ,x      ;movhi: R:y -> ,x
02f2 : 7e03aa           [ 4]         jmp     L116
02f5 :                       L92:
02f5 : e6e81a           [ 5]         ldb     26,s    ;movqi: 26,s -> R:b
02f8 : c404             [ 2]         andb    #4      ;andqi: R:b &= #4
02fa : 5d               [ 2]         tstb            ;tstqi: R:b
02fb : 2705             [ 3]         beq    L99
02fd : 109ed6           [ 6]         ldy     _clip_xmax      ;movhi: _clip_xma
0300 : 2003             [ 3]         bra     L130
0302 :                       L99:
0302 : 109ed2           [ 6]         ldy     _clip_xmin      ;movhi: _clip_xmi
0305 :                       L130:
0305 : ae6e             [ 6]         ldx     14,s    ;movhi: 14,s -> R:x
0307 : 10af84           [ 6]         sty     ,x      ;movhi: R:y -> ,x
030a : 7e03aa           [ 4]         jmp     L116
030d :                       L96:
030d : e6e81a           [ 5]         ldb     26,s    ;movqi: 26,s -> R:b
0310 : c401             [ 2]         andb    #1      ;andqi: R:b &= #1
0312 : 5d               [ 2]         tstb            ;tstqi: R:b
0313 : 2729             [ 3]         beq    L101
0315 : ae6c             [ 6]         ldx     12,s    ;movhi: 12,s -> R:x
0317 : ec84             [ 5]         ldd     ,x      ;movhi: ,x -> R:d
0319 : ded8             [ 5]         ldu     _clip_ymax      ;movhi: _clip_yma
031b : 3440             [ 7]         pshs    u       ;subhi: R:d -= R:u
031d : a3e1             [ 9]         subd    ,s++
                                                     ;ashlhi: d by #1
031f : 58               [ 2]         aslb
0320 : 49               [ 2]         rola
0321 : 1f02             [ 6]         tfr     d,y     ;movhi: R:d -> R:y
0323 : ae6e             [ 6]         ldx     14,s    ;movhi: 14,s -> R:x
0325 : ec84             [ 5]         ldd     ,x      ;movhi: ,x -> R:d
0327 : 30ab             [ 8]         leax    d,y     ;addhi: R:x = R:y + R:d
0329 : 10a36a           [ 8]         cmpd    10,s    ;cmphi:
032c : 2d06             [ 3]         blt    L102
032e : 3420             [ 7]         pshs    y       ;subhi: R:d -= R:y
0330 : a3e1             [ 9]         subd    ,s++
0332 : 1f01             [ 6]         tfr     d,x     ;movhi: R:d -> R:x
0334 :                       L102:
0334 : 10ae6e           [ 7]         ldy     14,s    ;movhi: 14,s -> R:y
0337 : afa4             [ 5]         stx     ,y      ;movhi: R:x -> ,y
0339 : ae6c             [ 6]         ldx     12,s    ;movhi: 12,s -> R:x
033b : 206b12           [ 3]         jmp     L131
033e :                       L101:
033e : e6e81a           [ 5]         ldb     26,s    ;movqi: 26,s -> R:b
0341 : c402             [ 2]         andb    #2      ;andqi: R:b &= #2
0343 : 5d               [ 2]         tstb            ;tstqi: R:b
0344 : 2728             [ 3]         beq    L105
0346 : ded4             [ 5]         ldu     _clip_ymin      ;movhi: _clip_ymi
0348 : 1f30             [ 6]         tfr     u,d     ;movhi: R:u -> R:d
034a : 10ae6c           [ 7]         ldy     12,s    ;movhi: 12,s -> R:y
034d : a3a4             [ 6]         subd    ,y      ;subhi: R:d -= ,y
                                                     ;ashlhi: d by #1
034f : 58               [ 2]         aslb
0350 : 49               [ 2]         rola
0351 : 1f02             [ 6]         tfr     d,y     ;movhi: R:d -> R:y
0353 : ae6e             [ 6]         ldx     14,s    ;movhi: 14,s -> R:x
0355 : ec84             [ 5]         ldd     ,x      ;movhi: ,x -> R:d
0357 : 30ab             [ 8]         leax    d,y     ;addhi: R:x = R:y + R:d
0359 : 10a36a           [ 8]         cmpd    10,s    ;cmphi:
035c : 2d06             [ 3]         blt    L106
035e : 3420             [ 7]         pshs    y       ;subhi: R:d -= R:y
0360 : a3e1             [ 9]         subd    ,s++
0362 : 1f01             [ 6]         tfr     d,x     ;movhi: R:d -> R:x
0364 :                       L106:
0364 : 10ae6e           [ 7]         ldy     14,s    ;movhi: 14,s -> R:y
0367 : afa4             [ 5]         stx     ,y      ;movhi: R:x -> ,y
0369 : ae6c             [ 6]         ldx     12,s    ;movhi: 12,s -> R:x
036b : 203b12           [ 3]         jmp     L131
036e :                       L105:
036e : e6e81a           [ 5]         ldb     26,s    ;movqi: 26,s -> R:b
0371 : c404             [ 2]         andb    #4      ;andqi: R:b &= #4
0373 : 5d               [ 2]         tstb            ;tstqi: R:b
0374 : 270d             [ 3]         beq    L108
0376 : 10ae6e           [ 7]         ldy     14,s    ;movhi: 14,s -> R:y
0379 : eca4             [ 5]         ldd     ,y      ;movhi: ,y -> R:d
037b : ded6             [ 5]         ldu     _clip_xmax      ;movhi: _clip_xma
037d : 3440             [ 7]         pshs    u       ;subhi: R:d -= R:u
037f : a3e1             [ 9]         subd    ,s++
0381 : 2009             [ 3]         bra     L133
0383 :                       L108:
0383 : ded2             [ 5]         ldu     _clip_xmin      ;movhi: _clip_xmi
0385 : 1f30             [ 6]         tfr     u,d     ;movhi: R:u -> R:d
0387 : 10ae6e           [ 7]         ldy     14,s    ;movhi: 14,s -> R:y
038a : a3a4             [ 6]         subd    ,y      ;subhi: R:d -= ,y
038c :                       L133:
                                                     ;ashrhi: d by #1
038c : 47               [ 2]         asra
038d : 56               [ 2]         rorb
038e : 1f02             [ 6]         tfr     d,y     ;movhi: R:d -> R:y
0390 : ae6c             [ 6]         ldx     12,s    ;movhi: 12,s -> R:x
0392 : ec84             [ 5]         ldd     ,x      ;movhi: ,x -> R:d
0394 : 30ab             [ 8]         leax    d,y     ;addhi: R:x = R:y + R:d
0396 : 10a368           [ 8]         cmpd    8,s     ;cmphi:
0399 : 2d06             [ 3]         blt    L111
039b : 3420             [ 7]         pshs    y       ;subhi: R:d -= R:y
039d : a3e1             [ 9]         subd    ,s++
039f : 1f01             [ 6]         tfr     d,x     ;movhi: R:d -> R:x
03a1 :                       L111:
03a1 : 10ae6c           [ 7]         ldy     12,s    ;movhi: 12,s -> R:y
03a4 : afa4             [ 5]         stx     ,y      ;movhi: R:x -> ,y
03a6 : ae6e             [ 6]         ldx     14,s    ;movhi: 14,s -> R:x
03a8 :                       L131:
03a8 : ef84             [ 5]         stu     ,x      ;movhi: R:u -> ,x
03aa :                       L116:
03aa : 10aee81e         [ 7]         ldy     30,s    ;movhi: 30,s -> R:y
03ae : aee81c           [ 6]         ldx     28,s    ;movhi: 28,s -> R:x
03b1 : 5f               [ 2]         clrb            ;clrqi REG:b
03b2 : 9cd8             [ 6]         cmpx    _clip_ymax      ;cmphi:
03b4 : 2f04             [ 3]         ble    L117
03b6 : c601             [ 2]         ldb     #1      ;movqi: #1 -> R:b
03b8 : 2006             [ 3]         bra     L118
03ba :                       L117:
03ba : 9cd4             [ 6]         cmpx    _clip_ymin      ;cmphi:
03bc : 2c02             [ 3]         bge    L118
03be : c602             [ 2]         ldb     #2      ;movqi: #2 -> R:b
03c0 :                       L118:
03c0 : 109cd6           [ 7]         cmpy    _clip_xmax      ;cmphi:
03c3 : 2f04             [ 3]         ble    L120
03c5 : ca04             [ 2]         orb     #4      ;iorqi: b |= #4
03c7 : 2007             [ 3]         bra     L121
03c9 :                       L120:
03c9 : 109cd2           [ 7]         cmpy    _clip_xmin      ;cmphi:
03cc : 2c02             [ 3]         bge    L121
03ce : ca08             [ 2]         orb     #8      ;iorqi: b |= #8
03d0 :                       L121:
03d0 : e7e81a           [ 5]         stb     26,s    ;movqi: R:b -> 26,s
03d3 :                       L53:
03d3 : e6e81b           [ 5]         ldb     27,s    ;movqi: 27,s -> R:b
03d6 : eae81a           [ 5]         orb     26,s    ;iorqi: b |= 26,s
03d9 : 5d               [ 2]         tstb            ;tstqi: R:b
03da : 1026fd89         [ 6]         lbne    L56
03de : ece822           [ 6]         ldd     34,s    ;movhi: 34,s -> R:d
03e1 : 93d2             [ 6]         subd    _clip_xmin      ;subhi: R:d -= _c
03e3 : ede816           [ 6]         std     22,s    ;movhi: R:d -> 22,s
03e6 : dcd4             [ 5]         ldd     _clip_ymin      ;movhi: _clip_ymi
03e8 : a3e820           [ 7]         subd    32,s    ;subhi: R:d -= 32,s
03eb : ede814           [ 6]         std     20,s    ;movhi: R:d -> 20,s
03ee : aee828           [ 6]         ldx     40,s    ;movhi: 40,s -> R:x
03f1 : c6ff             [ 2]         ldb     #-1     ;movqi: #-1 -> R:b
03f3 : e780             [ 6]         stb     ,x+     ;movqi: R:b -> ,x+
03f5 : e6e815           [ 5]         ldb     21,s    ;movlsbqihi: 20,s -> R:b 
03f8 : cb7f             [ 2]         addb    #127    ;addqi: R:b += #127
03fa : e780             [ 6]         stb     ,x+     ;movqi: R:b -> ,x+
03fc : e6e817           [ 5]         ldb     23,s    ;movlsbqihi: 22,s -> R:b 
03ff : cb80             [ 2]         addb    #-128   ;addqi: R:b += #-128
0401 : e780             [ 6]         stb     ,x+     ;movqi: R:b -> ,x+
0403 : c601             [ 2]         ldb     #1      ;movqi: #1 -> R:b
0405 : e780             [ 6]         stb     ,x+     ;movqi: R:b -> ,x+
0407 : dcd4             [ 5]         ldd     _clip_ymin      ;movhi: _clip_ymi
0409 : a3e81c           [ 7]         subd    28,s    ;subhi: R:d -= 28,s
040c : a3e814           [ 7]         subd    20,s    ;subhi: R:d -= 20,s
040f : e780             [ 6]         stb     ,x+     ;movqi: R:b -> ,x+
0411 : ece81e           [ 6]         ldd     30,s    ;movhi: 30,s -> R:d
0414 : 93d2             [ 6]         subd    _clip_xmin      ;subhi: R:d -= _c
0416 : a3e816           [ 7]         subd    22,s    ;subhi: R:d -= 22,s
0419 : e780             [ 6]         stb     ,x+     ;movqi: R:b -> ,x+
041b : afe828           [ 6]         stx     40,s    ;movhi: R:x -> 40,s
041e : e6e818           [ 5]         ldb     24,s    ;movqi: 24,s -> R:b
0421 : cb06             [ 2]         addb    #6      ;addqi: R:b += #6
0423 : e7e818           [ 5]         stb     24,s    ;movqi: R:b -> 24,s
0426 :                       L36:
0426 : ee66             [ 6]         ldu     6,s     ;movhi: 6,s -> R:u
0428 : 1183ffff         [ 5]         cmpu    #-1     ;cmphi:
042c : 1026fca6         [ 6]         lbne    L38
0430 :                       L37:
0430 : e6e818           [ 5]         ldb     24,s    ;extendqihi: 24,s -> R:d
0433 : 1d               [ 2]         sex
                             ;;;EPILOGUE
0434 : 3570             [11]         puls    x,y,u   ;restore registers
0436 : 32e81e           [ 5]         leas    30,s    ; deallocate auto variabl
0439 : 39               [ 5]         rts             ; return from function
                             ;;;-----------------------------------------
                             ;;; END EPILOGUE for CohenSutherlandClip
                             ;;;-----------------------------------------
                             
                               direct -1
                             
                               include "Thrust_Sound.asm"
                             ; Thrust sound effects
                             ; Copyright (C) 2004  Ville Krumlinde
                             
                             ;   todo: anropa init_music_buf samtidigt som lev
                             ;     ResetSounds, nullar buffer, sätter mixer ti
                             ;
                             ;dåligt
                             ;  vad är fel med current solution?
                             ;  två ljud kan inte dela channel
                             ;
                             ;Sound_Thrust_Init
                             ;  sätter mixers
                             ;  sätter timer
                             ;Sound_Thrust_Update
                             ;  sätter ljudreg
                             ;
                             ;ideer
                             ;  freq baserat på sinus
                             ;  arpeggio baserat på sinus
                             ;  vibrato baserat på sinus
                             ;
                             ;  slå på/av vibrato/arpeggio
                             ;    källor: frame tictoc, sinus
                             ;
                             ;  random changes
                             
                             
                             
c800 =                       SoundShadow equ $C800                   ;current 
c83f =                       SoundWork equ $C83F                     ;current 
                             
                             
                             ;Use frequency-table from Thrust_Music.asm
0018 =                       Octave = 24
0008 =                       OctaveCount = 8
7261 =                       FreqTable = L059582
                             
                             
                             mSoundId macro id,slot,name
                             name = (id << 2) | slot
                              endm
                             
                             ;This is a bit clumsy:
                             ; - changing id (priority) also means having to s
                             ; - changing slot (channel) also means having to 
                              mSoundId 1,2,ThrustSoundId
0006 =                      >ThrustSoundId = (1 << 2) | 2
                             
                              mSoundId 14,2,WalkerDestroyedSoundId
003a =                      >WalkerDestroyedSoundId = (14 << 2) | 2
                             
                             
                              mSoundId 2,0,GunFireSoundId
0008 =                      >GunFireSoundId = (2 << 2) | 0
                             
                              mSoundId 3,0,ShipFireSoundId
000c =                      >ShipFireSoundId = (3 << 2) | 0
                             
                              mSoundId 4,0,ExtraLifeSoundId
0010 =                      >ExtraLifeSoundId = (4 << 2) | 0
                             
                             
                              mSoundId 5,1,WalkerBounceSoundId
0015 =                      >WalkerBounceSoundId = (5 << 2) | 1
                             
                              mSoundId 6,1,ShieldSoundId
0019 =                      >ShieldSoundId = (6 << 2) | 1
                             
                              mSoundId 7,1,WarpOutSoundId
001d =                      >WarpOutSoundId = (7 << 2) | 1
                             
                              mSoundId 8,1,ExplosionSoundId
0021 =                      >ExplosionSoundId = (8 << 2) | 1
                             
                              mSoundId 9,1,PickupSoundId
0025 =                      >PickupSoundId = (9 << 2) | 1
                             
                              mSoundId 10,1,WarpInSoundId
0029 =                      >WarpInSoundId = (10 << 2) | 1
                             
                              mSoundId 11,1,CountdownSoundId
002d =                      >CountdownSoundId = (11 << 2) | 1
                             
                              mSoundId 12,1,PlanetExplodeSoundId
0031 =                      >PlanetExplodeSoundId = (12 << 2) | 1
                             
                              mSoundId 13,1,PerfectBonusSoundId
0035 =                      >PerfectBonusSoundId = (13 << 2) | 1
                             
                             
                             
043a :                       SoundsTable:
043a : 0000                    dw 0                  ;0 is unused
043c : 04dd                    dw Sound_Thrust
043e : 0591                    dw Sound_GunFire
0440 : 04ef                    dw Sound_ShipFire
0442 : 0646                    dw Sound_ExtraLife
0444 : 04c9                    dw Sound_Dummy        ;bounce
0446 : 0554                    dw Sound_Shield
0448 : 05a1                    dw Sound_WarpOut
044a : 051b                    dw Sound_Explosion
044c : 0565                    dw Sound_Pickup
044e : 05b5                    dw Sound_WarpIn
0450 : 06aa                    dw Sound_Countdown
0452 : 05dd                    dw Sound_PlanetExplode
0454 : 0605                    dw Sound_PerfectBonus
0456 : 0682                    dw Sound_WalkerDestroyed
                             
0458 :                       SoundsInitTable:
0458 : 0000                    dw 0                  ;0 is unused
045a : 04ca                    dw Sound_Thrust_Init
045c : 0572                    dw Sound_GunFire_Init
045e : 04e2                    dw Sound_ShipFire_Init
0460 : 063b                    dw Sound_ExtraLife_Init
0462 : 0655                    dw Sound_WalkerBounce_Init
0464 : 0523                    dw Sound_Shield_Init
0466 : 0592                    dw Sound_WarpOut_Init
0468 : 0504                    dw Sound_Explosion_Init
046a : 0555                    dw Sound_Pickup_Init
046c : 05a6                    dw Sound_WarpIn_Init
046e : 069b                    dw Sound_Countdown_Init
0470 : 05ce                    dw Sound_PlanetExplode_Init
0472 : 05f8                    dw Sound_PerfectBonus_Init
0474 : 0673                    dw Sound_WalkerDestroyed_Init
                             
                             ;Emit sound, all registers except D are preserved
                             mEmitSound macro SoundId
                               if \0=1
                                 lda #SoundId
                               endif
                               jsr EmitSound
                               endm
                             
                             
                             ;*****************
0476 :                       EmitSound:
0476 : 3470             [11]   pshs x,y,u
                             
0478 : 1f89             [ 6]   tfr a,b
                             
047a : 8403             [ 2]   anda #3
047c : 48               [ 2]   lsla
047d : 54               [ 2]   lsrb
047e : c4fe             [ 2]   andb #254
                               ;a=slot*2, b=sound id * 2
                             
0480 : 8ec940           [ 3]   ldx #SoundSlots
0483 : 6d86             [ 7]   tst a,x
0485 : 2704             [ 3]   beq esOkEmit          ;slot is free
0487 : e186             [ 5]   cmpb a,x              ;slot busy, test priority
0489 : 250e             [ 3]   blo esExit
                             
048b :                       esOkEmit:
048b : e786             [ 5]   stb a,x
                             
048d : 3186             [ 5]   leay a,x
                               ;y=sound slot
                             
048f : ce0458           [ 3]   ldu #SoundsInitTable
0492 : 8ec83f           [ 3]   ldx #SoundWork
0495 : add5             [11]   jsr [b,u]
0497 : a721             [ 5]   sta 1,y               ;set timer
                             
0499 :                       esExit:
                             
0499 : 35f0             [13]   puls x,y,u,pc
                             ;  rts
                             
                             
                             ;*****************
049b :                       UpdateSound:
                               direct $c8
049b : 8ec83f           [ 3]   ldx #SoundWork
049e : cec944           [ 3]   ldu #SoundSlots + ((SlotCount-1)*2)
04a1 : 8603             [ 2]   lda #SlotCount
04a3 :                       usLop1:
04a3 : e6c4             [ 4]   ldb ,u                ;b=sound id * 2
04a5 : 271d             [ 3]   beq usNext
                             
04a7 : 6a41             [ 7]   dec 1,u               ;decrease time
04a9 : 270e             [ 3]   beq usSoundFin
                             
04ab : 3442             [ 8]   pshs a,u
                             
04ad : a641             [ 5]   lda 1,u               ;a=timer
                             
04af : 108e043a         [ 4]   ldy #SoundsTable
04b3 : adb5             [11]   jsr [b,y]
                             
04b5 : 3542             [ 8]   puls a,u
                             
04b7 : 200b             [ 3]   bra usNext
                             
04b9 :                       usSoundFin:
04b9 : 6fc4             [ 6]   clr ,u                ;make slot empty
04bb : 1f89             [ 6]   tfr a,b
                             
04bd : cb07             [ 2]   addb #7
04bf : 50               [ 2]   negb
04c0 : cb0d             [ 2]   addb #$d              ;b=this channels volume r
04c2 : 6f85             [ 7]   clr b,x               ;clear volume
                             
04c4 :                       usNext:
04c4 : 335e             [ 5]   leau -2,u
04c6 : 4a               [ 2]   deca
04c7 : 26da             [ 3]   bne usLop1
                               direct -1
04c9 :                       Sound_Dummy:
04c9 : 39               [ 5]   rts
                             
                             
                             ;*****************
f289 =                       UpdateSoundChip = $f289
                             
                             
                             ;*****************
                             ;Sound-routines
                             ;Separate sound-function for each soundid
                             ;*****************
                             
                             ;SoundWork have the registers reversed
000d =                       RegPitchA1 = $d - 0
000c =                       RegPitchA2 = $d - 1
000b =                       RegPitchB1 = $d - 2
000a =                       RegPitchB2 = $d - 3
0009 =                       RegPitchC1 = $d - 4
0008 =                       RegPitchC2 = $d - 5
0007 =                       RegNoisePitch = $d - 6
0006 =                       RegMixer =      $d - 7
0005 =                       RegVolA = $d - 8
0004 =                       RegVolB = $d - 9
0003 =                       RegVolC = $d - 10
                             
0001 =                       MixerToneA = 1
0002 =                       MixerToneB = 2
0004 =                       MixerToneC = 4
0008 =                       MixerNoiseA = 8
0010 =                       MixerNoiseB = 16
0020 =                       MixerNoiseC = 32
                             
                             ;x must point to sound regs
                             mMixerOn macro flag
                              lda #~flag
                              anda RegMixer,x
                              sta RegMixer,x
                              endm
                             
                             ;x must point to sound regs
                             mMixerOff macro flag
                              lda #flag
                              ora RegMixer,x
                              sta RegMixer,x
                              endm
                             
                             ;x must point to sound regs
                             mMixerOnOff macro onbit,offbit
                              lda #~onbit
                              anda RegMixer,x
                              ora #offbit
                              sta RegMixer,x
                              endm
                             
                             ;x must point to sound regs
                             mSound macro reg,value
                              if \0>1
                                lda #value
                              endif
                              sta reg,x
                              endm
                             
04ca :                       Sound_Thrust_Init:   ;return start time in A
                             ;  mMixerOn MixerNoiseC
                             ;  mMixerOff MixerToneC
                               mMixerOnOff MixerNoiseC,MixerToneC
04ca : 86df             [ 2]> lda #~MixerNoiseC
04cc : a406             [ 5]> anda RegMixer,x
04ce : 8a04             [ 2]> ora #MixerToneC
04d0 : a706             [ 5]> sta RegMixer,x
                             
                               mSound RegNoisePitch,$1f
                            > if 2>1
04d2 : 861f             [ 2]>   lda #$1f
                            > endif
04d4 : a707             [ 5]> sta RegNoisePitch,x
                             
                               mSound RegVolC,13
                            > if 2>1
04d6 : 860d             [ 2]>   lda #13
                            > endif
04d8 : a703             [ 5]> sta RegVolC,x
                             
04da : 860d             [ 2]   lda #13
04dc : 39               [ 5]   rts
                             
04dd :                       Sound_Thrust:   ;a=time, x=sound regs
04dd : 6a07             [ 7]   dec RegNoisePitch,x  ;**todo: keep this? affect
04df : 6a03             [ 7]   dec RegVolC,x
04e1 : 39               [ 5]   rts
                             
04e2 :                       Sound_ShipFire_Init:
                               mSound RegVolA,14
                            > if 2>1
04e2 : 860e             [ 2]>   lda #14
                            > endif
04e4 : a705             [ 5]> sta RegVolA,x
                             
                             ;  mSound RegPitchA1,50
                             ;  mSound RegPitchA2,0
                               mMixerOn MixerToneA
04e6 : 86fe             [ 2]> lda #~MixerToneA
04e8 : a406             [ 5]> anda RegMixer,x
04ea : a706             [ 5]> sta RegMixer,x
                             
04ec : 860a             [ 2]   lda #10
04ee : 39               [ 5]   rts
                             
04ef :                       Sound_ShipFire:
                               direct $c8
                               ;Arpeggio every frame + note falling every 2nd 
04ef : ce72cd           [ 3]   ldu #FreqTable + (Octave*4) + Octave/2
04f2 : d626             [ 4]   ldb LoopCounterLow
04f4 : c401             [ 2]   andb #1
04f6 : 2703             [ 3]   beq  ssf1
04f8 : 33c818           [ 5]     leau Octave,u
04fb :                       ssf1:
04fb : 44               [ 2]   lsra
04fc : 48               [ 2]   lsla
04fd : 33c6             [ 5]   leau a,u
04ff : ecc4             [ 5]   ldd ,u
0501 : ed0c             [ 6]   std RegPitchA2,x
                               direct -1
0503 : 39               [ 5]   rts
                             
0504 :                       Sound_Explosion_Init:   ;return start time in A
                               mMixerOn MixerNoiseB
0504 : 86ef             [ 2]> lda #~MixerNoiseB
0506 : a406             [ 5]> anda RegMixer,x
0508 : a706             [ 5]> sta RegMixer,x
                             
                               mMixerOff MixerToneB
050a : 8602             [ 2]> lda #MixerToneB
050c : aa06             [ 5]> ora RegMixer,x
050e : a706             [ 5]> sta RegMixer,x
                             
                               mSound RegNoisePitch,$1f
                            > if 2>1
0510 : 861f             [ 2]>   lda #$1f
                            > endif
0512 : a707             [ 5]> sta RegNoisePitch,x
                             
                               mSound RegVolB,15
                            > if 2>1
0514 : 860f             [ 2]>   lda #15
                            > endif
0516 : a704             [ 5]> sta RegVolB,x
                             
0518 : 8640             [ 2]   lda #64
051a : 39               [ 5]   rts
                             
051b :                       Sound_Explosion:   ;a=time, x=sound regs
051b : 8b40             [ 2]   adda #64
051d : 44               [ 2]   lsra
051e : 44               [ 2]   lsra
051f : 44               [ 2]   lsra
0520 : a704             [ 5]   sta RegVolB,x
0522 : 39               [ 5]   rts
                             
                             
0523 :                       Sound_Shield_Init:   ;x=sound regs, return start 
                               direct $c8
                               mMixerOnOff MixerToneB,MixerNoiseB
0523 : 86fd             [ 2]> lda #~MixerToneB
0525 : a406             [ 5]> anda RegMixer,x
0527 : 8a10             [ 2]> ora #MixerNoiseB
0529 : a706             [ 5]> sta RegMixer,x
                             
                               mSound RegVolB,11
                            > if 2>1
052b : 860b             [ 2]>   lda #11
                            > endif
052d : a704             [ 5]> sta RegVolB,x
                             
                             
052f : ce7261           [ 3]   ldu #FreqTable ;+ (Octave)
                               mTestFlag RefuelFlag
                            >  if 255>RefuelFlag
0532 : 96e5             [ 4]>    lda GameFlags1
0534 : 8502             [ 2]>    bita #RefuelFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(RefuelFlag)>>8
                            >  endif
                             
0536 : 2708             [ 3]   beq ss1
0538 : 8618             [ 2]     lda #Octave
053a : 33c6             [ 5]     leau a,u
                                 mSound RegVolB,12
                            > if 2>1
053c : 860c             [ 2]>   lda #12
                            > endif
053e : a704             [ 5]> sta RegVolB,x
                             
0540 :                       ss1:
                             
                               mTicToc 4
0540 : 9626             [ 4]>  lda LoopCounterLow
0542 : 8403             [ 2]>  anda #4-1
0544 : 8102             [ 2]>  cmpa #4/2
0546 : 2402             [ 3]>  bcc l10032
0548 : 8803             [ 2]>  eora #4-1
054a :                      >l10032:
                             
054a : c60c             [ 2]   ldb #Octave/2
054c : 3d               [11]   mul
054d : eccb             [ 9]   ldd d,u
                             
054f : ed0a             [ 6]   std RegPitchB2,x
                             
0551 : 8602             [ 2]   lda #2
                               direct -1
0553 : 39               [ 5]   rts
                             
0554 :                       Sound_Shield:   ;a=time, x=sound regs
                               ;All sound is made in init
0554 : 39               [ 5]   rts
                             
0555 :                       Sound_Pickup_Init:   ;x=sound regs, return start 
                               mMixerOnOff MixerToneB,MixerNoiseB
0555 : 86fd             [ 2]> lda #~MixerToneB
0557 : a406             [ 5]> anda RegMixer,x
0559 : 8a10             [ 2]> ora #MixerNoiseB
055b : a706             [ 5]> sta RegMixer,x
                             
                             
055d : cc0021           [ 3]   ldd #$21
0560 : ed0a             [ 6]   std RegPitchB2,x
                             ;  mSound RegPitchB2
                             ;  tfr b,a
                             ;  mSound RegPitchB1
                             
0562 : 8608             [ 2]   lda #8
0564 : 39               [ 5]   rts
                             
0565 :                       Sound_Pickup:   ;a=time, x=sound regs
0565 : 8402             [ 2]   anda #2
0567 : 2604             [ 3]   bne spBeep
0569 : 6f04             [ 7]     clr RegVolB,x
056b : 2004             [ 3]     bra spExit
056d :                       spBeep:
                                 mSound RegVolB,14
                            > if 2>1
056d : 860e             [ 2]>   lda #14
                            > endif
056f : a704             [ 5]> sta RegVolB,x
                             
0571 :                       spExit:
0571 : 39               [ 5]   rts
                             
0572 :                       Sound_GunFire_Init:   ;x=sound regs, return start
                               direct $c8
                               mMixerOnOff MixerToneA,MixerNoiseA
0572 : 86fe             [ 2]> lda #~MixerToneA
0574 : a406             [ 5]> anda RegMixer,x
0576 : 8a08             [ 2]> ora #MixerNoiseA
0578 : a706             [ 5]> sta RegMixer,x
                             
                             
                               ;Slightly higher tone if homing
057a : ce7273           [ 3]   ldu #FreqTable + (Octave*0) + (2*9)
                               mTestFlag HomingGunShotsFlag
                            >  if 255>HomingGunShotsFlag
                            >    lda GameFlags1
                            >    bita #HomingGunShotsFlag
                            >  else
057d : 96e6             [ 4]>    lda GameFlags2
057f : 8502             [ 2]>    bita #(HomingGunShotsFlag)>>8
                            >  endif
                             
0581 : 2703             [ 3]   beq sgfNoHoming
0583 : 33c830           [ 5]     leau Octave*2,u
0586 :                       sgfNoHoming:
0586 : ecc4             [ 5]   ldd ,u
                             
0588 : ed0c             [ 6]   std RegPitchA2,x
                               mSound RegVolA,12
                            > if 2>1
058a : 860c             [ 2]>   lda #12
                            > endif
058c : a705             [ 5]> sta RegVolA,x
                             
058e : 8602             [ 2]   lda #2
                               direct -1
0590 : 39               [ 5]   rts
                             
0591 :                       Sound_GunFire:   ;a=time, x=sound regs
0591 : 39               [ 5]   rts
                             
0592 :                       Sound_WarpOut_Init:   ;x=sound regs, return start
                               mMixerOnOff MixerToneB,MixerNoiseB
0592 : 86fd             [ 2]> lda #~MixerToneB
0594 : a406             [ 5]> anda RegMixer,x
0596 : 8a10             [ 2]> ora #MixerNoiseB
0598 : a706             [ 5]> sta RegMixer,x
                             
                               mSound RegVolB,13
                            > if 2>1
059a : 860d             [ 2]>   lda #13
                            > endif
059c : a704             [ 5]> sta RegVolB,x
                             
059e : 8620             [ 2]   lda #32
05a0 : 39               [ 5]   rts
                             
05a1 :                       Sound_WarpOut:   ;a=time, x=sound regs
                               direct $c8
05a1 : ce7291           [ 3]   ldu #FreqTable + Octave*2
05a4 : 2017             [ 3]   bra SoundWarpSub
                               direct -1
                             ;  rts
                             
05a6 :                       Sound_WarpIn_Init:   ;x=sound regs, return start 
                               mMixerOnOff MixerToneB,MixerNoiseB
05a6 : 86fd             [ 2]> lda #~MixerToneB
05a8 : a406             [ 5]> anda RegMixer,x
05aa : 8a10             [ 2]> ora #MixerNoiseB
05ac : a706             [ 5]> sta RegMixer,x
                             
                               mSound RegVolB,12
                            > if 2>1
05ae : 860c             [ 2]>   lda #12
                            > endif
05b0 : a704             [ 5]> sta RegVolB,x
                             
05b2 : 8620             [ 2]   lda #32
05b4 : 39               [ 5]   rts
                             
05b5 :                       Sound_WarpIn:   ;a=time, x=sound regs
                               direct $c8
05b5 : ce7291           [ 3]   ldu #FreqTable + Octave*2
05b8 : 40               [ 2]   nega
05b9 : 8b20             [ 2]   adda #32      ;reverse time
05bb : 2000             [ 3]   bra SoundWarpSub
                               direct -1
                             ;  rts
                             
05bd :                       SoundWarpSub:
                               direct $c8
05bd : 47               [ 2]   asra
05be : 48               [ 2]   asla
05bf : 48               [ 2]   asla
05c0 : 33c6             [ 5]   leau a,u
                             
05c2 : 9626             [ 4]   lda LoopCounterLow
05c4 : 8401             [ 2]   anda #1
05c6 : c618             [ 2]   ldb #Octave
05c8 : 3d               [11]   mul
05c9 : eccb             [ 9]   ldd d,u
                             
05cb : ed0a             [ 6]   std RegPitchB2,x
                               direct -1
05cd : 39               [ 5]   rts
                             
05ce :                       Sound_PlanetExplode_Init:   ;x=sound regs, return
                               mMixerOnOff MixerToneB,MixerNoiseB
05ce : 86fd             [ 2]> lda #~MixerToneB
05d0 : a406             [ 5]> anda RegMixer,x
05d2 : 8a10             [ 2]> ora #MixerNoiseB
05d4 : a706             [ 5]> sta RegMixer,x
                             
                               mSound RegVolB,14
                            > if 2>1
05d6 : 860e             [ 2]>   lda #14
                            > endif
05d8 : a704             [ 5]> sta RegVolB,x
                             
05da : 8640             [ 2]   lda #64
05dc : 39               [ 5]   rts
                             
05dd :                       Sound_PlanetExplode:   ;a=time, x=sound regs
                               direct $c8
05dd : ce72a9           [ 3]   ldu #FreqTable + Octave*3
                             
05e0 : 8128             [ 2]   cmpa #40
05e2 : 2c08             [ 3]   bge speNoRandom
                                 mRandomToA
05e4 : bdf511           [ 8]>  jsr random                    ;call rom
                             
05e7 : 841f             [ 2]     anda #31
05e9 : 48               [ 2]     asla
05ea : 33c6             [ 5]     leau a,u
05ec :                       speNoRandom:
                             
05ec : 9626             [ 4]   lda LoopCounterLow
05ee : 8401             [ 2]   anda #1
05f0 : c618             [ 2]   ldb #Octave
05f2 : 3d               [11]   mul
                             
05f3 : eccb             [ 9]   ldd d,u
05f5 : ed0a             [ 6]   std RegPitchB2,x
                             
                               direct -1
05f7 : 39               [ 5]   rts
                             
05f8 :                       Sound_PerfectBonus_Init:   ;x=sound regs, return 
                               mMixerOnOff MixerToneB,MixerNoiseB
05f8 : 86fd             [ 2]> lda #~MixerToneB
05fa : a406             [ 5]> anda RegMixer,x
05fc : 8a10             [ 2]> ora #MixerNoiseB
05fe : a706             [ 5]> sta RegMixer,x
                             
0600 : 6f04             [ 7]   clr RegVolB,x
0602 : 8650             [ 2]   lda #80
0604 : 39               [ 5]   rts
                             
0605 :                       Sound_PerfectBonus:   ;a=time, x=sound regs
                               direct $c8
0605 : ce7261           [ 3]   ldu #FreqTable ;+ Octave*1
                             
0608 : 8120             [ 2]   cmpa #32
060a : 2c2e             [ 3]   bge speNoSound
                             
060c : 47               [ 2]   asra
060d : 48               [ 2]   asla
060e : 48               [ 2]   asla
060f : 108e6d2c         [ 4]   ldy #SineTable
0613 : a6a6             [ 5]   lda a,y
0615 : 48               [ 2]   asla
0616 : 33c6             [ 5]   leau a,u
                             
0618 : 9626             [ 4]   lda LoopCounterLow
061a : 8401             [ 2]   anda #1
061c : c618             [ 2]   ldb #Octave
061e : 3d               [11]   mul
061f : 33c5             [ 5]   leau b,u
                             
                               mTicToc 32
0621 : 9626             [ 4]>  lda LoopCounterLow
0623 : 841f             [ 2]>  anda #32-1
0625 : 8110             [ 2]>  cmpa #32/2
0627 : 2402             [ 3]>  bcc l10046
0629 : 881f             [ 2]>  eora #32-1
062b :                      >l10046:
                             
062b : a6a6             [ 5]   lda a,y
062d : 47               [ 2]   asra
062e : ab41             [ 5]   adda 1,u
                             
                               mSound RegPitchB1
                            > if 1>1
                            >   lda #
                            > endif
0630 : a70b             [ 5]> sta RegPitchB1,x
                             
0632 : a6c4             [ 4]   lda ,u
                               mSound RegPitchB2
                            > if 1>1
                            >   lda #
                            > endif
0634 : a70a             [ 5]> sta RegPitchB2,x
                             
                             
                               mSound RegVolB,14
                            > if 2>1
0636 : 860e             [ 2]>   lda #14
                            > endif
0638 : a704             [ 5]> sta RegVolB,x
                             
063a :                       speNoSound:
                               direct -1
063a : 39               [ 5]   rts
                             
063b :                       Sound_ExtraLife_Init:   ;x=sound regs, return sta
                               mMixerOnOff MixerToneA,MixerNoiseA
063b : 86fe             [ 2]> lda #~MixerToneA
063d : a406             [ 5]> anda RegMixer,x
063f : 8a08             [ 2]> ora #MixerNoiseA
0641 : a706             [ 5]> sta RegMixer,x
                             
0643 : 8608             [ 2]   lda #8
0645 : 39               [ 5]   rts
                             
0646 :                       Sound_ExtraLife:   ;a=time, x=sound regs
                               direct $c8
0646 : 8402             [ 2]   anda #2
0648 : c607             [ 2]   ldb #7
064a : 3d               [11]   mul
064b : e705             [ 5]   stb RegVolA,x
                             
064d : ce7331           [ 3]   ldu #FreqTable + Octave*8  + (2*8)
0650 : ecc4             [ 5]   ldd ,u
                             
0652 : ed0c             [ 6]   std RegPitchA2,x
                               direct -1
0654 : 39               [ 5]   rts
                             
0655 :                       Sound_WalkerBounce_Init:   ;x=sound regs, return 
                               direct $c8
                               mMixerOnOff MixerToneB,MixerNoiseB
0655 : 86fd             [ 2]> lda #~MixerToneB
0657 : a406             [ 5]> anda RegMixer,x
0659 : 8a10             [ 2]> ora #MixerNoiseB
065b : a706             [ 5]> sta RegMixer,x
                             
                             
                               ;Use hardcoded adress for jumping to avoid long
065d : b6c9ca           [ 5]   lda ZzapConfig+4
                             ;  lda zcJumping,y
                             
0660 : 44               [ 2]   lsra
0661 : 44               [ 2]   lsra
0662 : 840f             [ 2]   anda #15
0664 : 40               [ 2]   nega
0665 : 8b0f             [ 2]   adda #15
0667 : 847f             [ 2]   anda #127
0669 : a704             [ 5]   sta RegVolB,x
                             
066b : cc060c           [ 3]   ldd #$60c
                             
066e : ed0a             [ 6]   std RegPitchB2,x
                             
0670 : 8602             [ 2]   lda #2
                               direct -1
0672 : 39               [ 5]   rts
                             
0673 :                       Sound_WalkerDestroyed_Init:   ;x=sound regs, retu
                               mMixerOnOff MixerToneC,MixerNoiseC
0673 : 86fb             [ 2]> lda #~MixerToneC
0675 : a406             [ 5]> anda RegMixer,x
0677 : 8a20             [ 2]> ora #MixerNoiseC
0679 : a706             [ 5]> sta RegMixer,x
                             
                               mSound RegVolC,15
                            > if 2>1
067b : 860f             [ 2]>   lda #15
                            > endif
067d : a703             [ 5]> sta RegVolC,x
                             
067f : 8640             [ 2]   lda #64
0681 : 39               [ 5]   rts
                             
0682 :                       Sound_WalkerDestroyed:   ;a=time, x=sound regs
                               direct $c8
                             
0682 : ce7291           [ 3]   ldu #FreqTable + Octave*2
                             
0685 : a77f             [ 5]   sta -1,s
                             
0687 : 8403             [ 2]   anda #3
0689 : c618             [ 2]   ldb #Octave
068b : 3d               [11]   mul
068c : 33cb             [ 8]   leau d,u
                             
068e : e67f             [ 5]   ldb -1,s
0690 : 57               [ 2]   asrb
0691 : 57               [ 2]   asrb
0692 : 57               [ 2]   asrb
                             
0693 : a67f             [ 5]   lda -1,s
0695 : 3d               [11]   mul
0696 : e3c4             [ 6]   addd ,u
                             
0698 : ed08             [ 6]   std RegPitchC2,x
                             
                               direct -1
069a : 39               [ 5]   rts
                             
069b :                       Sound_Countdown_Init:   ;x=sound regs, return sta
                               mMixerOnOff MixerToneB,MixerNoiseB
069b : 86fd             [ 2]> lda #~MixerToneB
069d : a406             [ 5]> anda RegMixer,x
069f : 8a10             [ 2]> ora #MixerNoiseB
06a1 : a706             [ 5]> sta RegMixer,x
                             
06a3 : 860e             [ 2]   lda #14
06a5 : a704             [ 5]   sta RegVolB,x
06a7 : 8602             [ 2]   lda #2
06a9 : 39               [ 5]   rts
                             
06aa :                       Sound_Countdown:   ;a=time, x=sound regs
                               direct $c8
                             
06aa : ce72c1           [ 3]   ldu #FreqTable + Octave*4
06ad : 860a             [ 2]   lda #10
06af : 9bf3             [ 4]   adda PowerLife
06b1 : c606             [ 2]   ldb #Octave/4
06b3 : 3d               [11]   mul
06b4 : 33cb             [ 8]   leau d,u
                             
06b6 : ecc4             [ 5]   ldd ,u
                             
06b8 : ed0a             [ 6]   std RegPitchB2,x
                               direct -1
06ba : 39               [ 5]   rts
                             
                               include "Thrust_Fx.asm"
                             ; Thrust graphical effects
                             ; Copyright (C) 2004  Ville Krumlinde
                             
                             ;    Time       8 bits:
                             ;    TargetType 4 bits: ship,orb,gun,fuel,switch,
                             ;    FxType     4 bits: explosion,teleportfx,250s
                             ;    Index      8 bits: fuel,switch etc index
                             ;      en del dör direkt, refuel stänger av sig s
                             ;  DrawFx
                             ;    jumptable for targettype, returns coords
                             ;      FxGetCoords index
                             ;    jumptable for fxtype
                             ;      FxDrawFx coords,time
                             ;      every fx-rutin can also be called separate
                             ;  UpdateFx
                             ;    dec time
                             ;    jumptable for Finish
                             ;      FxFinish_Ship FxType
                             ;        case TeleportInFx
                             ;          set active
                             ;        case TeleportOutFx
                             ;          jsr finishlevel
                             ;        case Explosion
                             ;          call loselife
                             ;  Thrust_Fx.asm
                             ;  requirements
                             ;    able to draw refueling effect
                             ;    teleport in/out effect
                             ;  mEmitFx FxTarget,FxType,InitTime,IndexReg (opt
                             
                             
c8a0 =                       FxTempEntry = TemporaryArea    ;Temporary storage
                             
0000 =                       FxTargetShip   = 0
0001 =                       FxTargetPod    = 1
0002 =                       FxTargetGun    = 2
0003 =                       FxTargetPlant  = 3
0004 =                       FxTargetFuel   = 4
0005 =                       FxTargetSwitch = 5
0006 =                       FxTargetWalker = 6      ;bonus game
                             
0000 =                       FxTypeDotShatter = 0
0001 =                       FxTypeRefueling  = 1
0002 =                       FxTypePickUpPod  = 2
0003 =                       FxTypeScore150   = 3
0004 =                       FxTypeScore300   = 4
0005 =                       FxTypeScore750   = 5
0006 =                       FxTypeWarpIn     = 6
0007 =                       FxTypeWarpOut    = 7
0008 =                       FxTypeFuelCell   = 8
0009 =                       FxTypePlanetExplode = 9
000a =                       FxTypeGunFire = 10
                             
0040 =                       ShatterStartTime = 64
                             
                             ;A holds byte, exits with targettype in a, and fx
                             mFxSplitTargetFx macro
                               tfr a,b
                               anda #15
                               lsrb
                               lsrb
                               lsrb
                               lsrb
                               endm
                             
                             
                             ;Emit effect, all registers except D are preserve
                             mEmitFx macro FxTarget,FxType,IndexReg
                               if ('IndexReg'!='0') && ('IndexReg'!='b')
                                 tfr IndexReg,b
                               endif
                               lda #FxTarget | (FxType<<4)
                               jsr EmitFx
                               endm
                             
                             
                             ;*****************
06bb :                       EmitFx:         ;a=encoded target/type, b=index
06bb : 3430             [ 9]   pshs x,y
                               mDecLocals 4,0,0
                            >  nolist
                             
0000 =                       LocalTarget = LocalB1
0001 =                       LocalFx = LocalB2
0002 =                       LocalIndex = LocalB3
0003 =                       LocalEncoded = LocalB4
                             
06bf : a763             [ 5]   sta LocalEncoded,s
06c1 : e762             [ 5]   stb LocalIndex,s
                               mFxSplitTargetFx
06c3 : 1f89             [ 6]>  tfr a,b
06c5 : 840f             [ 2]>  anda #15
06c7 : 54               [ 2]>  lsrb
06c8 : 54               [ 2]>  lsrb
06c9 : 54               [ 2]>  lsrb
06ca : 54               [ 2]>  lsrb
                             
06cb : a7e4             [ 4]   sta LocalTarget,s
06cd : e761             [ 5]   stb LocalFx,s
                             
                               ;find free
06cf : 8ec913           [ 3]   ldx #FxList
06d2 : c603             [ 2]   ldb #MaxFx
06d4 :                       efxLoop:
06d4 : 6d84             [ 6]   tst ,x
06d6 : 2714             [ 3]   beq efxFound
06d8 : 3003             [ 5]   leax 3,x
06da : 5a               [ 2]   decb
06db : 26f7             [ 3]   bne efxLoop
                             
                               ;no free found, replace first that isn't target
                               ;ships fx must be prioritized because ExplodeSh
06dd : 8ec913           [ 3]   ldx #FxList
06e0 :                       efxLoop2:
06e0 : a601             [ 5]   lda 1,x
06e2 : 840f             [ 2]   anda #15
06e4 : 8100             [ 2]   cmpa #FxTargetShip
06e6 : 2604             [ 3]   bne efxFound
06e8 : 3003             [ 5]   leax 3,x
06ea : 20f4             [ 3]   bra efxLoop2
                             
06ec :                       efxFound:                       ;free found, writ
06ec : 108e0a3e         [ 4]   ldy #FxInitTable
06f0 : a661             [ 5]   lda LocalFx,s
06f2 : 48               [ 2]   lsla
06f3 : 31a6             [ 5]   leay a,y
                             
06f5 : a6a4             [ 4]   lda ,y                        ;time
06f7 : a784             [ 4]   sta ,x
                             
06f9 : a663             [ 5]   lda LocalEncoded,s            ;target/fx as one
06fb : a701             [ 5]   sta 1,x
                             
06fd : a662             [ 5]   lda LocalIndex,s              ;index
06ff : a702             [ 5]   sta 2,x
                             
0701 : a621             [ 5]   lda 1,y                       ;sound fx
0703 : 2703             [ 3]   beq efxNoSound
                                 mEmitSound
                            >  if 0=1
                            >    lda #
                            >  endif
0705 : bd0476           [ 8]>  jsr EmitSound
                             
0708 :                       efxNoSound:
                             
                               mFreeLocals
0708 : 3264             [ 5]>  leas FrameSize,s
                             
070a : 35b0             [11]   puls x,y,pc
                             ;  rts
                             
                             
                             ;*****************
070c :                       DrawFx:
                               mDecLocals 4,1,0
                            >  nolist
                             
0001 =                       LocalTarget = LocalB2
0002 =                       LocalFx = LocalB3
0003 =                       LocalTime = LocalB4
                             
070e : 108ec913         [ 4]   ldy #FxList
0712 : c603             [ 2]   ldb #MaxFx
0714 :                       dfxLoop:
0714 : a6a4             [ 4]   lda ,y
0716 : 272e             [ 3]   beq dfxNext
                             
0718 : e7e4             [ 4]   stb LocalB1,s
071a : 10af64           [ 7]   sty LocalW1,s
                             
071d : a763             [ 5]   sta LocalTime,s
                             
071f : a621             [ 5]   lda 1,y
                               mFxSplitTargetFx
0721 : 1f89             [ 6]>  tfr a,b
0723 : 840f             [ 2]>  anda #15
0725 : 54               [ 2]>  lsrb
0726 : 54               [ 2]>  lsrb
0727 : 54               [ 2]>  lsrb
0728 : 54               [ 2]>  lsrb
                             
0729 : a761             [ 5]   sta LocalTarget,s
072b : e762             [ 5]   stb LocalFx,s
                             
072d : e661             [ 5]   ldb LocalTarget,s
072f : 58               [ 2]   lslb
0730 : 8e0a6a           [ 3]   ldx #FxGetCoordsTable
0733 : a622             [ 5]   lda 2,y               ;A holds index
0735 : ad95             [11]   jsr [b,x]
                             
                               ;X and Y holds world coords
                             
0737 : ce0a54           [ 3]   ldu #FxDrawTable
073a : e662             [ 5]   ldb LocalFx,s
073c : 58               [ 2]   lslb
073d : a663             [ 5]   lda LocalTime,s       ;A holds time
073f : add5             [11]   jsr [b,u]
                             
0741 : e6e4             [ 4]   ldb LocalB1,s
0743 : 10ae64           [ 7]   ldy LocalW1,s
                             
0746 :                       dfxNext:
0746 : 3123             [ 5]   leay 3,y
0748 : 5a               [ 2]   decb
0749 : 26c9             [ 3]   bne dfxLoop
                             
                               mFreeLocals
074b : 3266             [ 5]>  leas FrameSize,s
                             
074d : 39               [ 5]   rts
                             
                             
                             ;*****************
074e :                       UpdateFx:
                               mDecLocals 3,1,0
                            >  nolist
                             
                               direct $c8
0001 =                       LocalTarget = LocalB2
0002 =                       LocalFx = LocalB3
                             
0750 : 108ec913         [ 4]   ldy #FxList
0754 : c603             [ 2]   ldb #MaxFx
0756 :                       ufxLoop:
0756 : 6da4             [ 6]   tst ,y
0758 : 272a             [ 3]   beq ufxNext
                             
075a : 6aa4             [ 6]   dec ,y                ;decrease time
075c : 2626             [ 3]   bne ufxNext
                             
075e : e7e4             [ 4]   stb LocalB1,s         ;reached zero, call finis
0760 : 10af63           [ 7]   sty LocalW1,s
                             
0763 : a621             [ 5]   lda 1,y
                               mFxSplitTargetFx
0765 : 1f89             [ 6]>  tfr a,b
0767 : 840f             [ 2]>  anda #15
0769 : 54               [ 2]>  lsrb
076a : 54               [ 2]>  lsrb
076b : 54               [ 2]>  lsrb
076c : 54               [ 2]>  lsrb
                             
076d : a761             [ 5]   sta LocalTarget,s
076f : e762             [ 5]   stb LocalFx,s
                             
0771 : ce0a78           [ 3]   ldu #FxFinishTable
0774 : e661             [ 5]   ldb LocalTarget,s
0776 : 58               [ 2]   lslb
0777 : 33c5             [ 5]   leau b,u
0779 : a662             [ 5]   lda LocalFx,s         ;A holds fxtype
077b : e622             [ 5]   ldb 2,y               ;B holds index
077d : add4             [10]   jsr [,u]
                             
077f : e6e4             [ 4]   ldb LocalB1,s
0781 : 10ae63           [ 7]   ldy LocalW1,s
                             
0784 :                       ufxNext:
0784 : 3123             [ 5]   leay 3,y
0786 : 5a               [ 2]   decb
0787 : 26cd             [ 3]   bne ufxLoop
                             
                               direct -1
                               mFreeLocals
0789 : 3265             [ 5]>  leas FrameSize,s
                             
078b : 39               [ 5]   rts
                             
                             
                             ;*****************
078c :                       FxGetScreenCoords:      ;X/Y world coords, return
078c : 10af7c           [ 7]   sty -4,s              ;save y, mGetScreenMacro 
                             
                               ;transform x
                               mGetScreenX
                            >  if  0 = 0    ;no param, X holds X-coord
078f : 1f12             [ 6]>    tfr x,y
                            >  endif
                            >  if  0 = 1
                            >    ldy     
                            >  endif
                            >  if  0 = 2   ;as09 treats "2,y" as two separate 
                            >    ldy     ,
                            >  endif
0791 : bec8c6           [ 6]>  ldx     ViewX
0794 : 1f20             [ 6]>  tfr     y,d
0796 : af7e             [ 6]>  stx -2,s
0798 : a37e             [ 7]>  subd -2,s
079a : 2c0a             [ 3]>  bge     L1430101
079c : fcc8cd           [ 6]>  ldd     CurLevelEndX
                            >;  stx -2,s
079f : a37e             [ 7]>  subd -2,s
07a1 : 10af7e           [ 7]>  sty -2,s
07a4 : e37e             [ 7]>  addd -2,s
07a6 :                      >L1430101:
                             
07a6 : 2b19             [ 3]   bmi fxsOffScreen
07a8 : 4d               [ 2]   tsta
07a9 : 2616             [ 3]   bne fxsOffScreen
07ab : c080             [ 2]   subb #128
07ad : e77f             [ 5]   stb -1,s
                             
07af : ec7c             [ 6]   ldd -4,s              ;load y
07b1 : b3c8c8           [ 7]   subd ViewY            ;transform y
07b4 : 2b0b             [ 3]   bmi fxsOffScreen
07b6 : 4d               [ 2]   tsta
07b7 : 2608             [ 3]   bne fxsOffScreen
                             
07b9 : 50               [ 2]   negb
07ba : 1f98             [ 6]   tfr b,a
07bc : e67f             [ 5]   ldb -1,s
07be : 8b7f             [ 2]   adda #127
07c0 : 39               [ 5]   rts
07c1 :                       fxsOffScreen:
07c1 : 4f               [ 2]   clra
07c2 : 39               [ 5]   rts
                             
                             ;*****************
07c3 :                       FxDrawSpriteVL:                 ;Draw a single sp
                               mDecLocals 2,2,0
                            >  nolist
                             
                               ;DP must be D0
                             
                               ;**todo: perhaps make a FxDrawVL also, this rou
                             
07c5 : a7e4             [ 4]   sta LocalB1,s
07c7 : e761             [ 5]   stb LocalB2,s
07c9 : af62             [ 6]   stx LocalW1,s
                             
07cb : aec4             [ 5]   ldx ,u
07cd : 10ae42           [ 7]   ldy 2,u
07d0 : 8dba             [ 7]   jsr FxGetScreenCoords
07d2 : 2739             [ 3]   beq fxdExit
                             
07d4 : ed64             [ 6]   std LocalW2,s
                               mSetScale $7f                 ;Scale $7f is req
                            >  if 1=1
07d6 : 867f             [ 2]>    lda #$7f                                   ;i
                            >  endif
07d8 : 9704             [ 4]>  sta <$04
                             
07da : bdf354           [ 8]   jsr reset0ref
07dd : ec64             [ 6]   ldd LocalW2,s
                               mMove_pen_d_Quick
07df : 9701             [ 4]>  sta   <0x01
07e1 : 0f00             [ 6]>  clr   <0x00
07e3 : 86ce             [ 2]>  lda   #0xCE
07e5 : 970c             [ 4]>  sta   <0x0C
07e7 : 0f0a             [ 6]>  clr   <0x0A
07e9 : 0c00             [ 6]>  inc   <0x00
07eb : d701             [ 4]>  stb   <0x01
07ed : 0f05             [ 6]>  clr   <0x05
07ef : c640             [ 2]>  ldb   #0x40
07f1 : d50d             [ 4]>PF33D0116: bitb  <0x0D
07f3 : 27fc             [ 3]>  beq   PF33D0116
                            >;PF33B0116: lda   #0x04
                            >;PF3410116: deca
                            >;  bne   PF3410116
                             
                             
07f5 : a661             [ 5]   lda LocalB2,s
                               mSetIntensity
                            >  if 0=1
                            >    lda   #            ;if argument exists, load 
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
07f7 : 9701             [ 4]>  sta   <01
07f9 : cc0401           [ 3]>  ldd   #$0401
07fc : 9700             [ 4]>  sta   <00
07fe : d700             [ 4]>  stb   <00
                             
                             
0800 : ae62             [ 6]   ldx LocalW1,s
0802 : a680             [ 6]   lda ,x+                       ;Nr of vectors in
0804 :                       fxdLoop:
0804 : e6e4             [ 4]   ldb LocalB1,s                 ;Scale
0806 : bdf3b7           [ 8]   jsr move_draw_VL4             ;Draw list
0809 : a680             [ 6]   lda ,x+                       ;Get next count, 
080b : 2af7             [ 3]   bpl fxdLoop
080d :                       fxdExit:
                             
                               mFreeLocals
080d : 3266             [ 5]>  leas FrameSize,s
                             
080f : 39               [ 5]   rts
                             
                             
                             ;*****************
0810 :                       FxMoveDrawPattern:                ;a=point count,
0810 : a77f             [ 5]   sta -1,s
0812 : ec81             [ 8]   ldd ,x++
                               mMove_pen_d_Quick
0814 : 9701             [ 4]>  sta   <0x01
0816 : 0f00             [ 6]>  clr   <0x00
0818 : 86ce             [ 2]>  lda   #0xCE
081a : 970c             [ 4]>  sta   <0x0C
081c : 0f0a             [ 6]>  clr   <0x0A
081e : 0c00             [ 6]>  inc   <0x00
0820 : d701             [ 4]>  stb   <0x01
0822 : 0f05             [ 6]>  clr   <0x05
0824 : c640             [ 2]>  ldb   #0x40
0826 : d50d             [ 4]>PF33D0119: bitb  <0x0D
0828 : 27fc             [ 3]>  beq   PF33D0119
                            >;PF33B0119: lda   #0x04
                            >;PF3410119: deca
                            >;  bne   PF3410119
                             
082a : a67f             [ 5]   lda -1,s
082c : 7ef434           [ 4]   jmp dwp_with_count
                             
                             
                             ;*****************
082f :                       Draw_Warp:                      ;A=time, X/Y=worl
                               mDecLocals 2,1,0
                            >  nolist
                             
0831 : a7e4             [ 4]   sta LocalB1,s
0833 : bd078c           [ 8]   jsr FxGetScreenCoords
0836 : ed62             [ 6]   std LocalW1,s
                             
0838 : bdf354           [ 8]   jsr reset0ref
083b : ec62             [ 6]   ldd LocalW1,s
083d : bdf2fc           [ 8]   jsr move_pen7f_to_d
                             
                               ;draw several times without reset0ref, each rin
0840 : 8604             [ 2]   lda #4
0842 : a761             [ 5]   sta LocalB2,s
0844 :                       dwLoop:
0844 : a6e4             [ 4]   lda LocalB1,s
0846 : 8b14             [ 2]   adda #20
                               mSetIntensity
                            >  if 0=1
                            >    lda   #            ;if argument exists, load 
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
0848 : 9701             [ 4]>  sta   <01
084a : cc0401           [ 3]>  ldd   #$0401
084d : 9700             [ 4]>  sta   <00
084f : d700             [ 4]>  stb   <00
                             
                             
0851 : 8e4b8c           [ 3]   ldx #WarpVectorList
0854 : a680             [ 6]   lda ,x+
0856 : e6e4             [ 4]   ldb LocalB1,s
0858 : cb06             [ 2]   addb #6       ;scale
                             
085a : bdf3b7           [ 8]   jsr move_draw_VL4
                             
085d : a6e4             [ 4]   lda LocalB1,s
085f : 8b06             [ 2]   adda #6
0861 : a7e4             [ 4]   sta LocalB1,s
                             
0863 : 6a61             [ 7]   dec LocalB2,s
0865 : 26dd             [ 3]   bne dwLoop
                             
                               mFreeLocals
0867 : 3264             [ 5]>  leas FrameSize,s
                             
0869 : 39               [ 5]   rts
                             
                             
                             ;*****************
086a :                       DrawRisingScore:                    ;A=time, X/Y=
                               ;Draw a slowly rising score amount
                               mDecLocals 1,0,4
                            >  nolist
                             
                             
086c : a7e4             [ 4]   sta LocalB1,s
086e : a77f             [ 5]   sta -1,s
0870 : 8620             [ 2]   lda #32
0872 : a07f             [ 5]   suba -1,s
0874 : 1f89             [ 6]   tfr a,b
                             ;  lsla
0876 : 40               [ 2]   nega
                             
0877 : af61             [ 6]   stx LocalBuffer,s
0879 : 31a6             [ 5]   leay a,y
087b : 10af63           [ 7]   sty LocalBuffer+2,s
                             
087e : 1f31             [ 6]   tfr u,x
0880 : 3361             [ 5]   leau LocalBuffer,s
                             
0882 : 1f98             [ 6]   tfr b,a ;scale
0884 : 44               [ 2]   lsra
                             ;  lsra
                             
0885 : e6e4             [ 4]   ldb LocalB1,s ;intensity
0887 : cb40             [ 2]   addb #$40
                             
0889 : bd07c3           [ 8]   jsr FxDrawSpriteVL
                             
                               mFreeLocals
088c : 3265             [ 5]>  leas FrameSize,s
                             
088e : 39               [ 5]   rts
                             
                             
                             ;*****************
                             ;GetCoords-routines
                             ;Returns world-coords in X and Y for each type of
                             ;*****************
                             
                             
                             ;*****************
088f :                       FxGetCoords_Ship:
088f : bec8bb           [ 6]   ldx ShipX
0892 : 10bec8bd         [ 7]   ldy ShipY
0896 : 39               [ 5]   rts
                             
                             ;*****************
0897 :                       FxGetCoords_Pod:
0897 : bec8bf           [ 6]   ldx PodX
089a : 10bec8c1         [ 7]   ldy PodY
089e : 39               [ 5]   rts
                             
                             ;*****************
089f :                       FxGetCoords_Gun:                ;index in A
089f : fec8ca           [ 6]   ldu CurLevelEntry             ;Gun
08a2 : ee44             [ 6]   ldu leGuns,u
08a4 : 3341             [ 5]   leau 1,u                      ;skip gun count
08a6 : c605             [ 2]   ldb #GunEntry
08a8 : 3d               [11]   mul
08a9 : 33cb             [ 8]   leau d,u                      ;u points to gun 
08ab : ffc8a0           [ 6]   stu FxTempEntry
08ae : aec4             [ 5]   ldx geGunX,u
08b0 : 10ae42           [ 7]   ldy geGunY,u
08b3 : 39               [ 5]   rts
                             
                             ;*****************
08b4 :                       FxGetCoords_Plant:
08b4 : fec8ca           [ 6]   ldu CurLevelEntry
08b7 : ae4c             [ 6]   ldx lePowerX,u
08b9 : 10ae4e           [ 7]   ldy lePowerY,u
08bc : 39               [ 5]   rts
                             
                             ;*****************
08bd :                       FxGetCoords_Fuel:               ;index in A
08bd : fec8ca           [ 6]   ldu CurLevelEntry
08c0 : ee46             [ 6]   ldu leFuel,u
08c2 : 3341             [ 5]   leau 1,u                      ;skip fuel count
08c4 : c604             [ 2]   ldb #FuelEntry
08c6 : 3d               [11]   mul
08c7 : 33cb             [ 8]   leau d,u                      ;u points to fuel
08c9 : aec4             [ 5]   ldx ,u
08cb : 10ae42           [ 7]   ldy 2,u
08ce : 39               [ 5]   rts
                             
                             ;*****************
08cf :                       FxGetCoords_Switch:             ;index in A
08cf : fec8ca           [ 6]   ldu CurLevelEntry
08d2 : eec814           [ 6]   ldu leSwitches,u
08d5 : 3341             [ 5]   leau 1,u                      ;skip switch coun
08d7 : c605             [ 2]   ldb #SwitchEntry
08d9 : 3d               [11]   mul
08da : 33cb             [ 8]   leau d,u                      ;u points to fuel
08dc : aec4             [ 5]   ldx seSwitchX,u
08de : 10ae42           [ 7]   ldy seSwitchY,u
08e1 : 39               [ 5]   rts
                             
                             ;*****************
08e2 :                       FxGetCoords_Walker:             ;index in A
08e2 : cec962           [ 3]   ldu #WalkerList
08e5 : c607             [ 2]   ldb #WalkerEntry
08e7 : 3d               [11]   mul
08e8 : 33cb             [ 8]   leau d,u
                               ;Walker constants are not declared yet
                               ;avoid 2-bytes offsets
08ea : ae42             [ 6]   ldx 2,u ;weWalkerX
08ec : 10ae44           [ 7]   ldy 4,u ;weWalkerY
08ef : 39               [ 5]   rts
                             
                             
                             
                             
                             
                             ;*****************
                             ;Draw-routines
                             ;Separate draw-function for each fxtype
                             ;*****************
                             
                             
                             ;*****************
08f0 :                       FxDraw_DotShatter:              ;A=time, X/Y=worl
                               mDecLocals 0,0,4
                            >  nolist
                             
08f2 : afe4             [ 5]   stx LocalBuffer,s
08f4 : 10af62           [ 7]   sty LocalBuffer+2,s
08f7 : 33e4             [ 4]   leau LocalBuffer,s
                             
08f9 : 40               [ 2]   nega                          ;reverse time
08fa : 8b40             [ 2]   adda #ShatterStartTime
                             
08fc : bd22b9           [ 8]   jsr DotShatter
                               mFreeLocals
08ff : 3264             [ 5]>  leas FrameSize,s
                             
0901 : 39               [ 5]   rts
                             
                             ;*****************
0902 :                       FxDraw_Refueling:
                               mDecLocals 1,1,0
                            >  nolist
                             
                             
                               ;Surround fuelcell with box
0904 : bd078c           [ 8]   jsr FxGetScreenCoords
0907 : ed61             [ 6]   std LocalW1,s
0909 : bdf354           [ 8]   jsr reset0ref
                               mSetIntensity $70
                            >  if 1=1
090c : 8670             [ 2]>    lda   #$70            ;if argument exists, lo
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
090e : 9701             [ 4]>  sta   <01
0910 : cc0401           [ 3]>  ldd   #$0401
0913 : 9700             [ 4]>  sta   <00
0915 : d700             [ 4]>  stb   <00
                             
0917 : ec61             [ 6]   ldd LocalW1,s
0919 : bdf2fc           [ 8]   jsr move_pen7f_to_d
091c : 8e4baa           [ 3]   ldx #RefuelVectorList
                             
                               mRandomToA
091f : bdf511           [ 8]>  jsr random                    ;call rom
                             
0922 : b7c829           [ 5]   sta Pattern
                             
0925 : c614             [ 2]   ldb #DrawScale
0927 : b6c826           [ 5]   lda LoopCounterLow
092a : 840f             [ 2]   anda #15
092c : 40               [ 2]   nega
092d : 3402             [ 6]   pshs a
092f : e0e0             [ 6]   subb ,s+
0931 : 1f98             [ 6]   tfr b,a
                               mSetScale
                            >  if 0=1
                            >    lda #                  ;if argument exists, l
                            >  endif
0933 : 9704             [ 4]>  sta <$04
                             
                             
0935 : 8603             [ 2]   lda #4-1
0937 : bd0810           [ 8]   jsr FxMoveDrawPattern
                             
                               ;Draw dots rising from the fuelcell
093a : 860c             [ 2]   lda #12
093c : a7e4             [ 4]   sta LocalB1,s
093e : 108ef000         [ 4]   ldy #$F000            ;offset each coordinate w
0942 :                       fdrStars:
0942 : bdf354           [ 8]   jsr reset0ref
                             
0945 : b6c826           [ 5]   lda LoopCounterLow
0948 : aba0             [ 6]   adda ,y+
094a : 841f             [ 2]   anda #31
094c : ab61             [ 5]   adda LocalW1,s
094e : 8b10             [ 2]   adda #16
                             
0950 : e6a0             [ 6]   ldb ,y+
0952 : c41f             [ 2]   andb #TileW-1
0954 : c010             [ 2]   subb #TileW/2
0956 : eb62             [ 5]   addb LocalW1+1,s
                             
0958 : bdf2fc           [ 8]   jsr move_pen7f_to_d
                               mDot_at_current_position 1
                            >  ; From vectrex.txt
                            >  ;    "(WARNING! high intensity and long Vec_Dot
                            >  ;     your vectrex monitor, be carefull while e
095b : 86ff             [ 2]>       lda   #0xFF
095d : 970a             [ 4]>       sta   <0x0A
                            >;       ldb   #1         ;1 is a value for how lo
                            >;PF2CC0179: decb                     ;dwell is no
                            >;       bne   PF2CC0179
095f : 0f0a             [ 6]>       clr   <0x0A
                             
                             
0961 : 6ae4             [ 6]   dec LocalB1,s
0963 : 26dd             [ 3]   bne fdrStars
                             
                               mFreeLocals
0965 : 3263             [ 5]>  leas FrameSize,s
                             
0967 : 39               [ 5]   rts
                             
                             ;*****************
0968 :                       FxDraw_PickUpPod:               ;A=time, X/Y=worl
                               mDecLocals 2,1,20
                            >  nolist
                             
096b : a7e4             [ 4]   sta LocalB1,s
096d : bd078c           [ 8]   jsr FxGetScreenCoords
0970 : ed62             [ 6]   std LocalW1,s
                             
0972 : b6c826           [ 5]   lda LoopCounterLow            ;angle
0975 : 8e4b79           [ 3]   ldx #OrbVectorList
0978 : e680             [ 6]   ldb ,x+
097a : e761             [ 5]   stb LocalB2,s                 ;vector count
097c : 3364             [ 5]   leau LocalBuffer,s            ;Vector buffer
097e : bdf610           [ 8]   jsr rot_vec_list2             ;Rotate vectors
                             
0981 : bdf354           [ 8]   jsr reset0ref
                             
0984 : a6e4             [ 4]   lda LocalB1,s
0986 : 8b40             [ 2]   adda #$40
                               mSetIntensity
                            >  if 0=1
                            >    lda   #            ;if argument exists, load 
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
0988 : 9701             [ 4]>  sta   <01
098a : cc0401           [ 3]>  ldd   #$0401
098d : 9700             [ 4]>  sta   <00
098f : d700             [ 4]>  stb   <00
                             
                             
0991 : ec62             [ 6]   ldd LocalW1,s
0993 : bdf2fc           [ 8]   jsr move_pen7f_to_d
0996 : 3064             [ 5]   leax LocalBuffer,s
0998 : a661             [ 5]   lda LocalB2,s
099a : e6e4             [ 4]   ldb LocalB1,s
099c : cb14             [ 2]   addb #DrawScale
099e : bdf3b7           [ 8]   jsr move_draw_VL4
                               mFreeLocals
09a1 : 32e818           [ 5]>  leas FrameSize,s
                             
09a4 : 39               [ 5]   rts
                             
                             ;*****************
09a5 :                       FxDraw_Score150:                ;A=time, X/Y=worl
09a5 : ce4c56           [ 3]   ldu #Score150_Lines
09a8 : bd086a           [ 8]   jsr DrawRisingScore
09ab : 39               [ 5]   rts
                             
                             ;*****************
09ac :                       FxDraw_Score300:                ;A=time, X/Y=worl
09ac : ce4c74           [ 3]   ldu #Score300_Lines
09af : bd086a           [ 8]   jsr DrawRisingScore
09b2 : 39               [ 5]   rts
                             
                             ;*****************
09b3 :                       FxDraw_Score750:                ;A=time, X/Y=worl
09b3 : ce4c99           [ 3]   ldu #Score750_Lines
09b6 : bd086a           [ 8]   jsr DrawRisingScore
09b9 : 39               [ 5]   rts
                             
                             ;*****************
09ba :                       FxDraw_WarpIn:                  ;A=time, X/Y=worl
09ba : 8118             [ 2]   cmpa #24
09bc : 260c             [ 3]   bne wi1
09be : a77f             [ 5]     sta -1,s
                                 mClearFlag InactiveFlag
                            >  if 255>InactiveFlag
09c0 : 86ef             [ 2]>    lda #~InactiveFlag
09c2 : b4c8e5           [ 5]>    anda GameFlags1
09c5 : b7c8e5           [ 5]>    sta GameFlags1
                            >  else
                            >    lda #~((InactiveFlag)>>8)
                            >    anda GameFlags2
                            >    sta GameFlags2
                            >  endif
                             
09c8 : a67f             [ 5]     lda -1,s
09ca :                       wi1:
09ca : bd082f           [ 8]   jsr Draw_Warp
09cd : 39               [ 5]   rts
                             
                             ;*****************
09ce :                       FxDraw_WarpOut:                 ;A=time, X/Y=worl
09ce : a77f             [ 5]   sta -1,s
09d0 : 8620             [ 2]   lda #32                       ;reverse time
09d2 : a07f             [ 5]   suba -1,s
09d4 : bd082f           [ 8]   jsr Draw_Warp
09d7 : 39               [ 5]   rts
                             
                             
                             ;*****************
09d8 :                       FxDraw_FuelCell:                ;A=time, X/Y=worl
                               mDecLocals 1,0,4
                            >  nolist
                             
                             
09da : a7e4             [ 4]   sta LocalB1,s
                             
09dc : af61             [ 6]   stx LocalBuffer,s
09de : 10af63           [ 7]   sty LocalBuffer+2,s
09e1 : 3361             [ 5]   leau LocalBuffer,s
                             
                               ;scale
                             ;  lsra
                             
09e3 : e6e4             [ 4]   ldb LocalB1,s ;intensity
09e5 : cb40             [ 2]   addb #$40
                             
09e7 : 8e4bf4           [ 3]   ldx #SpriteFuelCell
09ea : bd07c3           [ 8]   jsr FxDrawSpriteVL
                             
                               mFreeLocals
09ed : 3265             [ 5]>  leas FrameSize,s
                             
09ef : 39               [ 5]   rts
                             
                             
                             ;*****************
09f0 :                       FxDraw_PlanetExplode:                ;A=time, X/Y
09f0 : 8402             [ 2]   anda #2
09f2 : 270a             [ 3]   beq peShow
                                 mClearFlag NoLandscapeFlag
                            >  if 255>NoLandscapeFlag
                            >    lda #~NoLandscapeFlag
                            >    anda GameFlags1
                            >    sta GameFlags1
                            >  else
09f4 : 86fe             [ 2]>    lda #~((NoLandscapeFlag)>>8)
09f6 : b4c8e6           [ 5]>    anda GameFlags2
09f9 : b7c8e6           [ 5]>    sta GameFlags2
                            >  endif
                             
09fc : 2008             [ 3]     bra peOk
09fe :                       peShow:
                                 mSetFlag NoLandscapeFlag
                            >  if 255>NoLandscapeFlag
                            >    lda #NoLandscapeFlag
                            >    ora GameFlags1
                            >    sta GameFlags1
                            >  else
09fe : 8601             [ 2]>    lda #(NoLandscapeFlag)>>8
0a00 : bac8e6           [ 5]>    ora GameFlags2
0a03 : b7c8e6           [ 5]>    sta GameFlags2
                            >  endif
                             
0a06 :                       peOk:
0a06 : 39               [ 5]   rts
                             
                             
                             ;*****************
0a07 :                       FxDraw_GunFire:                ;A=time, X/Y=world
                               mDecLocals 1,0,4
                            >  nolist
                             
0a09 : a7e4             [ 4]   sta LocalB1,s
                             
0a0b : af61             [ 6]   stx LocalBuffer,s
0a0d : 10af63           [ 7]   sty LocalBuffer+2,s
                             
                               ;Get lines for gun
0a10 : fec8a0           [ 6]   ldu FxTempEntry
0a13 : e644             [ 5]   ldb geGunSprite,u
0a15 : 58               [ 2]   aslb
0a16 : 8e1f43           [ 3]   ldx #GunSpriteTable
0a19 : ae85             [ 6]   ldx b,x
                             
                               ;scale
0a1b : 48               [ 2]   lsla
0a1c : 8b14             [ 2]   adda #DrawScale
                             
0a1e : e6e4             [ 4]   ldb LocalB1,s ;intensity
0a20 : cb60             [ 2]   addb #$60
                             ;  ldb #$5f
                             
0a22 : 3361             [ 5]   leau LocalBuffer,s
0a24 : bd07c3           [ 8]   jsr FxDrawSpriteVL
                             
                               mFreeLocals
0a27 : 3265             [ 5]>  leas FrameSize,s
                             
0a29 : 39               [ 5]   rts
                             
                             ;-----------------
                             ;Finish-routines
                             ;Separate finish-function for each target
                             ;Called when time has run out for the fx
                             ;-----------------
                             
                             ;*****************
0a2a :                       FxFinish_Ship:                  ;A=fxtype
0a2a : 8100             [ 2]   cmpa #FxTypeDotShatter
0a2c : 2605             [ 3]   bne fxsNext1
0a2e : bd26e4           [ 8]     jsr OnLoseLife
0a31 : 2009             [ 3]     bra fxsExit
0a33 :                       fxsNext1:
                             ;  cmpa #FxTypeWarpIn
                             ;  bne fxsNext2
                             ;    mClearFlag InactiveFlag
                             ;    bra fxsExit
                             ;fxsNext2:
0a33 : 8107             [ 2]   cmpa #FxTypeWarpOut
0a35 : 2605             [ 3]   bne fxsNext3
0a37 : bd2921           [ 8]     jsr OnExitLevel
0a3a : 2000             [ 3]     bra fxsExit
0a3c :                       fxsNext3:
0a3c :                       fxsExit:
0a3c : 39               [ 5]   rts
                             
0a3d :                       FxFinish_Dummy:                 ;A=fxtype
0a3d : 39               [ 5]   rts
                             
0a3e :                       FxInitTable: ;Starttime, soundfx for each fxtype
0a3e : 4021                    db ShatterStartTime,ExplosionSoundId
0a40 : 0200                    db 2,0
0a42 : 4025                    db 64,PickupSoundId
0a44 : 2000                    db 32,0
0a46 : 2000                    db 32,0
0a48 : 2000                    db 32,0
0a4a : 2029                    db 32,WarpInSoundId
0a4c : 201d                    db 32,WarpOutSoundId
0a4e : 1425                    db DrawScale,PickupSoundId
0a50 : 4031                    db 64,PlanetExplodeSoundId
0a52 : 0808                    db 8,GunFireSoundId
                             
0a54 :                       FxDrawTable:
0a54 : 08f0                    dw FxDraw_DotShatter
0a56 : 0902                    dw FxDraw_Refueling
0a58 : 0968                    dw FxDraw_PickUpPod
0a5a : 09a5                    dw FxDraw_Score150
0a5c : 09ac                    dw FxDraw_Score300
0a5e : 09b3                    dw FxDraw_Score750
0a60 : 09ba                    dw FxDraw_WarpIn
0a62 : 09ce                    dw FxDraw_WarpOut
0a64 : 09d8                    dw FxDraw_FuelCell
0a66 : 09f0                    dw FxDraw_PlanetExplode
0a68 : 0a07                    dw FxDraw_GunFire
                             
0a6a :                       FxGetCoordsTable:
0a6a : 088f                    dw FxGetCoords_Ship
0a6c : 0897                    dw FxGetCoords_Pod
0a6e : 089f                    dw FxGetCoords_Gun
0a70 : 08b4                    dw FxGetCoords_Plant
0a72 : 08bd                    dw FxGetCoords_Fuel
0a74 : 08cf                    dw FxGetCoords_Switch
0a76 : 08e2                    dw FxGetCoords_Walker
                             
0a78 :                       FxFinishTable:          ;OnFinish-event for each 
0a78 : 0a2a                    dw FxFinish_Ship
0a7a : 0a3d                    dw FxFinish_Dummy
0a7c : 0a3d                    dw FxFinish_Dummy
0a7e : 0a3d                    dw FxFinish_Dummy
0a80 : 0a3d                    dw FxFinish_Dummy
0a82 : 0a3d                    dw FxFinish_Dummy
0a84 : 0a3d                    dw FxFinish_Dummy
0a86 : 0a3d                    dw FxFinish_Dummy
                             
                               include "Thrust_Ship.asm"
                             ; Code for handling ship and pod movement
                             ; Copyright (C) 2004  Ville Krumlinde
                             
000e =                       Gravity = 14
                             
                             ; Gamemode settings
0a88 : 102010                ShipShotSpeeds: db 16,32,16
0a8b : 010301                ShipRotateMasks: db 1,3,1
                             
                             
                             ;*****************
0a8e :                       Ship_Update:                    ;Update, called f
                               direct $c8
                               mTestFlag InactiveFlag
                            >  if 255>InactiveFlag
0a8e : 96e5             [ 4]>    lda GameFlags1
0a90 : 8510             [ 2]>    bita #InactiveFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(InactiveFlag)>>8
                            >  endif
                             
0a92 : 2621             [ 3]   bne suExit
                             
0a94 : bd0cfb           [ 8]   jsr Ship_Control
0a97 : bd10fe           [ 8]   jsr Ship_DoMove
0a9a : bd1227           [ 8]   jsr Ship_UpdateShipPodPos
0a9d : 8d17             [ 7]   bsr Ship_Collisions
                             
0a9f : 967a             [ 4]   lda GameMode
0aa1 : 8102             [ 2]   cmpa #TimeAttackGame
0aa3 : 2610             [ 3]   bne suExit
0aa5 : 9626             [ 4]   lda LoopCounterLow
0aa7 : 843f             [ 2]   anda #63
0aa9 : 260a             [ 3]   bne suExit
0aab : 0ae3             [ 6]   dec TimeAttackTime
0aad : 2606             [ 3]   bne suExit
                               mSetFlag GameOverFlag
                            >  if 255>GameOverFlag
0aaf : 8640             [ 2]>    lda #GameOverFlag
0ab1 : 9ae5             [ 4]>    ora GameFlags1
0ab3 : 97e5             [ 4]>    sta GameFlags1
                            >  else
                            >    lda #(GameOverFlag)>>8
                            >    ora GameFlags2
                            >    sta GameFlags2
                            >  endif
                             
                             
0ab5 :                       suExit:
                               direct -1
0ab5 : 39               [ 5]   rts
                             
                             
                             ;*****************
0ab6 :                       Ship_Collisions:                ;Ship and pod col
                               mDecLocals 1,5,0
                            >  nolist
                             
0003 =                       LocalXmin1=LocalW2
0005 =                       LocalXmax1=LocalW3
0007 =                       LocalYmin1=LocalW4
0009 =                       LocalYmax1=LocalW5
                               direct $c8
                             
                               ;Ship-tests
                             
                               ;Setup hit-rectangle of ship
0ab8 : 9ebb             [ 5]   ldx ShipX
0aba : 301c             [ 5]   leax -(ShipArea/2),x
0abc : af63             [ 6]   stx LocalXmin1,s
0abe : 3008             [ 5]   leax ShipArea,x
0ac0 : af65             [ 6]   stx LocalXmax1,s
0ac2 : 9ebd             [ 5]   ldx ShipY
0ac4 : 301c             [ 5]   leax -(ShipArea/2),x
0ac6 : af67             [ 6]   stx LocalYmin1,s
0ac8 : 3008             [ 5]   leax ShipArea,x
0aca : af69             [ 6]   stx LocalYmax1,s
0acc : 3363             [ 5]   leau LocalXmin1,s
0ace : bd12a5           [ 8]   jsr ValidateX
0ad1 : 3365             [ 5]   leau LocalXmax1,s
0ad3 : bd12a5           [ 8]   jsr ValidateX
                             
                             ;TODO?
                             ;  ldx ShipX
                             ;  ldy ShipY
                             ;  mMakeRect LocalXmin1,ShipArea
                             
0ad6 : deca             [ 5]   ldu CurLevelEntry             ;Collision ship v
0ad8 : ee46             [ 6]   ldu leFuel,u
0ada : a6c0             [ 6]   lda ,u+                       ;load count
0adc : a7e4             [ 4]   sta LocalB1,s
0ade : 4f               [ 2]   clra
0adf : d6e9             [ 4]   ldb FuelActive
0ae1 :                       scoVsFuelLoop:
0ae1 : 57               [ 2]   asrb
0ae2 : 2424             [ 3]   bcc scoVsNextFuel
0ae4 : ed61             [ 6]   std LocalW1,s
                               mTestAreaVsArea LocalXmin1,LocalXmax1,LocalYmin
0ae6 : aec4             [ 5]>  ldx     0,u
                            >
0ae8 : 300c             [ 5]>  leax    FuelArea/2,x
0aea : ac63             [ 7]>  cmpx    LocalXmin1,s
0aec : 2d18             [ 3]>  blt    scoVsFuelMiss
                            >
0aee : 3088e8           [ 5]>  leax    -FuelArea,x
0af1 : ac65             [ 7]>  cmpx    LocalXmax1,s
0af3 : 2e11             [ 3]>  bgt    scoVsFuelMiss
                            >
0af5 : ae42             [ 6]>  ldx     2,u
0af7 : 300c             [ 5]>  leax    FuelArea/2,x
0af9 : ac67             [ 7]>  cmpx    LocalYmin1,s
0afb : 2d09             [ 3]>  blt    scoVsFuelMiss
                            >
0afd : 3088e8           [ 5]>  leax    -FuelArea,x
0b00 : ac69             [ 7]>  cmpx    LocalYmax1,s
0b02 : 2e02             [ 3]>  bgt    scoVsFuelMiss
                             
0b04 : 2058             [ 3]   bra scoExplodeShip
0b06 :                       scoVsFuelMiss:
0b06 : ec61             [ 6]   ldd LocalW1,s
0b08 :                       scoVsNextFuel:
0b08 : 3344             [ 5]   leau FuelEntry,u
0b0a : 4c               [ 2]   inca
0b0b : a1e4             [ 4]   cmpa LocalB1,s
0b0d : 26d2             [ 3]   bne scoVsFuelLoop
                             
0b0f : 3363             [ 5]   leau LocalXmin1,s             ;Collision ship v
0b11 : bd2d62           [ 8]   jsr RectVsLevel
0b14 : 2548             [ 3]   bcs scoExplodeShip
                             
0b16 : deca             [ 5]   ldu CurLevelEntry             ;Collision ship v
0b18 : 334c             [ 5]   leau lePowerX,u
                               mTestAreaVsArea LocalXmin1,LocalXmax1,LocalYmin
0b1a : aec4             [ 5]>  ldx     0,u
                            >
0b1c : 300c             [ 5]>  leax    PlantArea/2,x
0b1e : ac63             [ 7]>  cmpx    LocalXmin1,s
0b20 : 2d18             [ 3]>  blt    scoVsPowerMiss
                            >
0b22 : 3088e8           [ 5]>  leax    -PlantArea,x
0b25 : ac65             [ 7]>  cmpx    LocalXmax1,s
0b27 : 2e11             [ 3]>  bgt    scoVsPowerMiss
                            >
0b29 : ae42             [ 6]>  ldx     2,u
0b2b : 300c             [ 5]>  leax    PlantArea/2,x
0b2d : ac67             [ 7]>  cmpx    LocalYmin1,s
0b2f : 2d09             [ 3]>  blt    scoVsPowerMiss
                            >
0b31 : 3088e8           [ 5]>  leax    -PlantArea,x
0b34 : ac69             [ 7]>  cmpx    LocalYmax1,s
0b36 : 2e02             [ 3]>  bgt    scoVsPowerMiss
                             
0b38 : 2024             [ 3]   bra scoExplodeShip
0b3a :                       scoVsPowerMiss:
                             
                             ;  mTestFlag HasOrbFlag
                             ;  bne scoVsPodMiss
0b3a : deca             [ 5]   ldu CurLevelEntry             ;Collision ship v
0b3c : 3348             [ 5]   leau leOrbX,u
                               mTestAreaVsArea LocalXmin1,LocalXmax1,LocalYmin
0b3e : aec4             [ 5]>  ldx     0,u
                            >
0b40 : 3007             [ 5]>  leax    StationaryPodArea/2,x
0b42 : ac63             [ 7]>  cmpx    LocalXmin1,s
0b44 : 2d16             [ 3]>  blt    scoVsPodMiss
                            >
0b46 : 3012             [ 5]>  leax    -StationaryPodArea,x
0b48 : ac65             [ 7]>  cmpx    LocalXmax1,s
0b4a : 2e10             [ 3]>  bgt    scoVsPodMiss
                            >
0b4c : ae42             [ 6]>  ldx     2,u
0b4e : 3007             [ 5]>  leax    StationaryPodArea/2,x
0b50 : ac67             [ 7]>  cmpx    LocalYmin1,s
0b52 : 2d08             [ 3]>  blt    scoVsPodMiss
                            >
0b54 : 3012             [ 5]>  leax    -StationaryPodArea,x
0b56 : ac69             [ 7]>  cmpx    LocalYmax1,s
0b58 : 2e02             [ 3]>  bgt    scoVsPodMiss
                             
0b5a : 2002             [ 3]   bra scoExplodeShip
0b5c :                       scoVsPodMiss:
                             
0b5c : 2006             [ 3]   bra scoPodTests
                             
0b5e :                       scoExplodeShip:
0b5e : bd2af7           [ 8]   jsr ExplodeShip
0b61 : 7e0bef           [ 4]   jmp scoExit
                             
                               ;Pod-tests
                             
0b64 :                       scoPodTests:
                               mTestFlag HasOrbFlag
                            >  if 255>HasOrbFlag
0b64 : 96e5             [ 4]>    lda GameFlags1
0b66 : 8504             [ 2]>    bita #HasOrbFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(HasOrbFlag)>>8
                            >  endif
                             
0b68 : 10270083         [ 6]   lbeq scoNoPod
                             
                               ;Setup hit-rectangle of pod
0b6c : 9ebf             [ 5]   ldx PodX
0b6e : 301d             [ 5]   leax -(PodArea/2),x
0b70 : af63             [ 6]   stx LocalXmin1,s
0b72 : 3006             [ 5]   leax PodArea,x
0b74 : af65             [ 6]   stx LocalXmax1,s
0b76 : 9ec1             [ 5]   ldx PodY
0b78 : 301d             [ 5]   leax -(PodArea/2),x
0b7a : af67             [ 6]   stx LocalYmin1,s
0b7c : 3006             [ 5]   leax PodArea,x
0b7e : af69             [ 6]   stx LocalYmax1,s
0b80 : 3363             [ 5]   leau LocalXmin1,s
0b82 : bd12a5           [ 8]   jsr ValidateX
0b85 : 3365             [ 5]   leau LocalXmax1,s
0b87 : bd12a5           [ 8]   jsr ValidateX
                             
0b8a : 3363             [ 5]   leau LocalXmin1,s             ;Collision pod vs
0b8c : bd2d62           [ 8]   jsr RectVsLevel
0b8f : 25cd             [ 3]   bcs scoExplodeShip
                             
0b91 : deca             [ 5]   ldu CurLevelEntry             ;Collision pod vs
0b93 : ee46             [ 6]   ldu leFuel,u
0b95 : a6c0             [ 6]   lda ,u+                       ;load count
0b97 : a7e4             [ 4]   sta LocalB1,s
0b99 : 4f               [ 2]   clra
0b9a : d6e9             [ 4]   ldb FuelActive
0b9c :                       scoPodVsFuelLoop:
0b9c : 57               [ 2]   asrb
0b9d : 2424             [ 3]   bcc scoPodVsNextFuel
0b9f : ed61             [ 6]   std LocalW1,s
                               mTestAreaVsArea LocalXmin1,LocalXmax1,LocalYmin
0ba1 : aec4             [ 5]>  ldx     0,u
                            >
0ba3 : 300c             [ 5]>  leax    FuelArea/2,x
0ba5 : ac63             [ 7]>  cmpx    LocalXmin1,s
0ba7 : 2d18             [ 3]>  blt    scoPodVsFuelMiss
                            >
0ba9 : 3088e8           [ 5]>  leax    -FuelArea,x
0bac : ac65             [ 7]>  cmpx    LocalXmax1,s
0bae : 2e11             [ 3]>  bgt    scoPodVsFuelMiss
                            >
0bb0 : ae42             [ 6]>  ldx     2,u
0bb2 : 300c             [ 5]>  leax    FuelArea/2,x
0bb4 : ac67             [ 7]>  cmpx    LocalYmin1,s
0bb6 : 2d09             [ 3]>  blt    scoPodVsFuelMiss
                            >
0bb8 : 3088e8           [ 5]>  leax    -FuelArea,x
0bbb : ac69             [ 7]>  cmpx    LocalYmax1,s
0bbd : 2e02             [ 3]>  bgt    scoPodVsFuelMiss
                             
0bbf : 209d             [ 3]   bra scoExplodeShip
0bc1 :                       scoPodVsFuelMiss:
0bc1 : ec61             [ 6]   ldd LocalW1,s
0bc3 :                       scoPodVsNextFuel:
0bc3 : 3344             [ 5]   leau FuelEntry,u
0bc5 : 4c               [ 2]   inca
0bc6 : a1e4             [ 4]   cmpa LocalB1,s
0bc8 : 26d2             [ 3]   bne scoPodVsFuelLoop
                             
0bca : deca             [ 5]   ldu CurLevelEntry             ;Collision pod vs
0bcc : 334c             [ 5]   leau lePowerX,u
                               mTestAreaVsArea LocalXmin1,LocalXmax1,LocalYmin
0bce : aec4             [ 5]>  ldx     0,u
                            >
0bd0 : 300c             [ 5]>  leax    PlantArea/2,x
0bd2 : ac63             [ 7]>  cmpx    LocalXmin1,s
0bd4 : 2d19             [ 3]>  blt    scoPodVsPowerMiss
                            >
0bd6 : 3088e8           [ 5]>  leax    -PlantArea,x
0bd9 : ac65             [ 7]>  cmpx    LocalXmax1,s
0bdb : 2e12             [ 3]>  bgt    scoPodVsPowerMiss
                            >
0bdd : ae42             [ 6]>  ldx     2,u
0bdf : 300c             [ 5]>  leax    PlantArea/2,x
0be1 : ac67             [ 7]>  cmpx    LocalYmin1,s
0be3 : 2d0a             [ 3]>  blt    scoPodVsPowerMiss
                            >
0be5 : 3088e8           [ 5]>  leax    -PlantArea,x
0be8 : ac69             [ 7]>  cmpx    LocalYmax1,s
0bea : 2e03             [ 3]>  bgt    scoPodVsPowerMiss
                             
0bec : 7e0b5e           [ 4]   bra scoExplodeShip
0bef :                       scoPodVsPowerMiss:
                             
0bef :                       scoNoPod:
                             
                             
0bef :                       scoExit:
                             
                               direct -1
                               mFreeLocals
0bef : 326b             [ 5]>  leas FrameSize,s
                             
0bf1 : 39               [ 5]   rts
                             
                             
                             ;*****************
0bf2 :                       Ship_Loaded:            ;Set pod to be carried by
                               direct $c8
                             
0bf2 : 109eca           [ 6]   ldy CurLevelEntry
                               mClearFlag PullFlag
                            >  if 255>PullFlag
0bf5 : 86f7             [ 2]>    lda #~PullFlag
0bf7 : 94e5             [ 4]>    anda GameFlags1
0bf9 : 97e5             [ 4]>    sta GameFlags1
                            >  else
                            >    lda #~((PullFlag)>>8)
                            >    anda GameFlags2
                            >    sta GameFlags2
                            >  endif
                             
                               mSetFlag HasOrbFlag
                            >  if 255>HasOrbFlag
0bfb : 8604             [ 2]>    lda #HasOrbFlag
0bfd : 9ae5             [ 4]>    ora GameFlags1
0bff : 97e5             [ 4]>    sta GameFlags1
                            >  else
                            >    lda #(HasOrbFlag)>>8
                            >    ora GameFlags2
                            >    sta GameFlags2
                            >  endif
                             
                             
                               ;Calculate center coordinate
0c01 : ec28             [ 6]   ldd leOrbX,y
0c03 : 93bb             [ 6]   subd ShipX
0c05 : 47               [ 2]   asra
0c06 : 56               [ 2]   rorb
0c07 : d3bb             [ 6]   addd ShipX
0c09 : ddac             [ 5]   std CenterX
                             
0c0b : ec2a             [ 6]   ldd leOrbY,y
0c0d : 93bd             [ 6]   subd ShipY
0c0f : 47               [ 2]   asra
0c10 : 56               [ 2]   rorb
0c11 : d3bd             [ 6]   addd ShipY
0c13 : ddaf             [ 5]   std CenterY
                             
0c15 : bd0c35           [ 8]   jsr Ship_FindLoadAngle
0c18 : 97b2             [ 4]   sta AlphaHi
                             
0c1a : bd1227           [ 8]   jsr Ship_UpdateShipPodPos ;Pod and ship coords 
                             
0c1d : 967a             [ 4]   lda GameMode
0c1f : 8100             [ 2]   cmpa #NormalGame
0c21 : 260c             [ 3]   bne slSkipHalf
0c23 : dcb7             [ 5]   ldd ShipSpeedX            ;half speed
0c25 : 47               [ 2]   asra
0c26 : 56               [ 2]   rorb
0c27 : ddb7             [ 5]   std ShipSpeedX
0c29 : dcb9             [ 5]   ldd ShipSpeedY
0c2b : 47               [ 2]   asra
0c2c : 56               [ 2]   rorb
0c2d : ddb9             [ 5]   std ShipSpeedY
0c2f :                       slSkipHalf:
                             
                               mEmitFx FxTargetPod,FxTypePickUpPod,0
                            >  if ('0'!='0') && ('0'!='b')
                            >    tfr 0,b
                            >  endif
0c2f : 8621             [ 2]>  lda #FxTargetPod | (FxTypePickUpPod<<4)
0c31 : bd06bb           [ 8]>  jsr EmitFx
                             
                               direct -1
0c34 : 39               [ 5]   rts
                             
                             
                             ;*****************
0c35 :                       Ship_FindLoadAngle:
                               ;Find the angle between pod and ship when pod i
                               ;Loop the distance table and find the best matc
                               ;This is quite slow but it is only called once 
                               direct $c8
                               mDecLocals 5,0,0
                            >  nolist
                             
0000 =                       LocalDx = LocalB1
0001 =                       LocalDy = LocalB2
0002 =                       LocalBest = LocalB3
0003 =                       LocalLoop = LocalB4
0004 =                       LocalBestI = LocalB5
                             
                               ; ShipX := PixX + DistanceLUT[ I ];
                               ; ShipY := PixY - DistanceLUT[ I+1 ];
                               ; PodX := PixX - DistanceLUT[ I ];
                               ; PodY := PixY + DistanceLUT[ I+1 ];
                             
0c37 : 109eca           [ 6]   ldy CurLevelEntry
                             
0c3a : dcbb             [ 5]   ldd ShipX
0c3c : a328             [ 7]   subd leOrbX,y
0c3e : 49               [ 2]   rola
0c3f : 56               [ 2]   rorb
0c40 : e7e4             [ 4]   stb LocalDx,s
                               ;b=distance/2, with sign bit
                             
0c42 : ec2a             [ 6]   ldd leOrbY,y
0c44 : 93bd             [ 6]   subd ShipY
0c46 : 49               [ 2]   rola
0c47 : 56               [ 2]   rorb
0c48 : e761             [ 5]   stb LocalDy,s
                               ;b=distance/2, with sign bit
                             
0c4a : 867f             [ 2]   lda #127
0c4c : a762             [ 5]   sta LocalBest,s
0c4e : 6f64             [ 7]   clr LocalBestI,s
                             
0c50 : ce12b7           [ 3]   ldu #DistanceTable
0c53 : 86f0             [ 2]   lda #ALPHA_MAX
0c55 : a763             [ 5]   sta LocalLoop,s
0c57 :                       flaLoop:
0c57 : a6e4             [ 4]   lda LocalDx,s
0c59 : a0c4             [ 4]   suba ,u
0c5b : 2a01             [ 3]   bpl flaXPos
0c5d : 40               [ 2]     nega
0c5e :                       flaXPos:
0c5e : a77f             [ 5]   sta -1,s
                             
0c60 : a661             [ 5]   lda LocalDy,s
0c62 : a041             [ 5]   suba 1,u
0c64 : 2a01             [ 3]   bpl flaYPos
0c66 : 40               [ 2]     nega
0c67 :                       flaYPos:
0c67 : ab7f             [ 5]   adda -1,s
                             
0c69 : a162             [ 5]   cmpa LocalBest,s
0c6b : 2c06             [ 3]   bge flaNotBetter
0c6d : a762             [ 5]     sta LocalBest,s
0c6f : a663             [ 5]     lda LocalLoop,s
0c71 : a764             [ 5]     sta LocalBestI,s
0c73 :                       flaNotBetter:
                             
0c73 : 3342             [ 5]   leau 2,u
0c75 : 6a63             [ 7]   dec LocalLoop,s
0c77 : 26de             [ 3]   bne flaLoop
                             
0c79 : 86f0             [ 2]   lda #ALPHA_MAX
0c7b : a064             [ 5]   suba LocalBestI,s
                             
                               mFreeLocals
0c7d : 3265             [ 5]>  leas FrameSize,s
                             
                               direct -1
0c7f : 39               [ 5]   rts
                             
                             
                             ;*****************
0c80 :                       Ship_DemoControl:                        ;read in
                               direct $c8
                             
0c80 : 9edb             [ 5]   ldx DemoPtr
                             
0c82 : 96dd             [ 4]   lda DemoCounter
0c84 : 2607             [ 3]   bne sdcDecCounter
0c86 : 3002             [ 5]     leax 2,x
0c88 : 9fdb             [ 5]     stx DemoPtr
0c8a : a601             [ 5]     lda 1,x
0c8c : 4c               [ 2]     inca
0c8d :                       sdcDecCounter:
0c8d : 4a               [ 2]   deca
0c8e : 97dd             [ 4]   sta DemoCounter
                             
0c90 : a684             [ 4]   lda ,x
                             
                               direct -1
0c92 : 39               [ 5]   rts
                             
                             
0001 =                       Button1 = 1
0002 =                       Button2 = 2
0004 =                       Button3 = 4
0008 =                       Button4 = 8
0010 =                       JoyLeft = 16
0020 =                       JoyRight = 32
0080 =                       JoyDown = 128
                             
                             ;*****************
0c93 :                       Ship_ConsoleControl:                    ;read inp
                               direct $c8
                             
                               ;DP must be D0 when reading joystick
                               mDptoD0
0c93 : 86d0             [ 2]>  lda   #0xD0
0c95 : 1f8b             [ 6]>  tfr   a,dp
                            >  direct -1
                             
                             
0c97 : bdf1f8           [ 8]   jsr read_joystick
                             
                               ;A must have bit set for firebutton, to disable
0c9a : 8601             [ 2]   lda #$1
0c9c : f6c880           [ 5]   ldb ButtonConfig
0c9f : 2a02             [ 3]   bpl sccNo2Fire
0ca1 : 48               [ 2]     lsla
0ca2 : 48               [ 2]     lsla
0ca3 :                       sccNo2Fire:
0ca3 : 59               [ 2]   rolb
0ca4 : 2a01             [ 3]   bpl sccNo1Fire
0ca6 : 48               [ 2]     lsla
0ca7 :                       sccNo1Fire:
0ca7 : bdf1b4           [ 8]   jsr read_switches
                             
                               ;Back to C8
                               mDptoC8
0caa : 86c8             [ 2]>  lda   #0xC8
0cac : 1f8b             [ 6]>  tfr   a,dp
                            >  direct $c8
                             
                             
0cae : 4f               [ 2]   clra
0caf : 8ec812           [ 3]   ldx #$C812
                             
0cb2 : d680             [ 4]   ldb ButtonConfig
                             
0cb4 : e77f             [ 5]   stb -1,s
0cb6 : c403             [ 2]   andb #3
0cb8 : 6d85             [ 7]   tst b,x
0cba : 2702             [ 3]   beq sccNoButton4
0cbc : 8a08             [ 2]     ora #Button4
0cbe :                       sccNoButton4:
0cbe : e67f             [ 5]   ldb -1,s
                             
0cc0 : 54               [ 2]   lsrb
0cc1 : 54               [ 2]   lsrb
0cc2 : e77f             [ 5]   stb -1,s
0cc4 : c403             [ 2]   andb #3
0cc6 : 6d85             [ 7]   tst b,x
0cc8 : 2702             [ 3]   beq sccNoButton3
0cca : 8a04             [ 2]     ora #Button3
0ccc :                       sccNoButton3:
0ccc : e67f             [ 5]   ldb -1,s
                             
0cce : 54               [ 2]   lsrb
0ccf : 54               [ 2]   lsrb
0cd0 : e77f             [ 5]   stb -1,s
0cd2 : c403             [ 2]   andb #3
0cd4 : 6d85             [ 7]   tst b,x
0cd6 : 2702             [ 3]   beq sccNoButton2
0cd8 : 8a02             [ 2]     ora #Button2
0cda :                       sccNoButton2:
0cda : e67f             [ 5]   ldb -1,s
                             
0cdc : 54               [ 2]   lsrb
0cdd : 54               [ 2]   lsrb
0cde : 6d85             [ 7]   tst b,x
0ce0 : 2702             [ 3]   beq sccNoButton1
0ce2 : 8a01             [ 2]     ora #Button1
0ce4 :                       sccNoButton1:
                             
0ce4 : d61b             [ 4]   ldb $c81b     ;read joystick
0ce6 : 2708             [ 3]   beq sccNoJoy
0ce8 : 2a04             [ 3]   bpl sccRight
0cea : 8a10             [ 2]     ora #JoyLeft
0cec : 2002             [ 3]     bra sccNoJoy
0cee :                       sccRight:
0cee : 8a20             [ 2]     ora #JoyRight
0cf0 :                       sccNoJoy:
                             
0cf0 : d61c             [ 4]   ldb $c81c     ;todo: test down is lock
0cf2 : 2706             [ 3]   beq sccNoUpDown
0cf4 : 2a04             [ 3]   bpl sccUp
0cf6 : 8a80             [ 2]     ora #JoyDown
0cf8 : 2000             [ 3]     bra sccNoUpDown
0cfa :                       sccUp:
0cfa :                       sccNoUpDown:
                             
                               direct -1
0cfa : 39               [ 5]   rts
                             
                             ;*****************
0cfb :                       Ship_Control:
                               mDecLocals 2,1,4
                            >  nolist
                             
0000 =                       LocalInput = LocalB1
0001 =                       LocalFuelCount = LocalB2
                               direct $c8
                             
0cfd : 96da             [ 4]   lda DemoMode
0cff : 2a05             [ 3]   bpl scNoDemo
0d01 : bd0c80           [ 8]     bsr Ship_DemoControl        ;read input from 
0d04 : 2002             [ 3]     bra scInputFin
0d06 :                       scNoDemo:                       ;read input from 
0d06 : 8d8b             [ 7]     bsr Ship_ConsoleControl
0d08 :                       scInputFin:
0d08 : a7e4             [ 4]   sta LocalInput,s
                             
                               if DemoRecord=1
                                 ;Unused instruction signal VecxMod to sample 
                                 db $14
                               endif
                             
0d0a : 967a             [ 4]   lda GameMode                  ;lock thrust, but
0d0c : 8101             [ 2]   cmpa #HardGame
0d0e : 262a             [ 3]   bne scLockFinish
0d10 : a6e4             [ 4]   lda LocalInput,s
0d12 : 8588             [ 2]   bita #Button4 | JoyDown
0d14 : 271e             [ 3]   beq scNoLock
0d16 : 8a04             [ 2]     ora #Button3        ;lock automatically also 
0d18 : a7e4             [ 4]     sta LocalInput,s
                               mTestFlag LockedThrustFlag
                            >  if 255>LockedThrustFlag
                            >    lda GameFlags1
                            >    bita #LockedThrustFlag
                            >  else
0d1a : 96e6             [ 4]>    lda GameFlags2
0d1c : 8504             [ 2]>    bita #(LockedThrustFlag)>>8
                            >  endif
                             
0d1e : 261a             [ 3]   bne scLockFinish
                             ;  lda ShipAngle
                             ;  sta LockedShipAngle
0d20 : c608             [ 2]   ldb #8  ;Lock up or down depending on gravity
                               mTestFlag ReverseGravFlag
                            >  if 255>ReverseGravFlag
0d22 : 96e5             [ 4]>    lda GameFlags1
0d24 : 8580             [ 2]>    bita #ReverseGravFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(ReverseGravFlag)>>8
                            >  endif
                             
0d26 : 2702             [ 3]   beq scLockAngleUp
0d28 : cb10             [ 2]     addb #SHIP_DIRMAX/2
0d2a :                       scLockAngleUp:
0d2a : d768             [ 4]   stb LockedShipAngle
                               mSetFlag LockedThrustFlag
                            >  if 255>LockedThrustFlag
                            >    lda #LockedThrustFlag
                            >    ora GameFlags1
                            >    sta GameFlags1
                            >  else
0d2c : 8604             [ 2]>    lda #(LockedThrustFlag)>>8
0d2e : 9ae6             [ 4]>    ora GameFlags2
0d30 : 97e6             [ 4]>    sta GameFlags2
                            >  endif
                             
0d32 : 2006             [ 3]   bra scLockFinish
0d34 :                       scNoLock:
                               mClearFlag LockedThrustFlag
                            >  if 255>LockedThrustFlag
                            >    lda #~LockedThrustFlag
                            >    anda GameFlags1
                            >    sta GameFlags1
                            >  else
0d34 : 86fb             [ 2]>    lda #~((LockedThrustFlag)>>8)
0d36 : 94e6             [ 4]>    anda GameFlags2
0d38 : 97e6             [ 4]>    sta GameFlags2
                            >  endif
                             
0d3a :                       scLockFinish:
                             
                             
                               ;Thrust
0d3a : a6e4             [ 4]   lda LocalInput,s
0d3c : 8504             [ 2]   bita #Button3
                             ;  tst stick1_button3
0d3e : 2714             [ 3]   beq scNotPressed_3
0d40 : dce1             [ 5]     ldd ShipFuel
0d42 : 2710             [ 3]     beq scNotPressed_3          ;Ship must have f
                                 mEmitSound ThrustSoundId
                            >  if 1=1
0d44 : 8606             [ 2]>    lda #ThrustSoundId
                            >  endif
0d46 : bd0476           [ 8]>  jsr EmitSound
                             
                                 mSetFlag ThrustFlag
                            >  if 255>ThrustFlag
0d49 : 8620             [ 2]>    lda #ThrustFlag
0d4b : 9ae5             [ 4]>    ora GameFlags1
0d4d : 97e5             [ 4]>    sta GameFlags1
                            >  else
                            >    lda #(ThrustFlag)>>8
                            >    ora GameFlags2
                            >    sta GameFlags2
                            >  endif
                             
0d4f : bd11b2           [ 8]     jsr Ship_DoThrust
0d52 : 2006             [ 3]     bra scThrustFin
0d54 :                       scNotPressed_3:                 ;No thrust
                                 mClearFlag ThrustFlag
                            >  if 255>ThrustFlag
0d54 : 86df             [ 2]>    lda #~ThrustFlag
0d56 : 94e5             [ 4]>    anda GameFlags1
0d58 : 97e5             [ 4]>    sta GameFlags1
                            >  else
                            >    lda #~((ThrustFlag)>>8)
                            >    anda GameFlags2
                            >    sta GameFlags2
                            >  endif
                             
0d5a :                       scThrustFin:
                             
                             
                             ;  tst stick1_button1            ;Firebutton
0d5a : a6e4             [ 4]   lda LocalInput,s
0d5c : 8501             [ 2]   bita #Button1
0d5e : 273e             [ 3]   beq scFireFinish
                                 mTestFlag ShieldFlag        ;can't fire while
                            >  if 255>ShieldFlag        
0d60 : 96e5             [ 4]>    lda GameFlags1
0d62 : 8501             [ 2]>    bita #ShieldFlag        
                            >  else
                            >    lda GameFlags2
                            >    bita #(ShieldFlag        )>>8
                            >  endif
                             
0d64 : 2638             [ 3]     bne scFireFinish
                                 ;Find free
0d66 : 108ec91c         [ 4]     ldy #ShipShotList
0d6a : 8604             [ 2]     lda #ShipShotCount
0d6c :                       scFire1:
0d6c : 6da4             [ 6]     tst ssShotActive,y
0d6e : 2707             [ 3]     beq scFreeFound
0d70 : 3129             [ 5]     leay ShipShotEntry,y
0d72 : 4a               [ 2]     deca
0d73 : 26f7             [ 3]     bne scFire1
0d75 : 2027             [ 3]     bra scFireFinish            ;No free found
0d77 :                       scFreeFound:
                                 mEmitSound ShipFireSoundId
                            >  if 1=1
0d77 : 860c             [ 2]>    lda #ShipFireSoundId
                            >  endif
0d79 : bd0476           [ 8]>  jsr EmitSound
                             
0d7c : 63a4             [ 6]     com ssShotActive,y          ;Set active
0d7e : d6b6             [ 4]     ldb ShipAngle               ;Calc rise & run,
                                 mShipAngleToVec b
0d80 : 58               [ 2]> lslb
0d81 : c010             [ 2]> subb #16
0d83 : 2a02             [ 3]> bpl l10290
0d85 : cb40             [ 2]>   addb #VEC_DIRMAX
0d87 :                      >l10290:
                             
0d87 : 8e0a88           [ 3]     ldx #ShipShotSpeeds
0d8a : 967a             [ 4]     lda GameMode
0d8c : a686             [ 5]     lda a,x                     ;scale
0d8e : bdf601           [ 8]     jsr convert_angle_to_rise_run  ;dp must be c8
                                 ;D holds result, optimize assign both with st
0d91 : 40               [ 2]     nega                        ;Y axis points do
0d92 : a728             [ 5]     sta ssShotVelocY,y
0d94 : e727             [ 5]     stb ssShotVelocX,y
0d96 : dcbb             [ 5]     ldd ShipX                   ;Set start positi
0d98 : ed21             [ 6]     std ssShotX,y
0d9a : dcbd             [ 5]     ldd ShipY
0d9c : ed24             [ 6]     std ssShotY,y
0d9e :                       scFireFinish:
                             
                             
0d9e : d67a             [ 4]   ldb GameMode
0da0 : 8e0a8b           [ 3]   ldx #ShipRotateMasks
0da3 : 9626             [ 4]   lda LoopCounterLow
0da5 : a485             [ 5]   anda b,x
0da7 : 271e             [ 3]   beq scLRFinished
                             
                             ;  lda $c81b
0da9 : a6e4             [ 4]   lda LocalInput,s
0dab : 8430             [ 2]   anda #JoyLeft | JoyRight
0dad : 2718             [ 3]   beq scLRFinished
0daf : 8510             [ 2]   bita #JoyLeft
0db1 : 260a             [ 3]   bne scRotateLeft
0db3 : 0ab6             [ 6]     dec ShipAngle               ;Rotate right
0db5 : 2a10             [ 3]     bpl scLRFinished
0db7 : 861f             [ 2]       lda #SHIP_DIRMAX-1
0db9 : 97b6             [ 4]       sta ShipAngle
0dbb : 200a             [ 3]     bra scLRFinished
0dbd :                       scRotateLeft:                   ;Rotate left
0dbd : 0cb6             [ 6]    inc ShipAngle
0dbf : 96b6             [ 4]    lda ShipAngle
0dc1 : 8120             [ 2]    cmpa #SHIP_DIRMAX
0dc3 : 2d02             [ 3]    blt scLRFinished
0dc5 : 0fb6             [ 6]      clr ShipAngle
0dc7 :                       scLRFinished:
                             
                             
                               ;Shield/pull
0dc7 : a6e4             [ 4]   lda LocalInput,s
0dc9 : 8502             [ 2]   bita #Button2
                             ;  tst stick1_button2
0dcb : 10270114         [ 6]   lbeq scNoShield
0dcf : dce1             [ 5]     ldd ShipFuel
0dd1 : 1027010e         [ 6]     lbeq scNoShield             ;Ship must have f
                             
                                 mSetFlag ShieldFlag
                            >  if 255>ShieldFlag
0dd5 : 8601             [ 2]>    lda #ShieldFlag
0dd7 : 9ae5             [ 4]>    ora GameFlags1
0dd9 : 97e5             [ 4]>    sta GameFlags1
                            >  else
                            >    lda #(ShieldFlag)>>8
                            >    ora GameFlags2
                            >    sta GameFlags2
                            >  endif
                             
                                 mEmitSound ShieldSoundId
                            >  if 1=1
0ddb : 8619             [ 2]>    lda #ShieldSoundId
                            >  endif
0ddd : bd0476           [ 8]>  jsr EmitSound
                             
                             
0de0 : dcbb             [ 5]     ldd ShipX                   ;Set up buffer wi
0de2 : ed64             [ 6]     std LocalBuffer,s
0de4 : dcbd             [ 5]     ldd ShipY
0de6 : c30020           [ 4]     addd #RefuelDistance / 2
0de9 : ed66             [ 6]     std LocalBuffer+2,s
0deb : 3164             [ 5]     leay LocalBuffer,s
                             
0ded : 967a             [ 4]     lda GameMode                ;Refuel while car
0def : 8101             [ 2]     cmpa #HardGame
0df1 : 2708             [ 3]     beq scGoFuelTest
                                 mTestFlag HasOrbFlag
                            >  if 255>HasOrbFlag
0df3 : 96e5             [ 4]>    lda GameFlags1
0df5 : 8504             [ 2]>    bita #HasOrbFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(HasOrbFlag)>>8
                            >  endif
                             
0df7 : 10260093         [ 6]     lbne scSkipFuelTest
0dfb :                       scGoFuelTest:
                             
0dfb : deca             [ 5]     ldu CurLevelEntry           ;Test if fuel is 
0dfd : ee46             [ 6]     ldu leFuel,u
0dff : a6c0             [ 6]     lda ,u+                     ;load count
0e01 : a761             [ 5]     sta LocalFuelCount,s
0e03 : 4f               [ 2]     clra
0e04 : d6e9             [ 4]     ldb FuelActive
0e06 :                       scFuelLoop:
0e06 : 57               [ 2]     asrb
0e07 : 1024007a         [ 6]     lbcc scNextFuel
0e0b : ed62             [ 6]     std LocalW1,s
                                 ;point is fuel-pos, rect is area under ship
                                 mPointVsRect (FuelArea+4),RefuelDistance,scFu
0e0d : aec4             [ 5]>  ldx      0,u
0e0f : eca4             [ 5]>  ldd      0,y
0e11 : 83000e           [ 4]>  subd    #(FuelArea+4)/2
0e14 : ed7e             [ 6]>  std -2,s
0e16 : ac7e             [ 7]>  cmpx -2,s
0e18 : 2d69             [ 3]>  blt    scFuelMiss
0e1a : c3001c           [ 4]>  addd    #(FuelArea+4)
0e1d : ed7e             [ 6]>  std -2,s
0e1f : ac7e             [ 7]>  cmpx -2,s
0e21 : 2e60             [ 3]>  bgt    scFuelMiss
0e23 : ae42             [ 6]>  ldx     2,u
0e25 : ec22             [ 6]>  ldd     2,y
0e27 : 830020           [ 4]>  subd    #RefuelDistance/2
0e2a : ed7e             [ 6]>  std -2,s
0e2c : ac7e             [ 7]>  cmpx -2,s
0e2e : 2d53             [ 3]>  blt    scFuelMiss
0e30 : c30040           [ 4]>  addd    #RefuelDistance
0e33 : ed7e             [ 6]>  std -2,s
0e35 : ac7e             [ 7]>  cmpx -2,s
0e37 : 2e4a             [ 3]>  bgt    scFuelMiss
                             
                             
                                 mSetFlag RefuelFlag         ;Fuel found
                            >  if 255>RefuelFlag         
0e39 : 8602             [ 2]>    lda #RefuelFlag         
0e3b : 9ae5             [ 4]>    ora GameFlags1
0e3d : 97e5             [ 4]>    sta GameFlags1
                            >  else
                            >    lda #(RefuelFlag         )>>8
                            >    ora GameFlags2
                            >    sta GameFlags2
                            >  endif
                             
                             
0e3f : a662             [ 5]     lda LocalW1,s
                                 mEmitFx FxTargetFuel,FxTypeRefueling,a
                            >  if ('a'!='0') && ('a'!='b')
0e41 : 1f89             [ 6]>    tfr a,b
                            >  endif
0e43 : 8614             [ 2]>  lda #FxTargetFuel | (FxTypeRefueling<<4)
0e45 : bd06bb           [ 8]>  jsr EmitFx
                             
                             
0e48 : 9626             [ 4]     lda LoopCounterLow          ;Refuel one unit 
0e4a : 8403             [ 2]     anda #3
0e4c : 10260099         [ 6]     lbne scShieldFin
                             
0e50 : 8ec8ea           [ 3]     ldx #FuelAmounts            ;Decrease amount 
0e53 : a662             [ 5]     lda LocalW1,s
0e55 : e686             [ 5]     ldb a,x
0e57 : 5a               [ 2]     decb
0e58 : e786             [ 5]     stb a,x
0e5a : 1026008b         [ 6]     lbne scShieldFin
                             
                                 mEmitFx FxTargetFuel,FxTypeFuelCell,a
                            >  if ('a'!='0') && ('a'!='b')
0e5e : 1f89             [ 6]>    tfr a,b
                            >  endif
0e60 : 8684             [ 2]>  lda #FxTargetFuel | (FxTypeFuelCell<<4)
0e62 : bd06bb           [ 8]>  jsr EmitFx
                             
0e65 : a662             [ 5]     lda LocalW1,s
                                 mEmitFx FxTargetFuel,FxTypeScore300,a
                            >  if ('a'!='0') && ('a'!='b')
0e67 : 1f89             [ 6]>    tfr a,b
                            >  endif
0e69 : 8644             [ 2]>  lda #FxTargetFuel | (FxTypeScore300<<4)
0e6b : bd06bb           [ 8]>  jsr EmitFx
                             
                             
0e6e : a662             [ 5]     lda LocalW1,s
                                 mClearBitA FuelActive
0e70 : c6ff             [ 2]>  ldb #255                    ;start with all bit
0e72 : 1cfe             [ 3]>  andcc #$fe                  ;clear carry flag, 
0e74 :                      >lop0299:                          ;rotate a zero 
0e74 : 59               [ 2]>  rolb
0e75 : 4a               [ 2]>  deca
0e76 : 2afc             [ 3]>  bpl lop0299
0e78 : d4e9             [ 4]>  andb FuelActive                   ;b now has a 
0e7a : d7e9             [ 4]>  stb FuelActive
                             
                             
                                 mGiveScore 300
0e7c : 861e             [ 2]>  lda #300 / 10
0e7e : bd1acf           [ 8]>  jsr GiveScoreA
                             
                             
0e81 : 2066             [ 3]     bra scShieldFin
0e83 :                       scFuelMiss:
0e83 : ec62             [ 6]     ldd LocalW1,s
0e85 :                       scNextFuel:
0e85 : 3344             [ 5]     leau FuelEntry,u
0e87 : 4c               [ 2]     inca
0e88 : a161             [ 5]     cmpa LocalFuelCount,s
0e8a : 1026ff78         [ 6]     bne scFuelLoop
0e8e :                       scSkipFuelTest:
                                 mClearFlag RefuelFlag       ;no fuel found
                            >  if 255>RefuelFlag       
0e8e : 86fd             [ 2]>    lda #~RefuelFlag       
0e90 : 94e5             [ 4]>    anda GameFlags1
0e92 : 97e5             [ 4]>    sta GameFlags1
                            >  else
                            >    lda #~((RefuelFlag       )>>8)
                            >    anda GameFlags2
                            >    sta GameFlags2
                            >  endif
                             
                             
                             
                                 mTestFlag HasOrbFlag        ;Test if pod is u
                            >  if 255>HasOrbFlag        
0e94 : 96e5             [ 4]>    lda GameFlags1
0e96 : 8504             [ 2]>    bita #HasOrbFlag        
                            >  else
                            >    lda GameFlags2
                            >    bita #(HasOrbFlag        )>>8
                            >  endif
                             
0e98 : 264f             [ 3]     bne scShieldFin
                             
0e9a : dcbd             [ 5]     ldd ShipY
0e9c : ed66             [ 6]     std LocalBuffer+2,s
0e9e : 3164             [ 5]     leay LocalBuffer,s
                             
0ea0 : deca             [ 5]     ldu CurLevelEntry           ;point is pod-pos
0ea2 : 3348             [ 5]     leau leOrbX,u
                                 mPointVsRect BeamLength*2,BeamLength*2,scPodM
0ea4 : aec4             [ 5]>  ldx      0,u
0ea6 : eca4             [ 5]>  ldd      0,y
0ea8 : 83003c           [ 4]>  subd    #BeamLength*2/2
0eab : ed7e             [ 6]>  std -2,s
0ead : ac7e             [ 7]>  cmpx -2,s
0eaf : 2d27             [ 3]>  blt    scPodMiss
0eb1 : c30078           [ 4]>  addd    #BeamLength*2
0eb4 : ed7e             [ 6]>  std -2,s
0eb6 : ac7e             [ 7]>  cmpx -2,s
0eb8 : 2e1e             [ 3]>  bgt    scPodMiss
0eba : ae42             [ 6]>  ldx     2,u
0ebc : ec22             [ 6]>  ldd     2,y
0ebe : 83003c           [ 4]>  subd    #BeamLength*2/2
0ec1 : ed7e             [ 6]>  std -2,s
0ec3 : ac7e             [ 7]>  cmpx -2,s
0ec5 : 2d11             [ 3]>  blt    scPodMiss
0ec7 : c30078           [ 4]>  addd    #BeamLength*2
0eca : ed7e             [ 6]>  std -2,s
0ecc : ac7e             [ 7]>  cmpx -2,s
0ece : 2e08             [ 3]>  bgt    scPodMiss
                             
                                 mSetFlag PullFlag           ;pod found
                            >  if 255>PullFlag           
0ed0 : 8608             [ 2]>    lda #PullFlag           
0ed2 : 9ae5             [ 4]>    ora GameFlags1
0ed4 : 97e5             [ 4]>    sta GameFlags1
                            >  else
                            >    lda #(PullFlag           )>>8
                            >    ora GameFlags2
                            >    sta GameFlags2
                            >  endif
                             
0ed6 : 2011             [ 3]     bra scShieldFin
0ed8 :                       scPodMiss:
                                 mTestFlag PullFlag
                            >  if 255>PullFlag
0ed8 : 96e5             [ 4]>    lda GameFlags1
0eda : 8508             [ 2]>    bita #PullFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(PullFlag)>>8
                            >  endif
                             
0edc : 270b             [ 3]     beq scShieldFin
                                   ;Ship has pulled the pod loose from the pla
0ede : bd0bf2           [ 8]       jsr Ship_Loaded
0ee1 : 2006             [ 3]     bra scShieldFin
0ee3 :                       scNoShield:
                                 mClearFlag (ShieldFlag | RefuelFlag | PullFla
                            >  if 255>(ShieldFlag | RefuelFlag | PullFlag)
0ee3 : 86f4             [ 2]>    lda #~(ShieldFlag | RefuelFlag | PullFlag)
0ee5 : 94e5             [ 4]>    anda GameFlags1
0ee7 : 97e5             [ 4]>    sta GameFlags1
                            >  else
                            >    lda #~(((ShieldFlag | RefuelFlag | PullFlag))
                            >    anda GameFlags2
                            >    sta GameFlags2
                            >  endif
                             
0ee9 :                       scShieldFin:
                             
                               ;Decrease 'perfect' bonus when shield is used (
                               mTestFlag ShieldFlag
                            >  if 255>ShieldFlag
0ee9 : 96e5             [ 4]>    lda GameFlags1
0eeb : 8501             [ 2]>    bita #ShieldFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(ShieldFlag)>>8
                            >  endif
                             
0eed : 2721             [ 3]   beq scSkipPerfect
0eef : 9626             [ 4]   lda LoopCounterLow
0ef1 : 8407             [ 2]   anda #7
0ef3 : 261b             [ 3]   bne scSkipPerfect
                               mTestFlag RefuelFlag
                            >  if 255>RefuelFlag
0ef5 : 96e5             [ 4]>    lda GameFlags1
0ef7 : 8502             [ 2]>    bita #RefuelFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(RefuelFlag)>>8
                            >  endif
                             
0ef9 : 2615             [ 3]   bne scSkipPerfect
                               mTestFlag PullFlag
                            >  if 255>PullFlag
0efb : 96e5             [ 4]>    lda GameFlags1
0efd : 8508             [ 2]>    bita #PullFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(PullFlag)>>8
                            >  endif
                             
0eff : 260f             [ 3]   bne scSkipPerfect
                               mTestFlag NoLandscapeFlag
                            >  if 255>NoLandscapeFlag
                            >    lda GameFlags1
                            >    bita #NoLandscapeFlag
                            >  else
0f01 : 96e6             [ 4]>    lda GameFlags2
0f03 : 8501             [ 2]>    bita #(NoLandscapeFlag)>>8
                            >  endif
                             
0f05 : 2609             [ 3]   bne scSkipPerfect
0f07 : 96f5             [ 4]     lda PerfectBonus
0f09 : 8102             [ 2]     cmpa #2                     ;don't decrease b
0f0b : 2f03             [ 3]     ble scSkipPerfect
0f0d : 4a               [ 2]       deca
0f0e : 97f5             [ 4]       sta PerfectBonus
0f10 :                       scSkipPerfect:
                             
0f10 :                       scExit:
                               mFreeLocals
0f10 : 3268             [ 5]>  leas FrameSize,s
                             
                               direct -1
0f12 : 39               [ 5]   rts
                             
                             
                             
                             
                             
                             ;*****************
0f13 :                       Ship_Draw:
                               ;DP must be D0
                               ;allocate buffer for rotated vectors
                               mDecLocals 0,2,((ShipVectorCount+ThrustVectorCo
                            >  nolist
                             
0000 =                       LocalShip = LocalW1
0002 =                       LocalPlatform = LocalW2
0002 =                       LocalOrb = LocalW2
                             
                               mTestFlag InactiveFlag
                            >  if 255>InactiveFlag
0f16 : b6c8e5           [ 5]>    lda GameFlags1
0f19 : 8510             [ 2]>    bita #InactiveFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(InactiveFlag)>>8
                            >  endif
                             
0f1b : 102601db         [ 6]   lbne sddExit
                             
                               ;Rotate vectors before reset pen, otherwise pos
0f1f : c609             [ 2]   ldb #ShipVectorCount-1
                               mTestFlag ThrustFlag
                            >  if 255>ThrustFlag
0f21 : b6c8e5           [ 5]>    lda GameFlags1
0f24 : 8520             [ 2]>    bita #ThrustFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(ThrustFlag)>>8
                            >  endif
                             
0f26 : 2702             [ 3]   beq sddNoThrust1
0f28 : cb03             [ 2]     addb #ThrustVectorCount
0f2a :                       sddNoThrust1:
0f2a : b6c8b6           [ 5]   lda ShipAngle
                               mShipAngleToVec a
0f2d : 48               [ 2]> lsla
0f2e : 8010             [ 2]> suba #16
0f30 : 2a02             [ 3]> bpl l10327
0f32 : 8b40             [ 2]>   adda #VEC_DIRMAX
0f34 :                      >l10327:
                             
0f34 : 8e4b5f           [ 3]   ldx #ShipVectorList
0f37 : 3364             [ 5]   leau LocalBuffer,s            ;Vector buffer
0f39 : bdf610           [ 8]   jsr rot_vec_list2             ;Rotate vectors
                             
0f3c : bdf354           [ 8]   jsr reset0ref                 ;Reset pen
                             
                               mGetScreenX ShipX
                            >  if  1 = 0    ;no param, X holds X-coord
                            >    tfr x,y
                            >  endif
                            >  if  1 = 1
0f3f : 10bec8bb         [ 7]>    ldy     ShipX
                            >  endif
                            >  if  1 = 2   ;as09 treats "2,y" as two separate 
                            >    ldy     ShipX,
                            >  endif
0f43 : bec8c6           [ 6]>  ldx     ViewX
0f46 : 1f20             [ 6]>  tfr     y,d
0f48 : af7e             [ 6]>  stx -2,s
0f4a : a37e             [ 7]>  subd -2,s
0f4c : 2c0a             [ 3]>  bge     L1430328
0f4e : fcc8cd           [ 6]>  ldd     CurLevelEndX
                            >;  stx -2,s
0f51 : a37e             [ 7]>  subd -2,s
0f53 : 10af7e           [ 7]>  sty -2,s
0f56 : e37e             [ 7]>  addd -2,s
0f58 :                      >L1430328:
                             
0f58 : c080             [ 2]   subb #128
0f5a : 3404             [ 6]   pshs b
                             
0f5c : fcc8bd           [ 6]   ldd ShipY
0f5f : b3c8c8           [ 7]   subd ViewY
0f62 : 50               [ 2]   negb
0f63 : 1f98             [ 6]   tfr b,a
0f65 : 3504             [ 6]   puls b
0f67 : 8b7f             [ 2]   adda #127
0f69 : ede4             [ 5]   std LocalShip,s               ;Save ship screen
0f6b : bdf2fc           [ 8]   jsr move_pen7f_to_d           ;Set pen position
                             
                               mSetIntensity $4f
                            >  if 1=1
0f6e : 864f             [ 2]>    lda   #$4f            ;if argument exists, lo
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
0f70 : 9701             [ 4]>  sta   <01
0f72 : cc0401           [ 3]>  ldd   #$0401
0f75 : 9700             [ 4]>  sta   <00
0f77 : d700             [ 4]>  stb   <00
                             
                             
0f79 : 3064             [ 5]   leax LocalBuffer,s            ;Vector buffer
0f7b : 8609             [ 2]   lda   #ShipVectorCount-1      ;Nr of vectors in
0f7d : c614             [ 2]   ldb   #DrawScale              ;Scale
0f7f : bdf3b7           [ 8]   jsr   move_draw_VL4           ;Draw list
                             
                               mTestFlag ThrustFlag          ;Draw thrust-tail
                            >  if 255>ThrustFlag          
0f82 : b6c8e5           [ 5]>    lda GameFlags1
0f85 : 8520             [ 2]>    bita #ThrustFlag          
                            >  else
                            >    lda GameFlags2
                            >    bita #(ThrustFlag          )>>8
                            >  endif
                             
0f87 : 2726             [ 3]   beq sddNoThrust2
0f89 : b6c826           [ 5]     lda LoopCounterLow
                                 ;asra
0f8c : 48               [ 2]     asla
0f8d : 48               [ 2]     asla
0f8e : 48               [ 2]     asla
0f8f : 843f             [ 2]     anda #63
                                 ;adda #40
                                 mSetIntensity
                            >  if 0=1
                            >    lda   #            ;if argument exists, load 
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
0f91 : 9701             [ 4]>  sta   <01
0f93 : cc0401           [ 3]>  ldd   #$0401
0f96 : 9700             [ 4]>  sta   <00
0f98 : d700             [ 4]>  stb   <00
                             
0f9a : 30e818           [ 5]     leax LocalBuffer+(ShipVectorCount*2),s       
0f9d : c614             [ 2]     ldb   #DrawScale              ;Scale
0f9f : b6c826           [ 5]   lda LoopCounterLow
0fa2 : 44               [ 2]   lsra
0fa3 : 44               [ 2]   lsra
                             ; lda $C87D+2
                             ; lda ShipSpeedX
                             ; adda ShipSpeedY
                             ; mRandomToA
                             ;  adda DrawList
                             ;  asra
0fa4 : 8403             [ 2]   anda #3
0fa6 : a77f             [ 5]   sta -1,s
0fa8 : eb7f             [ 5]   addb -1,s
                             ;    lda LoopCounterLow
                             ;    rora
                             ;    rora
                             ;    anda #0
                             ;    sta -1,s
                             ;    subb -1,s
0faa : 8602             [ 2]     lda   #ThrustVectorCount-1      ;Nr of vector
0fac : bdf3b7           [ 8]     jsr   move_draw_VL4           ;Draw list
0faf :                       sddNoThrust2:
                             
                               mTestFlag ShieldFlag          ;Test for shield
                            >  if 255>ShieldFlag          
0faf : b6c8e5           [ 5]>    lda GameFlags1
0fb2 : 8501             [ 2]>    bita #ShieldFlag          
                            >  else
                            >    lda GameFlags2
                            >    bita #(ShieldFlag          )>>8
                            >  endif
                             
0fb4 : 273a             [ 3]   beq sddNoShield
0fb6 : bdf354           [ 8]     jsr reset0ref
0fb9 : 864f             [ 2]     lda #$4f                    ;draw shield
0fbb : f6c826           [ 5]     ldb LoopCounterLow
0fbe : c41f             [ 2]     andb #31
0fc0 : e77f             [ 5]     stb -1,s
0fc2 : a07f             [ 5]     suba -1,s
                                 mSetIntensity
                            >  if 0=1
                            >    lda   #            ;if argument exists, load 
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
0fc4 : 9701             [ 4]>  sta   <01
0fc6 : cc0401           [ 3]>  ldd   #$0401
0fc9 : 9700             [ 4]>  sta   <00
0fcb : d700             [ 4]>  stb   <00
                             
0fcd : ece4             [ 5]     ldd LocalShip,s
0fcf : bdf2fc           [ 8]     jsr move_pen7f_to_d
                             
0fd2 : 8688             [ 2]     lda #%10001000              ;set drawing patt
0fd4 : f6c826           [ 5]     ldb LoopCounterLow
0fd7 : 54               [ 2]     lsrb
0fd8 : 54               [ 2]     lsrb
0fd9 : c403             [ 2]     andb #3
0fdb :                       sddRor:
0fdb : 2704             [ 3]     beq sddRorFin
0fdd : 46               [ 2]     rora
0fde : 5a               [ 2]     decb
0fdf : 20fa             [ 3]     bra sddRor
0fe1 :                       sddRorFin:
0fe1 : b7c829           [ 5]     sta $c829
                             
                                 mSetScale DrawScale
                            >  if 1=1
0fe4 : 8614             [ 2]>    lda #DrawScale                  ;if argument 
                            >  endif
0fe6 : 9704             [ 4]>  sta <$04
                             
                             
0fe8 : 8e4b98           [ 3]     ldx #ShieldVectorList
0feb : 8607             [ 2]     lda #8-1
0fed : bd0810           [ 8]     jsr FxMoveDrawPattern
0ff0 :                       sddNoShield:
                             
                             
                               mTestFlag LockedThrustFlag
                            >  if 255>LockedThrustFlag
                            >    lda GameFlags1
                            >    bita #LockedThrustFlag
                            >  else
0ff0 : b6c8e6           [ 5]>    lda GameFlags2
0ff3 : 8504             [ 2]>    bita #(LockedThrustFlag)>>8
                            >  endif
                             
0ff5 : 2742             [ 3]   beq sddNoLock
0ff7 : c609             [ 2]     ldb #ShipVectorCount-1
0ff9 : b6c868           [ 5]     lda LockedShipAngle
                                 mShipAngleToVec a
0ffc : 48               [ 2]> lsla
0ffd : 8010             [ 2]> suba #16
0fff : 2a02             [ 3]> bpl l10336
1001 : 8b40             [ 2]>   adda #VEC_DIRMAX
1003 :                      >l10336:
                             
1003 : 8e4b5f           [ 3]     ldx #ShipVectorList
1006 : 3364             [ 5]     leau LocalBuffer,s            ;Vector buffer
1008 : bdf610           [ 8]     jsr rot_vec_list2             ;Rotate vectors
                             
100b : bdf354           [ 8]     jsr reset0ref                 ;Reset pen
                                 mSetIntensity $4f
                            >  if 1=1
100e : 864f             [ 2]>    lda   #$4f            ;if argument exists, lo
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
1010 : 9701             [ 4]>  sta   <01
1012 : cc0401           [ 3]>  ldd   #$0401
1015 : 9700             [ 4]>  sta   <00
1017 : d700             [ 4]>  stb   <00
                             
                             
1019 : ece4             [ 5]     ldd LocalShip,s               ;load ship scre
101b : bdf2fc           [ 8]     jsr move_pen7f_to_d           ;Set pen positi
                             
                                 mTicToc 32
101e : b6c826           [ 5]>  lda LoopCounterLow
1021 : 841f             [ 2]>  anda #32-1
1023 : 8110             [ 2]>  cmpa #32/2
1025 : 2402             [ 3]>  bcc l10338
1027 : 881f             [ 2]>  eora #32-1
1029 :                      >l10338:
                             
1029 : 8b30             [ 2]     adda #48
                                 mSetScale
                            >  if 0=1
                            >    lda #                  ;if argument exists, l
                            >  endif
102b : 9704             [ 4]>  sta <$04
                             
                             
                                 mSetByte Pattern,%10001000
                            > if 0=%10001000
                            >   clr Pattern
                            > else
102d : 8688             [ 2]>   lda #%10001000
102f : b7c829           [ 5]>   sta Pattern
                            > endif
                             
1032 : 3064             [ 5]     leax LocalBuffer,s            ;Vector buffer
1034 : 8608             [ 2]     lda #ShipVectorCount-2        ;Nr of vectors 
1036 : bd0810           [ 8]     jsr FxMoveDrawPattern
1039 :                       sddNoLock:
                             
                             
                               mTestFlag HasOrbFlag
                            >  if 255>HasOrbFlag
1039 : b6c8e5           [ 5]>    lda GameFlags1
103c : 8504             [ 2]>    bita #HasOrbFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(HasOrbFlag)>>8
                            >  endif
                             
103e : 2766             [ 3]   beq sddNoOrb
                                 mSetIntensity $4f
                            >  if 1=1
1040 : 864f             [ 2]>    lda   #$4f            ;if argument exists, lo
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
1042 : 9701             [ 4]>  sta   <01
1044 : cc0401           [ 3]>  ldd   #$0401
1047 : 9700             [ 4]>  sta   <00
1049 : d700             [ 4]>  stb   <00
                             
                                 mGetScreenX PodX
                            >  if  1 = 0    ;no param, X holds X-coord
                            >    tfr x,y
                            >  endif
                            >  if  1 = 1
104b : 10bec8bf         [ 7]>    ldy     PodX
                            >  endif
                            >  if  1 = 2   ;as09 treats "2,y" as two separate 
                            >    ldy     PodX,
                            >  endif
104f : bec8c6           [ 6]>  ldx     ViewX
1052 : 1f20             [ 6]>  tfr     y,d
1054 : af7e             [ 6]>  stx -2,s
1056 : a37e             [ 7]>  subd -2,s
1058 : 2c0a             [ 3]>  bge     L1430343
105a : fcc8cd           [ 6]>  ldd     CurLevelEndX
                            >;  stx -2,s
105d : a37e             [ 7]>  subd -2,s
105f : 10af7e           [ 7]>  sty -2,s
1062 : e37e             [ 7]>  addd -2,s
1064 :                      >L1430343:
                             
1064 : c080             [ 2]     subb #128
1066 : 3404             [ 6]     pshs b
1068 : fcc8c1           [ 6]     ldd PodY
106b : b3c8c8           [ 7]     subd ViewY
106e : 50               [ 2]     negb
106f : 1f98             [ 6]     tfr b,a
1071 : 3504             [ 6]     puls b
1073 : 8b7f             [ 2]     adda #127
1075 : ed62             [ 6]     std LocalOrb,s
                             
1077 : bdf354           [ 8]     jsr reset0ref               ;Draw Orb
107a : ec62             [ 6]     ldd LocalOrb,s
107c : bdf2fc           [ 8]     jsr move_pen7f_to_d
107f : 8e4b79           [ 3]     ldx #OrbVectorList
1082 : a680             [ 6]     lda ,x+
1084 : c614             [ 2]     ldb #DrawScale
1086 : bdf3b7           [ 8]     jsr move_draw_VL4
                             
1089 : bdf354           [ 8]     jsr reset0ref               ;Draw tractor bea
108c : ece4             [ 5]     ldd LocalShip,s
108e : bdf2fc           [ 8]     jsr move_pen7f_to_d
1091 : ece4             [ 5]     ldd LocalShip,s
1093 : a062             [ 5]     suba LocalOrb,s
1095 : 40               [ 2]     nega
1096 : e063             [ 5]     subb LocalOrb+1,s
1098 : 50               [ 2]     negb
1099 : ed64             [ 6]     std LocalBuffer,s
109b : 3064             [ 5]     leax LocalBuffer,s
                                 mSetByte $c829,%10001000    ;use a pattern to
                            > if 0=%10001000    
                            >   clr $c829
                            > else
109d : 8688             [ 2]>   lda #%10001000    
109f : b7c829           [ 5]>   sta $c829
                            > endif
                             
10a2 : 4f               [ 2]     clra
10a3 : bdf434           [ 8]     jsr dwp_with_count
10a6 :                       sddNoOrb:
                             
                             
                               mTestFlag PullFlag            ;Test if ship is 
                            >  if 255>PullFlag            
10a6 : b6c8e5           [ 5]>    lda GameFlags1
10a9 : 8508             [ 2]>    bita #PullFlag            
                            >  else
                            >    lda GameFlags2
                            >    bita #(PullFlag            )>>8
                            >  endif
                             
10ab : 274d             [ 3]   beq sddNoPull
                                 mSetIntensity $4f           ;Draw tractor bea
                            >  if 1=1
10ad : 864f             [ 2]>    lda   #$4f                       ;if argument
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
10af : 9701             [ 4]>  sta   <01
10b1 : cc0401           [ 3]>  ldd   #$0401
10b4 : 9700             [ 4]>  sta   <00
10b6 : d700             [ 4]>  stb   <00
                             
                             
10b8 : fec8ca           [ 6]     ldu CurLevelEntry
                                 mGetScreenX leOrbX,u
                            >  if  2 = 0    ;no param, X holds X-coord
                            >    tfr x,y
                            >  endif
                            >  if  2 = 1
                            >    ldy     leOrbX
                            >  endif
                            >  if  2 = 2   ;as09 treats "2,y" as two separate 
10bb : 10ae48           [ 7]>    ldy     leOrbX,u
                            >  endif
10be : bec8c6           [ 6]>  ldx     ViewX
10c1 : 1f20             [ 6]>  tfr     y,d
10c3 : af7e             [ 6]>  stx -2,s
10c5 : a37e             [ 7]>  subd -2,s
10c7 : 2c0a             [ 3]>  bge     L1430347
10c9 : fcc8cd           [ 6]>  ldd     CurLevelEndX
                            >;  stx -2,s
10cc : a37e             [ 7]>  subd -2,s
10ce : 10af7e           [ 7]>  sty -2,s
10d1 : e37e             [ 7]>  addd -2,s
10d3 :                      >L1430347:
                             
10d3 : c080             [ 2]     subb #128
10d5 : 3404             [ 6]     pshs b
10d7 : ec4a             [ 6]     ldd leOrbY,u
10d9 : b3c8c8           [ 7]     subd ViewY
10dc : 50               [ 2]     negb
10dd : cb04             [ 2]     addb #4
10df : 1f98             [ 6]     tfr b,a
10e1 : 3504             [ 6]     puls b
10e3 : 8b7f             [ 2]     adda #127
10e5 : ed62             [ 6]     std LocalPlatform,s
                             
10e7 : bdf354           [ 8]     jsr reset0ref
10ea : ece4             [ 5]     ldd LocalShip,s
10ec : bdf2fc           [ 8]     jsr move_pen7f_to_d
10ef : ece4             [ 5]     ldd LocalShip,s
10f1 : a062             [ 5]     suba LocalPlatform,s
10f3 : 40               [ 2]     nega
10f4 : e063             [ 5]     subb LocalPlatform+1,s
10f6 : 50               [ 2]     negb
10f7 : bdf3df           [ 8]     jsr draw_to_d
10fa :                       sddNoPull:
                             
10fa :                       sddExit:
                               mFreeLocals
10fa : 32e81e           [ 5]>  leas FrameSize,s
                             
10fd : 39               [ 5]   rts
                             
                             
                             
                             ;*****************
10fe :                       Ship_DoMove:                    ;Update centerx/y
                               direct $c8
                             
                               mTestFlag HasOrbFlag
                            >  if 255>HasOrbFlag
10fe : 96e5             [ 4]>    lda GameFlags1
1100 : 8504             [ 2]>    bita #HasOrbFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(HasOrbFlag)>>8
                            >  endif
                             
1102 : 272d             [ 3]   beq sdmNoPod
                             
                               ;Alpha += dAlpha, 0..WDIRMAX
                             
                             ;  lda LoopCounterLow
                             ;  anda #SpinFrameMask
                             ;  bne sdmSkipAlpha
                             
1104 : dcb4             [ 5]   ldd AlphaDelta
1106 : 2b0a             [ 3]   bmi sdmNegD
1108 : d3b2             [ 6]   addd Alpha
110a : 81f0             [ 2]   cmpa #ALPHA_MAX
110c : 250e             [ 3]   blo sdmAlphaOk
110e : 80f0             [ 2]     suba #ALPHA_MAX
1110 : 200a             [ 3]     bra sdmAlphaOk
1112 :                       sdmNegD:
1112 : dcb2             [ 5]   ldd Alpha
1114 : d3b4             [ 6]   addd AlphaDelta
1116 : 81f0             [ 2]   cmpa #ALPHA_MAX
1118 : 2502             [ 3]   blo sdmAlphaOk
111a : 8bf0             [ 2]     adda #ALPHA_MAX
111c :                       sdmAlphaOk:
111c : ddb2             [ 5]   std Alpha
                             ;sdmSkipAlpha:
                             
                               ;Alpha damping
                             
111e : 96e4             [ 4]   lda FrameCounter
1120 : 8403             [ 2]   anda #FRAME4MASK
1122 : 260d             [ 3]   bne sdmExitAlphaDamping
1124 : 86ff             [ 2]   lda #-1
1126 : 9eb4             [ 5]   ldx AlphaDelta
1128 : 2707             [ 3]   beq sdmExitAlphaDamping
112a : 2b01             [ 3]   bmi *+3
112c : 40               [ 2]     nega
112d : 3086             [ 5]   leax a,x
112f : 9fb4             [ 5]   stx AlphaDelta
1131 :                       sdmExitAlphaDamping:
                             
1131 :                       sdmNoPod:
                             
                               ;SpeedX damping + range test
1131 : dcb7             [ 5]   ldd ShipSpeedX
1133 : 271b             [ 3]   beq sdmNoXDamping
1135 : 1f89             [ 6]   tfr a,b
1137 : 57               [ 2]   asrb
1138 : 2b03             [ 3]   bmi sdmNegXDamping
113a : 5c               [ 2]   incb
113b : 2001             [ 3]   bra sdmXDampStore
113d :                       sdmNegXDamping:
113d : 5a               [ 2]   decb
113e :                       sdmXDampStore:
113e : 50               [ 2]   negb
113f : 1d               [ 2]   sex
1140 : d3b7             [ 6]   addd ShipSpeedX
000c =                       SpeedMax = 12                   ;keep x speed in 
1142 : 810c             [ 2]   cmpa #SpeedMax
1144 : 2d02             [ 3]   blt sdmXHiOk
1146 : 860c             [ 2]     lda #SpeedMax
1148 :                       sdmXHiOk:
1148 : 81f4             [ 2]   cmpa #-SpeedMax
114a : 2c02             [ 3]   bge sdmXRangeFin
114c : 86f4             [ 2]     lda #-SpeedMax
114e :                       sdmXRangeFin:
114e : ddb7             [ 5]   std ShipSpeedX
1150 :                       sdmNoXDamping:
                             
                               ;Gravity + range test
1150 : c60e             [ 2]   ldb #Gravity
                               mTestFlag ReverseGravFlag
                            >  if 255>ReverseGravFlag
1152 : 96e5             [ 4]>    lda GameFlags1
1154 : 8580             [ 2]>    bita #ReverseGravFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(ReverseGravFlag)>>8
                            >  endif
                             
1156 : 2702             [ 3]   beq sdmNormalGrav
1158 : 50               [ 2]     negb
1159 : 57               [ 2]     asrb ;try smaller gravity in reverse
115a :                       sdmNormalGrav:
115a : 1d               [ 2]   sex
115b : d3b9             [ 6]   addd ShipSpeedY
115d : 810c             [ 2]   cmpa #SpeedMax                ;keep y speed in 
115f : 2d02             [ 3]   blt sdmYHiOk
1161 : 860c             [ 2]     lda #SpeedMax
1163 :                       sdmYHiOk:
1163 : 81f4             [ 2]   cmpa #-SpeedMax
1165 : 2c02             [ 3]   bge sdmYRangeFin
1167 : 86f4             [ 2]     lda #-SpeedMax
1169 :                       sdmYRangeFin:
1169 : ddb9             [ 5]   std ShipSpeedY
                             
                               ;Center += ShipSpeed
                             
116b : d6b7             [ 4]   ldb ShipSpeedXHi
116d : 1d               [ 2]   sex
116e : ed7e             [ 6]   std -2,s
1170 : 8ec8ac           [ 3]   ldx #CenterX
                               mGet_D_from_fixed
1173 : ec84             [ 5]>  ldd ,x
                            >
1175 : 6802             [ 7]>  asl 2,x
1177 : 59               [ 2]>  rolb
1178 : 49               [ 2]>  rola
                            >
1179 : 6802             [ 7]>  asl 2,x
117b : 59               [ 2]>  rolb
117c : 49               [ 2]>  rola
                             
117d : e37e             [ 7]   addd -2,s
                               mStore_D_as_fixed
117f : 6f02             [ 7]>  clr 2,x
                            >
1181 : 47               [ 2]>  asra
1182 : 56               [ 2]>  rorb
1183 : 6602             [ 7]>  ror 2,x
                            >
1185 : 47               [ 2]>  asra
1186 : 56               [ 2]>  rorb
1187 : 6602             [ 7]>  ror 2,x
                            >
1189 : ed84             [ 5]>  std ,x
                             
                             
118b : d6b9             [ 4]   ldb ShipSpeedYHi
118d : 1d               [ 2]   sex
118e : ed7e             [ 6]   std -2,s
1190 : 8ec8af           [ 3]   ldx #CenterY
                               mGet_D_from_fixed
1193 : ec84             [ 5]>  ldd ,x
                            >
1195 : 6802             [ 7]>  asl 2,x
1197 : 59               [ 2]>  rolb
1198 : 49               [ 2]>  rola
                            >
1199 : 6802             [ 7]>  asl 2,x
119b : 59               [ 2]>  rolb
119c : 49               [ 2]>  rola
                             
119d : e37e             [ 7]   addd -2,s
                               mStore_D_as_fixed
119f : 6f02             [ 7]>  clr 2,x
                            >
11a1 : 47               [ 2]>  asra
11a2 : 56               [ 2]>  rorb
11a3 : 6602             [ 7]>  ror 2,x
                            >
11a5 : 47               [ 2]>  asra
11a6 : 56               [ 2]>  rorb
11a7 : 6602             [ 7]>  ror 2,x
                            >
11a9 : ed84             [ 5]>  std ,x
                             
                             
11ab : cec8ac           [ 3]   ldu #CenterX
11ae : bd12a5           [ 8]   jsr ValidateX
                             
                               direct -1
11b1 : 39               [ 5]   rts
                             
                             
                             
                             ;*****************
11b2 :                       Ship_DoThrust:                  ;Adjust speed and
                               direct $c8
                               mDecLocals 1,0,0
                            >  nolist
                             
0000 =                       LocalAngle = LocalB1
                             
                               mTestFlag LockedThrustFlag
                            >  if 255>LockedThrustFlag
                            >    lda GameFlags1
                            >    bita #LockedThrustFlag
                            >  else
11b4 : 96e6             [ 4]>    lda GameFlags2
11b6 : 8504             [ 2]>    bita #(LockedThrustFlag)>>8
                            >  endif
                             
11b8 : 2604             [ 3]   bne sdtLocked
11ba : 96b6             [ 4]   lda ShipAngle
11bc : 2002             [ 3]   bra sdtStoreAngle
11be :                       sdtLocked:
11be : 9668             [ 4]   lda LockedShipAngle
11c0 :                       sdtStoreAngle:
11c0 : a7e4             [ 4]   sta LocalAngle,s
                             
                             ;  lda LocalAngle,s
11c2 : 48               [ 2]   lsla
11c3 : 8e1497           [ 3]   ldx #AccelTable
11c6 : 3086             [ 5]   leax a,x
                             
                               mTestFlag HasOrbFlag
                            >  if 255>HasOrbFlag
11c8 : 96e5             [ 4]>    lda GameFlags1
11ca : 8504             [ 2]>    bita #HasOrbFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(HasOrbFlag)>>8
                            >  endif
                             
11cc : 2744             [ 3]   beq sdtNoPod
                             
                               ;ax := AccelLUT[ dir*2 ];
                               ;ay := AccelLUT[ dir*2+1 ];
11ce : e684             [ 4]   ldb ,x
11d0 : 1d               [ 2]   sex
11d1 : d3b7             [ 6]   addd ShipSpeedX
11d3 : ddb7             [ 5]   std ShipSpeedX
                             
11d5 : e601             [ 5]   ldb 1,x
11d7 : 1d               [ 2]   sex
11d8 : d3b9             [ 6]   addd ShipSpeedY
11da : ddb9             [ 5]   std ShipSpeedY
                             
                               ;adjust spin
                             ;  lda LoopCounterLow
                             ;  anda #SpinFrameMask
                             ;  bne sdtSkipAlpha
11dc : 96e4             [ 4]   lda FrameCounter
11de : 84c1             [ 2]   anda #FRAME6MASK
11e0 : 262e             [ 3]   bne sdtSkipAlpha
                             
                               ;calc index into spin-table
11e2 : a6e4             [ 4]   lda LocalAngle,s
11e4 : 8e14d7           [ 3]   ldx #ShipAngleToAlpha
11e7 : a686             [ 5]   lda a,x
11e9 : 90b2             [ 4]   suba AlphaHi
11eb : 2402             [ 3]   bcc sdtIdxOk
11ed : 8bf0             [ 2]     adda #ALPHA_MAX
11ef :                       sdtIdxOk:
                             
                               ;Calc index into sine-table, and decide if valu
11ef : 5f               [ 2]   clrb
11f0 : 8178             [ 2]   cmpa #ALPHA_MAX/2
11f2 : 2503             [ 3]   blo sdtSinPositive
11f4 : 8078             [ 2]     suba #ALPHA_MAX/2
11f6 : 5a               [ 2]     decb
11f7 :                       sdtSinPositive:
                               ;IF W >= 60 then W := 120 - W;
11f7 : 813c             [ 2]   cmpa #ALPHA_MAX/4
11f9 : 2504             [ 3]   blo sdtNegSkip
11fb : 88ff             [ 2]     eora #$FF
11fd : 8b78             [ 2]     adda #ALPHA_MAX/2
11ff :                       sdtNegSkip:
11ff : 44               [ 2]   lsra                          ;a = 0..30, b = -
                             
1200 : 8e14f7           [ 3]   ldx #SpinSinTab
1203 : a686             [ 5]   lda a,x
1205 : 5d               [ 2]   tstb
1206 : 2701             [ 3]   beq sdtPositive
1208 : 40               [ 2]     nega
1209 :                       sdtPositive:
1209 : 1f89             [ 6]   tfr a,b
120b : 1d               [ 2]   sex
                             
120c : d3b4             [ 6]   addd AlphaDelta
120e : ddb4             [ 5]   std AlphaDelta
1210 :                       sdtSkipAlpha:
                             
1210 : 2012             [ 3]   bra sdtExit
                             
1212 :                       sdtNoPod:
                               ;ax := AccelLUT[ dir*2 ] * 2;
                               ;ay := AccelLUT[ dir*2+1 ] * 2;
1212 : e684             [ 4]   ldb ,x
1214 : 1d               [ 2]   sex
1215 : 58               [ 2]   aslb
1216 : 49               [ 2]   rola
1217 : d3b7             [ 6]   addd ShipSpeedX
1219 : ddb7             [ 5]   std ShipSpeedX
                             
121b : e601             [ 5]   ldb 1,x
121d : 1d               [ 2]   sex
121e : 58               [ 2]   aslb
121f : 49               [ 2]   rola
1220 : d3b9             [ 6]   addd ShipSpeedY
1222 : ddb9             [ 5]   std ShipSpeedY
                             
1224 :                       sdtExit:
                             
                               mFreeLocals
1224 : 3261             [ 5]>  leas FrameSize,s
                             
                               direct -1
1226 : 39               [ 5]   rts
                             
                             
                             ;*****************
1227 :                       Ship_UpdateShipPodPos:                  ;refresh 
                               ;Must be called after every change to centerx/y
ff42 =                       ShipExitY = WorldTopY + 50              ;exit bel
                               direct $c8
                             
                               mTestFlag HasOrbFlag
                            >  if 255>HasOrbFlag
1227 : 96e5             [ 4]>    lda GameFlags1
1229 : 8504             [ 2]>    bita #HasOrbFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(HasOrbFlag)>>8
                            >  endif
                             
122b : 2764             [ 3]   beq uspNoPod
                             
                               ;Update ship and pod
                             
                               ; I := Hi(nAlpha) * 2;
122d : 8e12b7           [ 3]   ldx #DistanceTable
1230 : d6b2             [ 4]   ldb AlphaHi
1232 : 4f               [ 2]   clra
1233 : 58               [ 2]   lslb
1234 : 49               [ 2]   rola
1235 : 308b             [ 8]   leax d,x
                             
                               ; ShipX := PixX + DistanceLUT[ I ];
                               ; ShipY := PixY - DistanceLUT[ I+1 ];
                               ; PodX := PixX - DistanceLUT[ I ];
                               ; PodY := PixY + DistanceLUT[ I+1 ];
1237 : a684             [ 4]   lda ,x
1239 : 109eac           [ 6]   ldy CenterX
123c : 31a6             [ 5]   leay a,y
123e : 109fbb           [ 6]   sty ShipX
                             
1241 : 40               [ 2]   nega
1242 : 109eac           [ 6]   ldy CenterX
1245 : 31a6             [ 5]   leay a,y
1247 : 109fbf           [ 6]   sty PodX
                             
124a : a601             [ 5]   lda 1,x
124c : 109eaf           [ 6]   ldy CenterY
124f : 31a6             [ 5]   leay a,y
1251 : 108cff42         [ 5]     cmpy #ShipExitY
1255 : 2e02             [ 3]     bgt uspPodYOk
1257 : 2020             [ 3]     bra uspExitLevel
1259 :                       uspPodYOk:
1259 : 109fc1           [ 6]   sty PodY
                             
125c : 40               [ 2]   nega
125d : 109eaf           [ 6]   ldy CenterY
1260 : 31a6             [ 5]   leay a,y
1262 : 108cff42         [ 5]     cmpy #ShipExitY
1266 : 2e02             [ 3]     bgt uspShipYOk
1268 : 200f             [ 3]     bra uspExitLevel
126a :                       uspShipYOk:
126a : 109fbd           [ 6]   sty ShipY
                             
126d : cec8bb           [ 3]   ldu #ShipX
1270 : 8d33             [ 7]   bsr ValidateX
1272 : cec8bf           [ 3]   ldu #PodX
1275 : 8d2e             [ 7]   bsr ValidateX
                             
1277 : 202b             [ 3]   bra uspExit
                             
1279 :                       uspExitLevel:                   ;Top of world: en
                               mSetFlag InactiveFlag         ;disable ship mov
                            >  if 255>InactiveFlag         
1279 : 8610             [ 2]>    lda #InactiveFlag         
127b : 9ae5             [ 4]>    ora GameFlags1
127d : 97e5             [ 4]>    sta GameFlags1
                            >  else
                            >    lda #(InactiveFlag         )>>8
                            >    ora GameFlags2
                            >    sta GameFlags2
                            >  endif
                             
                               mEmitFx FxTargetShip,FxTypeWarpOut,0
                            >  if ('0'!='0') && ('0'!='b')
                            >    tfr 0,b
                            >  endif
127f : 8670             [ 2]>  lda #FxTargetShip | (FxTypeWarpOut<<4)
1281 : bd06bb           [ 8]>  jsr EmitFx
                             
                               mTestFlag HasOrbFlag
                            >  if 255>HasOrbFlag
1284 : 96e5             [ 4]>    lda GameFlags1
1286 : 8504             [ 2]>    bita #HasOrbFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(HasOrbFlag)>>8
                            >  endif
                             
1288 : 271a             [ 3]   beq uspExit
                               mEmitFx FxTargetPod,FxTypeWarpOut,0
                            >  if ('0'!='0') && ('0'!='b')
                            >    tfr 0,b
                            >  endif
128a : 8671             [ 2]>  lda #FxTargetPod | (FxTypeWarpOut<<4)
128c : bd06bb           [ 8]>  jsr EmitFx
                             
128f : 2013             [ 3]   bra uspExit
                             
1291 :                       uspNoPod:                       ;update ship only
1291 : dcac             [ 5]   ldd CenterX
1293 : ddbb             [ 5]   std ShipX
1295 : dcaf             [ 5]   ldd CenterY
1297 : 1083ff42         [ 5]   cmpd #ShipExitY
129b : 2fdc             [ 3]   ble uspExitLevel
129d : ddbd             [ 5]   std ShipY
                             
129f : cec8bb           [ 3]   ldu #ShipX
12a2 : 8d01             [ 7]   bsr ValidateX
                             
12a4 :                       uspExit:
                             
                               direct -1
12a4 : 39               [ 5]   rts
                             
                             
                             ;*****************
12a5 :                       ValidateX:                      ;u=pointer to x c
                               direct $c8
12a5 : ecc4             [ 5]   ldd ,u
12a7 : 4d               [ 2]   tsta                          ;Check for world 
12a8 : 2a06             [ 3]   bpl vxCheckRightEdge
12aa : d3cd             [ 6]     addd CurLevelEndX           ;Left end hit, wr
                             ;    subd #1
12ac : edc4             [ 5]     std ,u
12ae : 2006             [ 3]     bra vxXOk
12b0 :                       vxCheckRightEdge:
12b0 : 93cd             [ 6]     subd CurLevelEndX
12b2 : 2b02             [ 3]     bmi vxXOk
12b4 : edc4             [ 5]     std ,u              ;Right edge hit
12b6 :                       vxXOk:
                               direct -1
12b6 : 39               [ 5]   rts
                             
                             
                             ;Distance from center to ship/pod. Xy-pairs.
                             ;This is the complete circle, we could use 1/4 ci
12b7 :                       DistanceTable:
12b7 : 1e001e001d011d..       db 30,0, 30,0, 29,1, 29,1, 29,3, 29,3, 29,4, 29,
12d7 : 1b0c1b0c1a0d1a..       db 27,12, 27,12, 26,13, 26,13, 25,15, 25,15, 25,
12f3 : 15151515141614..       db 21,21, 21,21, 20,22, 20,22, 18,23, 18,23, 17,
130f : 0c1b0c1b0a1c0a..       db 12,27, 12,27, 10,28, 10,28, 9,28, 9,28, 7,28,
132f : 001e001eff1dff..       db 0,30, 0,30, -1,29, -1,29, -3,29, -3,29, -4,29
134b : f61cf61cf41bf4..       db -10,28, -10,28, -12,27, -12,27, -13,26, -13,2
1363 : ee17ee17ec16ec..       db -18,23, -18,23, -20,22, -20,22, -21,21, -21,2
137b : e710e710e70ee7..       db -25,16, -25,16, -25,14, -25,14, -26,13, -26,1
1393 : e407e407e306e3..       db -28,7, -28,7, -29,6, -29,6, -29,4, -29,4, -29
13af : e3fde3fde3fce3..       db -29,-3, -29,-3, -29,-4, -29,-4, -29,-6, -29,-
13c7 : e5f4e5f4e6f3e6..       db -27,-12, -27,-12, -26,-13, -26,-13, -25,-15, 
13dd : e9eeeaeceaeceb..       db -23,-18, -22,-20, -22,-20, -21,-21, -21,-21, 
13f3 : f0e7f0e7f2e7f2..       db -16,-25, -16,-25, -14,-25, -14,-25, -13,-26, 
1409 : f7e4f9e4f9e4fa..       db -9,-28, -7,-28, -7,-28, -6,-29, -6,-29, -4,-2
1421 : 00e201e301e303..       db 0,-30, 1,-29, 1,-29, 3,-29, 3,-29, 4,-29, 4,-
143d : 0ae40ce50ce50d..       db 10,-28, 12,-27, 12,-27, 13,-26, 13,-26, 15,-2
1455 : 12e914ea14ea15..       db 18,-23, 20,-22, 20,-22, 21,-21, 21,-21, 22,-2
146d : 19f019f219f21a..       db 25,-16, 25,-14, 25,-14, 26,-13, 26,-13, 27,-1
1487 : 1dfa1dfa1dfc1d..       db 29,-6, 29,-6, 29,-4, 29,-4, 29,-3, 29,-3, 29,
                             
                             ;Acceleration values xy-pairs for each ship direc
1497 :                       AccelTable:
1497 : 190018fc17f714..       db 25,0, 24,-4, 23,-9, 20,-13, 17,-17, 13,-20, 9
14ab : f7e9f3ecefefec..       db -9,-23, -13,-20, -17,-17, -20,-13, -23,-9, -2
14bd : ec0def11f314f7..       db -20,13, -17,17, -13,20, -9,23, -4,24, 0,25, 4
14d1 : 140d17091804           db 20,13, 23,9, 24,4
                             
                             ;Map ShipAngle -> AlphaDir
14d7 :                       ShipAngleToAlpha:
14d7 : 00080f171e262d35       db   0,  8, 15, 23, 30, 38, 45, 53
14df : 3c444b535a626971       db  60, 68, 75, 83, 90, 98,105,113
14e7 : 7880878f969ea5ad       db 120,128,135,143,150,158,165,173
14ef : b4bcc3cbd2dae1e9       db 180,188,195,203,210,218,225,233
                             
                             ;Contains sine-values for a quarter of a circle
14f7 :                       SpinSinTab:
14f7 : 000305080a0d0f..       db   0,  3,  5,  8, 10, 13, 15, 18, 20, 23
1501 : 191b1d1f212325..       db  25, 27, 29, 31, 33, 35, 37, 39, 40, 42
150b : 2b2d2e2f303031..       db  43, 45, 46, 47, 48, 48, 49, 49, 50, 50
1515 : 32                     db  50
                             
1516 :                       DemoList:
1516 : 151c15e41768            dw DemoData1,DemoData2,DemoData3
                             
                             ;Recorded demo data
                             ;First two bytes: start level, reserved
151c :                       DemoData1:
151c : 0000                   db 0,0
151e : 000b100700010c..       db $00, $0b, $10, $07, $00, $01, $0c, $07, $20, 
152e : 20082100000801..       db $20, $08, $21, $00, $00, $08, $01, $00, $00, 
153e : 00050100000501..       db $00, $05, $01, $00, $00, $05, $01, $00, $00, 
154e : 1c150c141c070c..       db $1c, $15, $0c, $14, $1c, $07, $0c, $15, $00, 
155e : 0c05001120022c..       db $0c, $05, $00, $11, $20, $02, $2c, $06, $0c, 
156e : 20022c040c041c..       db $20, $02, $2c, $04, $0c, $04, $1c, $07, $0c, 
157e : 1e020e0502040e..       db $1e, $02, $0e, $05, $02, $04, $0e, $01, $2e, 
158e : 02040e0b020c22..       db $02, $04, $0e, $0b, $02, $0c, $22, $01, $2e, 
159e : 00062003000b20..       db $00, $06, $20, $03, $00, $0b, $20, $04, $00, 
15ae : 00060100000110..       db $00, $06, $01, $00, $00, $01, $10, $02, $11, 
15be : 1c000c072c0c0c..       db $1c, $00, $0c, $07, $2c, $0c, $0c, $15, $1c, 
15ce : 1c020c030e0b2e..       db $1c, $02, $0c, $03, $0e, $0b, $2e, $0f, $0e, 
15de : 0e291e010e7d           db $0e, $29, $1e, $01, $0e, $7d
                             
15e4 :                       DemoData2:
15e4 : 0100                   db 1,0
15e6 : 000f20072c010c..       db $00, $0f, $20, $07, $2c, $01, $0c, $12, $00, 
15f6 : 0008200a2c0f0c..       db $00, $08, $20, $0a, $2c, $0f, $0c, $0f, $20, 
1606 : 000320052c010c..       db $00, $03, $20, $05, $2c, $01, $0c, $06, $00, 
1616 : 000b0c06001920..       db $00, $0b, $0c, $06, $00, $19, $20, $03, $00, 
1626 : 000220062c010c..       db $00, $02, $20, $06, $2c, $01, $0c, $12, $2c, 
1636 : 00060100000610..       db $00, $06, $01, $00, $00, $06, $10, $01, $1c, 
1646 : 1c050c0d2c0820..       db $1c, $05, $0c, $0d, $2c, $08, $20, $03, $00, 
1656 : 00070100000501..       db $00, $07, $01, $00, $00, $05, $01, $00, $00, 
1666 : 00040100000b01..       db $00, $04, $01, $00, $00, $0b, $01, $00, $00, 
1676 : 1c061002001220..       db $1c, $06, $10, $02, $00, $12, $20, $07, $00, 
1686 : 00270c0b000720..       db $00, $27, $0c, $0b, $00, $07, $20, $0c, $00, 
1696 : 00030100000710..       db $00, $03, $01, $00, $00, $07, $10, $0a, $02, 
16a6 : 1e0a0e0802050c..       db $1e, $0a, $0e, $08, $02, $05, $0c, $09, $00, 
16b6 : 000b1002120102..       db $00, $0b, $10, $02, $12, $01, $02, $06, $0e, 
16c6 : 0e0a1e0f0e0302..       db $0e, $0a, $1e, $0f, $0e, $03, $02, $02, $00, 
16d6 : 00070100000601..       db $00, $07, $01, $00, $00, $06, $01, $00, $00, 
16e6 : 0c0c1c040c0600..       db $0c, $0c, $1c, $04, $0c, $06, $00, $06, $20, 
16f6 : 01000007010000..       db $01, $00, $00, $07, $01, $00, $00, $04, $01, 
1706 : 0c100000100100..       db $0c, $10, $00, $00, $10, $01, $00, $08, $01, 
1716 : 01000004010000..       db $01, $00, $00, $04, $01, $00, $00, $08, $01, 
1726 : 0c052c080c0a1c..       db $0c, $05, $2c, $08, $0c, $0a, $1c, $01, $10, 
1736 : 0100000e0c052c..       db $01, $00, $00, $0e, $0c, $05, $2c, $00, $20, 
1746 : 0e350005200d0c..       db $0e, $35, $00, $05, $20, $0d, $0c, $08, $00, 
1756 : 1c030c132c040c..       db $1c, $03, $0c, $13, $2c, $04, $0c, $19, $1c, 
1766 : 0051                   db $00, $51
                             
1768 :                       DemoData3:
1768 : 0200                   db 2,0
176a : 0006200f2c020c..       db $00, $06, $20, $0f, $2c, $02, $0c, $09, $00, 
177a : 2e060e0002020e..       db $2e, $06, $0e, $00, $02, $02, $0e, $18, $02, 
178a : 2e012c00200a2c..       db $2e, $01, $2c, $00, $20, $0a, $2c, $00, $0c, 
179a : 01000007200f00..       db $01, $00, $00, $07, $20, $0f, $00, $00, $0c, 
17aa : 0c1b2c0020142c..       db $0c, $1b, $2c, $00, $20, $14, $2c, $01, $0c, 
17ba : 0c0f2c030c051c..       db $0c, $0f, $2c, $03, $0c, $05, $1c, $0d, $10, 
17ca : 00030100000320..       db $00, $03, $01, $00, $00, $03, $20, $06, $2c, 
17da : 0c051c0f0c0e00..       db $0c, $05, $1c, $0f, $0c, $0e, $00, $14, $02, 
17ea : 0e0102040e032e..       db $0e, $01, $02, $04, $0e, $03, $2e, $00, $22, 
17fa : 22062e000e072e..       db $22, $06, $2e, $00, $0e, $07, $2e, $0b, $0e, 
180a : 000502050e031e..       db $00, $05, $02, $05, $0e, $03, $1e, $02, $12, 
181a : 0e0312051e000e..       db $0e, $03, $12, $05, $1e, $00, $0e, $08, $02, 
182a : 2e042008002910..       db $2e, $04, $20, $08, $00, $29, $10, $0b, $00, 
183a : 0e0b1e01120102..       db $0e, $0b, $1e, $01, $12, $01, $02, $11, $12, 
184a : 000510021c111e..       db $00, $05, $10, $02, $1c, $11, $1e, $0b, $1f, 
185a : 01000009010000..       db $01, $00, $00, $09, $01, $00, $00, $07, $01, 
186a : 01000007010000..       db $01, $00, $00, $07, $01, $00, $00, $03, $01, 
187a : 0c121c0010091c..       db $0c, $12, $1c, $00, $10, $09, $1c, $00, $0c, 
188a : 0c000009200e2c..       db $0c, $00, $00, $09, $20, $0e, $2c, $03, $0c, 
189a : 100400030c1a2c..       db $10, $04, $00, $03, $0c, $1a, $2c, $0c, $0c, 
18aa : 020912001e030e..       db $02, $09, $12, $00, $1e, $03, $0e, $02, $02, 
18ba : 02020e0302060e..       db $02, $02, $0e, $03, $02, $06, $0e, $0d, $1e, 
18ca : 01000004200221..       db $01, $00, $00, $04, $20, $02, $21, $00, $00, 
18da : 00060100000601..       db $00, $06, $01, $00, $00, $06, $01, $00, $00, 
18ea : 00060100000401..       db $00, $06, $01, $00, $00, $04, $01, $00, $00, 
18fa : 00070100000320..       db $00, $07, $01, $00, $00, $03, $20, $04, $2c, 
190a : 10070000020422..       db $10, $07, $00, $00, $02, $04, $22, $11, $02, 
191a : 0200000920092c..       db $02, $00, $00, $09, $20, $09, $2c, $01, $0c, 
192a : 01000006010000..       db $01, $00, $00, $06, $01, $00, $00, $04, $10, 
193a : 1e030e04020000..       db $1e, $03, $0e, $04, $02, $00, $00, $21, $01, 
194a : 0d00000c010000..       db $0d, $00, $00, $0c, $01, $00, $00, $06, $10, 
195a : 01000006010000..       db $01, $00, $00, $06, $01, $00, $00, $0a, $20, 
196a : 0c160008200502..       db $0c, $16, $00, $08, $20, $05, $02, $03, $0e, 
197a : 1c000c07000620..       db $1c, $00, $0c, $07, $00, $06, $20, $05, $22, 
198a : 0e171e040e080c..       db $0e, $17, $1e, $04, $0e, $08, $0c, $1b, $2c, 
199a : 1c0e001a010000..       db $1c, $0e, $00, $1a, $01, $00, $00, $07, $01, 
19aa : 0100000420082c..       db $01, $00, $00, $04, $20, $08, $2c, $04, $0c, 
19ba : 020400050c0700..       db $02, $04, $00, $05, $0c, $07, $00, $01, $10, 
19ca : 0c0a00080c132c..       db $0c, $0a, $00, $08, $0c, $13, $2c, $07, $0c, 
19da : 0c0b0002200900..       db $0c, $0b, $00, $02, $20, $09, $00, $05, $0c, 
19ea : 0c021c06100500..       db $0c, $02, $1c, $06, $10, $05, $00, $07, $0c, 
19fa : 0c0d1c010c352c..       db $0c, $0d, $1c, $01, $0c, $35, $2c, $04, $0c, 
1a0a : 0cd5001b               db $0c, $d5, $00, $1b
                             
                             
                             ;*****************
1a0e :                       UpdateFrameCounter:
                               direct $c8
1a0e : 96e4             [ 4]   lda FrameCounter
1a10 : 2a02             [ 3]   bpl ufcOkCnt3
1a12 : 8a40             [ 2]     ora #$40
1a14 :                       ufcOkCnt3:
1a14 : 8b40             [ 2]   adda #$40
1a16 : 97e4             [ 4]   sta FrameCounter
                             
1a18 : 843f             [ 2]   anda #$3f
1a1a : 2604             [ 3]   bne ufcOkCnt64
1a1c : 863f             [ 2]     lda #$3f
1a1e : 2002             [ 3]     bra ufcDoAdd
1a20 :                       ufcOkCnt64:
1a20 : 86ff             [ 2]   lda #$ff
1a22 :                       ufcDoAdd:
1a22 : 9be4             [ 4]   adda FrameCounter
1a24 : 97e4             [ 4]   sta FrameCounter
                             
                              if false
                                 ;Atari 2600 code
                                 lda     FrameCnt            ; 3
                                 sta     FrameCnt1
                                 bpl     .okCnt3             ; 2³
                                 ora     #$40                ; 2         reset
                             .okCnt3:
                                 clc                         ; 2
                                 adc     #$40                ; 2         incre
                                 sta     FrameCnt            ; 3
                             
                                 and     #$3f                ; 2
                                 bne     .okCnt64            ; 2³
                                 lda     #$3f                ; 2         reset
                                 BIT_W                       ; 2
                             .okCnt64:
                                 lda     #$ff                ; 2         incre
                                 clc                         ; 2
                                 adc     FrameCnt            ; 3
                                 sta     FrameCnt            ; 3 = 28-32
                               endif
                             
                               direct -1
1a26 : 39               [ 5]   rts
                             
                             
                             ;*****************
1a27 :                       DrawDisplay:            ;Draw status panel. Copy 
1a27 : b6c8da           [ 5]   lda DemoMode          ;no display in demomode
1a2a : 2a01             [ 3]   bpl ddGoOn
1a2c : 39               [ 5]     rts
1a2d :                       ddGoOn:
                               mDecLocals 0,0,20
                            >  nolist
                             
                             
1a30 : 33e4             [ 4]   leau LocalBuffer,s
                             
1a32 : b6c87a           [ 5]   lda GameMode
1a35 : 8102             [ 2]   cmpa #TimeAttackGame
1a37 : 2632             [ 3]   bne ddNoTimeAttack
                             
1a39 : cc5449           [ 3]   ldd #'TI'
1a3c : edc1             [ 8]   std ,u++
1a3e : cc4d45           [ 3]   ldd #'ME'
1a41 : edc1             [ 8]   std ,u++
1a43 : cc3a20           [ 3]   ldd #': '
1a46 : edc1             [ 8]   std ,u++
1a48 : f6c8e3           [ 5]   ldb TimeAttackTime    ;time, flash if low
1a4b : c10a             [ 2]   cmpb #10
1a4d : 2c10             [ 3]   bge ddDoTime
1a4f : b6c826           [ 5]   lda LoopCounterLow
1a52 : 8408             [ 2]   anda #8
1a54 : 2609             [ 3]   bne ddDoTime
1a56 : cc2020           [ 3]   ldd #'  '
1a59 : edc4             [ 5]   std ,u
1a5b : ed42             [ 6]   std 2,u
1a5d : 2006             [ 3]   bra ddTimeFin
1a5f :                       ddDoTime:
1a5f : 4f               [ 2]   clra
1a60 : 1f01             [ 6]   tfr d,x
1a62 : bd4de8           [ 8]   jsr Text_ConvertX
1a65 :                       ddTimeFin:
1a65 : c680             [ 2]   ldb #$80              ;end byte
1a67 : e744             [ 5]   stb 4,u
1a69 : 2042             [ 3]   bra ddDoDraw
                             
1a6b :                       ddNoTimeAttack:         ;normal game
1a6b : 8ec8da           [ 3]   ldx #PlayerScore      ;copy score to buffer
1a6e : c620             [ 2]   ldb #' '
1a70 : 8d48             [ 7]   bsr CopyScoreFromXtoU
                             
1a72 : 3347             [ 5]   leau 7,u              ;Nr of ships left
1a74 : e7c4             [ 4]   stb ,u
1a76 : b6c8e0           [ 5]   lda ShipLives
1a79 : 8b30             [ 2]   adda #'0'
1a7b : ed41             [ 6]   std 1,u
                             
1a7d : 3343             [ 5]   leau 3,u              ;Fuel, flash if low
1a7f : b6c87a           [ 5]   lda GameMode
1a82 : 8103             [ 2]   cmpa #BonusGame
1a84 : 2608             [ 3]   bne ddNotBonus
                                 ;In bonusgame, draw current level instead of 
1a86 : f6c8d1           [ 5]     ldb CurLevel
1a89 : 4f               [ 2]     clra
1a8a : 1f01             [ 6]     tfr d,x
1a8c : 2018             [ 3]     bra ddDrawFuel
1a8e :                       ddNotBonus
1a8e : bec8e1           [ 6]   ldx ShipFuel
1a91 : 8c012c           [ 4]   cmpx #300
1a94 : 2c10             [ 3]   bge ddDrawFuel
1a96 : b6c826           [ 5]   lda LoopCounterLow
1a99 : 8408             [ 2]   anda #8
1a9b : 2609             [ 3]   bne ddDrawFuel
1a9d :                       ddSkipFuel:
1a9d : cc2020           [ 3]   ldd #'  '
1aa0 : edc4             [ 5]   std ,u
1aa2 : ed42             [ 6]   std 2,u
1aa4 : 2003             [ 3]   bra ddFuelFin
1aa6 :                       ddDrawFuel:
1aa6 : bd4de8           [ 8]   jsr Text_ConvertX
1aa9 :                       ddFuelFin:
1aa9 : c680             [ 2]   ldb #$80              ;End byte
1aab : e744             [ 5]   stb 4,u
                             
1aad :                       ddDoDraw:
1aad : 8672             [ 2]   lda #114
1aaf : c6b3             [ 2]   ldb #-127 + 50
1ab1 : 30e4             [ 4]   leax LocalBuffer,s
1ab3 : bd4cb9           [ 8]   jsr Text_Print
                             
                               mFreeLocals
1ab6 : 32e814           [ 5]>  leas FrameSize,s
                             
1ab9 : 39               [ 5]   rts
                             
1aba :                       CopyScoreFromXtoU:      ;u=destination buffer, b=
1aba : e77f             [ 5]   stb -1,s
1abc : ec84             [ 5]   ldd ,x
1abe : edc4             [ 5]   std ,u
1ac0 : ec02             [ 6]   ldd 2,x
1ac2 : ed42             [ 6]   std 2,u
1ac4 : ec04             [ 6]   ldd 4,x
1ac6 : ed44             [ 6]   std 4,u
1ac8 : 8630             [ 2]   lda #$30            ;extra zero + end byte
1aca : e67f             [ 5]   ldb -1,s
1acc : ed46             [ 6]   std 6,u
1ace : 39               [ 5]   rts
                             
                             ;*****************
1acf :                       GiveScoreA:
0009 =                       MAX_LIVES = 9
1acf : f6c8da           [ 5]   ldb DemoMode          ;no score in demomode
1ad2 : 2a01             [ 3]   bpl gsaGoOn
1ad4 : 39               [ 5]     rts
1ad5 :                       gsaGoOn:
1ad5 : 3450             [ 9]   pshs x,u
1ad7 : 8ec8da           [ 3]   ldx #PlayerScore
1ada : 10ae02           [ 7]   ldy 2,x
1add : bdf85e           [ 8]   jsr convert_a_to_bcd_and_add
1ae0 : 1f20             [ 6]   tfr y,d
1ae2 : a102             [ 5]   cmpa 2,x              ;extra life each 10000 po
1ae4 : 271c             [ 3]   beq gsaExit
1ae6 : b6c87a           [ 5]     lda GameMode
1ae9 : 8101             [ 2]     cmpa #HardGame      ;every 20000 for hard mod
1aeb : 2606             [ 3]     bne gsaExtra
1aed : a602             [ 5]       lda 2,x
1aef : 8401             [ 2]       anda #1
1af1 : 260f             [ 3]       bne gsaExit
1af3 :                       gsaExtra:
1af3 : b6c8e0           [ 5]     lda ShipLives
1af6 : 8109             [ 2]     cmpa #MAX_LIVES
1af8 : 2708             [ 3]     beq gsaExit
1afa : 7cc8e0           [ 7]     inc ShipLives
                                 mEmitSound ExtraLifeSoundId
                            >  if 1=1
1afd : 8610             [ 2]>    lda #ExtraLifeSoundId
                            >  endif
1aff : bd0476           [ 8]>  jsr EmitSound
                             
1b02 :                       gsaExit:
1b02 : 3550             [ 9]   puls x,u
1b04 : 39               [ 5]   rts
                             
                             
                             
                             
                             
                             ;*****************
1b05 :                       AdjustFuel:                     ;Update ship fuel
                               direct $c8
                               mDecLocals 1,0,0
                            >  nolist
                             
                             
1b07 : 96e4             [ 4]   lda FrameCounter
1b09 : 84c0             [ 2]   anda #FRAME3MASK
1b0b : 2635             [ 3]   bne afExit
                             
1b0d : 0d6a             [ 6]   tst CheatLives
1b0f : 2631             [ 3]   bne afExit
                             
                               mTestFlag InactiveFlag
                            >  if 255>InactiveFlag
1b11 : 96e5             [ 4]>    lda GameFlags1
1b13 : 8510             [ 2]>    bita #InactiveFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(InactiveFlag)>>8
                            >  endif
                             
1b15 : 262b             [ 3]   bne afExit
                             
                               ;if refueling, inc 1
                               ;else
                               ;  if shield -1
                               ;  if thrust -1 (if hasorb extra -1)
                             
1b17 : 6fe4             [ 6]   clr LocalB1,s
                             
                               mTestFlag RefuelFlag
                            >  if 255>RefuelFlag
1b19 : 96e5             [ 4]>    lda GameFlags1
1b1b : 8502             [ 2]>    bita #RefuelFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(RefuelFlag)>>8
                            >  endif
                             
1b1d : 2612             [ 3]   bne afRefueling
                             
                               mTestFlag ThrustFlag
                            >  if 255>ThrustFlag
1b1f : 96e5             [ 4]>    lda GameFlags1
1b21 : 8520             [ 2]>    bita #ThrustFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(ThrustFlag)>>8
                            >  endif
                             
1b23 : 2702             [ 3]   beq afTestShield
1b25 : 6ae4             [ 6]     dec LocalB1,s
                             ;    mTestFlag HasOrbFlag
                             ;    beq afTestShield
                             ;      dec LocalB1,s
1b27 :                       afTestShield:
                               mTestFlag ShieldFlag
                            >  if 255>ShieldFlag
1b27 : 96e5             [ 4]>    lda GameFlags1
1b29 : 8501             [ 2]>    bita #ShieldFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(ShieldFlag)>>8
                            >  endif
                             
1b2b : 2708             [ 3]   beq afStore
1b2d : 6ae4             [ 6]     dec LocalB1,s
1b2f : 2004             [ 3]     bra afStore
                             
1b31 :                       afRefueling:
1b31 : 8610             [ 2]   lda #16
1b33 : a7e4             [ 4]   sta LocalB1,s
                             
1b35 :                       afStore:
1b35 : e6e4             [ 4]   ldb LocalB1,s
1b37 : 2709             [ 3]   beq afExit
1b39 : 1d               [ 2]   sex
1b3a : d3e1             [ 6]   addd ShipFuel
1b3c : 2a02             [ 3]   bpl afOk
1b3e : 4f               [ 2]     clra
1b3f : 5f               [ 2]     clrb
1b40 :                       afOk:
1b40 : dde1             [ 5]   std ShipFuel
1b42 :                       afExit:
                             
                               mFreeLocals
1b42 : 3261             [ 5]>  leas FrameSize,s
                             
                               direct -1
1b44 : 39               [ 5]   rts
                             
                             
                             ;*****************              ;See if it's time
                             ;List of center angle for each gun type
                             ;NE,NW,SE,SW
1b45 : f808e818              GunShotAngles: db -8,8,-24,24
                             
1b49 :                       UpdateGuns:
                               mDecLocals 2,2
                            >  nolist
                             
0001 =                       LocalAngle = LocalB2
0004 =                       LocalGun = LocalW2
0078 =                       MaxGunDistance = 120            ;Minimum distance
                               direct $c8
                             
1b4b : 96f7             [ 4]   lda GunShotTimer              ;Check delay time
1b4d : 2706             [ 3]   beq ugTimeOk
1b4f : 4a               [ 2]     deca
1b50 : 97f7             [ 4]     sta GunShotTimer
1b52 : 7e1c26           [ 4]     lbra ugFin
                             
1b55 :                       ugTimeOk:
1b55 : 96f6             [ 4]   lda GunShotActive             ;Exit if no empty
1b57 : 8107             [ 2]   cmpa #GunShotAllActive
1b59 : 102700c9         [ 6]   lbeq ugFin
                             
1b5d : 0df4             [ 6]   tst PowerShot                 ;Exit if guns are
1b5f : 102600c3         [ 6]   lbne ugFin
                             
1b63 : deca             [ 5]   ldu CurLevelEntry             ;Find a gun that 
1b65 : ee44             [ 6]   ldu leGuns,u
1b67 : 102700bb         [ 6]   lbeq ugFin                    ;exit if no guns
1b6b : e6c0             [ 6]   ldb ,u+                       ;load guncount
1b6d : e7e4             [ 4]   stb LocalB1,s
1b6f : dce7             [ 5]   ldd GunsActive
1b71 :                       ugGunLoop:
1b71 : 47               [ 2]   asra
1b72 : 56               [ 2]   rorb
1b73 : 242f             [ 3]   bcc ugGunNotActive
1b75 : ed62             [ 6]   std LocalW1,s
                             
1b77 : ecc4             [ 5]   ldd geGunX,u
1b79 : 93bb             [ 6]   subd ShipX
                               mTestRangeD -MaxGunDistance,MaxGunDistance,ugNe
1b7b : 1083ff88         [ 5]>  cmpd #-MaxGunDistance
1b7f : 2d21             [ 3]>  blt ugNextGun
1b81 : 10830078         [ 5]>  cmpd #MaxGunDistance
1b85 : 2e1b             [ 3]>  bgt ugNextGun
                             
                             
1b87 : ec42             [ 6]   ldd geGunY,u
1b89 : 93bd             [ 6]   subd ShipY
                               mTestRangeD -MaxGunDistance,MaxGunDistance,ugNe
1b8b : 1083ff88         [ 5]>  cmpd #-MaxGunDistance
1b8f : 2d11             [ 3]>  blt ugNextGun
1b91 : 10830078         [ 5]>  cmpd #MaxGunDistance
1b95 : 2e0b             [ 3]>  bgt ugNextGun
                             
                             
                               ;Gun can shoot, throw a dice to see if choose t
                               ;Otherwise the first closest gun would always f
                               mRandomToA
1b97 : bdf511           [ 8]>  jsr random                    ;call rom
                             
1b9a : 8403             [ 2]   anda #3
1b9c : 2604             [ 3]   bne ugNextGun
                             
1b9e : ef64             [ 6]   stu LocalGun,s
1ba0 : 200b             [ 3]   bra ugGunFound
                             
1ba2 :                       ugNextGun:
1ba2 : ec62             [ 6]   ldd LocalW1,s
1ba4 :                       ugGunNotActive:
1ba4 : 3345             [ 5]   leau GunEntry,u
1ba6 : 6ae4             [ 6]   dec LocalB1,s
1ba8 : 26c7             [ 3]   bne ugGunLoop
1baa : 207a12           [ 3]   jmp ugFin                     ;No gun was found
1bad :                       ugGunFound:
                             
1bad : 8600             [ 2]   lda #0                        ;Find a free guns
1baf : d6f6             [ 4]   ldb GunShotActive
1bb1 : cec8fb           [ 3]   ldu #GunShots
1bb4 :                       ugLoop:
1bb4 : 57               [ 2]   asrb                          ;test active
1bb5 : 2568             [ 3]   bcs ugAlreadyActive
1bb7 : ed62             [ 6]   std LocalW1,s
                             
1bb9 : ae64             [ 6]   ldx LocalGun,s                ;Slot found, emit
1bbb : ec84             [ 5]   ldd geGunX,x
1bbd : edc4             [ 5]   std gsShotX,u
1bbf : ec02             [ 6]   ldd geGunY,x
1bc1 : ed43             [ 6]   std gsShotY,u
                             
1bc3 : a604             [ 5]   lda geGunSprite,x
1bc5 : 8e1b45           [ 3]   ldx #GunShotAngles
1bc8 : e686             [ 5]   ldb a,x
                             
                               ;16 is 90 deg
                             
                               ;gun can shoot in 135 deg (0..23)
                               ;repeat until we have a random value 0..23
1bca : 8e0000           [ 3]   ldx #0
1bcd :                       ugRndAngle:
1bcd : 3001             [ 5]   leax 1,x
1bcf : 8c0005           [ 4]   cmpx #5                       ;bailout after 5 
1bd2 : 2604             [ 3]   bne ugRndAngle1
1bd4 : 860c             [ 2]     lda #12
1bd6 : 200b             [ 3]     bra ugRndAngle2
1bd8 :                       ugRndAngle1:
                               mRandomToA
1bd8 : bdf511           [ 8]>  jsr random                    ;call rom
                             
                               ;improve randomness by xoring loopcounter
1bdb : 9826             [ 4]   eora LoopCounterLow
1bdd : 841f             [ 2]   anda #31
1bdf : 8117             [ 2]   cmpa #23
1be1 : 22ea             [ 3]   bhi ugRndAngle
1be3 :                       ugRndAngle2:
1be3 : 800c             [ 2]   suba #12                      ;a is -12..11
                             
1be5 : a77f             [ 5]   sta -1,s
1be7 : eb7f             [ 5]   addb -1,s                     ;final angle is g
1be9 : e761             [ 5]   stb LocalAngle,s
                             
1beb : e661             [ 5]   ldb LocalAngle,s              ;Calc rise & run
1bed : 96fa             [ 4]   lda GunShotSpeed              ;scale
                             
1bef : bdf601           [ 8]   jsr convert_angle_to_rise_run ;dp must be c8
1bf2 : 40               [ 2]   nega                          ;Y axis points do
1bf3 : a747             [ 5]   sta gsShotVelocY,u
1bf5 : e746             [ 5]   stb gsShotVelocX,u
                             
1bf7 : a662             [ 5]   lda LocalW1,s                 ;Set shot active
                               mSetBitA GunShotActive
1bf9 : c601             [ 2]>  ldb #1
1bfb :                      >lop0426:
1bfb : 4a               [ 2]>  deca
1bfc : 2b03             [ 3]>  bmi fin0426
1bfe : 59               [ 2]>  rolb
1bff : 20fa             [ 3]>  bra lop0426
1c01 :                      >fin0426:
1c01 : daf6             [ 4]>  orb GunShotActive
1c03 : d7f6             [ 4]>  stb GunShotActive
                             
                             
                               mRandomToA                    ;Reset delay for 
1c05 : bdf511           [ 8]>  jsr random                    ;call rom
                             
1c08 : 94f8             [ 4]   anda GunShotMask
1c0a : 9bf9             [ 4]   adda GunShotDelay
1c0c : 97f7             [ 4]   sta GunShotTimer
                             
                               ;mEmitSound GunFireSoundId
1c0e : deca             [ 5]   ldu CurLevelEntry             ;Get index of fir
1c10 : ee44             [ 6]   ldu leGuns,u
1c12 : e6c4             [ 4]   ldb ,u
1c14 : e0e4             [ 4]   subb LocalB1,s
                               mEmitFx FxTargetGun,FxTypeGunFire,b
                            >  if ('b'!='0') && ('b'!='b')
                            >    tfr b,b
                            >  endif
1c16 : 86a2             [ 2]>  lda #FxTargetGun | (FxTypeGunFire<<4)
1c18 : bd06bb           [ 8]>  jsr EmitFx
                             
                             
1c1b : 2009             [ 3]   bra ugFin                     ;Exit
                             
1c1d :                       ugNext:
1c1d : ec62             [ 6]   ldd LocalW1,s
1c1f :                       ugAlreadyActive:
1c1f : 3348             [ 5]   leau GunShotEntry,u
1c21 : 4c               [ 2]   inca
1c22 : 8103             [ 2]   cmpa #MaxGunShots
1c24 : 268e             [ 3]   bne ugLoop
                             
1c26 :                       ugFin:
                               direct -1
                               mFreeLocals
1c26 : 3266             [ 5]>  leas FrameSize,s
                             
1c28 : 39               [ 5]   rts
                             
                             
                             ;*****************              ;Update active gu
1c29 :                       UpdateGunShots
                               mDecLocals 0,1
                            >  nolist
                             
                               direct $c8
                             
1c2b : 8600             [ 2]   lda #0                        ;loop from 0 to M
1c2d : d6f6             [ 4]   ldb GunShotActive
1c2f : cec8fb           [ 3]   ldu #GunShots
1c32 :                       gsMoveLoop:
1c32 : 57               [ 2]   asrb                          ;test active
1c33 : 10240148         [ 6]   lbcc gsNotActive
1c37 : ede4             [ 5]   std LocalW1,s
                             
                               ;Move
                               mUpdateXCoord gsShotX, gsShotVelocX
1c39 : 30c4             [ 4]>  leax gsShotX,u               ;Update sprite X c
                            >  mGet_D_from_fixed
1c3b : ec84             [ 5]>  ldd ,x
                            >
1c3d : 6802             [ 7]>  asl 2,x
1c3f : 59               [ 2]>  rolb
1c40 : 49               [ 2]>  rola
                            >
1c41 : 6802             [ 7]>  asl 2,x
1c43 : 59               [ 2]>  rolb
1c44 : 49               [ 2]>  rola
                            >
1c45 : ed7e             [ 6]>  std -2,s
1c47 : e646             [ 5]>  ldb  gsShotVelocX,u
1c49 : 1d               [ 2]>  sex
1c4a : e37e             [ 7]>  addd -2,s
                            >  mStore_D_as_fixed
1c4c : 6f02             [ 7]>  clr 2,x
                            >
1c4e : 47               [ 2]>  asra
1c4f : 56               [ 2]>  rorb
1c50 : 6602             [ 7]>  ror 2,x
                            >
1c52 : 47               [ 2]>  asra
1c53 : 56               [ 2]>  rorb
1c54 : 6602             [ 7]>  ror 2,x
                            >
1c56 : ed84             [ 5]>  std ,x
                            >
1c58 : 4d               [ 2]>  tsta                          ;Check for world 
1c59 : 2a06             [ 3]>  bpl CheckRightEdge0443
1c5b : d3cd             [ 6]>    addd CurLevelEndX           ;Left end hit, wr
1c5d : edc4             [ 5]>    std gsShotX,u
1c5f : 2006             [ 3]>    bra XOk0443
1c61 :                      >CheckRightEdge0443:
1c61 : 93cd             [ 6]>    subd CurLevelEndX
1c63 : 2b02             [ 3]>    bmi XOk0443
1c65 : edc4             [ 5]>    std gsShotX,u              ;Right edge hit
1c67 :                      >XOk0443:
                             
                               mUpdateYCoord gsShotY, gsShotVelocY, gsRemoveSh
1c67 : 3043             [ 5]>  leax gsShotY,u               ;Update sprite Y c
                            >  mGet_D_from_fixed
1c69 : ec84             [ 5]>  ldd ,x
                            >
1c6b : 6802             [ 7]>  asl 2,x
1c6d : 59               [ 2]>  rolb
1c6e : 49               [ 2]>  rola
                            >
1c6f : 6802             [ 7]>  asl 2,x
1c71 : 59               [ 2]>  rolb
1c72 : 49               [ 2]>  rola
                            >
1c73 : ed7e             [ 6]>  std -2,s
1c75 : e647             [ 5]>  ldb  gsShotVelocY,u
1c77 : 1d               [ 2]>  sex
1c78 : e37e             [ 7]>  addd -2,s
1c7a : 1083fc40         [ 5]>  cmpd #WorldTopY << Fixed
1c7e : 2e03             [ 3]>  bgt NotHitTopOfWorld0446
1c80 : 7e1d6f           [ 4]>    lbra  gsRemoveShot            ;Top of world h
1c83 :                      >NotHitTopOfWorld0446:
                            >  mStore_D_as_fixed
1c83 : 6f02             [ 7]>  clr 2,x
                            >
1c85 : 47               [ 2]>  asra
1c86 : 56               [ 2]>  rorb
1c87 : 6602             [ 7]>  ror 2,x
                            >
1c89 : 47               [ 2]>  asra
1c8a : 56               [ 2]>  rorb
1c8b : 6602             [ 7]>  ror 2,x
                            >
1c8d : ed84             [ 5]>  std ,x
                            >
                             
                             
                               mTestFlag HomingGunShotsFlag
                            >  if 255>HomingGunShotsFlag
                            >    lda GameFlags1
                            >    bita #HomingGunShotsFlag
                            >  else
1c8f : 96e6             [ 4]>    lda GameFlags2
1c91 : 8502             [ 2]>    bita #(HomingGunShotsFlag)>>8
                            >  endif
                             
1c93 : 2746             [ 3]   beq gsNoHoming
                               ;Try to make the homing missiles move unpredict
                               ;Skip homingness a while each second to avoid t
1c95 : 9626             [ 4]   lda LoopCounterLow
1c97 : 8120             [ 2]   cmpa #32
1c99 : 2540             [ 3]   blo gsNoHoming
1c9b : 8401             [ 2]   anda #1
1c9d : 273c             [ 3]   beq gsNoHoming
1c9f : a6e4             [ 4]   lda LocalW1,s
1ca1 : 8401             [ 2]   anda #1
1ca3 : 2636             [ 3]   bne gsNoHoming
000c =                       ShotVelocXMax=12
1ca5 : dcbb             [ 5]   ldd ShipX
1ca7 : 10a3c4           [ 7]   cmpd gsShotX,u
1caa : 250b             [ 3]   blo gsHomeXDec
1cac : a646             [ 5]     lda gsShotVelocX,u
1cae : 810c             [ 2]     cmpa #ShotVelocXMax
1cb0 : 2c0e             [ 3]     bge gsHomeXFin
1cb2 : 4c               [ 2]     inca
1cb3 : a746             [ 5]     sta gsShotVelocX,u
                             ;    inc gsShotVelocX,u
1cb5 : 2009             [ 3]     bra gsHomeXFin
1cb7 :                       gsHomeXDec:
1cb7 : a646             [ 5]     lda gsShotVelocX,u
1cb9 : 81f4             [ 2]     cmpa #-ShotVelocXMax
1cbb : 2f03             [ 3]     ble gsHomeXFin
1cbd : 4a               [ 2]     deca
1cbe : a746             [ 5]     sta gsShotVelocX,u
                             ;    dec gsShotVelocX,u
1cc0 :                       gsHomeXFin
                             
000c =                       ShotVelocYMax=12
1cc0 : dcbd             [ 5]   ldd ShipY
1cc2 : 10a343           [ 8]   cmpd gsShotY,u
1cc5 : 250b             [ 3]   blo gsHomeYDec
1cc7 : a647             [ 5]     lda gsShotVelocY,u
1cc9 : 810c             [ 2]     cmpa #ShotVelocYMax
1ccb : 2c0e             [ 3]     bge gsHomeYFin
1ccd : 4c               [ 2]     inca
1cce : a747             [ 5]     sta gsShotVelocY,u
1cd0 : 2009             [ 3]     bra gsHomeYFin
1cd2 :                       gsHomeYDec:
1cd2 : a647             [ 5]     lda gsShotVelocY,u
1cd4 : 81f4             [ 2]     cmpa #-ShotVelocYMax
1cd6 : 2f03             [ 3]     ble gsHomeYFin
1cd8 : 4a               [ 2]     deca
1cd9 : a747             [ 5]     sta gsShotVelocY,u
1cdb :                       gsHomeYFin
                             
1cdb :                       gsNoHoming:
                             
1cdb : 108ec8bb         [ 4]   ldy #ShipX                    ;Collision gunsho
                               mPointVsArea ShipArea,gsShipOk, gsShotX,gsShotY
1cdf : aec4             [ 5]>  ldx      gsShotX,u
1ce1 : eca4             [ 5]>  ldd      0,y
1ce3 : 830004           [ 4]>  subd    #ShipArea/2
1ce6 : ed7e             [ 6]>  std -2,s
1ce8 : ac7e             [ 7]>  cmpx -2,s
1cea : 102d0030         [ 6]>  lblt    gsShipOk
1cee : c30008           [ 4]>  addd    #ShipArea
1cf1 : ed7e             [ 6]>  std -2,s
1cf3 : ac7e             [ 7]>  cmpx -2,s
1cf5 : 102e0025         [ 6]>  lbgt    gsShipOk
1cf9 : ae43             [ 6]>  ldx     gsShotY,u
1cfb : ec22             [ 6]>  ldd     2,y
1cfd : 830004           [ 4]>  subd    #ShipArea/2
1d00 : ed7e             [ 6]>  std -2,s
1d02 : ac7e             [ 7]>  cmpx -2,s
1d04 : 102d0016         [ 6]>  lblt    gsShipOk
1d08 : c30008           [ 4]>  addd    #ShipArea
1d0b : ed7e             [ 6]>  std -2,s
1d0d : ac7e             [ 7]>  cmpx -2,s
1d0f : 102e000b         [ 6]>  lbgt    gsShipOk
                             
                                 mTestFlag ShieldFlag        ;if shield, just 
                            >  if 255>ShieldFlag        
1d13 : 96e5             [ 4]>    lda GameFlags1
1d15 : 8501             [ 2]>    bita #ShieldFlag        
                            >  else
                            >    lda GameFlags2
                            >    bita #(ShieldFlag        )>>8
                            >  endif
                             
1d17 : 2603             [ 3]     bne gsShipSkipExplode
1d19 : bd2af7           [ 8]       jsr ExplodeShip
1d1c :                       gsShipSkipExplode:
1d1c : 2051             [ 3]     bra gsRemoveShot
1d1e :                       gsShipOk:
                             
                               mTestFlag HasOrbFlag          ;Collision gunsho
                            >  if 255>HasOrbFlag          
1d1e : 96e5             [ 4]>    lda GameFlags1
1d20 : 8504             [ 2]>    bita #HasOrbFlag          
                            >  else
                            >    lda GameFlags2
                            >    bita #(HasOrbFlag          )>>8
                            >  endif
                             
1d22 : 273d             [ 3]   beq gsPodOk
1d24 : 108ec8bf         [ 4]     ldy #PodX
                                 mPointVsArea PodArea,gsPodOk, gsShotX,gsShotY
1d28 : aec4             [ 5]>  ldx      gsShotX,u
1d2a : eca4             [ 5]>  ldd      0,y
1d2c : 830003           [ 4]>  subd    #PodArea/2
1d2f : ed7e             [ 6]>  std -2,s
1d31 : ac7e             [ 7]>  cmpx -2,s
1d33 : 102d002a         [ 6]>  lblt    gsPodOk
1d37 : c30006           [ 4]>  addd    #PodArea
1d3a : ed7e             [ 6]>  std -2,s
1d3c : ac7e             [ 7]>  cmpx -2,s
1d3e : 102e001f         [ 6]>  lbgt    gsPodOk
1d42 : ae43             [ 6]>  ldx     gsShotY,u
1d44 : ec22             [ 6]>  ldd     2,y
1d46 : 830003           [ 4]>  subd    #PodArea/2
1d49 : ed7e             [ 6]>  std -2,s
1d4b : ac7e             [ 7]>  cmpx -2,s
1d4d : 102d0010         [ 6]>  lblt    gsPodOk
1d51 : c30006           [ 4]>  addd    #PodArea
1d54 : ed7e             [ 6]>  std -2,s
1d56 : ac7e             [ 7]>  cmpx -2,s
1d58 : 102e0005         [ 6]>  lbgt    gsPodOk
                             
1d5c : bd2af7           [ 8]       jsr ExplodeShip
1d5f : 200e             [ 3]       bra gsRemoveShot
1d61 :                       gsPodOk:
                             
1d61 : 10ae43           [ 7]   ldy gsShotY,u                 ;Collision shots 
1d64 : aec4             [ 5]   ldx gsShotX,u
1d66 : bd2d92           [ 8]   jsr PointVsLevel
1d69 : 2402             [ 3]   bcc gsNoHit
1d6b : 2002             [ 3]     bra gsRemoveShot
1d6d :                       gsNoHit:
                             
1d6d : 200e             [ 3]   bra gsMoveNext
1d6f :                       gsRemoveShot:
1d6f : a6e4             [ 4]   lda LocalW1,s                 ;a is current loo
                               mClearBitA GunShotActive
1d71 : c6ff             [ 2]>  ldb #255                    ;start with all bit
1d73 : 1cfe             [ 3]>  andcc #$fe                  ;clear carry flag, 
1d75 :                      >lop0454:                          ;rotate a zero 
1d75 : 59               [ 2]>  rolb
1d76 : 4a               [ 2]>  deca
1d77 : 2afc             [ 3]>  bpl lop0454
1d79 : d4f6             [ 4]>  andb GunShotActive                   ;b now has
1d7b : d7f6             [ 4]>  stb GunShotActive
                             
                             
1d7d :                       gsMoveNext:
1d7d : ece4             [ 5]   ldd LocalW1,s
1d7f :                       gsNotActive:
1d7f : 3348             [ 5]   leau GunShotEntry,u
1d81 : 4c               [ 2]   inca
1d82 : 8103             [ 2]   cmpa #MaxGunShots
1d84 : 1026feaa         [ 6]   bne gsMoveLoop
                             
                               direct -1
                               mFreeLocals
1d88 : 3262             [ 5]>  leas FrameSize,s
                             
1d8a : 39               [ 5]   rts
                             
                             
                             
                             ;*****************
1d8b :                       DrawGunShots:
                               ;DP must be D0
                               mDecLocals 0,2,4
                            >  nolist
                             
                             
                               mSetScale $7f                 ;Scale $7f is req
                            >  if 1=1
1d8d : 867f             [ 2]>    lda #$7f                                   ;i
                            >  endif
1d8f : 9704             [ 4]>  sta <$04
                             
                             
1d91 : 8ec8fb           [ 3]   ldx #GunShots                 ;Draw all active 
1d94 : 8603             [ 2]   lda #MaxGunShots
1d96 : f6c8f6           [ 5]   ldb GunShotActive
1d99 :                       dgsLoop:
1d99 : 57               [ 2]   asrb                          ;test active
1d9a : 2456             [ 3]   bcc dgsNotActive
1d9c : ede4             [ 5]   std LocalW1,s
                             
                               mTestFlag HomingGunShotsFlag
                            >  if 255>HomingGunShotsFlag
                            >    lda GameFlags1
                            >    bita #HomingGunShotsFlag
                            >  else
1d9e : b6c8e6           [ 5]>    lda GameFlags2
1da1 : 8502             [ 2]>    bita #(HomingGunShotsFlag)>>8
                            >  endif
                             
1da3 : 2615             [ 3]   bne dgsHoming
                             
1da5 :                       dgsNormal:
1da5 : af62             [ 6]   stx LocalW2,s
1da7 : 3364             [ 5]   leau LocalBuffer,s
1da9 : ec84             [ 5]   ldd gsShotX,x
1dab : edc4             [ 5]   std ,u
1dad : ec03             [ 6]   ldd gsShotY,x
1daf : ed42             [ 6]   std 2,u
1db1 : 867f             [ 2]   lda #$7f
1db3 : bd2110           [ 8]   jsr DrawDot
1db6 : ae62             [ 6]   ldx LocalW2,s
1db8 : 2036             [ 3]   bra dgsNext
                             
1dba :                       dgsHoming:
1dba : a6e4             [ 4]   lda LocalW1,s
1dbc : 8401             [ 2]   anda #1
1dbe : 27e5             [ 3]   beq dgsNormal
                             
1dc0 : af62             [ 6]   stx LocalW2,s
1dc2 : 3364             [ 5]   leau LocalBuffer,s
1dc4 : ec84             [ 5]   ldd gsShotX,x
1dc6 : edc4             [ 5]   std ,u
1dc8 : ec03             [ 6]   ldd gsShotY,x
1dca : ed42             [ 6]   std 2,u
1dcc : 867f             [ 2]   lda #$7f
1dce : bd2179           [ 8]   jsr DrawBullet
1dd1 : ae62             [ 6]   ldx LocalW2,s
                             
                               ;Draw a 'tail' on the homing shots by subtracti
1dd3 : 3364             [ 5]   leau LocalBuffer,s
1dd5 : e606             [ 5]   ldb gsShotVelocX,x
1dd7 : 50               [ 2]   negb
1dd8 : 57               [ 2]   asrb
1dd9 : 57               [ 2]   asrb
1dda : 1d               [ 2]   sex
1ddb : e3c4             [ 6]   addd ,u
1ddd : edc4             [ 5]   std ,u
1ddf : e607             [ 5]   ldb gsShotVelocY,x
1de1 : 50               [ 2]   negb
1de2 : 57               [ 2]   asrb
1de3 : 57               [ 2]   asrb
1de4 : 1d               [ 2]   sex
1de5 : e342             [ 7]   addd 2,u
1de7 : ed42             [ 6]   std 2,u
1de9 : 8634             [ 2]   lda #$34
1deb : bd2179           [ 8]   jsr DrawBullet
1dee : ae62             [ 6]   ldx LocalW2,s
                             
1df0 :                       dgsNext:
1df0 : ece4             [ 5]   ldd LocalW1,s
1df2 :                       dgsNotActive:
1df2 : 3008             [ 5]   leax GunShotEntry,x
1df4 : 4a               [ 2]   deca
1df5 : 26a2             [ 3]   bne dgsLoop
                             
                               mFreeLocals
1df7 : 3268             [ 5]>  leas FrameSize,s
                             
1df9 : 39               [ 5]   rts
                             
                             
                             
                             ;*****************
1dfa :                       DrawFuel:                       ;Draw active fuel
0002 =                       FrameSize set 2                 ;Size of stack fr
0000 =                       Local1 set 0
                               ;DP must be D0
1dfa : 327e             [ 5]   leas    -FrameSize,s
                             
                               mSetIntensity $5f
                            >  if 1=1
1dfc : 865f             [ 2]>    lda   #$5f            ;if argument exists, lo
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
1dfe : 9701             [ 4]>  sta   <01
1e00 : cc0401           [ 3]>  ldd   #$0401
1e03 : 9700             [ 4]>  sta   <00
1e05 : d700             [ 4]>  stb   <00
                             
                             
1e07 : fec8ca           [ 6]   ldu CurLevelEntry
1e0a : ee46             [ 6]   ldu leFuel,u
1e0c : 2717             [ 3]   beq dfExit                    ;exit if no fuel 
1e0e : f6c8e9           [ 5]   ldb FuelActive
1e11 : a6c0             [ 6]   lda ,u+                       ;load count
1e13 :                       dfLoop:
1e13 : 57               [ 2]   asrb                          ;test active
1e14 : 240a             [ 3]   bcc dfNext
                             
1e16 : ede4             [ 5]   std Local1,s
                             
1e18 : 8e4bf4           [ 3]   ldx #SpriteFuelCell
1e1b : bd2378           [ 8]   jsr DrawSprite
                             
1e1e : ece4             [ 5]   ldd Local1,s
                             
1e20 :                       dfNext:
1e20 : 3344             [ 5]   leau FuelEntry,u
1e22 : 4a               [ 2]   deca
1e23 : 26ee             [ 3]   bne dfLoop
                             
1e25 :                       dfExit:
1e25 : 3262             [ 5]   leas    FrameSize,s
1e27 : 39               [ 5]   rts
                             
                             
                             ;*****************
1e28 :                       DrawOrb:                        ;Draw stationary 
                               ;DP must be D0
                             
                               mTestFlag HasOrbFlag          ;Exit if ship is 
                            >  if 255>HasOrbFlag          
1e28 : b6c8e5           [ 5]>    lda GameFlags1
1e2b : 8504             [ 2]>    bita #HasOrbFlag          
                            >  else
                            >    lda GameFlags2
                            >    bita #(HasOrbFlag          )>>8
                            >  endif
                             
1e2d : 2616             [ 3]   bne doExit
                             
                               mSetIntensity $5f
                            >  if 1=1
1e2f : 865f             [ 2]>    lda   #$5f            ;if argument exists, lo
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
1e31 : 9701             [ 4]>  sta   <01
1e33 : cc0401           [ 3]>  ldd   #$0401
1e36 : 9700             [ 4]>  sta   <00
1e38 : d700             [ 4]>  stb   <00
                             
                             
1e3a : fec8ca           [ 6]   ldu CurLevelEntry
1e3d : 3348             [ 5]   leau leOrbX,u
1e3f : 8e4c0e           [ 3]   ldx #SpriteStationaryPod
1e42 : bd2378           [ 8]   jsr DrawSprite
                             
1e45 :                       doExit:
1e45 : 39               [ 5]   rts
                             
                             
                             ;*****************
1e46 :                       DrawPowerplant:                 ;Draw powerplant 
                               ;DP must be D0
                               mDecLocals 0,1,10
                            >  nolist
                             
                             
1e48 : f6c8f4           [ 5]   ldb PowerShot                 ;Decrease gun dis
1e4b : 270b             [ 3]   beq dpSkip
1e4d : b6c826           [ 5]   lda LoopCounterLow
1e50 : 841f             [ 2]   anda #31
1e52 : 2604             [ 3]   bne dpSkip
1e54 : 5a               [ 2]   decb
1e55 : f7c8f4           [ 5]   stb PowerShot
1e58 :                       dpSkip:
                             
1e58 : b6c8f3           [ 5]   lda PowerLife                 ;Flash if about t
1e5b : 2a6c             [ 3]   bpl dpDraw
1e5d : 3062             [ 5]     leax LocalBuffer,s
1e5f : 40               [ 2]     nega                        ;Display countdow
1e60 : 8b2f             [ 2]     adda #'0'-1
1e62 : c620             [ 2]     ldb #' '                    ;ROM display must
1e64 : e784             [ 4]     stb ,x
1e66 : c680             [ 2]     ldb #$80
1e68 : ed01             [ 6]     std 1,x
                             
1e6a : b6c826           [ 5]     lda LoopCounterLow
1e6d : 843f             [ 2]     anda #63
1e6f : 40               [ 2]     nega
1e70 : 8b40             [ 2]     adda #64
1e72 : a7e4             [ 4]     sta LocalW1,s
1e74 : 44               [ 2]     lsra
1e75 : 44               [ 2]     lsra
1e76 : 40               [ 2]     nega
1e77 : c670             [ 2]     ldb #$70
1e79 : fdc82a           [ 6]     std   $C82A           ;Specify height and wid
1e7c : bdf354           [ 8]     jsr reset0ref
                                 mCombine d,-30,-30
1e7f : cce2e2           [ 3]>  ldd #(lo -30)<<8 | (lo -30)
                             
1e82 : abe4             [ 4]     adda LocalW1,s
1e84 : bdf312           [ 8]     jsr move_pen_d
                             ;    lda #$40
                             ;    suba LocalW1,s
                                 mTicToc 64
1e87 : b6c826           [ 5]>  lda LoopCounterLow
1e8a : 843f             [ 2]>  anda #64-1
1e8c : 8120             [ 2]>  cmpa #64/2
1e8e : 2402             [ 3]>  bcc l10489
1e90 : 883f             [ 2]>  eora #64-1
1e92 :                      >l10489:
                             
1e92 : 8b20             [ 2]     adda #32
                                 mSetIntensity
                            >  if 0=1
                            >    lda   #            ;if argument exists, load 
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
1e94 : 9701             [ 4]>  sta   <01
1e96 : cc0401           [ 3]>  ldd   #$0401
1e99 : 9700             [ 4]>  sta   <00
1e9b : d700             [ 4]>  stb   <00
                             
                             
1e9d : 1f13             [ 6]     tfr x,u
1e9f : bdf495           [ 8]     jsr display_string
                             
1ea2 : b6c826           [ 5]     lda LoopCounterLow
1ea5 : 843f             [ 2]     anda #63
1ea7 : 2619             [ 3]     bne dpNoAdjustCounter
                                   mEmitSound CountdownSoundId
                            >  if 1=1
1ea9 : 862d             [ 2]>    lda #CountdownSoundId
                            >  endif
1eab : bd0476           [ 8]>  jsr EmitSound
                             
1eae : 7cc8f3           [ 7]       inc PowerLife
1eb1 : b6c8f3           [ 5]       lda PowerLife
1eb4 : 81ff             [ 2]       cmpa #-1
1eb6 : 260a             [ 3]       bne dpNoAdjustCounter
                                     ;Planet exploded
                                     mEmitFx FxTargetShip,FxTypePlanetExplode,
                            >  if ('0'!='0') && ('0'!='b')
                            >    tfr 0,b
                            >  endif
1eb8 : 8690             [ 2]>  lda #FxTargetShip | (FxTypePlanetExplode<<4)
1eba : bd06bb           [ 8]>  jsr EmitFx
                             
1ebd : bd2af7           [ 8]         jsr ExplodeShip
1ec0 : 2047             [ 3]         bra dpExit
1ec2 :                       dpNoAdjustCounter:
                             
1ec2 : b6c826           [ 5]     lda LoopCounterLow
1ec5 : 8408             [ 2]     anda #8
1ec7 : 2740             [ 3]     beq dpExit
1ec9 :                       dpDraw:
                               mSetIntensity $5f
                            >  if 1=1
1ec9 : 865f             [ 2]>    lda   #$5f            ;if argument exists, lo
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
1ecb : 9701             [ 4]>  sta   <01
1ecd : cc0401           [ 3]>  ldd   #$0401
1ed0 : 9700             [ 4]>  sta   <00
1ed2 : d700             [ 4]>  stb   <00
                             
                             
1ed4 : fec8ca           [ 6]   ldu CurLevelEntry
1ed7 : 334c             [ 5]   leau lePowerX,u
1ed9 : efe4             [ 5]   stu LocalW1,s
1edb : 8e4c29           [ 3]   ldx #SpritePowerplant
1ede : bd2378           [ 8]   jsr DrawSprite
                             
1ee1 : 7dc8f4           [ 7]   tst PowerShot                 ;draw rising dot 
1ee4 : 2623             [ 3]   bne dpExit
                             
1ee6 : aee4             [ 5]   ldx LocalW1,s
1ee8 : 3362             [ 5]   leau LocalBuffer,s
1eea : ec84             [ 5]   ldd ,x
1eec : c30009           [ 4]   addd #9
1eef : edc4             [ 5]   std ,u
1ef1 : ec02             [ 6]   ldd 2,x
1ef3 : 83000c           [ 4]   subd #12
1ef6 : ed7e             [ 6]   std -2,s
1ef8 : f6c826           [ 5]   ldb LoopCounterLow
1efb : c40f             [ 2]   andb #15
1efd : 54               [ 2]   lsrb
1efe : 50               [ 2]   negb
1eff : 1d               [ 2]   sex
1f00 : e37e             [ 7]   addd -2,s
1f02 : ed42             [ 6]   std 2,u
1f04 : 8660             [ 2]   lda #$60
                             ;  jsr DrawDot
1f06 : bd2179           [ 8]   jsr DrawBullet
                             
1f09 :                       dpExit:
                             
                               mFreeLocals
1f09 : 326c             [ 5]>  leas FrameSize,s
                             
1f0b : 39               [ 5]   rts
                             
                             
                             ;*****************
1f0c :                       DrawGuns:                       ;Draw active guns
                               mDecLocals 1,1
                            >  nolist
                             
                             
                               ;DP must be D0
                               mSetIntensity $5f
                            >  if 1=1
1f0e : 865f             [ 2]>    lda   #$5f            ;if argument exists, lo
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
1f10 : 9701             [ 4]>  sta   <01
1f12 : cc0401           [ 3]>  ldd   #$0401
1f15 : 9700             [ 4]>  sta   <00
1f17 : d700             [ 4]>  stb   <00
                             
                             
1f19 : fec8ca           [ 6]   ldu CurLevelEntry
1f1c : ee44             [ 6]   ldu leGuns,u
1f1e : 2720             [ 3]   beq dgExit                    ;exit if no guns
1f20 : a6c0             [ 6]   lda ,u+                       ;load guncount
1f22 : a7e4             [ 4]   sta LocalB1,s
1f24 : fcc8e7           [ 6]   ldd GunsActive
1f27 :                       dgLoop:
1f27 : 47               [ 2]   asra
1f28 : 56               [ 2]   rorb
1f29 : 240f             [ 3]   bcc dgNext
                             
1f2b : ed61             [ 6]   std LocalW1,s
                             
1f2d : a644             [ 5]   lda geGunSprite,u             ;sprite entry
1f2f : 48               [ 2]   asla
1f30 : 8e1f43           [ 3]   ldx #GunSpriteTable
1f33 : ae86             [ 6]   ldx a,x
1f35 : bd2378           [ 8]   jsr DrawSprite
                             
1f38 : ec61             [ 6]   ldd LocalW1,s
                             
1f3a :                       dgNext:
1f3a : 3345             [ 5]   leau GunEntry,u
1f3c : 6ae4             [ 6]   dec LocalB1,s
1f3e : 26e7             [ 3]   bne dgLoop
                             
1f40 :                       dgExit:
                               mFreeLocals
1f40 : 3263             [ 5]>  leas FrameSize,s
                             
1f42 : 39               [ 5]   rts
                             
1f43 :                       GunSpriteTable:
1f43 : 4bb44bc44bd44be4        dw SpriteGunNE,SpriteGunNW,SpriteGunSE,SpriteGu
                             
                             
                             
                             ;*****************
1f4b :                       DrawSwitches:                   ;Draw door switch
                               ;DP must be D0
                               mDecLocals 1,0,0
                            >  nolist
                             
                             
                               mSetIntensity $5f
                            >  if 1=1
1f4d : 865f             [ 2]>    lda   #$5f            ;if argument exists, lo
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
1f4f : 9701             [ 4]>  sta   <01
1f51 : cc0401           [ 3]>  ldd   #$0401
1f54 : 9700             [ 4]>  sta   <00
1f56 : d700             [ 4]>  stb   <00
                             
                             
1f58 : fec8ca           [ 6]   ldu CurLevelEntry
1f5b : eec814           [ 6]   ldu leSwitches,u
1f5e : a6c0             [ 6]   lda ,u+                       ;load count
1f60 : 2718             [ 3]   beq dswExit                   ;exit if no switc
1f62 :                       dswLoop:
1f62 : a7e4             [ 4]   sta LocalB1,s
                             
1f64 : a644             [ 5]   lda seSwitchDir,u
1f66 : 2705             [ 3]   beq dswDrawLeft
1f68 : 8e4c4e           [ 3]   ldx #SpriteSwitchRight
1f6b : 2003             [ 3]   bra dswDraw
1f6d :                       dswDrawLeft:
1f6d : 8e4c46           [ 3]   ldx #SpriteSwitchLeft
1f70 :                       dswDraw:
1f70 : bd2378           [ 8]   jsr DrawSprite
                             
1f73 : a6e4             [ 4]   lda LocalB1,s
1f75 :                       dswNext:
1f75 : 3345             [ 5]   leau SwitchEntry,u
1f77 : 4a               [ 2]   deca
1f78 : 26e8             [ 3]   bne dswLoop
                             
1f7a :                       dswExit:
                               mFreeLocals
1f7a : 3261             [ 5]>  leas FrameSize,s
                             
1f7c : 39               [ 5]   rts
                             
                             
                             
                             ;*****************
1f7d :                       UpdateDoors:
                               ;  DoorCounter
                               ;    0  : stängd, exit
                               ;    bit 7
                               ;      0 : opening
                               ;          öka med 1, om max sätt bit 7
                               ;      1 : closing
                               ;          minska med 1, om noll clear bit 7
                               ;      >=DoorSize : fully open
                               direct $c8
                             
1f7d : 9626             [ 4]   lda LoopCounterLow
1f7f : 8404             [ 2]   anda #4
1f81 : 2724             [ 3]   beq udoExit
                             
1f83 : 96f2             [ 4]   lda DoorCounter
1f85 : 2720             [ 3]   beq udoExit
1f87 : 2b0f             [ 3]   bmi udoClosing
                             
1f89 : 4c               [ 2]   inca
1f8a : 2904             [ 3]   bvs udoSetClose
1f8c : 97f2             [ 4]   sta DoorCounter
1f8e : 2017             [ 3]   bra udoExit
1f90 :                       udoSetClose:
1f90 : 8620             [ 2]   lda #DoorSize
1f92 : 8a80             [ 2]   ora #%10000000
1f94 : 97f2             [ 4]   sta DoorCounter
1f96 : 200f             [ 3]   bra udoExit
                             
1f98 :                       udoClosing:
1f98 : 847f             [ 2]   anda #%01111111
1f9a : 4a               [ 2]   deca
1f9b : 2706             [ 3]   beq udoSetOpen
1f9d : 8a80             [ 2]   ora #%10000000
1f9f : 97f2             [ 4]   sta DoorCounter
1fa1 : 2004             [ 3]   bra udoExit
                             
1fa3 :                       udoSetOpen:
1fa3 : 8600             [ 2]   lda #0
1fa5 : 97f2             [ 4]   sta DoorCounter
                             
1fa7 :                       udoExit:
                             
                               direct -1
1fa7 : 39               [ 5]   rts
                             
                             
                             ;*****************
                             ;Lines for doors are generated on stack, then dra
1fa8 :                       DrawDoors:
0019 =                       DoorLineSize = 25               ;Size of buffer t
0019 =                       DoorListSize = 25               ;Size of buffer t
                               mDecLocals 3,0,DoorLineSize+DoorListSize
                            >  nolist
                             
0003 =                       LocalDoorLines = LocalBuffer
001c =                       LocalDoorList  = LocalBuffer+DoorLineSize
0001 =                       LocalOpen = LocalB2
0002 =                       LocalTmp = LocalB3
                             
1fab : b6c8f2           [ 5]   lda DoorCounter
1fae : 847f             [ 2]   anda #%01111111
                             ;  cmpa #DoorSize
                             ;  lbge dorExit                  ;doors are fully
1fb0 : a761             [ 5]   sta LocalOpen,s               ;amount to open d
                             
                               mSetIntensity WallIntensity
                            >  if 1=1
1fb2 : 8630             [ 2]>    lda   #WallIntensity            ;if argument 
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
1fb4 : 9701             [ 4]>  sta   <01
1fb6 : cc0401           [ 3]>  ldd   #$0401
1fb9 : 9700             [ 4]>  sta   <00
1fbb : d700             [ 4]>  stb   <00
                             
                             
1fbd : fec8ca           [ 6]   ldu CurLevelEntry
1fc0 : eec812           [ 6]   ldu leDoors,u
                             
1fc3 : a6c0             [ 6]   lda ,u+                       ;load count
1fc5 : 1027011e         [ 6]   lbeq dorExit
1fc9 :                       dorLoop:
1fc9 : a7e4             [ 4]   sta LocalB1,s
                             
1fcb : 3063             [ 5]   leax LocalDoorLines,s
1fcd : 31e81c           [ 5]   leay LocalDoorList,s
1fd0 : 10af81           [ 9]   sty ,x++
1fd3 : ec43             [ 6]   ldd deDoorY,u
1fd5 : ed81             [ 8]   std ,x++
1fd7 : ec41             [ 6]   ldd deDoorX,u
1fd9 : ed81             [ 8]   std ,x++
                             
1fdb : a6c4             [ 4]   lda deDoorDir,u
1fdd : 48               [ 2]   asla
1fde : 108e1fe4         [ 4]   ldy #dorTable
1fe2 : 6eb6             [ 7]   jmp [a,y]
                             
1fe4 :                       dorTable:
1fe4 : 1fec2043207d208b        dw dorRightDoor,dorUpDoor,dorInvertRightDoor,do
                             
1fec :                       dorRightDoor:                           ;draw doo
                               ;--
                               ;  |
                               ;--
                               ;positive y is down, positive x is right
                               ;  db 1  ;line count
                               ;  db 1  ;linetype, 0=vert, 1=horiz, 2=slope
                               ;  db FullW,0  ;x0,y0
                               ;  db 0,HalfH  ;x1,y1
1fec : a661             [ 5]   lda LocalOpen,s
1fee : 8120             [ 2]   cmpa #DoorSize
1ff0 : 102c00ea         [ 6]   lbge dorNext
1ff4 : 48               [ 2]   asla
1ff5 : a762             [ 5]   sta LocalTmp,s
                             
1ff7 :                       dorDoHoriz:
1ff7 : a662             [ 5]   lda LocalTmp,s
1ff9 : 8140             [ 2]   cmpa #TileW*2
1ffb : 102400df         [ 6]   lbhs dorNext
                             
1fff : 8603             [ 2]   lda #3
2001 : a780             [ 6]   sta ,x+
                             
2003 : 8601             [ 2]   lda #1        ;line 1
2005 : a780             [ 6]   sta ,x+
                             
2007 : 4f               [ 2]   clra
2008 : a780             [ 6]   sta ,x+
200a : a780             [ 6]   sta ,x+
                             
200c : 8640             [ 2]   lda #TileW*2
200e : a062             [ 5]   suba LocalTmp,s
2010 : a780             [ 6]   sta ,x+
2012 : 4f               [ 2]   clra
2013 : a780             [ 6]   sta ,x+
                             
                             
2015 : 4f               [ 2]   clra          ;line 2
2016 : a780             [ 6]   sta ,x+
                             
2018 : 8640             [ 2]   lda #TileW*2
201a : a062             [ 5]   suba LocalTmp,s
201c : a780             [ 6]   sta ,x+
201e : 4f               [ 2]   clra
201f : a780             [ 6]   sta ,x+
                             
2021 : 8640             [ 2]   lda #TileW*2
2023 : a062             [ 5]   suba LocalTmp,s
2025 : a780             [ 6]   sta ,x+
2027 : 8620             [ 2]   lda #TileH
2029 : a780             [ 6]   sta ,x+
                             
                             
202b : 8601             [ 2]   lda #1        ;line 3
202d : a780             [ 6]   sta ,x+
                             
202f : 4f               [ 2]   clra
2030 : a780             [ 6]   sta ,x+
2032 : 8620             [ 2]   lda #TileH
2034 : a780             [ 6]   sta ,x+
                             
2036 : 8640             [ 2]   lda #TileW*2
2038 : a062             [ 5]   suba LocalTmp,s
203a : a780             [ 6]   sta ,x+
203c : 8620             [ 2]   lda #TileH
203e : a780             [ 6]   sta ,x+
                             
2040 : 7e20d8           [ 4]   jmp dorDraw
                             
                             
2043 :                       dorUpDoor:                      ;draw door closin
                               ;----
                               ;____
                               ;positive y is down, positive x is right
                               ;  db 1  ;line count
                               ;  db 1  ;linetype, 0=vert, 1=horiz, 2=slope
                               ;  db FullW,0  ;x0,y0
                               ;  db 0,HalfH  ;x1,y1
2043 : a661             [ 5]   lda LocalOpen,s
2045 : 8120             [ 2]   cmpa #DoorSize
2047 : 102c0093         [ 6]   lbge dorNext
                             
204b : 8602             [ 2]   lda #2
204d : a780             [ 6]   sta ,x+
                             
                               ;Bottom line, fixed
204f : 8601             [ 2]   lda #1
2051 : a780             [ 6]   sta ,x+
                             
2053 : 8600             [ 2]   lda #0
2055 : a780             [ 6]   sta ,x+
2057 : 8640             [ 2]   lda #TileH*2
2059 : a780             [ 6]   sta ,x+
                             
205b : 8640             [ 2]   lda #TileW*2
205d : a780             [ 6]   sta ,x+
205f : 8640             [ 2]   lda #TileH*2
2061 : a780             [ 6]   sta ,x+
                             
                             
                               ;Top line, this moves down when door opens
2063 : 8601             [ 2]   lda #1
2065 : a780             [ 6]   sta ,x+
                             
2067 : 4f               [ 2]   clra
2068 : a780             [ 6]   sta ,x+
206a : ab61             [ 5]   adda LocalOpen,s              ;add twice, tileh
206c : ab61             [ 5]   adda LocalOpen,s
206e : a780             [ 6]   sta ,x+
                             
2070 : 8640             [ 2]   lda #(TileW*2)
2072 : a780             [ 6]   sta ,x+
2074 : 4f               [ 2]   clra
2075 : ab61             [ 5]   adda LocalOpen,s              ;add twice, tileh
2077 : ab61             [ 5]   adda LocalOpen,s
2079 : a780             [ 6]   sta ,x+
207b : 205b             [ 3]   bra dorDraw
                             
207d :                       dorInvertRightDoor:
207d : a661             [ 5]   lda LocalOpen,s
207f : 40               [ 2]   nega
2080 : 8b20             [ 2]   adda #DoorSize
2082 : 2a01             [ 3]   bpl dorInvertR1
2084 : 4f               [ 2]     clra
2085 :                       dorInvertR1:
2085 : 48               [ 2]   asla
2086 : a762             [ 5]   sta LocalTmp,s
2088 : 7e1ff7           [ 4]   bra dorDoHoriz
                             
                             
208b :                       dorUpDoorWalls:                      ;draw door c
                               ; ----
                               ;|    |
                               ;|    |
                               ;positive y is down, positive x is right
                               ;  db 1  ;line count
                               ;  db 1  ;linetype, 0=vert, 1=horiz, 2=slope
                               ;  db FullW,0  ;x0,y0
                               ;  db 0,HalfH  ;x1,y1
208b : a661             [ 5]   lda LocalOpen,s
208d : 8120             [ 2]   cmpa #DoorSize
208f : 102c004b         [ 6]   lbge dorNext
                             
2093 : 8603             [ 2]   lda #3
2095 : a780             [ 6]   sta ,x+
                             
                               ;Left wall
2097 : 4f               [ 2]   clra
2098 : a780             [ 6]   sta ,x+       ;linetype
209a : a780             [ 6]   sta ,x+       ;x0
209c : ab61             [ 5]   adda LocalOpen,s
209e : ab61             [ 5]   adda LocalOpen,s
20a0 : a780             [ 6]   sta ,x+       ;y0
20a2 : 4f               [ 2]   clra
20a3 : a780             [ 6]   sta ,x+       ;x1
20a5 : 8640             [ 2]   lda #(TileH*2)
20a7 : a780             [ 6]   sta ,x+       ;y1
                             
                               ;Right wall
20a9 : 4f               [ 2]   clra
20aa : a780             [ 6]   sta ,x+       ;linetype
20ac : 8640             [ 2]   lda #(TileW*2)
20ae : a780             [ 6]   sta ,x+       ;x0
20b0 : a661             [ 5]   lda LocalOpen,s
20b2 : ab61             [ 5]   adda LocalOpen,s
20b4 : a780             [ 6]   sta ,x+       ;y0
20b6 : 8640             [ 2]   lda #(TileW*2)
20b8 : a780             [ 6]   sta ,x+       ;x1
20ba : 8640             [ 2]   lda #(TileH*2)
20bc : a780             [ 6]   sta ,x+       ;y1
                             
                               ;Top line, this moves down when door opens
20be : 8601             [ 2]   lda #1
20c0 : a780             [ 6]   sta ,x+
                             
20c2 : 4f               [ 2]   clra
20c3 : a780             [ 6]   sta ,x+
20c5 : ab61             [ 5]   adda LocalOpen,s              ;add twice, tileh
20c7 : ab61             [ 5]   adda LocalOpen,s
20c9 : a780             [ 6]   sta ,x+
                             
20cb : 8640             [ 2]   lda #(TileW*2)
20cd : a780             [ 6]   sta ,x+
20cf : 4f               [ 2]   clra
20d0 : ab61             [ 5]   adda LocalOpen,s              ;add twice, tileh
20d2 : ab61             [ 5]   adda LocalOpen,s
20d4 : a780             [ 6]   sta ,x+
20d6 : 2000             [ 3]   bra dorDraw
                             
                             
20d8 :                       dorDraw:
20d8 : 3163             [ 5]   leay LocalDoorLines,s
20da : 8630             [ 2]   lda #WallIntensity
20dc : 8d0d             [ 7]   bsr ClipDraw
                             
20de :                       dorNext:
20de : a6e4             [ 4]   lda LocalB1,s
20e0 : 3345             [ 5]   leau DoorEntry,u
20e2 : 4a               [ 2]   deca
20e3 : 1026fee2         [ 6]   bne dorLoop
                             
20e7 :                       dorExit:
                               mFreeLocals
20e7 : 32e835           [ 5]>  leas FrameSize,s
                             
20ea : 39               [ 5]   rts
                             
                             
                             ;*****************
20eb :                       ClipDraw:              ;a=intensity, y points to:
                               ;**todo: this will not work when x-world-wrap i
                               ;_CohenSutherlandClip is not aware of world-wra
                               ;clipX coord will need to be adjusted to ViewX+
                             
20eb : aea1             [ 8]   ldx ,y++                      ;destlines
                             
20ed : 340a             [ 7]   pshs a,dp                     ;save intensity +
                               mDptoC8                       ;clip needs c8
20ef : 86c8             [ 2]>  lda   #0xC8
20f1 : 1f8b             [ 6]>  tfr   a,dp
                            >  direct $c8
                             
20f3 : eca1             [ 8]   ldd ,y++
20f5 : ede3             [ 8]   std ,--s                      ;offset y
20f7 : eca1             [ 8]   ldd ,y++
20f9 : ede3             [ 8]   std ,--s                      ;offset x
20fb : afe3             [ 8]   stx ,--s                      ;pointer to desti
20fd : 10afe3           [ 9]   sty ,--s                      ;pointer to lines
2100 : bd00b9           [ 8]   jsr _CohenSutherlandClip
2103 : 3268             [ 5]   leas  8,s
2105 : 350a             [ 7]   puls dp,a                     ;restore dp + int
2107 : 5d               [ 2]   tstb
2108 : 2705             [ 3]   beq cdrExit                   ;empty list, all 
                             
210a : 6f85             [ 7]   clr b,x                       ;write end of dra
                             
                               ;a holds intensity
210c : bd2a9a           [ 8]   jsr GoDrawList
                             
210f :                       cdrExit:
                               direct -1
210f : 39               [ 5]   rts
                             
                             
                             
                             ;*****************
2110 :                       DrawDot:                        ;a=intensity,  u=
                               mDecLocals 3,0
                            >  nolist
                             
0000 =                       LocalTempX = LocalB1
0001 =                       LocalTempY = LocalB2
0002 =                       LocalInt = LocalB3
2112 : a762             [ 5]   sta LocalInt,s
                             
                               ;X coord
                               mGetScreenX ,u
                            >  if  2 = 0    ;no param, X holds X-coord
                            >    tfr x,y
                            >  endif
                            >  if  2 = 1
                            >    ldy     
                            >  endif
                            >  if  2 = 2   ;as09 treats "2,y" as two separate 
2114 : 10aec4           [ 6]>    ldy     ,u
                            >  endif
2117 : bec8c6           [ 6]>  ldx     ViewX
211a : 1f20             [ 6]>  tfr     y,d
211c : af7e             [ 6]>  stx -2,s
211e : a37e             [ 7]>  subd -2,s
2120 : 2c0a             [ 3]>  bge     L1430554
2122 : fcc8cd           [ 6]>  ldd     CurLevelEndX
                            >;  stx -2,s
2125 : a37e             [ 7]>  subd -2,s
2127 : 10af7e           [ 7]>  sty -2,s
212a : e37e             [ 7]>  addd -2,s
212c :                      >L1430554:
                             
212c : 2b48             [ 3]   bmi ddExit                    ;offscreen, skip
212e : 4d               [ 2]   tsta
212f : 2645             [ 3]   bne ddExit                    ;offscreen, skip
                             
2131 : c080             [ 2]   subb #128
2133 : e7e4             [ 4]   stb LocalTempX,s
                             
                               ;Y coord
2135 : ec42             [ 6]   ldd 2,u
2137 : b3c8c8           [ 7]   subd ViewY
213a : 2b3a             [ 3]   bmi ddExit                    ;offscreen, skip
213c : 4d               [ 2]   tsta
213d : 2637             [ 3]   bne ddExit                    ;offscreen, skip
                             
213f : e761             [ 5]   stb LocalTempY,s
2141 : bdf354           [ 8]   jsr reset0ref                 ;this dot should 
                               mSetScale $7f
                            >  if 1=1
2144 : 867f             [ 2]>    lda #$7f                  ;if argument exists
                            >  endif
2146 : 9704             [ 4]>  sta <$04
                             
2148 : a662             [ 5]   lda LocalInt,s
                               mSetIntensity
                            >  if 0=1
                            >    lda   #            ;if argument exists, load 
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
214a : 9701             [ 4]>  sta   <01
214c : cc0401           [ 3]>  ldd   #$0401
214f : 9700             [ 4]>  sta   <00
2151 : d700             [ 4]>  stb   <00
                             
2153 : a661             [ 5]   lda LocalTempY,s
                             
2155 : 40               [ 2]   nega
2156 : 8b7f             [ 2]   adda #127
2158 : e6e4             [ 4]   ldb LocalTempX,s
                             
                               mMove_pen_d_Quick
215a : 9701             [ 4]>  sta   <0x01
215c : 0f00             [ 6]>  clr   <0x00
215e : 86ce             [ 2]>  lda   #0xCE
2160 : 970c             [ 4]>  sta   <0x0C
2162 : 0f0a             [ 6]>  clr   <0x0A
2164 : 0c00             [ 6]>  inc   <0x00
2166 : d701             [ 4]>  stb   <0x01
2168 : 0f05             [ 6]>  clr   <0x05
216a : c640             [ 2]>  ldb   #0x40
216c : d50d             [ 4]>PF33D0557: bitb  <0x0D
216e : 27fc             [ 3]>  beq   PF33D0557
                            >;PF33B0557: lda   #0x04
                            >;PF3410557: deca
                            >;  bne   PF3410557
                             
                               mDot_at_current_position 1
                            >  ; From vectrex.txt
                            >  ;    "(WARNING! high intensity and long Vec_Dot
                            >  ;     your vectrex monitor, be carefull while e
2170 : 86ff             [ 2]>       lda   #0xFF
2172 : 970a             [ 4]>       sta   <0x0A
                            >;       ldb   #1         ;1 is a value for how lo
                            >;PF2CC0558: decb                     ;dwell is no
                            >;       bne   PF2CC0558
2174 : 0f0a             [ 6]>       clr   <0x0A
                             
2176 :                       ddExit:
                               mFreeLocals
2176 : 3263             [ 5]>  leas FrameSize,s
                             
2178 : 39               [ 5]   rts
                             
                             
                             ;*****************
2179 :                       DrawBullet:                        ;a=intensity, 
                               mDecLocals 3,0
                            >  nolist
                             
0000 =                       LocalTempX = LocalB1
0001 =                       LocalTempY = LocalB2
0002 =                       LocalInt = LocalB3
217b : a762             [ 5]   sta LocalInt,s
                             
                               ;X coord
                               mGetScreenX ,u
                            >  if  2 = 0    ;no param, X holds X-coord
                            >    tfr x,y
                            >  endif
                            >  if  2 = 1
                            >    ldy     
                            >  endif
                            >  if  2 = 2   ;as09 treats "2,y" as two separate 
217d : 10aec4           [ 6]>    ldy     ,u
                            >  endif
2180 : bec8c6           [ 6]>  ldx     ViewX
2183 : 1f20             [ 6]>  tfr     y,d
2185 : af7e             [ 6]>  stx -2,s
2187 : a37e             [ 7]>  subd -2,s
2189 : 2c0a             [ 3]>  bge     L1430573
218b : fcc8cd           [ 6]>  ldd     CurLevelEndX
                            >;  stx -2,s
218e : a37e             [ 7]>  subd -2,s
2190 : 10af7e           [ 7]>  sty -2,s
2193 : e37e             [ 7]>  addd -2,s
2195 :                      >L1430573:
                             
2195 : 2b44             [ 3]   bmi dbExit                    ;offscreen, skip
2197 : 4d               [ 2]   tsta
2198 : 2641             [ 3]   bne dbExit                    ;offscreen, skip
                             
219a : c080             [ 2]   subb #128
219c : e7e4             [ 4]   stb LocalTempX,s
                             
                               ;Y coord
219e : ec42             [ 6]   ldd 2,u
21a0 : b3c8c8           [ 7]   subd ViewY
21a3 : 2b36             [ 3]   bmi dbExit                    ;offscreen, skip
21a5 : 4d               [ 2]   tsta
21a6 : 2633             [ 3]   bne dbExit                    ;offscreen, skip
                             
21a8 : e761             [ 5]   stb LocalTempY,s
21aa : bdf354           [ 8]   jsr reset0ref                 ;this dot should 
                               mSetScale $7f
                            >  if 1=1
21ad : 867f             [ 2]>    lda #$7f                  ;if argument exists
                            >  endif
21af : 9704             [ 4]>  sta <$04
                             
21b1 : a662             [ 5]   lda LocalInt,s
                               mSetIntensity
                            >  if 0=1
                            >    lda   #            ;if argument exists, load 
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
21b3 : 9701             [ 4]>  sta   <01
21b5 : cc0401           [ 3]>  ldd   #$0401
21b8 : 9700             [ 4]>  sta   <00
21ba : d700             [ 4]>  stb   <00
                             
21bc : a661             [ 5]   lda LocalTempY,s
                             
21be : 40               [ 2]   nega
21bf : 8b7f             [ 2]   adda #127
21c1 : e6e4             [ 4]   ldb LocalTempX,s
                             
                               mMove_pen_d_Quick
21c3 : 9701             [ 4]>  sta   <0x01
21c5 : 0f00             [ 6]>  clr   <0x00
21c7 : 86ce             [ 2]>  lda   #0xCE
21c9 : 970c             [ 4]>  sta   <0x0C
21cb : 0f0a             [ 6]>  clr   <0x0A
21cd : 0c00             [ 6]>  inc   <0x00
21cf : d701             [ 4]>  stb   <0x01
21d1 : 0f05             [ 6]>  clr   <0x05
21d3 : c640             [ 2]>  ldb   #0x40
21d5 : d50d             [ 4]>PF33D0576: bitb  <0x0D
21d7 : 27fc             [ 3]>  beq   PF33D0576
                            >;PF33B0576: lda   #0x04
                            >;PF3410576: deca
                            >;  bne   PF3410576
                             
21d9 : 8d03             [ 7]   bsr DrawBulletAtCurrentPosition
                             ;  clra  ;z if visible
21db :                       dbExit:
                               mFreeLocals
21db : 3263             [ 5]>  leas FrameSize,s
                             
21dd : 39               [ 5]   rts
                             
                             
                             ;*****************
                              ;Quick draw macros
                             
                             _QpenOn macro
                               lda   #0xFF ;pen on
                               sta   <0x0A
                              endm
                             
                             _QpenOff macro
                               clr   <0x0A ;pen off
                              endm
                             
                             _Qmove macro xx,yy,ww
                             One = ($20-1)/2
                               mCombine d,xx*One,yy*One
                               sta   <0x01
                               clr   <0x00
                               inc   <0x00
                               stb   <0x01
                               clr   <0x05
                               if 1\3=11
                                 ;need to wait for long lines (third param=1)
                                 ldb   #0x40
                             wait\?
                                 bitb  <0x0D
                                 beq   wait\?
                               endif
                              endm
                             
                             
                             ;*****************
21de :                       DrawBulletAtCurrentPosition:
                               mSetScale 1
                            >  if 1=1
21de : 8601             [ 2]>    lda #1                  ;if argument exists, 
                            >  endif
21e0 : 9704             [ 4]>  sta <$04
                             
                             
                             ;  _db1 -1,-1
                             
                               _Qmove 2,-1
000f =                      >One = ($20-1)/2
                            >  mCombine d,2*One,-1*One
21e2 : cc1ef1           [ 3]>  ldd #(lo 2*One)<<8 | (lo -1*One)
                            >
21e5 : 9701             [ 4]>  sta   <0x01
21e7 : 0f00             [ 6]>  clr   <0x00
21e9 : 0c00             [ 6]>  inc   <0x00
21eb : d701             [ 4]>  stb   <0x01
21ed : 0f05             [ 6]>  clr   <0x05
                            >  if 1=11
                            >    ;need to wait for long lines (third param=1)
                            >    ldb   #0x40
                            >wait0579
                            >    bitb  <0x0D
                            >    beq   wait0579
                            >  endif
                             
                             
                               _QpenOn
21ef : 86ff             [ 2]>  lda   #0xFF ;pen on
21f1 : 970a             [ 4]>  sta   <0x0A
                             
                             
                               _Qmove 0,2
000f =                      >One = ($20-1)/2
                            >  mCombine d,0*One,2*One
21f3 : cc001e           [ 3]>  ldd #(lo 0*One)<<8 | (lo 2*One)
                            >
21f6 : 9701             [ 4]>  sta   <0x01
21f8 : 0f00             [ 6]>  clr   <0x00
21fa : 0c00             [ 6]>  inc   <0x00
21fc : d701             [ 4]>  stb   <0x01
21fe : 0f05             [ 6]>  clr   <0x05
                            >  if 1=11
                            >    ;need to wait for long lines (third param=1)
                            >    ldb   #0x40
                            >wait0582
                            >    bitb  <0x0D
                            >    beq   wait0582
                            >  endif
                             
                               _Qmove -1,1
000f =                      >One = ($20-1)/2
                            >  mCombine d,-1*One,1*One
2200 : ccf10f           [ 3]>  ldd #(lo -1*One)<<8 | (lo 1*One)
                            >
2203 : 9701             [ 4]>  sta   <0x01
2205 : 0f00             [ 6]>  clr   <0x00
2207 : 0c00             [ 6]>  inc   <0x00
2209 : d701             [ 4]>  stb   <0x01
220b : 0f05             [ 6]>  clr   <0x05
                            >  if 1=11
                            >    ;need to wait for long lines (third param=1)
                            >    ldb   #0x40
                            >wait0584
                            >    bitb  <0x0D
                            >    beq   wait0584
                            >  endif
                             
                               _Qmove -2,0
000f =                      >One = ($20-1)/2
                            >  mCombine d,-2*One,0*One
220d : cce200           [ 3]>  ldd #(lo -2*One)<<8 | (lo 0*One)
                            >
2210 : 9701             [ 4]>  sta   <0x01
2212 : 0f00             [ 6]>  clr   <0x00
2214 : 0c00             [ 6]>  inc   <0x00
2216 : d701             [ 4]>  stb   <0x01
2218 : 0f05             [ 6]>  clr   <0x05
                            >  if 1=11
                            >    ;need to wait for long lines (third param=1)
                            >    ldb   #0x40
                            >wait0586
                            >    bitb  <0x0D
                            >    beq   wait0586
                            >  endif
                             
                               _Qmove -1,-1
000f =                      >One = ($20-1)/2
                            >  mCombine d,-1*One,-1*One
221a : ccf1f1           [ 3]>  ldd #(lo -1*One)<<8 | (lo -1*One)
                            >
221d : 9701             [ 4]>  sta   <0x01
221f : 0f00             [ 6]>  clr   <0x00
2221 : 0c00             [ 6]>  inc   <0x00
2223 : d701             [ 4]>  stb   <0x01
2225 : 0f05             [ 6]>  clr   <0x05
                            >  if 1=11
                            >    ;need to wait for long lines (third param=1)
                            >    ldb   #0x40
                            >wait0588
                            >    bitb  <0x0D
                            >    beq   wait0588
                            >  endif
                             
                               _Qmove 0,-2
000f =                      >One = ($20-1)/2
                            >  mCombine d,0*One,-2*One
2227 : cc00e2           [ 3]>  ldd #(lo 0*One)<<8 | (lo -2*One)
                            >
222a : 9701             [ 4]>  sta   <0x01
222c : 0f00             [ 6]>  clr   <0x00
222e : 0c00             [ 6]>  inc   <0x00
2230 : d701             [ 4]>  stb   <0x01
2232 : 0f05             [ 6]>  clr   <0x05
                            >  if 1=11
                            >    ;need to wait for long lines (third param=1)
                            >    ldb   #0x40
                            >wait0590
                            >    bitb  <0x0D
                            >    beq   wait0590
                            >  endif
                             
                               _Qmove 1,-1
000f =                      >One = ($20-1)/2
                            >  mCombine d,1*One,-1*One
2234 : cc0ff1           [ 3]>  ldd #(lo 1*One)<<8 | (lo -1*One)
                            >
2237 : 9701             [ 4]>  sta   <0x01
2239 : 0f00             [ 6]>  clr   <0x00
223b : 0c00             [ 6]>  inc   <0x00
223d : d701             [ 4]>  stb   <0x01
223f : 0f05             [ 6]>  clr   <0x05
                            >  if 1=11
                            >    ;need to wait for long lines (third param=1)
                            >    ldb   #0x40
                            >wait0592
                            >    bitb  <0x0D
                            >    beq   wait0592
                            >  endif
                             
                               _Qmove 2,0
000f =                      >One = ($20-1)/2
                            >  mCombine d,2*One,0*One
2241 : cc1e00           [ 3]>  ldd #(lo 2*One)<<8 | (lo 0*One)
                            >
2244 : 9701             [ 4]>  sta   <0x01
2246 : 0f00             [ 6]>  clr   <0x00
2248 : 0c00             [ 6]>  inc   <0x00
224a : d701             [ 4]>  stb   <0x01
224c : 0f05             [ 6]>  clr   <0x05
                            >  if 1=11
                            >    ;need to wait for long lines (third param=1)
                            >    ldb   #0x40
                            >wait0594
                            >    bitb  <0x0D
                            >    beq   wait0594
                            >  endif
                             
                               _Qmove 1,1
000f =                      >One = ($20-1)/2
                            >  mCombine d,1*One,1*One
224e : cc0f0f           [ 3]>  ldd #(lo 1*One)<<8 | (lo 1*One)
                            >
2251 : 9701             [ 4]>  sta   <0x01
2253 : 0f00             [ 6]>  clr   <0x00
2255 : 0c00             [ 6]>  inc   <0x00
2257 : d701             [ 4]>  stb   <0x01
2259 : 0f05             [ 6]>  clr   <0x05
                            >  if 1=11
                            >    ;need to wait for long lines (third param=1)
                            >    ldb   #0x40
                            >wait0596
                            >    bitb  <0x0D
                            >    beq   wait0596
                            >  endif
                             
                             
                              if false
                               _db1 2,0
                               _db1 0,2
                               _db1 -2,0
                               _db1 0,-2
                              endif
                             
                               _QpenOff
225b : 0f0a             [ 6]>  clr   <0x0A ;pen off
                             
                             
225d : 39               [ 5]   rts
                             
                             
                             ;*****************
225e :                       DrawPlusAtCurrentPosition:  ;a=scale
                               mSetScale
                            >  if 0=1
                            >    lda #                  ;if argument exists, l
                            >  endif
225e : 9704             [ 4]>  sta <$04
                             
                             
                               ;negative y is down, negative x is left
                             
                               _Qmove -2,0,1
000f =                      >One = ($20-1)/2
                            >  mCombine d,-2*One,0*One
2260 : cce200           [ 3]>  ldd #(lo -2*One)<<8 | (lo 0*One)
                            >
2263 : 9701             [ 4]>  sta   <0x01
2265 : 0f00             [ 6]>  clr   <0x00
2267 : 0c00             [ 6]>  inc   <0x00
2269 : d701             [ 4]>  stb   <0x01
226b : 0f05             [ 6]>  clr   <0x05
                            >  if 11=11
                            >    ;need to wait for long lines (third param=1)
226d : c640             [ 2]>    ldb   #0x40
226f :                      >wait0600
226f : d50d             [ 4]>    bitb  <0x0D
2271 : 27fc             [ 3]>    beq   wait0600
                            >  endif
                             
                               _QpenOn
2273 : 86ff             [ 2]>  lda   #0xFF ;pen on
2275 : 970a             [ 4]>  sta   <0x0A
                             
                               _Qmove 4,0,1
000f =                      >One = ($20-1)/2
                            >  mCombine d,4*One,0*One
2277 : cc3c00           [ 3]>  ldd #(lo 4*One)<<8 | (lo 0*One)
                            >
227a : 9701             [ 4]>  sta   <0x01
227c : 0f00             [ 6]>  clr   <0x00
227e : 0c00             [ 6]>  inc   <0x00
2280 : d701             [ 4]>  stb   <0x01
2282 : 0f05             [ 6]>  clr   <0x05
                            >  if 11=11
                            >    ;need to wait for long lines (third param=1)
2284 : c640             [ 2]>    ldb   #0x40
2286 :                      >wait0603
2286 : d50d             [ 4]>    bitb  <0x0D
2288 : 27fc             [ 3]>    beq   wait0603
                            >  endif
                             
                               _QpenOff
228a : 0f0a             [ 6]>  clr   <0x0A ;pen off
                             
                               _Qmove -2,2,1
000f =                      >One = ($20-1)/2
                            >  mCombine d,-2*One,2*One
228c : cce21e           [ 3]>  ldd #(lo -2*One)<<8 | (lo 2*One)
                            >
228f : 9701             [ 4]>  sta   <0x01
2291 : 0f00             [ 6]>  clr   <0x00
2293 : 0c00             [ 6]>  inc   <0x00
2295 : d701             [ 4]>  stb   <0x01
2297 : 0f05             [ 6]>  clr   <0x05
                            >  if 11=11
                            >    ;need to wait for long lines (third param=1)
2299 : c640             [ 2]>    ldb   #0x40
229b :                      >wait0606
229b : d50d             [ 4]>    bitb  <0x0D
229d : 27fc             [ 3]>    beq   wait0606
                            >  endif
                             
                               _QpenOn
229f : 86ff             [ 2]>  lda   #0xFF ;pen on
22a1 : 970a             [ 4]>  sta   <0x0A
                             
                               _Qmove 0,-4,1
000f =                      >One = ($20-1)/2
                            >  mCombine d,0*One,-4*One
22a3 : cc00c4           [ 3]>  ldd #(lo 0*One)<<8 | (lo -4*One)
                            >
22a6 : 9701             [ 4]>  sta   <0x01
22a8 : 0f00             [ 6]>  clr   <0x00
22aa : 0c00             [ 6]>  inc   <0x00
22ac : d701             [ 4]>  stb   <0x01
22ae : 0f05             [ 6]>  clr   <0x05
                            >  if 11=11
                            >    ;need to wait for long lines (third param=1)
22b0 : c640             [ 2]>    ldb   #0x40
22b2 :                      >wait0609
22b2 : d50d             [ 4]>    bitb  <0x0D
22b4 : 27fc             [ 3]>    beq   wait0609
                            >  endif
                             
                               _QpenOff
22b6 : 0f0a             [ 6]>  clr   <0x0A ;pen off
                             
                             
22b8 : 39               [ 5]   rts
                             
                             
                             ;*****************
22b9 :                       DotShatter:                     ;u=pointer to x,y
                               mDecLocals 1,3,4
                            >  nolist
                             
0000 =                       LocalInt = LocalB1
0001 =                       LocalPos = LocalW1
0003 =                       LocalNeg = LocalW2
0005 =                       LocalPtr = LocalW3
                             
                               ;Calc intensity based on time
22bb : c67f             [ 2]   ldb #$7f
22bd : a77f             [ 5]   sta -1,s
22bf : e07f             [ 5]   subb -1,s
22c1 : e07f             [ 5]   subb -1,s
22c3 : 2a01             [ 3]   bpl dsIntPositive
22c5 : 5f               [ 2]     clrb
22c6 :                       dsIntPositive:
22c6 : e7e4             [ 4]   stb LocalInt,s
                             
22c8 : f6c826           [ 5]   ldb LoopCounterLow
22cb : c401             [ 2]   andb #1
22cd : 2701             [ 3]   beq dsSkip1
22cf : 44               [ 2]     lsra
22d0 :                       dsSkip1:
                             
22d0 : 1f89             [ 6]   tfr a,b
22d2 : 4f               [ 2]   clra
22d3 : ed61             [ 6]   std LocalPos,s
22d5 : 50               [ 2]   negb
22d6 : 1d               [ 2]   sex
22d7 : ed63             [ 6]   std LocalNeg,s
                             
22d9 : ef65             [ 6]   stu LocalPtr,s
22db : 3367             [ 5]   leau LocalBuffer,s
                             
                             mShatter macro xmod,ymod
                               ldy LocalPtr,s
                               ldd ,y
                               if xmod!=-1
                                 addd xmod,s
                               endif
                               std ,u
                               ldd 2,y
                               if ymod!=-1
                                 addd ymod,s
                               endif
                               std 2,u
                               lda LocalInt,s
                               jsr DrawDot
                               endm
                             
                               mShatter LocalNeg,LocalNeg
22dd : 10ae65           [ 7]>  ldy LocalPtr,s
22e0 : eca4             [ 5]>  ldd ,y
                            >  if LocalNeg!=-1
22e2 : e363             [ 7]>    addd LocalNeg,s
                            >  endif
22e4 : edc4             [ 5]>  std ,u
22e6 : ec22             [ 6]>  ldd 2,y
                            >  if LocalNeg!=-1
22e8 : e363             [ 7]>    addd LocalNeg,s
                            >  endif
22ea : ed42             [ 6]>  std 2,u
22ec : a6e4             [ 4]>  lda LocalInt,s
22ee : bd2110           [ 8]>  jsr DrawDot
                             
                               mShatter -1,LocalNeg
22f1 : 10ae65           [ 7]>  ldy LocalPtr,s
22f4 : eca4             [ 5]>  ldd ,y
                            >  if -1!=-1
                            >    addd -1,s
                            >  endif
22f6 : edc4             [ 5]>  std ,u
22f8 : ec22             [ 6]>  ldd 2,y
                            >  if LocalNeg!=-1
22fa : e363             [ 7]>    addd LocalNeg,s
                            >  endif
22fc : ed42             [ 6]>  std 2,u
22fe : a6e4             [ 4]>  lda LocalInt,s
2300 : bd2110           [ 8]>  jsr DrawDot
                             
                               mShatter LocalPos,LocalNeg
2303 : 10ae65           [ 7]>  ldy LocalPtr,s
2306 : eca4             [ 5]>  ldd ,y
                            >  if LocalPos!=-1
2308 : e361             [ 7]>    addd LocalPos,s
                            >  endif
230a : edc4             [ 5]>  std ,u
230c : ec22             [ 6]>  ldd 2,y
                            >  if LocalNeg!=-1
230e : e363             [ 7]>    addd LocalNeg,s
                            >  endif
2310 : ed42             [ 6]>  std 2,u
2312 : a6e4             [ 4]>  lda LocalInt,s
2314 : bd2110           [ 8]>  jsr DrawDot
                             
                             
                               mShatter LocalNeg,-1
2317 : 10ae65           [ 7]>  ldy LocalPtr,s
231a : eca4             [ 5]>  ldd ,y
                            >  if LocalNeg!=-1
231c : e363             [ 7]>    addd LocalNeg,s
                            >  endif
231e : edc4             [ 5]>  std ,u
2320 : ec22             [ 6]>  ldd 2,y
                            >  if -1!=-1
                            >    addd -1,s
                            >  endif
2322 : ed42             [ 6]>  std 2,u
2324 : a6e4             [ 4]>  lda LocalInt,s
2326 : bd2110           [ 8]>  jsr DrawDot
                             
                               mShatter LocalPos,-1
2329 : 10ae65           [ 7]>  ldy LocalPtr,s
232c : eca4             [ 5]>  ldd ,y
                            >  if LocalPos!=-1
232e : e361             [ 7]>    addd LocalPos,s
                            >  endif
2330 : edc4             [ 5]>  std ,u
2332 : ec22             [ 6]>  ldd 2,y
                            >  if -1!=-1
                            >    addd -1,s
                            >  endif
2334 : ed42             [ 6]>  std 2,u
2336 : a6e4             [ 4]>  lda LocalInt,s
2338 : bd2110           [ 8]>  jsr DrawDot
                             
                             
                               mShatter LocalNeg,LocalPos
233b : 10ae65           [ 7]>  ldy LocalPtr,s
233e : eca4             [ 5]>  ldd ,y
                            >  if LocalNeg!=-1
2340 : e363             [ 7]>    addd LocalNeg,s
                            >  endif
2342 : edc4             [ 5]>  std ,u
2344 : ec22             [ 6]>  ldd 2,y
                            >  if LocalPos!=-1
2346 : e361             [ 7]>    addd LocalPos,s
                            >  endif
2348 : ed42             [ 6]>  std 2,u
234a : a6e4             [ 4]>  lda LocalInt,s
234c : bd2110           [ 8]>  jsr DrawDot
                             
                               mShatter -1,LocalPos
234f : 10ae65           [ 7]>  ldy LocalPtr,s
2352 : eca4             [ 5]>  ldd ,y
                            >  if -1!=-1
                            >    addd -1,s
                            >  endif
2354 : edc4             [ 5]>  std ,u
2356 : ec22             [ 6]>  ldd 2,y
                            >  if LocalPos!=-1
2358 : e361             [ 7]>    addd LocalPos,s
                            >  endif
235a : ed42             [ 6]>  std 2,u
235c : a6e4             [ 4]>  lda LocalInt,s
235e : bd2110           [ 8]>  jsr DrawDot
                             
                               mShatter LocalPos,LocalPos
2361 : 10ae65           [ 7]>  ldy LocalPtr,s
2364 : eca4             [ 5]>  ldd ,y
                            >  if LocalPos!=-1
2366 : e361             [ 7]>    addd LocalPos,s
                            >  endif
2368 : edc4             [ 5]>  std ,u
236a : ec22             [ 6]>  ldd 2,y
                            >  if LocalPos!=-1
236c : e361             [ 7]>    addd LocalPos,s
                            >  endif
236e : ed42             [ 6]>  std 2,u
2370 : a6e4             [ 4]>  lda LocalInt,s
2372 : bd2110           [ 8]>  jsr DrawDot
                             
                             
                               mFreeLocals
2375 : 326b             [ 5]>  leas FrameSize,s
                             
2377 : 39               [ 5]   rts
                             
                             
                             
                             ;*****************
2378 :                       DrawSprite:                     ;Draw a single sp
                               mDecLocals 1,2
                            >  nolist
                             
                               ;DP must be D0
                             
237a : af61             [ 6]   stx LocalW1,s
                             
                               mGetScreenX 0,u               ;X coord
                            >  if  2 = 0    ;no param, X holds X-coord
                            >    tfr x,y
                            >  endif
                            >  if  2 = 1
                            >    ldy     0
                            >  endif
                            >  if  2 = 2   ;as09 treats "2,y" as two separate 
237c : 10aec4           [ 6]>    ldy     0,u               
                            >  endif
237f : bec8c6           [ 6]>  ldx     ViewX
2382 : 1f20             [ 6]>  tfr     y,d
2384 : af7e             [ 6]>  stx -2,s
2386 : a37e             [ 7]>  subd -2,s
2388 : 2c0a             [ 3]>  bge     L1430647
238a : fcc8cd           [ 6]>  ldd     CurLevelEndX
                            >;  stx -2,s
238d : a37e             [ 7]>  subd -2,s
238f : 10af7e           [ 7]>  sty -2,s
2392 : e37e             [ 7]>  addd -2,s
2394 :                      >L1430647:
                             
2394 : 2b46             [ 3]   bmi drExit                    ;offscreen, skip
2396 : 4d               [ 2]   tsta
2397 : 2643             [ 3]   bne drExit                    ;offscreen, skip
                             
2399 : c080             [ 2]   subb #128
239b : e7e4             [ 4]   stb LocalB1,s
                             
239d : ec42             [ 6]   ldd 2,u                       ;Y coord
239f : b3c8c8           [ 7]   subd ViewY
23a2 : 2b38             [ 3]   bmi drExit                    ;offscreen, skip
23a4 : 4d               [ 2]   tsta
23a5 : 2635             [ 3]   bne drExit                    ;offscreen, skip
                             
23a7 : 50               [ 2]   negb
23a8 : 1f98             [ 6]   tfr b,a
23aa : e6e4             [ 4]   ldb LocalB1,s
23ac : 8b7f             [ 2]   adda #127
                             
23ae : ed63             [ 6]   std LocalW2,s
                               mSetScale $7f                 ;Scale $7f is req
                            >  if 1=1
23b0 : 867f             [ 2]>    lda #$7f                                   ;i
                            >  endif
23b2 : 9704             [ 4]>  sta <$04
                             
23b4 : bdf354           [ 8]   jsr reset0ref
23b7 : ec63             [ 6]   ldd LocalW2,s
                               mMove_pen_d_Quick
23b9 : 9701             [ 4]>  sta   <0x01
23bb : 0f00             [ 6]>  clr   <0x00
23bd : 86ce             [ 2]>  lda   #0xCE
23bf : 970c             [ 4]>  sta   <0x0C
23c1 : 0f0a             [ 6]>  clr   <0x0A
23c3 : 0c00             [ 6]>  inc   <0x00
23c5 : d701             [ 4]>  stb   <0x01
23c7 : 0f05             [ 6]>  clr   <0x05
23c9 : c640             [ 2]>  ldb   #0x40
23cb : d50d             [ 4]>PF33D0649: bitb  <0x0D
23cd : 27fc             [ 3]>  beq   PF33D0649
                            >;PF33B0649: lda   #0x04
                            >;PF3410649: deca
                            >;  bne   PF3410649
                             
                             
23cf : ae61             [ 6]   ldx LocalW1,s
23d1 : a680             [ 6]   lda ,x+                       ;Nr of vectors in
23d3 :                       drLoop:
23d3 : c614             [ 2]   ldb #DrawScale                ;Scale
23d5 : bdf3b7           [ 8]   jsr move_draw_VL4             ;Draw list
23d8 : a680             [ 6]   lda ,x+                       ;Get next count, 
23da : 2af7             [ 3]   bpl drLoop
23dc :                       drExit:
                             
                               mFreeLocals
23dc : 3265             [ 5]>  leas FrameSize,s
                             
23de : 39               [ 5]   rts
                             
                             
                             
                             ;*****************
23df :                       UpdateShipShots:                ;Move all active 
                               direct $c8
                               mDecLocals 3,2
                            >  nolist
                             
0003 =                       Local1 = LocalW1
0005 =                       Local2 = LocalW2
0001 =                       LocalGunCount = LocalB2
0001 =                       LocalFuelCount = LocalB2        ;fuel use same te
0001 =                       LocalCount = LocalB2
                             
23e1 : cec91c           [ 3]   ldu #ShipShotList
23e4 : 8604             [ 2]   lda #ShipShotCount
23e6 :                       ussLoop:
23e6 : a762             [ 5]   sta LocalB3,s                  ;spill loop inde
23e8 : 6dc4             [ 6]   tst ssShotActive,u
23ea : 1027025a         [ 6]   lbeq ussNext
                             
                               ;Move shots
                               mUpdateXCoord ssShotX, ssShotVelocX
23ee : 3041             [ 5]>  leax ssShotX,u               ;Update sprite X c
                            >  mGet_D_from_fixed
23f0 : ec84             [ 5]>  ldd ,x
                            >
23f2 : 6802             [ 7]>  asl 2,x
23f4 : 59               [ 2]>  rolb
23f5 : 49               [ 2]>  rola
                            >
23f6 : 6802             [ 7]>  asl 2,x
23f8 : 59               [ 2]>  rolb
23f9 : 49               [ 2]>  rola
                            >
23fa : ed7e             [ 6]>  std -2,s
23fc : e647             [ 5]>  ldb  ssShotVelocX,u
23fe : 1d               [ 2]>  sex
23ff : e37e             [ 7]>  addd -2,s
                            >  mStore_D_as_fixed
2401 : 6f02             [ 7]>  clr 2,x
                            >
2403 : 47               [ 2]>  asra
2404 : 56               [ 2]>  rorb
2405 : 6602             [ 7]>  ror 2,x
                            >
2407 : 47               [ 2]>  asra
2408 : 56               [ 2]>  rorb
2409 : 6602             [ 7]>  ror 2,x
                            >
240b : ed84             [ 5]>  std ,x
                            >
240d : 4d               [ 2]>  tsta                          ;Check for world 
240e : 2a06             [ 3]>  bpl CheckRightEdge0664
2410 : d3cd             [ 6]>    addd CurLevelEndX           ;Left end hit, wr
2412 : ed41             [ 6]>    std ssShotX,u
2414 : 2006             [ 3]>    bra XOk0664
2416 :                      >CheckRightEdge0664:
2416 : 93cd             [ 6]>    subd CurLevelEndX
2418 : 2b02             [ 3]>    bmi XOk0664
241a : ed41             [ 6]>    std ssShotX,u              ;Right edge hit
241c :                      >XOk0664:
                             
                               mUpdateYCoord ssShotY, ssShotVelocY, ussRemoveS
241c : 3044             [ 5]>  leax ssShotY,u               ;Update sprite Y c
                            >  mGet_D_from_fixed
241e : ec84             [ 5]>  ldd ,x
                            >
2420 : 6802             [ 7]>  asl 2,x
2422 : 59               [ 2]>  rolb
2423 : 49               [ 2]>  rola
                            >
2424 : 6802             [ 7]>  asl 2,x
2426 : 59               [ 2]>  rolb
2427 : 49               [ 2]>  rola
                            >
2428 : ed7e             [ 6]>  std -2,s
242a : e648             [ 5]>  ldb  ssShotVelocY,u
242c : 1d               [ 2]>  sex
242d : e37e             [ 7]>  addd -2,s
242f : 1083fc40         [ 5]>  cmpd #WorldTopY << Fixed
2433 : 2e03             [ 3]>  bgt NotHitTopOfWorld0667
2435 : 7e2646           [ 4]>    lbra  ussRemoveShot            ;Top of world 
2438 :                      >NotHitTopOfWorld0667:
                            >  mStore_D_as_fixed
2438 : 6f02             [ 7]>  clr 2,x
                            >
243a : 47               [ 2]>  asra
243b : 56               [ 2]>  rorb
243c : 6602             [ 7]>  ror 2,x
                            >
243e : 47               [ 2]>  asra
243f : 56               [ 2]>  rorb
2440 : 6602             [ 7]>  ror 2,x
                            >
2442 : ed84             [ 5]>  std ,x
                            >
                             
                             
2444 : 10ae44           [ 7]   ldy ssShotY,u                 ;Collision shots 
2447 : ae41             [ 6]   ldx ssShotX,u
2449 : bd2d92           [ 8]   jsr PointVsLevel
244c : 2403             [ 3]   bcc ussNoHit
244e : 7e2646           [ 4]     lbra ussRemoveShot          ;remove shot
2451 :                       ussNoHit:
                             
2451 : 109eca           [ 6]   ldy CurLevelEntry             ;Collision shots 
2454 : 10ae24           [ 7]   ldy leGuns,y
2457 : 1027007b         [ 6]   lbeq ussNoGuns
245b : a6a0             [ 6]   lda ,y+                       ;load guncount
245d : a761             [ 5]   sta LocalGunCount,s
245f : a7e4             [ 4]   sta LocalB1,s
2461 : dce7             [ 5]   ldd GunsActive
2463 :                       ussGunLoop:
2463 : 47               [ 2]   asra
2464 : 56               [ 2]   rorb
2465 : 2469             [ 3]   bcc ussNextGun
2467 : ed63             [ 6]   std LocalW1,s
                               mPointVsArea GunArea,ussGunMiss, ssShotX,ssShot
2469 : ae41             [ 6]>  ldx      ssShotX,u
246b : eca4             [ 5]>  ldd      geGunX,y
246d : 830007           [ 4]>  subd    #GunArea/2
2470 : ed7e             [ 6]>  std -2,s
2472 : ac7e             [ 7]>  cmpx -2,s
2474 : 102d0056         [ 6]>  lblt    ussGunMiss
2478 : c3000e           [ 4]>  addd    #GunArea
247b : ed7e             [ 6]>  std -2,s
247d : ac7e             [ 7]>  cmpx -2,s
247f : 102e004b         [ 6]>  lbgt    ussGunMiss
2483 : ae44             [ 6]>  ldx     ssShotY,u
2485 : ec22             [ 6]>  ldd     geGunY,y
2487 : 830007           [ 4]>  subd    #GunArea/2
248a : ed7e             [ 6]>  std -2,s
248c : ac7e             [ 7]>  cmpx -2,s
248e : 102d003c         [ 6]>  lblt    ussGunMiss
2492 : c3000e           [ 4]>  addd    #GunArea
2495 : ed7e             [ 6]>  std -2,s
2497 : ac7e             [ 7]>  cmpx -2,s
2499 : 102e0031         [ 6]>  lbgt    ussGunMiss
                             
249d : a661             [ 5]     lda LocalGunCount,s         ;hit, clear activ
249f : a0e4             [ 4]     suba LocalB1,s
                                 mClearWordBitA GunsActive
24a1 : a77f             [ 5]>  sta -1,s
24a3 : ccffff           [ 3]>  ldd #$ffff                  ;start with all bit
24a6 : 1cfe             [ 3]>  andcc #$fe                  ;clear carry flag, 
24a8 :                      >lop0671:                          ;rotate a zero 
24a8 : 59               [ 2]>  rolb
24a9 : 49               [ 2]>  rola
24aa : 6a7f             [ 7]>  dec -1,s
24ac : 2afa             [ 3]>  bpl lop0671
24ae : 94e7             [ 4]>  anda GunsActive                  ;D now has a h
24b0 : d4e8             [ 4]>  andb GunsActive+1
24b2 : dde7             [ 5]>  std GunsActive
                             
                             
24b4 : e661             [ 5]     ldb LocalGunCount,s         ;gun index
24b6 : e0e4             [ 4]     subb LocalB1,s
                                 mEmitFx FxTargetGun,FxTypeDotShatter,b
                            >  if ('b'!='0') && ('b'!='b')
                            >    tfr b,b
                            >  endif
24b8 : 8602             [ 2]>  lda #FxTargetGun | (FxTypeDotShatter<<4)
24ba : bd06bb           [ 8]>  jsr EmitFx
                             
                             
24bd : e661             [ 5]     ldb LocalGunCount,s         ;gun index
24bf : e0e4             [ 4]     subb LocalB1,s
                                 mEmitFx FxTargetGun,FxTypeScore750,b
                            >  if ('b'!='0') && ('b'!='b')
                            >    tfr b,b
                            >  endif
24c1 : 8652             [ 2]>  lda #FxTargetGun | (FxTypeScore750<<4)
24c3 : bd06bb           [ 8]>  jsr EmitFx
                             
                             
                                 mGiveScore 750
24c6 : 864b             [ 2]>  lda #750 / 10
24c8 : bd1acf           [ 8]>  jsr GiveScoreA
                             
24cb : 7e2646           [ 4]     jmp ussRemoveShot           ;remove shot
24ce :                       ussGunMiss:
24ce : ec63             [ 6]   ldd LocalW1,s
24d0 :                       ussNextGun:
24d0 : 3125             [ 5]   leay GunEntry,y
24d2 : 6ae4             [ 6]   dec LocalB1,s
24d4 : 268d             [ 3]   bne ussGunLoop
24d6 :                       ussNoGuns:
                             
                             
24d6 : 109eca           [ 6]   ldy CurLevelEntry             ;Collision shots 
24d9 : 10ae26           [ 7]   ldy leFuel,y
24dc : 276d             [ 3]   beq ussNoFuel
24de : a6a0             [ 6]   lda ,y+                       ;load count
24e0 : a761             [ 5]   sta LocalFuelCount,s
24e2 : 4f               [ 2]   clra
24e3 : d6e9             [ 4]   ldb FuelActive
24e5 :                       ussFuelLoop:
24e5 : 57               [ 2]   asrb
24e6 : 245c             [ 3]   bcc ussNextFuel
24e8 : ed63             [ 6]   std LocalW1,s
                               mPointVsArea FuelArea,ussFuelMiss, ssShotX,ssSh
24ea : ae41             [ 6]>  ldx      ssShotX,u
24ec : eca4             [ 5]>  ldd      0,y
24ee : 83000c           [ 4]>  subd    #FuelArea/2
24f1 : ed7e             [ 6]>  std -2,s
24f3 : ac7e             [ 7]>  cmpx -2,s
24f5 : 102d0049         [ 6]>  lblt    ussFuelMiss
24f9 : c30018           [ 4]>  addd    #FuelArea
24fc : ed7e             [ 6]>  std -2,s
24fe : ac7e             [ 7]>  cmpx -2,s
2500 : 102e003e         [ 6]>  lbgt    ussFuelMiss
2504 : ae44             [ 6]>  ldx     ssShotY,u
2506 : ec22             [ 6]>  ldd     2,y
2508 : 83000c           [ 4]>  subd    #FuelArea/2
250b : ed7e             [ 6]>  std -2,s
250d : ac7e             [ 7]>  cmpx -2,s
250f : 102d002f         [ 6]>  lblt    ussFuelMiss
2513 : c30018           [ 4]>  addd    #FuelArea
2516 : ed7e             [ 6]>  std -2,s
2518 : ac7e             [ 7]>  cmpx -2,s
251a : 102e0024         [ 6]>  lbgt    ussFuelMiss
                             
251e : a663             [ 5]     lda LocalW1,s               ;hit, clear activ
                                 mClearBitA FuelActive
2520 : c6ff             [ 2]>  ldb #255                    ;start with all bit
2522 : 1cfe             [ 3]>  andcc #$fe                  ;clear carry flag, 
2524 :                      >lop0676:                          ;rotate a zero 
2524 : 59               [ 2]>  rolb
2525 : 4a               [ 2]>  deca
2526 : 2afc             [ 3]>  bpl lop0676
2528 : d4e9             [ 4]>  andb FuelActive                   ;b now has a 
252a : d7e9             [ 4]>  stb FuelActive
                             
                             
252c : e663             [ 5]     ldb LocalW1,s               ;fuel cell index
                                 mEmitFx FxTargetFuel,FxTypeDotShatter,b
                            >  if ('b'!='0') && ('b'!='b')
                            >    tfr b,b
                            >  endif
252e : 8604             [ 2]>  lda #FxTargetFuel | (FxTypeDotShatter<<4)
2530 : bd06bb           [ 8]>  jsr EmitFx
                             
                             
2533 : e663             [ 5]     ldb LocalW1,s               ;fuel cell index
                                 mEmitFx FxTargetFuel,FxTypeScore150,b
                            >  if ('b'!='0') && ('b'!='b')
                            >    tfr b,b
                            >  endif
2535 : 8634             [ 2]>  lda #FxTargetFuel | (FxTypeScore150<<4)
2537 : bd06bb           [ 8]>  jsr EmitFx
                             
                             
                                 mGiveScore 150
253a : 860f             [ 2]>  lda #150 / 10
253c : bd1acf           [ 8]>  jsr GiveScoreA
                             
253f : 7e2646           [ 4]     jmp ussRemoveShot           ;remove shot
2542 :                       ussFuelMiss:
2542 : ec63             [ 6]   ldd LocalW1,s
2544 :                       ussNextFuel:
2544 : 3124             [ 5]   leay FuelEntry,y
2546 : 4c               [ 2]   inca
2547 : a161             [ 5]   cmpa LocalFuelCount,s
2549 : 269a             [ 3]   bne ussFuelLoop
254b :                       ussNoFuel:
                             
254b : 109eca           [ 6]   ldy CurLevelEntry             ;Collision shot v
254e : 312c             [ 5]   leay lePowerX,y
                               mPointVsArea PlantArea,ussPowerMiss, ssShotX,ss
2550 : ae41             [ 6]>  ldx      ssShotX,u
2552 : eca4             [ 5]>  ldd      0,y
2554 : 83000c           [ 4]>  subd    #PlantArea/2
2557 : ed7e             [ 6]>  std -2,s
2559 : ac7e             [ 7]>  cmpx -2,s
255b : 102d0042         [ 6]>  lblt    ussPowerMiss
255f : c30018           [ 4]>  addd    #PlantArea
2562 : ed7e             [ 6]>  std -2,s
2564 : ac7e             [ 7]>  cmpx -2,s
2566 : 102e0037         [ 6]>  lbgt    ussPowerMiss
256a : ae44             [ 6]>  ldx     ssShotY,u
256c : ec22             [ 6]>  ldd     2,y
256e : 83000c           [ 4]>  subd    #PlantArea/2
2571 : ed7e             [ 6]>  std -2,s
2573 : ac7e             [ 7]>  cmpx -2,s
2575 : 102d0028         [ 6]>  lblt    ussPowerMiss
2579 : c30018           [ 4]>  addd    #PlantArea
257c : ed7e             [ 6]>  std -2,s
257e : ac7e             [ 7]>  cmpx -2,s
2580 : 102e001d         [ 6]>  lbgt    ussPowerMiss
                             
                                 mEmitFx FxTargetPlant,FxTypeDotShatter,0
                            >  if ('0'!='0') && ('0'!='b')
                            >    tfr 0,b
                            >  endif
2584 : 8603             [ 2]>  lda #FxTargetPlant | (FxTypeDotShatter<<4)
2586 : bd06bb           [ 8]>  jsr EmitFx
                             
2589 : 96f3             [ 4]     lda PowerLife
258b : 2b11             [ 3]     bmi ussPowerDead
258d : 1f89             [ 6]       tfr a,b
258f : 4a               [ 2]       deca                      ;decrease powerpl
2590 : 8101             [ 2]       cmpa #1
2592 : 2602             [ 3]       bne ussStorePower
2594 : 86f6             [ 2]         lda #-10                ;Start planet exp
2596 :                       ussStorePower:
2596 : 97f3             [ 4]       sta PowerLife
                             
                                   ;one hit when powerlife 15 =  1 second wait
                                   ;             "          1 = 30 seconds wai
2598 : 50               [ 2]       negb                      ;disable guns for
2599 : cb10             [ 2]       addb #16
259b : 58               [ 2]       aslb
259c : d7f4             [ 4]       stb PowerShot
259e :                       ussPowerDead:
259e : 7e2646           [ 4]     lbra ussRemoveShot           ;remove shot
25a1 :                       ussPowerMiss:
                             
                             
25a1 : 109eca           [ 6]   ldy CurLevelEntry             ;Collision shots 
25a4 : 96f2             [ 4]   lda DoorCounter
25a6 : 2659             [ 3]   bne ussNoSwitches             ;skip check if do
25a8 : 10aea814         [ 7]   ldy leSwitches,y
25ac : a6a0             [ 6]   lda ,y+                       ;load count
25ae : 2751             [ 3]   beq ussNoSwitches
25b0 : a761             [ 5]   sta LocalCount,s
25b2 : 4f               [ 2]   clra
25b3 :                       ussSwitchLoop:
25b3 : a7e4             [ 4]   sta LocalB1,s
                               mPointVsArea SwitchArea,ussNextSwitch, ssShotX,
25b5 : ae41             [ 6]>  ldx      ssShotX,u
25b7 : eca4             [ 5]>  ldd      seSwitchX,y
25b9 : 830005           [ 4]>  subd    #SwitchArea/2
25bc : ed7e             [ 6]>  std -2,s
25be : ac7e             [ 7]>  cmpx -2,s
25c0 : 102d0034         [ 6]>  lblt    ussNextSwitch
25c4 : c3000a           [ 4]>  addd    #SwitchArea
25c7 : ed7e             [ 6]>  std -2,s
25c9 : ac7e             [ 7]>  cmpx -2,s
25cb : 102e0029         [ 6]>  lbgt    ussNextSwitch
25cf : ae44             [ 6]>  ldx     ssShotY,u
25d1 : ec22             [ 6]>  ldd     seSwitchY,y
25d3 : 830005           [ 4]>  subd    #SwitchArea/2
25d6 : ed7e             [ 6]>  std -2,s
25d8 : ac7e             [ 7]>  cmpx -2,s
25da : 102d001a         [ 6]>  lblt    ussNextSwitch
25de : c3000a           [ 4]>  addd    #SwitchArea
25e1 : ed7e             [ 6]>  std -2,s
25e3 : ac7e             [ 7]>  cmpx -2,s
25e5 : 102e000f         [ 6]>  lbgt    ussNextSwitch
                             
                                 mSetByte DoorCounter,1      ;hit, open doors
                            > if 0=1      
                            >   clr DoorCounter
                            > else
25e9 : 8601             [ 2]>   lda #1      
25eb : 97f2             [ 4]>   sta DoorCounter
                            > endif
                             
                             
25ed : a6e4             [ 4]     lda LocalB1,s
                                 mEmitFx FxTargetSwitch,FxTypeDotShatter,a
                            >  if ('a'!='0') && ('a'!='b')
25ef : 1f89             [ 6]>    tfr a,b
                            >  endif
25f1 : 8605             [ 2]>  lda #FxTargetSwitch | (FxTypeDotShatter<<4)
25f3 : bd06bb           [ 8]>  jsr EmitFx
                             
                             
25f6 : 204e             [ 3]     bra ussRemoveShot           ;remove shot
25f8 :                       ussNextSwitch:
25f8 : a6e4             [ 4]   lda LocalB1,s
25fa : 3125             [ 5]   leay SwitchEntry,y
25fc : 4c               [ 2]   inca
25fd : a161             [ 5]   cmpa LocalCount,s
25ff : 26b2             [ 3]   bne ussSwitchLoop
2601 :                       ussNoSwitches:
                             
                             
                               mTestFlag HasOrbFlag          ;shots vs pod
                            >  if 255>HasOrbFlag          
2601 : 96e5             [ 4]>    lda GameFlags1
2603 : 8504             [ 2]>    bita #HasOrbFlag          
                            >  else
                            >    lda GameFlags2
                            >    bita #(HasOrbFlag          )>>8
                            >  endif
                             
2605 : 273d             [ 3]   beq ussPodMiss
2607 : 108ec8bf         [ 4]   ldy #PodX
                               mPointVsArea PodArea,ussPodMiss, ssShotX,ssShot
260b : ae41             [ 6]>  ldx      ssShotX,u
260d : eca4             [ 5]>  ldd      0,y
260f : 830003           [ 4]>  subd    #PodArea/2
2612 : ed7e             [ 6]>  std -2,s
2614 : ac7e             [ 7]>  cmpx -2,s
2616 : 102d002a         [ 6]>  lblt    ussPodMiss
261a : c30006           [ 4]>  addd    #PodArea
261d : ed7e             [ 6]>  std -2,s
261f : ac7e             [ 7]>  cmpx -2,s
2621 : 102e001f         [ 6]>  lbgt    ussPodMiss
2625 : ae44             [ 6]>  ldx     ssShotY,u
2627 : ec22             [ 6]>  ldd      2,y
2629 : 830003           [ 4]>  subd    #PodArea/2
262c : ed7e             [ 6]>  std -2,s
262e : ac7e             [ 7]>  cmpx -2,s
2630 : 102d0010         [ 6]>  lblt    ussPodMiss
2634 : c30006           [ 4]>  addd    #PodArea
2637 : ed7e             [ 6]>  std -2,s
2639 : ac7e             [ 7]>  cmpx -2,s
263b : 102e0005         [ 6]>  lbgt    ussPodMiss
                             
263f : bd2af7           [ 8]   jsr ExplodeShip
2642 : 2002             [ 3]   bra ussRemoveShot
2644 :                       ussPodMiss:
                             
                             
2644 : 2002             [ 3]   bra ussNext
                             
2646 :                       ussRemoveShot:
2646 : 6fc4             [ 6]   clr ssShotActive,u            ;remove shot
                             
2648 :                       ussNext:
2648 : a662             [ 5]   lda LocalB3,s                 ;restore loop ind
264a : 3349             [ 5]   leau ShipShotEntry,u
264c : 4a               [ 2]   deca
264d : 1026fd95         [ 6]   bne ussLoop
                             
                               mFreeLocals
2651 : 3267             [ 5]>  leas FrameSize,s
                             
                               direct -1
2653 : 39               [ 5]   rts
                             
                             
                             
                             ;*****************
2654 :                       DrawShipShots:
                               ;DP must be D0
                               mDecLocals 2,1
                            >  nolist
                             
0000 =                       LocalTempX = LocalB1
0001 =                       LocalTempY = LocalB2
                             
2656 : cec91c           [ 3]   ldu #ShipShotList             ;Draw all active 
2659 : 8604             [ 2]   lda #ShipShotCount
265b :                       dssLoop:
265b : ed62             [ 6]   std LocalW1,s
265d : 6dc4             [ 6]   tst ssShotActive,u
265f : 261c             [ 3]   bne dssActive
2661 :                       dssNext:
2661 : 3349             [ 5]   leau ShipShotEntry,u
2663 : ec62             [ 6]   ldd LocalW1,s
2665 : 4a               [ 2]   deca
2666 : 26f3             [ 3]   bne dssLoop
2668 : 207712           [ 3]   lbra dssFin
                             
266b :                       dssTestRemove:
266b : 10830164         [ 5]   cmpd #256 + 100               ;remove if too fa
266f : 2c08             [ 3]   bge dssRemove
2671 : 1083ff9c         [ 5]   cmpd #-100
2675 : 2d02             [ 3]   blt dssRemove
2677 : 20e8             [ 3]   bra dssNext
2679 :                       dssRemove:
2679 : 6fc4             [ 6]   clr ssShotActive,u            ;remove shot
267b : 20e4             [ 3]   bra dssNext
                             
267d :                       dssActive:
                               ;X coord
                               mGetScreenX ssShotX,u
                            >  if  2 = 0    ;no param, X holds X-coord
                            >    tfr x,y
                            >  endif
                            >  if  2 = 1
                            >    ldy     ssShotX
                            >  endif
                            >  if  2 = 2   ;as09 treats "2,y" as two separate 
267d : 10ae41           [ 7]>    ldy     ssShotX,u
                            >  endif
2680 : bec8c6           [ 6]>  ldx     ViewX
2683 : 1f20             [ 6]>  tfr     y,d
2685 : af7e             [ 6]>  stx -2,s
2687 : a37e             [ 7]>  subd -2,s
2689 : 2c0a             [ 3]>  bge     L1430701
268b : fcc8cd           [ 6]>  ldd     CurLevelEndX
                            >;  stx -2,s
268e : a37e             [ 7]>  subd -2,s
2690 : 10af7e           [ 7]>  sty -2,s
2693 : e37e             [ 7]>  addd -2,s
2695 :                      >L1430701:
                             
2695 : 2bd4             [ 3]   bmi dssTestRemove  ;offscreen, skip
2697 : 4d               [ 2]   tsta
2698 : 26d1             [ 3]   bne dssTestRemove  ;offscreen, skip
                             
269a : c080             [ 2]   subb #128
269c : e7e4             [ 4]   stb LocalTempX,s
                             
                               ;Y coord
269e : ec44             [ 6]   ldd ssShotY,u
26a0 : b3c8c8           [ 7]   subd ViewY
26a3 : 2bbc             [ 3]   bmi dssNext  ;offscreen, skip
26a5 : 4d               [ 2]   tsta
26a6 : 26b9             [ 3]   bne dssNext  ;offscreen, skip
                             
26a8 : e761             [ 5]   stb LocalTempY,s
26aa : bdf354           [ 8]   jsr reset0ref                 ;this shot should
                               mSetScale $7f                 ;Scale $7f is req
                            >  if 1=1
26ad : 867f             [ 2]>    lda #$7f                                   ;i
                            >  endif
26af : 9704             [ 4]>  sta <$04
                             
                             
                               mSetIntensity $50
                            >  if 1=1
26b1 : 8650             [ 2]>    lda   #$50            ;if argument exists, lo
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
26b3 : 9701             [ 4]>  sta   <01
26b5 : cc0401           [ 3]>  ldd   #$0401
26b8 : 9700             [ 4]>  sta   <00
26ba : d700             [ 4]>  stb   <00
                             
26bc : a661             [ 5]   lda LocalTempY,s
                             
26be : 40               [ 2]   nega
26bf : 8b7f             [ 2]   adda #127
26c1 : e6e4             [ 4]   ldb LocalTempX,s
                             
                               mMove_pen_d_Quick
26c3 : 9701             [ 4]>  sta   <0x01
26c5 : 0f00             [ 6]>  clr   <0x00
26c7 : 86ce             [ 2]>  lda   #0xCE
26c9 : 970c             [ 4]>  sta   <0x0C
26cb : 0f0a             [ 6]>  clr   <0x0A
26cd : 0c00             [ 6]>  inc   <0x00
26cf : d701             [ 4]>  stb   <0x01
26d1 : 0f05             [ 6]>  clr   <0x05
26d3 : c640             [ 2]>  ldb   #0x40
26d5 : d50d             [ 4]>PF33D0704: bitb  <0x0D
26d7 : 27fc             [ 3]>  beq   PF33D0704
                            >;PF33B0704: lda   #0x04
                            >;PF3410704: deca
                            >;  bne   PF3410704
                             
                               mDot_at_current_position 1
                            >  ; From vectrex.txt
                            >  ;    "(WARNING! high intensity and long Vec_Dot
                            >  ;     your vectrex monitor, be carefull while e
26d9 : 86ff             [ 2]>       lda   #0xFF
26db : 970a             [ 4]>       sta   <0x0A
                            >;       ldb   #1         ;1 is a value for how lo
                            >;PF2CC0705: decb                     ;dwell is no
                            >;       bne   PF2CC0705
26dd : 0f0a             [ 6]>       clr   <0x0A
                             
                             ;  jsr DrawBulletAtCurrentPosition
26df : 2080             [ 3]   bra dssNext
                             
26e1 :                       dssFin:
                             
                               mFreeLocals
26e1 : 3264             [ 5]>  leas FrameSize,s
                             
26e3 : 39               [ 5]   rts
                             
                             
                             
                             ;*****************
                               if false
                             ClipTest:
                                 ldd ViewX
                                 std _clip_xmin
                                 addd #256
                                 std _clip_xmax
                             
                                 ldd ViewY
                                 std _clip_ymin
                                 addd #256
                                 std _clip_ymax
                             
                                 ldd #(TileH*1)  ;offset y
                                 std ,--s
                                 ldd #(TileW*6)  ;offset x
                                 std ,--s
                                 ldd #DrawList
                                 std ,--s
                                 ldd #TestLines
                                 std ,--s
                                 jsr     _CohenSutherlandClip    ;CALL: (VOIDm
                                 leas  8,s
                             
                                 ;end of drawlist
                                 ldy #DrawList+6
                                 clr ,y
                                 mSetByte NeedRefresh,1
                               rts
                             TestLines:
                               db 1  ;linecount
                               db 2  ;linetype, 0=vert, 1=horiz, 2=slope
                               db (TileW * 5),((TileH/2) * 5)  ;x0,y0
                               db 0,0  ;x1,y1
                               endif
                             
                             
                             ;*****************
26e4 :                       OnLoseLife:
                             ;         dec Lives, beq GameOver
                             ;         om Fuel=0, beq GameOver
                             ;         else RestartLevel
                               direct $c8
                             
26e4 : 967a             [ 4]   lda GameMode
26e6 : 8103             [ 2]   cmpa #BonusGame
26e8 : 2726             [ 3]   beq ollGameOver
                             
26ea : 0d6a             [ 6]   tst CheatLives
26ec : 260b             [ 3]   bne ollCheating
26ee : 96e0             [ 4]     lda ShipLives
26f0 : 271e             [ 3]     beq ollGameOver
26f2 : 4a               [ 2]     deca
26f3 : 97e0             [ 4]     sta ShipLives
26f5 : dce1             [ 5]     ldd ShipFuel
26f7 : 2717             [ 3]     beq ollGameOver
26f9 :                       ollCheating:
                             
26f9 : 4f               [ 2]   clra
26fa : 97f5             [ 4]   sta PerfectBonus              ;no perfect bonus
                             
                               ;if planet destroyed, exit mission
26fc : 0df3             [ 6]   tst PowerLife
26fe : 2a0b             [ 3]   bpl ollPlanetOk
                             
                               mClearFlag HasOrbFlag
                            >  if 255>HasOrbFlag
2700 : 86fb             [ 2]>    lda #~HasOrbFlag
2702 : 94e5             [ 4]>    anda GameFlags1
2704 : 97e5             [ 4]>    sta GameFlags1
                            >  else
                            >    lda #~((HasOrbFlag)>>8)
                            >    anda GameFlags2
                            >    sta GameFlags2
                            >  endif
                             
2706 : bd2921           [ 8]   jsr OnExitLevel
                             
2709 : 200b             [ 3]   bra ollExit
270b :                       ollPlanetOk:
270b : bd2776           [ 8]   jsr RestartLevel
270e : 2006             [ 3]   bra ollExit
2710 :                       ollGameOver:
                               mSetFlag GameOverFlag
                            >  if 255>GameOverFlag
2710 : 8640             [ 2]>    lda #GameOverFlag
2712 : 9ae5             [ 4]>    ora GameFlags1
2714 : 97e5             [ 4]>    sta GameFlags1
                            >  else
                            >    lda #(GameOverFlag)>>8
                            >    ora GameFlags2
                            >    sta GameFlags2
                            >  endif
                             
2716 :                       ollExit:
                             
                               direct -1
2716 : 39               [ 5]   rts
                             
                             
                             ;*****************
2717 :                       ViewShipCenter:                 ;Set view with sh
                               direct $c8
2717 : dcac             [ 5]   ldd CenterX
2719 : 830080           [ 4]   subd #TileCountX / 2 * TileW
271c : 2a02             [ 3]   bpl vscXOk
271e : d3cd             [ 6]     addd CurLevelEndX
2720 :                       vscXOk:
2720 : ddc6             [ 5]   std ViewX
                             
2722 : dcaf             [ 5]   ldd CenterY
2724 : 830080           [ 4]   subd #TileCountY / 2 * TileH
2727 : 1093cf           [ 7]   cmpd CurLevelEndY
272a : 2d02             [ 3]   blt vscYOk
272c : dccf             [ 5]     ldd CurLevelEndY
272e :                       vscYOk:
272e : ddc8             [ 5]   std ViewY
                             
                               mSetByte NeedRefresh,1
                            > if 0=1
                            >   clr NeedRefresh
                            > else
2730 : 8601             [ 2]>   lda #1
2732 : 97c5             [ 4]>   sta NeedRefresh
                            > endif
                             
                               mSetByte ScrollX,0
                            > if 0=0
2734 : 0fc3             [ 6]>   clr ScrollX
                            > else
                            >   lda #0
                            >   sta ScrollX
                            > endif
                             
                               mSetByte ScrollY,0
                            > if 0=0
2736 : 0fc4             [ 6]>   clr ScrollY
                            > else
                            >   lda #0
                            >   sta ScrollY
                            > endif
                             
                               direct -1
2738 : 39               [ 5]   rts
                             
                             
                             ;*****************
2739 :                       ResetShip:                      ;Resets ship stat
                               direct $c8
                               mClearFlag (InactiveFlag | RefuelFlag | ShieldF
                            >  if 255>(InactiveFlag | RefuelFlag | ShieldFlag 
2739 : 86e4             [ 2]>    lda #~(InactiveFlag | RefuelFlag | ShieldFlag
273b : 94e5             [ 4]>    anda GameFlags1
273d : 97e5             [ 4]>    sta GameFlags1
                            >  else
                            >    lda #~(((InactiveFlag | RefuelFlag | ShieldFl
                            >    anda GameFlags2
                            >    sta GameFlags2
                            >  endif
                             
                             
                               ;Original Thrust have a slight angle on the tow
000f =                       AlphaInitAdjust = (ALPHA_MAX/16)
                             
                               ;Init ship direction up or down depending on gr
                               mTestFlag ReverseGravFlag
                            >  if 255>ReverseGravFlag
273f : 96e5             [ 4]>    lda GameFlags1
2741 : 8580             [ 2]>    bita #ReverseGravFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(ReverseGravFlag)>>8
                            >  endif
                             
2743 : 260a             [ 3]   bne rsAngleDown
2745 : 8608             [ 2]   lda #8
2747 : 97b6             [ 4]   sta ShipAngle
2749 : 864b             [ 2]   lda #(ALPHA_MAX/4) + AlphaInitAdjust
274b : 97b2             [ 4]   sta AlphaHi
274d : 2008             [ 3]   bra rsAngleEnd
274f :                       rsAngleDown:
274f : 8618             [ 2]   lda #8 + SHIP_DIRMAX/2
2751 : 97b6             [ 4]   sta ShipAngle
2753 : 86c3             [ 2]   lda #ALPHA_MAX/4 + ALPHA_MAX/2 + AlphaInitAdjus
2755 : 97b2             [ 4]   sta AlphaHi
2757 :                       rsAngleEnd:
                             
2757 : 4f               [ 2]   clra
2758 : 5f               [ 2]   clrb
2759 : ddb4             [ 5]   std AlphaDelta
275b : ddb7             [ 5]   std ShipSpeedX
275d : ddb9             [ 5]   std ShipSpeedY
                             
                               ;mSetFlag HasOrbFlag          ;uncomment to alw
                             
                               ;Warp-in effect
                               mSetFlag InactiveFlag         ;disable ship mov
                            >  if 255>InactiveFlag         
275f : 8610             [ 2]>    lda #InactiveFlag         
2761 : 9ae5             [ 4]>    ora GameFlags1
2763 : 97e5             [ 4]>    sta GameFlags1
                            >  else
                            >    lda #(InactiveFlag         )>>8
                            >    ora GameFlags2
                            >    sta GameFlags2
                            >  endif
                             
                               mEmitFx FxTargetShip,FxTypeWarpIn,0
                            >  if ('0'!='0') && ('0'!='b')
                            >    tfr 0,b
                            >  endif
2765 : 8660             [ 2]>  lda #FxTargetShip | (FxTypeWarpIn<<4)
2767 : bd06bb           [ 8]>  jsr EmitFx
                             
                               mTestFlag HasOrbFlag
                            >  if 255>HasOrbFlag
276a : 96e5             [ 4]>    lda GameFlags1
276c : 8504             [ 2]>    bita #HasOrbFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(HasOrbFlag)>>8
                            >  endif
                             
276e : 2705             [ 3]   beq rsNoPod
                                 mEmitFx FxTargetPod,FxTypeWarpIn,0
                            >  if ('0'!='0') && ('0'!='b')
                            >    tfr 0,b
                            >  endif
2770 : 8661             [ 2]>  lda #FxTargetPod | (FxTypeWarpIn<<4)
2772 : bd06bb           [ 8]>  jsr EmitFx
                             
2775 :                       rsNoPod:
                               direct -1
2775 : 39               [ 5]   rts
                             
                             
                             ;*****************
2776 :                       RestartLevel:
                               mDecLocals 5,0,0
                            >  nolist
                             
                               direct $c8
0001 =                       LocalShipTileX = LocalB2
0002 =                       LocalShipTileY = LocalB3
0003 =                       LocalBest = LocalB4             ;best diff
0004 =                       LocalBestI = LocalB5            ;best index in re
                             
                               mClearFlag InactiveFlag
                            >  if 255>InactiveFlag
2778 : 86ef             [ 2]>    lda #~InactiveFlag
277a : 94e5             [ 4]>    anda GameFlags1
277c : 97e5             [ 4]>    sta GameFlags1
                            >  else
                            >    lda #~((InactiveFlag)>>8)
                            >    anda GameFlags2
                            >    sta GameFlags2
                            >  endif
                             
                             
277e : dcaf             [ 5]   ldd CenterY                   ;find restart poi
2780 : 2a03             [ 3]   bpl rsPositiveY
2782 : cc0000           [ 3]     ldd #0
2785 :                       rsPositiveY:
                               mDivTileH
                            >  if TileH > 32
                            >    asra
                            >    rorb
                            >  endif
                            >  if TileH > 16
2785 : 47               [ 2]>    asra
2786 : 56               [ 2]>    rorb
                            >  endif
                            >  if TileH > 8
2787 : 47               [ 2]>    asra
2788 : 56               [ 2]>    rorb
                            >  endif
                            >  if TileH > 4
2789 : 47               [ 2]>    asra
278a : 56               [ 2]>    rorb
                            >  endif
                            >  if TileH > 2
278b : 47               [ 2]>    asra
278c : 56               [ 2]>    rorb
                            >  endif
                            >  if TileH > 1
278d : 47               [ 2]>    asra
278e : 56               [ 2]>    rorb
                            >  endif
                             
278f : e762             [ 5]   stb LocalShipTileY,s
                             
2791 : dcac             [ 5]   ldd CenterX
                               mDivTileW
                            >  if TileW > 32
                            >    asra
                            >    rorb
                            >  endif
                            >  if TileW > 16
2793 : 47               [ 2]>    asra
2794 : 56               [ 2]>    rorb
                            >  endif
                            >  if TileW > 8
2795 : 47               [ 2]>    asra
2796 : 56               [ 2]>    rorb
                            >  endif
                            >  if TileW > 4
2797 : 47               [ 2]>    asra
2798 : 56               [ 2]>    rorb
                            >  endif
                            >  if TileW > 2
2799 : 47               [ 2]>    asra
279a : 56               [ 2]>    rorb
                            >  endif
                            >  if TileW > 1
279b : 47               [ 2]>    asra
279c : 56               [ 2]>    rorb
                            >  endif
                             
279d : e761             [ 5]   stb LocalShipTileX,s
                             
279f : 8678             [ 2]   lda #120
27a1 : a763             [ 5]   sta LocalBest,s
                             
27a3 : deca             [ 5]   ldu CurLevelEntry
27a5 : eec810           [ 6]   ldu leRestart,u
27a8 : e6c0             [ 6]   ldb ,u+
27aa : e7e4             [ 4]   stb LocalB1,s
                               mTestFlag HasOrbFlag
                            >  if 255>HasOrbFlag
27ac : 96e5             [ 4]>    lda GameFlags1
27ae : 8504             [ 2]>    bita #HasOrbFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(HasOrbFlag)>>8
                            >  endif
                             
27b0 : 2702             [ 3]   beq *+4
                                 ;Use different defaults for haspod
27b2 : c601             [ 2]     ldb #1
27b4 : e764             [ 5]   stb LocalBestI,s
27b6 :                       rlPosLoop:
27b6 : e641             [ 5]   ldb 1,u                       ;compare abs(rest
27b8 : e062             [ 5]   subb LocalShipTileY,s
                               mTestFlag HasOrbFlag
                            >  if 255>HasOrbFlag
27ba : 96e5             [ 4]>    lda GameFlags1
27bc : 8504             [ 2]>    bita #HasOrbFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(HasOrbFlag)>>8
                            >  endif
                             
27be : 2606             [ 3]   bne rlHasOrb
                                 ;no pod, only consider points with lower y (c
                                 ;if none found, use the first in list
27c0 : 5a               [ 2]     decb ;0 is also ok
27c1 : 50               [ 2]     negb
27c2 : 2b1a             [ 3]     bmi rlNext
27c4 : 2003             [ 3]     bra rlStoreYDiff
27c6 :                       rlHasOrb:
                                 ;pod, only consider points with higher y (clo
                                 ;if none found, use the last in list (require
27c6 : 5d               [ 2]     tstb
27c7 : 2b15             [ 3]     bmi rlNext
27c9 :                       rlStoreYDiff:
27c9 : e77f             [ 5]   stb -1,s
                             
27cb : a6c4             [ 4]   lda ,u
27cd : a061             [ 5]   suba LocalShipTileX,s
27cf : 2a01             [ 3]   bpl rlPosX
27d1 : 40               [ 2]     nega
27d2 :                       rlPosX:
27d2 : ab7f             [ 5]   adda -1,s
                             
27d4 : a163             [ 5]   cmpa LocalBest,s
27d6 : 2c06             [ 3]   bge rlNext
27d8 : a763             [ 5]     sta LocalBest,s
27da : a6e4             [ 4]     lda LocalB1,s
27dc : a764             [ 5]     sta LocalBestI,s
27de :                       rlNext:
27de : 3342             [ 5]   leau 2,u
27e0 : 6ae4             [ 6]   dec LocalB1,s
27e2 : 26d2             [ 3]   bne rlPosLoop
                             
                               ;keep pod if more than screenh from PodY
27e4 : deca             [ 5]   ldu CurLevelEntry
27e6 : ec4a             [ 6]   ldd leOrbY,u
27e8 : 93af             [ 6]   subd CenterY
27ea : 10830080         [ 5]   cmpd #ScreenH/2
27ee : 2c06             [ 3]   bge rsKeepPod
                                 mClearFlag HasOrbFlag
                            >  if 255>HasOrbFlag
27f0 : 86fb             [ 2]>    lda #~HasOrbFlag
27f2 : 94e5             [ 4]>    anda GameFlags1
27f4 : 97e5             [ 4]>    sta GameFlags1
                            >  else
                            >    lda #~((HasOrbFlag)>>8)
                            >    anda GameFlags2
                            >    sta GameFlags2
                            >  endif
                             
27f6 :                       rsKeepPod:
                             
27f6 : deca             [ 5]   ldu CurLevelEntry
27f8 : eec810           [ 6]   ldu leRestart,u
27fb : a6c0             [ 6]   lda ,u+
27fd : a064             [ 5]   suba LocalBestI,s
27ff : 48               [ 2]   lsla
2800 : 33c6             [ 5]   leau a,u
2802 : e6c0             [ 6]   ldb ,u+
2804 : 8620             [ 2]   lda #TileW
2806 : 3d               [11]   mul
2807 : c30010           [ 4]   addd #TileW/2  ;center within tile
280a : ddac             [ 5]   std CenterX
280c : e6c0             [ 6]   ldb ,u+
280e : 8620             [ 2]   lda #TileH
2810 : 3d               [11]   mul
2811 : c30010           [ 4]   addd #TileH/2  ;center within tile
2814 : ddaf             [ 5]   std CenterY
                             
                               mSetByte GunShotActive,0
                            > if 0=0
2816 : 0ff6             [ 6]>   clr GunShotActive
                            > else
                            >   lda #0
                            >   sta GunShotActive
                            > endif
                             
                             
2818 : bd2739           [ 8]   jsr ResetShip
281b : bd1227           [ 8]   jsr Ship_UpdateShipPodPos
281e : bd2717           [ 8]   jsr ViewShipCenter
                             
                               mFreeLocals
2821 : 3265             [ 5]>  leas FrameSize,s
                             
                               direct -1
2823 : 39               [ 5]   rts
                             
                             ;*****************
2824 :                       SplitLevelNo:                     ;returns levell
2824 : 8e283a           [ 3]   ldx #LevelCounts
2827 : b6c87a           [ 5]   lda GameMode
282a : 3086             [ 5]   leax a,x
282c : b6c8d1           [ 5]   lda CurLevel
282f : 5f               [ 2]   clrb
2830 :                       splLoop:
2830 : a184             [ 4]   cmpa ,x
2832 : 2d05             [ 3]   blt splExit
2834 : a084             [ 4]   suba ,x
2836 : 5c               [ 2]   incb
2837 : 20f7             [ 3]   bra splLoop
2839 :                       splExit:
2839 : 39               [ 5]   rts
283a : 060808                LevelCounts: db LevelCountNormal,LevelCount,Level
                             
                             ;*****************
283d :                       PrepareLevel:                   ;Calculate level 
                               mDecLocals 1,0,0
                            >  nolist
                             
0000 =                       LocalLevelLo = LocalB1
                               direct $c8
                             
283f : 8ec8e5           [ 3]   ldx #LevelClearLabel
2842 : bdf545           [ 8]   jsr clear_256_bytes           ;Clear buffer
                             
2845 : 8ddd             [ 7]   bsr SplitLevelNo
2847 : a7e4             [ 4]   sta LocalLevelLo,s
2849 : c501             [ 2]   bitb #1                       ;reverse on 1 and
284b : 2706             [ 3]   beq plNoReverse
                                 mSetFlag ReverseGravFlag
                            >  if 255>ReverseGravFlag
284d : 8680             [ 2]>    lda #ReverseGravFlag
284f : 9ae5             [ 4]>    ora GameFlags1
2851 : 97e5             [ 4]>    sta GameFlags1
                            >  else
                            >    lda #(ReverseGravFlag)>>8
                            >    ora GameFlags2
                            >    sta GameFlags2
                            >  endif
                             
2853 :                       plNoReverse:
                             
2853 : c102             [ 2]   cmpb #2                       ;landscape invisi
2855 : 2506             [ 3]   blo plNoNoLand
                                 mSetFlag NoLandscapeFlag
                            >  if 255>NoLandscapeFlag
                            >    lda #NoLandscapeFlag
                            >    ora GameFlags1
                            >    sta GameFlags1
                            >  else
2857 : 8601             [ 2]>    lda #(NoLandscapeFlag)>>8
2859 : 9ae6             [ 4]>    ora GameFlags2
285b : 97e6             [ 4]>    sta GameFlags2
                            >  endif
                             
285d :                       plNoNoLand:
                             
285d : 967a             [ 4]   lda GameMode
285f : 8101             [ 2]   cmpa #HardGame
2861 : 2606             [ 3]   bne plNoHard
                                 mSetFlag HomingGunShotsFlag
                            >  if 255>HomingGunShotsFlag
                            >    lda #HomingGunShotsFlag
                            >    ora GameFlags1
                            >    sta GameFlags1
                            >  else
2863 : 8602             [ 2]>    lda #(HomingGunShotsFlag)>>8
2865 : 9ae6             [ 4]>    ora GameFlags2
2867 : 97e6             [ 4]>    sta GameFlags2
                            >  endif
                             
2869 :                       plNoHard:
                             
2869 : a6e4             [ 4]   lda LocalLevelLo,s
286b : 8e3107           [ 3]   ldx #Levels
286e : c616             [ 2]   ldb #LevelEntry               ;size of levelent
2870 : 3d               [11]   mul
2871 : 3410             [ 7]   pshs x
2873 : e3e1             [ 9]   addd ,s++
2875 : 1f01             [ 6]   tfr d,x                       ;x is now levelen
                             
2877 : 9fca             [ 5]   stx CurLevelEntry
                             
                               mSetWord GunsActive,$ffff     ;all guns active
                            > if 0=$ffff     
                            >   clra
                            >   clrb
                            > else
2879 : ccffff           [ 3]>   ldd #$ffff     
                            > endif
287c : dde7             [ 5]> std GunsActive
                             
                               mSetByte FuelActive,$ff       ;all fuelpods act
                            > if 0=$ff       
                            >   clr FuelActive
                            > else
287e : 86ff             [ 2]>   lda #$ff       
2880 : 97e9             [ 4]>   sta FuelActive
                            > endif
                             
                             
                               mSetByte PowerLife,15         ;hitpoints for po
                            > if 0=15         
                            >   clr PowerLife
                            > else
2882 : 860f             [ 2]>   lda #15         
2884 : 97f3             [ 4]>   sta PowerLife
                            > endif
                             
                             
2886 : a6e4             [ 4]   lda LocalLevelLo,s            ;1500 + (levelno 
2888 : 8b0f             [ 2]   adda #15
288a : 97f5             [ 4]   sta PerfectBonus              ;init perfect bon
                             
288c : cec8ea           [ 3]   ldu #FuelAmounts              ;all fuelpods ful
288f : 8610             [ 2]   lda #FullFuel
2891 : c608             [ 2]   ldb #MaxFuelCount
2893 :                       plFuel:
2893 : a7c0             [ 6]   sta ,u+
2895 : 5a               [ 2]   decb
2896 : 26fb             [ 3]   bne plFuel
                             
2898 : a684             [ 4]   lda leSizeX,x
289a : 97cc             [ 4]   sta CurLevelSizeX
                             
289c : 96cc             [ 4]   lda CurLevelSizeX
289e : c620             [ 2]   ldb #TileW
28a0 : 3d               [11]   mul
28a1 : ddcd             [ 5]   std CurLevelEndX              ;CurLevelEndX = (
                             
28a3 : a601             [ 5]   lda leSizeY,x
28a5 : c620             [ 2]   ldb #TileH
28a7 : 3d               [11]   mul
28a8 : 830100           [ 4]   subd #ScreenH
28ab : ddcf             [ 5]   std CurLevelEndY              ;CurLevelEndY = l
                             
                               ;Gun shot constants
                               ;Make guns fire more often on higher levels
                             
                               ;GunDelayMask = modeconstant >> (levello >> 1)
28ad : 967a             [ 4]   lda GameMode
28af : 8e291b           [ 3]   ldx #GunDelayMasks
28b2 : a686             [ 5]   lda a,x
28b4 : e6e4             [ 4]   ldb LocalLevelLo,s
28b6 : 57               [ 2]   asrb
28b7 :                       plGunMaskLoop:
28b7 : 5d               [ 2]   tstb
28b8 : 2708             [ 3]   beq plStoreGunDelayMask
28ba : 8107             [ 2]   cmpa #7
28bc : 2704             [ 3]   beq plStoreGunDelayMask
28be : 47               [ 2]   asra
28bf : 5a               [ 2]   decb
28c0 : 20f5             [ 3]   bra plGunMaskLoop
28c2 :                       plStoreGunDelayMask:
28c2 : 97f8             [ 4]   sta GunShotMask
                             
                               ;GunDelay = modeconstant - (levello * 8)
28c4 : 967a             [ 4]   lda GameMode
28c6 : 8e2918           [ 3]   ldx #GunDelays
28c9 : a686             [ 5]   lda a,x
28cb : e6e4             [ 4]   ldb LocalLevelLo,s
28cd :                       plGunDelayLoop:
28cd : 5d               [ 2]   tstb
28ce : 2708             [ 3]   beq plStoreGunDelay
28d0 : 4d               [ 2]   tsta
28d1 : 2705             [ 3]   beq plStoreGunDelay
28d3 : 8008             [ 2]   suba #8
28d5 : 5a               [ 2]   decb
28d6 : 20f5             [ 3]   bra plGunDelayLoop
28d8 :                       plStoreGunDelay:
28d8 : 97f9             [ 4]   sta GunShotDelay
                             
                               ;GunShotSpeed = modeconstant + (levello >> 1)
28da : 967a             [ 4]   lda GameMode
28dc : 8e291e           [ 3]   ldx #GunShotSpeeds
28df : a686             [ 5]   lda a,x
28e1 : e6e4             [ 4]   ldb LocalLevelLo,s
28e3 : 57               [ 2]   asrb
28e4 :                       plGunSpeedLoop:
28e4 : 5d               [ 2]   tstb
28e5 : 2708             [ 3]   beq plStoreGunSpeed
28e7 : 8118             [ 2]   cmpa #24
28e9 : 2c04             [ 3]   bge plStoreGunSpeed
28eb : 4c               [ 2]   inca
28ec : 5a               [ 2]   decb
28ed : 20f5             [ 3]   bra plGunSpeedLoop
28ef :                       plStoreGunSpeed:
28ef : 97fa             [ 4]   sta GunShotSpeed
                             
                               ;Set ship start position
                               ;use first restart point
28f1 : deca             [ 5]   ldu CurLevelEntry
28f3 : eec810           [ 6]   ldu leRestart,u
28f6 : a6c0             [ 6]   lda ,u+
28f8 : e6c0             [ 6]   ldb ,u+
28fa : 8620             [ 2]   lda #TileW
28fc : 3d               [11]   mul
28fd : c30010           [ 4]   addd #TileW/2  ;center within tile
2900 : ddac             [ 5]   std CenterX
2902 : e6c0             [ 6]   ldb ,u+
2904 : 8620             [ 2]   lda #TileH
2906 : 3d               [11]   mul
2907 : c30010           [ 4]   addd #TileH/2  ;center within tile
290a : ddaf             [ 5]   std CenterY
                             
290c : bd2739           [ 8]   jsr ResetShip
290f : bd1227           [ 8]   jsr Ship_UpdateShipPodPos
2912 : bd2717           [ 8]   jsr ViewShipCenter
                             
                               direct -1
                               mFreeLocals
2915 : 3261             [ 5]>  leas FrameSize,s
                             
2917 : 39               [ 5]   rts
                             
                             ;Gun fire delay for each game mode
2918 : 302030                GunDelays: db 48,32,48   ;multiple of 8
291b : 3f0f3f                GunDelayMasks: db 63,15,63
                             ;Gun shot speeds for each game mode
291e : 181218                GunShotSpeeds: db 24,18,24
                             
                             
                             ;*****************
2921 :                       OnExitLevel:
                               direct $c8
                             
2921 : 96da             [ 4]   lda DemoMode
2923 : 2a08             [ 3]   bpl oelNoDemo
                                 mSetFlag GameOverFlag
                            >  if 255>GameOverFlag
2925 : 8640             [ 2]>    lda #GameOverFlag
2927 : 9ae5             [ 4]>    ora GameFlags1
2929 : 97e5             [ 4]>    sta GameFlags1
                            >  else
                            >    lda #(GameOverFlag)>>8
                            >    ora GameFlags2
                            >    sta GameFlags2
                            >  endif
                             
292b : 203c             [ 3]     bra oelExit
292d :                       oelNoDemo:
                             
292d : bd4f95           [ 8]   jsr Text_LevelExit
2930 : 2634             [ 3]   bne oelIncomplete
                             
2932 : 0cd1             [ 6]   inc CurLevel
                             
2934 : bd2824           [ 8]   bsr SplitLevelNo              ;check if new rou
2937 : 4d               [ 2]   tsta
2938 : 2627             [ 3]   bne oelNoSpecial
293a : 5d               [ 2]   tstb
293b : 2724             [ 3]   beq oelNoSpecial              ;only display tex
293d : c101             [ 2]     cmpb #1
293f : 2606             [ 3]     bne oelNoGrav
2941 : 4f               [ 2]       clra
2942 : bd5248           [ 8]       jsr Text_Special          ;display 'reverse
2945 : 201a             [ 3]       bra oelNoSpecial
2947 :                       oelNoGrav:
2947 : c102             [ 2]     cmpb #2
2949 : 2607             [ 3]     bne oelNoNoLand
294b : 8601             [ 2]       lda #1
294d : bd5248           [ 8]       jsr Text_Special          ;display 'invisib
2950 : 200f             [ 3]       bra oelNoSpecial
2952 :                       oelNoNoLand:
2952 : c103             [ 2]     cmpb #3
2954 : 270b             [ 3]     beq oelNoSpecial            ;b=3: both revers
2956 : bd5434           [ 8]     jsr Text_ShowWellDone       ;b=4: game comple
                                 mSetFlag GameOverFlag
                            >  if 255>GameOverFlag
2959 : 8640             [ 2]>    lda #GameOverFlag
295b : 9ae5             [ 4]>    ora GameFlags1
295d : 97e5             [ 4]>    sta GameFlags1
                            >  else
                            >    lda #(GameOverFlag)>>8
                            >    ora GameFlags2
                            >    sta GameFlags2
                            >  endif
                             
295f : 2008             [ 3]     bra oelExit
2961 :                       oelNoSpecial:
                             
2961 : bd283d           [ 8]   bsr PrepareLevel
2964 : 2003             [ 3]   bra oelExit
                             
2966 :                       oelIncomplete:
2966 : bd2776           [ 8]   bsr RestartLevel
                             
2969 :                       oelExit:
                             
                               direct -1
2969 : 39               [ 5]   rts
                             
                             
                             ;*****************
296a :                       InitNewGame:    ;a <> 0 skip random reset
                               direct $c8
                             
296a : 4d               [ 2]   tsta
296b : 260d             [ 3]   bne ingNoResetRnd
                                 ;Reset random seeds
                                 ;This is important for demo-playback and reco
                                 mSetByte LoopCounterLow,0
                            > if 0=0
296d : 0f26             [ 6]>   clr LoopCounterLow
                            > else
                            >   lda #0
                            >   sta LoopCounterLow
                            > endif
                             
                                 mSetByte FrameCounter,0
                            > if 0=0
296f : 0fe4             [ 6]>   clr FrameCounter
                            > else
                            >   lda #0
                            >   sta FrameCounter
                            > endif
                             
2971 : 9e7b             [ 5]     ldx $C87B
                                 mCombine d,$ae,$77
2973 : ccae77           [ 3]>  ldd #(lo $ae)<<8 | (lo $77)
                             
2976 : ed84             [ 5]     std ,x
2978 : a702             [ 5]     sta 2,x
297a :                       ingNoResetRnd:
                             
297a : 8ec8a0           [ 3]   ldx #UserRamStart
297d : bdf545           [ 8]   jsr clear_256_bytes   ;Clear buffer
                             
2980 : bdf272           [ 8]   jsr clear_sound_chip
                             
2983 : cc03e8           [ 3]   ldd #1000
2986 : dde1             [ 5]   std ShipFuel
                             
                               ;normal = 2
                               mSetByte ShipLives,2
                            > if 0=2
                            >   clr ShipLives
                            > else
2988 : 8602             [ 2]>   lda #2
298a : 97e0             [ 4]>   sta ShipLives
                            > endif
                             
                             
298c : 8ec8da           [ 3]   ldx #PlayerScore
298f : cc2020           [ 3]   ldd #'  '
2992 : ed81             [ 8]   std ,x++
2994 : ed81             [ 8]   std ,x++
2996 : ed84             [ 5]   std ,x
                             
2998 : 967a             [ 4]   lda GameMode
299a : 8104             [ 2]   cmpa #DemoGame
299c : 2618             [ 3]   bne ingNoDemo
                                 ;Init demo game
299e : 0f7a             [ 6]     clr GameMode
                                 mSetByte DemoMode,-1        ;set flag that th
                            > if 0=-1        
                            >   clr DemoMode
                            > else
29a0 : 86ff             [ 2]>   lda #-1        
29a2 : 97da             [ 4]>   sta DemoMode
                            > endif
                             
29a4 : 966c             [ 4]     lda DemoSelected
29a6 : 48               [ 2]     lsla
29a7 : 8e1516           [ 3]     ldx #DemoList
29aa : ae86             [ 6]     ldx a,x
29ac : 9fdb             [ 5]     stx DemoPtr
                                 mSetByte DemoCounter,0
                            > if 0=0
29ae : 0fdd             [ 6]>   clr DemoCounter
                            > else
                            >   lda #0
                            >   sta DemoCounter
                            > endif
                             
29b0 : a684             [ 4]     lda ,x                      ;read startlevel 
29b2 : 97d1             [ 4]     sta CurLevel
29b4 : 200e             [ 3]     bra ingExit
29b6 :                       ingNoDemo:
29b6 : 8102             [ 2]     cmpa #TimeAttackGame
29b8 : 2604             [ 3]     bne ingNoTimeAttack
29ba : c64b             [ 2]     ldb #75                     ;init timeattack
29bc : d7e3             [ 4]     stb TimeAttackTime
29be :                       ingNoTimeAttack:
29be : 8600             [ 2]     lda #StartLevel
29c0 : 9b6b             [ 4]     adda CheatLevel
29c2 : 97d1             [ 4]     sta CurLevel
29c4 :                       ingExit:
                             
                               direct -1
29c4 : 39               [ 5]   rts
                             
                             
                             ;*****************
0004 =                       ScrollSpeed=4
004c =                       BorderWidth=76          ;Distance of ship to scre
0064 =                       EndBorderWidth=100      ;Distance ship<->border w
                             
29c5 :                       SetView:
                               direct $c8
                               mDecLocals 2,0,0
                            >  nolist
                             
0000 =                       LocalScreenX = LocalB1
0001 =                       LocalScreenY = LocalB2
                             
29c7 : dcc3             [ 5]   ldd ScrollX           ;load both scrollx/y
29c9 : 2704             [ 3]   beq svNoRefresh       ;zero if not scrolling
                                 mSetByte NeedRefresh,1
                            > if 0=1
                            >   clr NeedRefresh
                            > else
29cb : 8601             [ 2]>   lda #1
29cd : 97c5             [ 4]>   sta NeedRefresh
                            > endif
                             
29cf :                       svNoRefresh:
                             
                               ;update scroll x
                             
29cf : 9ebb             [ 5]   ldx ShipX
                               mGetScreenX
                            >  if  0 = 0    ;no param, X holds X-coord
29d1 : 1f12             [ 6]>    tfr x,y
                            >  endif
                            >  if  0 = 1
                            >    ldy     
                            >  endif
                            >  if  0 = 2   ;as09 treats "2,y" as two separate 
                            >    ldy     ,
                            >  endif
29d3 : 9ec6             [ 5]>  ldx     ViewX
29d5 : 1f20             [ 6]>  tfr     y,d
29d7 : af7e             [ 6]>  stx -2,s
29d9 : a37e             [ 7]>  subd -2,s
29db : 2c09             [ 3]>  bge     L1430781
29dd : dccd             [ 5]>  ldd     CurLevelEndX
                            >;  stx -2,s
29df : a37e             [ 7]>  subd -2,s
29e1 : 10af7e           [ 7]>  sty -2,s
29e4 : e37e             [ 7]>  addd -2,s
29e6 :                      >L1430781:
                             
29e6 : e7e4             [ 4]   stb LocalScreenX,s
                               ;b holds screen x
                             
29e8 : 0dc3             [ 6]   tst ScrollX
29ea : 2727             [ 3]   beq svScrollXFin
29ec : 2a11             [ 3]   bpl svScrollRight
                                 ;scroll left
29ee : c19c             [ 2]     cmpb #256-EndBorderWidth
29f0 : 2502             [ 3]     blo *+4
29f2 : 0fc3             [ 6]       clr ScrollX
29f4 : dcc6             [ 5]     ldd ViewX
29f6 : 830004           [ 4]     subd #ScrollSpeed
29f9 : 2a16             [ 3]     bpl svStoreX
29fb : d3cd             [ 6]     addd CurLevelEndX
29fd : 2012             [ 3]     bra svStoreX
29ff :                       svScrollRight:
29ff : c164             [ 2]     cmpb #EndBorderWidth
2a01 : 2202             [ 3]     bhi *+4
2a03 : 0fc3             [ 6]       clr ScrollX
2a05 : dcc6             [ 5]     ldd ViewX
2a07 : c30004           [ 4]     addd #ScrollSpeed
2a0a : 1093cd           [ 7]     cmpd CurLevelEndX
2a0d : 2502             [ 3]     blo svStoreX
2a0f : 93cd             [ 6]     subd CurLevelEndX
2a11 :                       svStoreX:
2a11 : ddc6             [ 5]   std ViewX
2a13 :                       svScrollXFin:
                             
                               ;update scroll y
                             
2a13 : dcbd             [ 5]   ldd ShipY
2a15 : 93c8             [ 6]   subd ViewY
2a17 : e761             [ 5]   stb LocalScreenY,s
                               ;b holds screen y
                             
2a19 : 9ec8             [ 5]   ldx ViewY
2a1b : 0dc4             [ 6]   tst ScrollY
2a1d : 2724             [ 3]   beq svScrollYFin
2a1f : 2a12             [ 3]   bpl svScrollDown
                                 ;scroll up
2a21 : c19c             [ 2]     cmpb #256-EndBorderWidth
2a23 : 2502             [ 3]     blo *+4
2a25 : 0fc4             [ 6]       clr ScrollY
2a27 : 301c             [ 5]     leax -ScrollSpeed,x
2a29 : 8cff10           [ 4]     cmpx #WorldTopY
2a2c : 2e13             [ 3]     bgt svStoreY
2a2e : 8eff10           [ 3]     ldx #WorldTopY
2a31 : 200e             [ 3]     bra svStoreY
2a33 :                       svScrollDown:
2a33 : c164             [ 2]     cmpb #EndBorderWidth
2a35 : 2202             [ 3]     bhi *+4
2a37 : 0fc4             [ 6]       clr ScrollY
2a39 : 3004             [ 5]     leax ScrollSpeed,x
2a3b : 9ccf             [ 6]     cmpx CurLevelEndY
2a3d : 2d02             [ 3]     blt svStoreY
2a3f : 9ecf             [ 5]     ldx CurLevelEndY
2a41 :                       svStoreY:
2a41 : 9fc8             [ 5]   stx ViewY
2a43 :                       svScrollYFin:
                             
                               ;test if need to start scrolling
                             
2a43 : 0dc3             [ 6]   tst ScrollX
2a45 : 2616             [ 3]   bne svEndCheckScrollX
2a47 : e6e4             [ 4]     ldb LocalScreenX,s
2a49 : c1b4             [ 2]     cmpb #256 - BorderWidth  ;right edge
2a4b : 2206             [ 3]     bhi svSetScrollRight
2a4d : c14c             [ 2]     cmpb #BorderWidth        ;left edge
2a4f : 2508             [ 3]     blo svSetScrollLeft
2a51 : 200a             [ 3]     bra svEndCheckScrollX
2a53 :                       svSetScrollRight:
                                 mSetByte ScrollX, 1
                            > if 0= 1
                            >   clr ScrollX
                            > else
2a53 : 8601             [ 2]>   lda # 1
2a55 : 97c3             [ 4]>   sta ScrollX
                            > endif
                             
2a57 : 2004             [ 3]     bra svEndCheckScrollX
2a59 :                       svSetScrollLeft:
                                 mSetByte ScrollX, -1
                            > if 0= -1
                            >   clr ScrollX
                            > else
2a59 : 86ff             [ 2]>   lda # -1
2a5b : 97c3             [ 4]>   sta ScrollX
                            > endif
                             
2a5d :                       svEndCheckScrollX:
                             
2a5d : 0dc4             [ 6]   tst ScrollY
2a5f : 2616             [ 3]   bne svEndCheckScrollY
2a61 : e661             [ 5]     ldb LocalScreenY,s
2a63 : c1b4             [ 2]     cmpb #256 - BorderWidth  ;bottom edge
2a65 : 2206             [ 3]     bhi svSetScrollDown
2a67 : c14c             [ 2]     cmpb #BorderWidth        ;top edge
2a69 : 2508             [ 3]     blo svSetScrollUp
2a6b : 200a             [ 3]     bra svEndCheckScrollY
2a6d :                       svSetScrollDown:
                                 mSetByte ScrollY, 1
                            > if 0= 1
                            >   clr ScrollY
                            > else
2a6d : 8601             [ 2]>   lda # 1
2a6f : 97c4             [ 4]>   sta ScrollY
                            > endif
                             
2a71 : 2004             [ 3]     bra svEndCheckScrollY
2a73 :                       svSetScrollUp:
                                 mSetByte ScrollY, -1
                            > if 0= -1
                            >   clr ScrollY
                            > else
2a73 : 86ff             [ 2]>   lda # -1
2a75 : 97c4             [ 4]>   sta ScrollY
                            > endif
                             
2a77 :                       svEndCheckScrollY:
                             
                               mFreeLocals
2a77 : 3262             [ 5]>  leas FrameSize,s
                             
                               direct -1
2a79 : 39               [ 5]   rts
                             
                             
                             
                             ;*****************
2a7a :                       DrawLevel:
                               ;DP must be D0
                               mDecLocals 1,0,0
                            >  nolist
                             
0000 =                       LocalInt = LocalB1
                             
2a7c : 8ec946           [ 3]   ldx #DrawList
2a7f : 8630             [ 2]   lda #WallIntensity
2a81 : a7e4             [ 4]   sta LocalInt,s
                             
                               mTestFlag NoLandscapeFlag
                            >  if 255>NoLandscapeFlag
                            >    lda GameFlags1
                            >    bita #NoLandscapeFlag
                            >  else
2a83 : b6c8e6           [ 5]>    lda GameFlags2
2a86 : 8501             [ 2]>    bita #(NoLandscapeFlag)>>8
                            >  endif
                             
2a88 : 2709             [ 3]   beq dlNormal
                                 ;If no landscape, only draw when shield is us
                                 mTestFlag ShieldFlag
                            >  if 255>ShieldFlag
2a8a : b6c8e5           [ 5]>    lda GameFlags1
2a8d : 8501             [ 2]>    bita #ShieldFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(ShieldFlag)>>8
                            >  endif
                             
2a8f : 2602             [ 3]     bne dlNormal
2a91 : 6fe4             [ 6]     clr LocalInt,s
2a93 :                       dlNormal:
2a93 : a6e4             [ 4]   lda LocalInt,s
2a95 : 8d03             [ 7]   bsr GoDrawList
                             
                               mFreeLocals
2a97 : 3261             [ 5]>  leas FrameSize,s
                             
2a99 : 39               [ 5]   rts
                             
                             
                             ;*****************
2a9a :                       GoDrawList:                     ;x=drawlist, a=in
                               mSetIntensity
                            >  if 0=1
                            >    lda   #            ;if argument exists, load 
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
2a9a : 9701             [ 4]>  sta   <01
2a9c : cc0401           [ 3]>  ldd   #$0401
2a9f : 9700             [ 4]>  sta   <00
2aa1 : d700             [ 4]>  stb   <00
                             
                               mSetScale $7f       ;Scale $7f is required for 
                            >  if 1=1
2aa3 : 867f             [ 2]>    lda #$7f                         ;if argument
                            >  endif
2aa5 : 9704             [ 4]>  sta <$04
                             
                             
2aa7 :                       dlLoop:
2aa7 : a680             [ 6]   lda ,x+
2aa9 : 274b             [ 3]   beq dlFinish
2aab : 2c2e             [ 3]   bge dlLine
                             
                               ;setpen
                             
                               ;reset0ref inlined
2aad : cc00cc           [ 3]   ldd   #0x00CC
2ab0 : d70c             [ 4]   stb   <0x0C
2ab2 : 970a             [ 4]   sta   <0x0A
2ab4 : cc0302           [ 3]   ldd   #0x0302
2ab7 : 0f01             [ 6]   clr   <0x01
2ab9 : 9700             [ 4]   sta   <0x00
2abb : d700             [ 4]   stb   <0x00
                             ;  stb   <0x00
2abd : c601             [ 2]   ldb   #0x01
2abf : d700             [ 4]   stb   <0x00
                             
2ac1 : ec81             [ 8]   ldd ,x++
                               mMove_pen_d_Quick
2ac3 : 9701             [ 4]>  sta   <0x01
2ac5 : 0f00             [ 6]>  clr   <0x00
2ac7 : 86ce             [ 2]>  lda   #0xCE
2ac9 : 970c             [ 4]>  sta   <0x0C
2acb : 0f0a             [ 6]>  clr   <0x0A
2acd : 0c00             [ 6]>  inc   <0x00
2acf : d701             [ 4]>  stb   <0x01
2ad1 : 0f05             [ 6]>  clr   <0x05
2ad3 : c640             [ 2]>  ldb   #0x40
2ad5 : d50d             [ 4]>PF33D0805: bitb  <0x0D
2ad7 : 27fc             [ 3]>  beq   PF33D0805
                            >;PF33B0805: lda   #0x04
                            >;PF3410805: deca
                            >;  bne   PF3410805
                             
                             
2ad9 : 20cc             [ 3]   bra dlLoop
                             
2adb :                       dlLine:
                               ;Optimize: Lines could be scaled down (scale 7f
                               ;This would require no line length larger than 
                             
2adb : ec81             [ 8]   ldd ,x++
                               mDrawToD
2add : 9701             [ 4]>  sta   <$01
2adf : 0f00             [ 6]>  clr   <$00
                            >;  leax  2,x
                            >  ;Ev. måste flera nop läggas till här för att ko
                            >  ;kommenterats bort
                            >;  nop
2ae1 : 0c00             [ 6]>  inc   <$00
2ae3 : d701             [ 4]>  stb   <$01
2ae5 : ccff00           [ 3]>  ldd   #$FF00
2ae8 : 970a             [ 4]>  sta   <$0A
2aea : d705             [ 4]>  stb   <$05
2aec : 8640             [ 2]>  lda   #$40
2aee :                      >wait10806:
2aee : 950d             [ 4]>  bita  <$0D
2af0 : 27fc             [ 3]>  beq   wait10806
                            >;  nop
2af2 : d70a             [ 4]>  stb   <$0A
                             
                             
2af4 : 20b1             [ 3]   bra dlLoop
                             
2af6 :                       dlFinish:
2af6 : 39               [ 5]   rts
                             
                             
                              if false
                             mTestTile macro XX,YY
                                db -1, 127 - (YY*TileH), -127 + (XX*TileW)
                                db 1, -TileH, 0
                                db 1, 0, TileW
                              endm
                             
                             mTestOneRow macro YY
                              mTestTile 0,YY
                              mTestTile 1,YY
                              mTestTile 2,YY
                              mTestTile 3,YY
                              mTestTile 4,YY
                              mTestTile 5,YY
                              mTestTile 6,YY
                              mTestTile 7,YY
                              mTestTile 8,YY
                              endm
                             
                             testdrawlist:
                               mTestOneRow 0
                               mTestOneRow 1
                               mTestOneRow 2
                               mTestOneRow 3
                               mTestOneRow 4
                               mTestOneRow 5
                               mTestOneRow 6
                               mTestOneRow 7
                             ;  db -1, 127,-127   ;set pen
                             ;  db 1,  -50,50     ;draw line
                             ;  db -1, -120,-120   ;set pen
                             ;  db 1,  25,50     ;draw line
                               db 0             ;end list
                              endif
                             
                             
                             
                             ;*****************
2af7 :                       ExplodeShip:
                               if Immortal=0
                                 mTestFlag InactiveFlag      ;do nothing if al
                            >  if 255>InactiveFlag      
2af7 : b6c8e5           [ 5]>    lda GameFlags1
2afa : 8510             [ 2]>    bita #InactiveFlag      
                            >  else
                            >    lda GameFlags2
                            >    bita #(InactiveFlag      )>>8
                            >  endif
                             
2afc : 2619             [ 3]     bne exsExit
                                 mTestFlag HasOrbFlag        ;explode orb also
                            >  if 255>HasOrbFlag        
2afe : b6c8e5           [ 5]>    lda GameFlags1
2b01 : 8504             [ 2]>    bita #HasOrbFlag        
                            >  else
                            >    lda GameFlags2
                            >    bita #(HasOrbFlag        )>>8
                            >  endif
                             
2b03 : 2705             [ 3]     beq exsNoPod
                                   mEmitFx FxTargetPod,FxTypeDotShatter,0
                            >  if ('0'!='0') && ('0'!='b')
                            >    tfr 0,b
                            >  endif
2b05 : 8601             [ 2]>  lda #FxTargetPod | (FxTypeDotShatter<<4)
2b07 : bd06bb           [ 8]>  jsr EmitFx
                             
2b0a :                       exsNoPod:
                                 mEmitFx FxTargetShip,FxTypeDotShatter,b
                            >  if ('b'!='0') && ('b'!='b')
                            >    tfr b,b
                            >  endif
2b0a : 8600             [ 2]>  lda #FxTargetShip | (FxTypeDotShatter<<4)
2b0c : bd06bb           [ 8]>  jsr EmitFx
                             
                                 mSetFlag InactiveFlag       ;disable ship mov
                            >  if 255>InactiveFlag       
2b0f : 8610             [ 2]>    lda #InactiveFlag       
2b11 : bac8e5           [ 5]>    ora GameFlags1
2b14 : b7c8e5           [ 5]>    sta GameFlags1
                            >  else
                            >    lda #(InactiveFlag       )>>8
                            >    ora GameFlags2
                            >    sta GameFlags2
                            >  endif
                             
2b17 :                       exsExit:
                               endif
2b17 : 39               [ 5]   rts
                             
                             
                             ;*****************
2b18 :                       RefreshDrawList:
                               direct $c8
                             
                               ;refresh DrawList-memory with lines from tiles 
2b18 : 0dc5             [ 6]   tst NeedRefresh
2b1a : 2601             [ 3]   bne rdBegin
2b1c : 39               [ 5]     rts ;quick exit if refresh not needed
                             
2b1d :                       rdBegin:
                              ; tileWX,tileWY
                              ; loop x until tileWX is larger than viewX+256
                              ;   if tileWX,tileWY is within screen (viewX/Y +
                              ;     copy the lines directly
                              ;   else
                              ;     clip the lines
                               mDecLocals 2,4
                            >  nolist
                             
0006 =                       LocalViewY = LocalW3
0008 =                       LocalEndY = LocalW4             ;Highest world y 
                             
                               ;set up clipping region
2b1f : dcc6             [ 5]   ldd ViewX
2b21 : ddd2             [ 5]   std _clip_xmin
2b23 : c300ff           [ 4]   addd #255
2b26 : ddd6             [ 5]   std _clip_xmax
2b28 : dcc8             [ 5]   ldd ViewY
2b2a : ddd4             [ 5]   std _clip_ymin
2b2c : c300ff           [ 4]   addd #255
2b2f : ddd8             [ 5]   std _clip_ymax
                             
2b31 : dcc8             [ 5]   ldd ViewY                     ;setup y-coords, 
2b33 : 2a20             [ 3]   bpl rdNoEmptySpace
2b35 : cc0000           [ 3]     ldd #0                      ;empty space at t
2b38 : ed66             [ 6]     std LocalViewY,s
2b3a : 4c               [ 2]     inca
2b3b : d3c8             [ 6]     addd ViewY
2b3d : ed68             [ 6]     std LocalEndY,s             ;end = 0 + 256 + 
2b3f : cc007f           [ 3]     ldd #127                    ;calc start scree
2b42 : d3c8             [ 6]     addd ViewY
2b44 : 1083ff80         [ 5]     cmpd #-128
2b48 : 2f04             [ 3]     ble rdNothingToDraw
2b4a : d7a2             [ 4]     stb TempPosY
2b4c : 2014             [ 3]     bra rdYCoordsFin
2b4e :                       rdNothingToDraw:                ;no tiles are vis
2b4e : 108ec946         [ 4]     ldy #DrawList
2b52 : 7e2c87           [ 4]     lbra rdEndList
2b55 :                       rdNoEmptySpace:                 ;normal case, no 
2b55 : ed66             [ 6]   std LocalViewY,s
2b57 : 4c               [ 2]   inca
2b58 : ed68             [ 6]   std LocalEndY,s
2b5a : ec66             [ 6]   ldd LocalViewY,s              ;calc start scree
2b5c : c41f             [ 2]   andb #TileH-1
2b5e : cb7f             [ 2]   addb #127
2b60 : d7a2             [ 4]   stb TempPosY
2b62 :                       rdYCoordsFin:
                             
2b62 : 10ae66           [ 7]   ldy LocalViewY,s
2b65 : 9ec6             [ 5]   ldx ViewX
                               mGetLevelTile
                            >  ;calc tile pointer: x = tiles + (CurLevelSizeX 
2b67 : 1f10             [ 6]>  tfr x,d               ;x
                            >  mDivTileW
                            >  if TileW > 32
                            >    asra
                            >    rorb
                            >  endif
                            >  if TileW > 16
2b69 : 47               [ 2]>    asra
2b6a : 56               [ 2]>    rorb
                            >  endif
                            >  if TileW > 8
2b6b : 47               [ 2]>    asra
2b6c : 56               [ 2]>    rorb
                            >  endif
                            >  if TileW > 4
2b6d : 47               [ 2]>    asra
2b6e : 56               [ 2]>    rorb
                            >  endif
                            >  if TileW > 2
2b6f : 47               [ 2]>    asra
2b70 : 56               [ 2]>    rorb
                            >  endif
                            >  if TileW > 1
2b71 : 47               [ 2]>    asra
2b72 : 56               [ 2]>    rorb
                            >  endif
                            >
2b73 : 9eca             [ 5]>  ldx CurLevelEntry
2b75 : ae02             [ 6]>  ldx leTiles,x
2b77 : 3a               [ 3]>  abx
2b78 : 1f20             [ 6]>  tfr y,d               ;y
                            >  mDivTileH
                            >  if TileH > 32
                            >    asra
                            >    rorb
                            >  endif
                            >  if TileH > 16
2b7a : 47               [ 2]>    asra
2b7b : 56               [ 2]>    rorb
                            >  endif
                            >  if TileH > 8
2b7c : 47               [ 2]>    asra
2b7d : 56               [ 2]>    rorb
                            >  endif
                            >  if TileH > 4
2b7e : 47               [ 2]>    asra
2b7f : 56               [ 2]>    rorb
                            >  endif
                            >  if TileH > 2
2b80 : 47               [ 2]>    asra
2b81 : 56               [ 2]>    rorb
                            >  endif
                            >  if TileH > 1
2b82 : 47               [ 2]>    asra
2b83 : 56               [ 2]>    rorb
                            >  endif
                            >
2b84 : 96cc             [ 4]>  lda CurLevelSizeX
2b86 : 3d               [11]>  mul
2b87 : 308b             [ 8]>  leax d,x
                             
                               ;x=tile pointer
2b89 : 9fa9             [ 5]   stx TempTilePtr
                             
                               ;see if view spans over right edge of level
2b8b : d6cc             [ 4]   ldb CurLevelSizeX
2b8d : 1d               [ 2]   sex
2b8e : ede3             [ 8]   std ,--s
2b90 : dcc6             [ 5]   ldd ViewX
                               mDivTileW  ;optimize: this value is already cal
                            >  if TileW > 32
                            >    asra
                            >    rorb
                            >  endif
                            >  if TileW > 16
2b92 : 47               [ 2]>    asra
2b93 : 56               [ 2]>    rorb
                            >  endif
                            >  if TileW > 8
2b94 : 47               [ 2]>    asra
2b95 : 56               [ 2]>    rorb
                            >  endif
                            >  if TileW > 4
2b96 : 47               [ 2]>    asra
2b97 : 56               [ 2]>    rorb
                            >  endif
                            >  if TileW > 2
2b98 : 47               [ 2]>    asra
2b99 : 56               [ 2]>    rorb
                            >  endif
                            >  if TileW > 1
2b9a : 47               [ 2]>    asra
2b9b : 56               [ 2]>    rorb
                            >  endif
                             
2b9c : c30009           [ 4]   addd #TileCountX+1
2b9f : a3e1             [ 9]   subd ,s++
2ba1 : 2a04             [ 3]   bpl rdNeedAdjust
2ba3 : 86ff             [ 2]     lda #-1  ;no adjust needed
2ba5 : 2006             [ 3]     bra rdStoreAdjust
2ba7 :                       rdNeedAdjust:
2ba7 : 8609             [ 2]     lda #TileCountX+1
2ba9 : e7e2             [ 6]     stb ,-s
2bab : a0e0             [ 6]     suba ,s+
2bad :                       rdStoreAdjust:
                               ;TempAdjustX = nr of tiles on row before edge, 
2bad : 97ab             [ 4]   sta TempAdjustX
                             
                               ;calc start world coords for first partly visib
2baf : ec66             [ 6]   ldd LocalViewY,s
2bb1 : c4e0             [ 2]   andb #~(TileH-1)
2bb3 : dda3             [ 5]   std TempTileWY
                             
2bb5 : dcc6             [ 5]   ldd ViewX
2bb7 : c4e0             [ 2]   andb #~(TileW-1)
2bb9 : dda5             [ 5]   std TempTileWX
2bbb : dda7             [ 5]   std TempTileWXStart
                             
                             
                             
                               ;0123456701234567
                               ;       X
                               ;calc screen x coord for first unclipped tile
2bbd : dcc6             [ 5]   ldd ViewX
2bbf : c41f             [ 2]   andb #TileW-1
2bc1 : 2701             [ 3]   beq rdZeroX
2bc3 : 50               [ 2]   negb
2bc4 :                       rdZeroX:
2bc4 : c080             [ 2]   subb #128
2bc6 : d7a1             [ 4]   stb TempPosX
2bc8 : d7a0             [ 4]   stb TempPosXStart
                             
2bca : 108ec946         [ 4]   ldy #DrawList
                             
2bce : c609             [ 2]   ldb #TileCountY+1
2bd0 :                       rsYLoop:
2bd0 : e7e4             [ 4]   stb LocalB1,s
                             
2bd2 : 96ab             [ 4]     lda TempAdjustX
2bd4 : c609             [ 2]     ldb #TileCountX+1
2bd6 :                       rsXLoop:
2bd6 : ed62             [ 6]     std LocalW1,s
                             
2bd8 : e680             [ 6]     ldb ,x+                     ;get tile
2bda : 2765             [ 3]     beq rdNextTile              ;0 = no tile
2bdc : c520             [ 2]     bitb #32                    ;>=32 = special t
2bde : 2661             [ 3]     bne rdNextTile
                             
                                 ;u = tilepointer
2be0 : 8606             [ 2]     lda #TileEntry
2be2 : 3d               [11]     mul
2be3 : ce2ec1           [ 3]     ldu #TileTable
2be6 : 33cb             [ 8]     leau d,u
                             
                                 ;test if tile needs clipping
2be8 : dca5             [ 5]     ldd TempTileWX
2bea : 93c6             [ 6]     subd ViewX
2bec : 2b3b             [ 3]     bmi rdNeedClip              ;TileX < ViewX
2bee : 108300df         [ 5]     cmpd #255-TileW             ;TileXEnd > ViewX
2bf2 : 2c35             [ 3]     bge rdNeedClip
                             
2bf4 : dca3             [ 5]     ldd TempTileWY
2bf6 : a366             [ 7]     subd LocalViewY,s
2bf8 : 2b2f             [ 3]     bmi rdNeedClip              ;TileY < ViewY
                             
2bfa : 96a2             [ 4]     lda TempPosY
2bfc : 81a0             [ 2]     cmpa #-(128 - TileH)
2bfe : 2f29             [ 3]     ble rdNeedClip              ;ScreenY >= end o
                             
                                 ;unclipped tile
                                 ;x = lines rel
2c00 : af64             [ 6]     stx LocalW2,s
2c02 : aec4             [ 5]     ldx teLinesRel,u
                             
                                 ;set pen
2c04 : 86ff             [ 2]     lda #-1
2c06 : a7a0             [ 6]     sta ,y+
2c08 : 96a2             [ 4]     lda TempPosY
2c0a : ab80             [ 6]     adda ,x+
2c0c : a7a0             [ 6]     sta ,y+                     ;write y coord
2c0e : 96a1             [ 4]     lda TempPosX
2c10 : ab80             [ 6]     adda ,x+
2c12 : a7a0             [ 6]     sta ,y+                     ;write x coord
                             
2c14 : a680             [ 6]     lda ,x+                     ;copy lines to dr
2c16 :                       rdLop1:
2c16 : a761             [ 5]     sta LocalB2,s
2c18 : c601             [ 2]     ldb #1
2c1a : e7a0             [ 6]     stb ,y+
2c1c : ec81             [ 8]     ldd ,x++
2c1e : eda1             [ 8]     std ,y++
2c20 : a661             [ 5]     lda LocalB2,s
2c22 : 4a               [ 2]     deca
2c23 : 26f1             [ 3]     bne rdLop1
                             
2c25 : ae64             [ 6]     ldx LocalW2,s
2c27 : 2018             [ 3]     bra rdNextTile
                             
2c29 :                       rdNeedClip:
                                 ;clip tile
                                 ;entry: y=drawlist, u=tile entry
2c29 : ec42             [ 6]     ldd teLinesAbs,u
                             ;    beq  rdNextTile     ;**safety, remove when a
                             
2c2b : dca3             [ 5]     ldd TempTileWY      ;offset y
2c2d : ede3             [ 8]     std ,--s
2c2f : dca5             [ 5]     ldd TempTileWX      ;offset x
2c31 : ede3             [ 8]     std ,--s
2c33 : 10afe3           [ 9]     sty ,--s            ;pointer to drawlist
2c36 : ec42             [ 6]     ldd teLinesAbs,u
2c38 : ede3             [ 8]     std ,--s            ;pointer to lines
2c3a : bd00b9           [ 8]     jsr _CohenSutherlandClip
2c3d : 3268             [ 5]     leas  8,s           ;Clean stack
2c3f : 31ab             [ 8]     leay d,y            ;d = nr of bytes written,
                             
2c41 :                       rdNextTile:
2c41 : dca5             [ 5]     ldd TempTileWX              ;update tile worl
2c43 : c30020           [ 4]     addd #TileW
2c46 : dda5             [ 5]     std TempTileWX
                             
2c48 : 96a1             [ 4]     lda TempPosX                ;update screen po
2c4a : 8b20             [ 2]     adda #TileW
2c4c : 97a1             [ 4]     sta TempPosX
                             
2c4e : ec62             [ 6]     ldd LocalW1,s
2c50 : 4a               [ 2]     deca
2c51 : 2605             [ 3]     bne rsNotYetAdjust
                                   ;tileptr have crossed right edge of level
                                   ;x = x - one row
2c53 : 96cc             [ 4]       lda CurLevelSizeX
                                   ;deca
2c55 : 40               [ 2]       nega
2c56 : 3086             [ 5]       leax a,x
                                   ;leave a negative value in A, it will not a
2c58 :                       rsNotYetAdjust:
2c58 : 5a               [ 2]     decb
2c59 : 1026ff79         [ 6]     bne rsXLoop
                             
                               ;next row
                             
2c5d : dca7             [ 5]   ldd TempTileWXStart           ;reset tile world
2c5f : dda5             [ 5]   std TempTileWX
                             
2c61 : dca3             [ 5]   ldd TempTileWY                ;update tile worl
2c63 : c30020           [ 4]   addd #TileH
2c66 : dda3             [ 5]   std TempTileWY
                             
                             ;  cmpd CurLevelEndY             ;if tilewy is of
                             ;  bgt rdEndList
                             
2c68 : ec68             [ 6]   ldd LocalEndY,s               ;if tilewy is off
2c6a : 1093a3           [ 7]   cmpd TempTileWY
2c6d : 2f18             [ 3]   ble rdEndList
                             
2c6f : 9ea9             [ 5]   ldx TempTilePtr               ;next row, update
                             
2c71 : d6cc             [ 4]   ldb CurLevelSizeX
2c73 : 3a               [ 3]   abx                           ;x=x+b
2c74 : 9fa9             [ 5]   stx TempTilePtr
                             
2c76 : 96a2             [ 4]   lda TempPosY                  ;next row, update
2c78 : 8020             [ 2]   suba #TileH
2c7a : 97a2             [ 4]   sta TempPosY
                             
2c7c : 96a0             [ 4]   lda TempPosXStart
2c7e : 97a1             [ 4]   sta TempPosX
                             
2c80 : e6e4             [ 4]   ldb LocalB1,s
2c82 : 5a               [ 2]   decb
2c83 : 1026ff49         [ 6]   bne rsYLoop
                             
2c87 :                       rdEndList:
2c87 : 8600             [ 2]   lda #0                        ;write end of dra
2c89 : a7a0             [ 6]   sta ,y+
                             
                               mSetByte NeedRefresh,0
                            > if 0=0
2c8b : 0fc5             [ 6]>   clr NeedRefresh
                            > else
                            >   lda #0
                            >   sta NeedRefresh
                            > endif
                             
                             
                               mFreeLocals
2c8d : 326a             [ 5]>  leas FrameSize,s
                             
                             
                               direct -1
2c8f : 39               [ 5]   rts
                             
                             
                             ;*****************
2c90 :                       DrawStars:                      ;draw stars in em
2c90 : fcc8c8           [ 6]   ldd ViewY
2c93 : 2b01             [ 3]   bmi dstOk
2c95 : 39               [ 5]     rts                         ;no empty space i
2c96 :                       dstOk:
                               mDecLocals 6,3,3
                            >  nolist
                             
0000 =                       LocalYRange = LocalB1           ;height of starfi
0001 =                       LocalScreenX = LocalB2
0002 =                       LocalScreenY = LocalB3
0003 =                       LocalSave = LocalB4
0004 =                       LocalInt = LocalB5
0004 =                       LocalDist = LocalB5
0006 =                       LocalYAdd = LocalW1
0008 =                       LocalXAdd = LocalW2
000a =                       LocalSaveSeed = LocalW3
                             
0014 =                       StarDensity = 20                ;nr of stars to d
                             
2c98 : 50               [ 2]   negb
2c99 : e7e4             [ 4]   stb LocalYRange,s
                             
2c9b : b6c826           [ 5]   lda LoopCounterLow            ;distort starfiel
2c9e : 84c0             [ 2]   anda #64 + 128                ;the distortion a
2ca0 : a764             [ 5]   sta LocalDist,s
                             
2ca2 : f6c8c9           [ 5]   ldb ViewY + 1
2ca5 : eb64             [ 5]   addb LocalDist,s
2ca7 : 4f               [ 2]   clra
2ca8 : 3406             [ 7]   pshs d
2caa : cc0100           [ 3]   ldd #256
2cad : a3e1             [ 9]   subd ,s++
2caf : ed66             [ 6]   std LocalYAdd,s
                             
2cb1 : f6c8c7           [ 5]   ldb ViewX + 1
2cb4 : eb64             [ 5]   addb LocalDist,s
2cb6 : 4f               [ 2]   clra
2cb7 : 3406             [ 7]   pshs d
2cb9 : cc0100           [ 3]   ldd #256
2cbc : a3e1             [ 9]   subd ,s++
2cbe : ed68             [ 6]   std LocalXAdd,s
                             
2cc0 : cce077           [ 3]   ldd #$E077                    ;reset random see
2cc3 : ed6c             [ 6]   std LocalBuffer,s
2cc5 : 86eb             [ 2]   lda #%11101011
2cc7 : a76e             [ 5]   sta LocalBuffer+2,s
2cc9 : 336c             [ 5]   leau LocalBuffer,s
                               mSetRandomSeedToU LocalSaveSeed
                            >  if 1=1
2ccb : fcc87b           [ 6]>    ldd $c87b
2cce : ed6a             [ 6]>    std LocalSaveSeed,s
                            >  endif
2cd0 : ffc87b           [ 6]>  stu $c87b
                             
                             
2cd3 : 8614             [ 2]   lda #StarDensity
2cd5 :                       dstLoop:
2cd5 : a763             [ 5]   sta LocalSave,s
                             
                               mRandomToA
2cd7 : bdf511           [ 8]>  jsr random                    ;call rom
                             
2cda : a063             [ 5]   suba LocalSave,s              ;Add loop index t
2cdc : 1f89             [ 6]   tfr a,b
2cde : 4f               [ 2]   clra
2cdf : e368             [ 7]   addd LocalXAdd,s
2ce1 : e761             [ 5]   stb LocalScreenX,s
                             
                               mRandomToA
2ce3 : bdf511           [ 8]>  jsr random                    ;call rom
                             
2ce6 : ab63             [ 5]   adda LocalSave,s              ;Add loop index t
2ce8 : 1f89             [ 6]   tfr a,b
2cea : 4f               [ 2]   clra
2ceb : e366             [ 7]   addd LocalYAdd,s
2ced : e762             [ 5]   stb LocalScreenY,s
                             
                               mRandomToA                    ;random intensity
2cef : bdf511           [ 8]>  jsr random                    ;call rom
                             
2cf2 : 843f             [ 2]   anda #63
2cf4 : 3402             [ 6]   pshs a
2cf6 : 8654             [ 2]   lda #64 + 20
2cf8 : a0e0             [ 6]   suba ,s+
2cfa : a764             [ 5]   sta LocalInt,s
                             
2cfc : e662             [ 5]   ldb LocalScreenY,s
2cfe : e1e4             [ 4]   cmpb LocalYRange,s
2d00 : 2251             [ 3]   bhi dstNext
                             
2d02 : bdf354           [ 8]   jsr reset0ref
                             
2d05 : e661             [ 5]   ldb LocalScreenX,s            ;vectrex screen t
2d07 : c080             [ 2]   subb #128
2d09 : a662             [ 5]   lda LocalScreenY,s
2d0b : 40               [ 2]   nega
2d0c : 8b7f             [ 2]   adda #127
                             
2d0e : a77f             [ 5]   sta -1,s
                               mSetScale $7f
                            >  if 1=1
2d10 : 867f             [ 2]>    lda #$7f                  ;if argument exists
                            >  endif
2d12 : 9704             [ 4]>  sta <$04
                             
2d14 : a67f             [ 5]   lda -1,s
                               mMove_pen_d_Quick
2d16 : 9701             [ 4]>  sta   <0x01
2d18 : 0f00             [ 6]>  clr   <0x00
2d1a : 86ce             [ 2]>  lda   #0xCE
2d1c : 970c             [ 4]>  sta   <0x0C
2d1e : 0f0a             [ 6]>  clr   <0x0A
2d20 : 0c00             [ 6]>  inc   <0x00
2d22 : d701             [ 4]>  stb   <0x01
2d24 : 0f05             [ 6]>  clr   <0x05
2d26 : c640             [ 2]>  ldb   #0x40
2d28 : d50d             [ 4]>PF33D0849: bitb  <0x0D
2d2a : 27fc             [ 3]>  beq   PF33D0849
                            >;PF33B0849: lda   #0x04
                            >;PF3410849: deca
                            >;  bne   PF3410849
                             
                             
2d2c : a664             [ 5]   lda LocalInt,s
                               mSetIntensity
                            >  if 0=1
                            >    lda   #            ;if argument exists, load 
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
2d2e : 9701             [ 4]>  sta   <01
2d30 : cc0401           [ 3]>  ldd   #$0401
2d33 : 9700             [ 4]>  sta   <00
2d35 : d700             [ 4]>  stb   <00
                             
                             
2d37 : a66c             [ 5]   lda LocalBuffer,s
2d39 : 8518             [ 2]   bita #8 + 16
2d3b : 2708             [ 3]   beq dstNiceStar
                               mDot_at_current_position
                            >  ; From vectrex.txt
                            >  ;    "(WARNING! high intensity and long Vec_Dot
                            >  ;     your vectrex monitor, be carefull while e
2d3d : 86ff             [ 2]>       lda   #0xFF
2d3f : 970a             [ 4]>       sta   <0x0A
                            >;       ldb   #         ; is a value for how long
                            >;PF2CC0851: decb                     ;dwell is no
                            >;       bne   PF2CC0851
2d41 : 0f0a             [ 6]>       clr   <0x0A
                             
2d43 : 200e             [ 3]   bra dstNext
2d45 :                       dstNiceStar:
2d45 : b6c826           [ 5]   lda LoopCounterLow
2d48 : 47               [ 2]   asra
2d49 : 47               [ 2]   asra
2d4a : 47               [ 2]   asra
2d4b : ab6c             [ 5]   adda LocalBuffer,s
2d4d : 8407             [ 2]   anda #7
2d4f : 4c               [ 2]   inca
2d50 : bd225e           [ 8]   jsr DrawPlusAtCurrentPosition
                             
2d53 :                       dstNext:
2d53 : a663             [ 5]   lda LocalSave,s
2d55 : 4a               [ 2]   deca
2d56 : 1026ff7b         [ 6]   bne dstLoop
                             
                               ;    if viewy<0
                               ;      yrange=abs(viewy)
                               ;    else
                               ;      exit
                               ;    yadd=256 - (viewy lo)
                               ;    xoff=viewx lo byte
                               ;    xadd=256 - xoff
                               ;    for 0 to starcount
                               ;      starX=random
                               ;      screenX=lo(starX + xadd)
                               ;      starY=random
                               ;      screenY=lo(starY + yadd)
                               ;      if screenY>yrange
                               ;        skip
                               ;      else
                               ;        set random intensity
                               ;        draw dot
                             
2d5a : ee6a             [ 6]   ldu LocalSaveSeed,s           ;restore old rand
                               mSetRandomSeedToU
                            >  if 0=1
                            >    ldd $c87b
                            >    std ,s
                            >  endif
2d5c : ffc87b           [ 6]>  stu $c87b
                             
                             
                               mFreeLocals
2d5f : 326f             [ 5]>  leas FrameSize,s
                             
2d61 : 39               [ 5]   rts
                             
                             
                             ;*****************
2d62 :                       RectVsLevel:                    ;u=ptr to left,ri
0000 =                       LocalLeft=0
0002 =                       LocalRight=2
0004 =                       LocalTop=4
0006 =                       LocalBottom=6
                             
                             _mRvL macro xx,yy,last
                               ldx xx,u
                               ldy yy,u
                               pshs u
                               bsr PointVsLevel
                               puls u
                               bcs rvlExit
                              endm
                             
                               _mRvL LocalLeft,LocalTop
2d62 : aec4             [ 5]>  ldx LocalLeft,u
2d64 : 10ae44           [ 7]>  ldy LocalTop,u
2d67 : 3440             [ 7]>  pshs u
2d69 : 8d27             [ 7]>  bsr PointVsLevel
2d6b : 3540             [ 7]>  puls u
2d6d : 2522             [ 3]>  bcs rvlExit
                             
                               _mRvL LocalRight,LocalTop
2d6f : ae42             [ 6]>  ldx LocalRight,u
2d71 : 10ae44           [ 7]>  ldy LocalTop,u
2d74 : 3440             [ 7]>  pshs u
2d76 : 8d1a             [ 7]>  bsr PointVsLevel
2d78 : 3540             [ 7]>  puls u
2d7a : 2515             [ 3]>  bcs rvlExit
                             
                               _mRvL LocalLeft,LocalBottom
2d7c : aec4             [ 5]>  ldx LocalLeft,u
2d7e : 10ae46           [ 7]>  ldy LocalBottom,u
2d81 : 3440             [ 7]>  pshs u
2d83 : 8d0d             [ 7]>  bsr PointVsLevel
2d85 : 3540             [ 7]>  puls u
2d87 : 2508             [ 3]>  bcs rvlExit
                             
                             
                               ;Last point does not need to save u or branch
2d89 : ae42             [ 6]   ldx LocalRight,u
2d8b : 10ae46           [ 7]   ldy LocalBottom,u
2d8e : 200212           [ 3]   jmp PointVsLevel
                             
2d91 :                       rvlExit:
2d91 : 39               [ 5]   rts
                             
                             
                             
                             ;*****************
2d92 :                       PointVsLevel:
                               ;x and y are coords to test
                               ;returns carry set if collision
                             
                               direct $c8
                             
2d92 : 1f20             [ 6]   tfr y,d
2d94 : 8580             [ 2]   bita #128                     ;Test for empty s
2d96 : 263c             [ 3]   bne tcEmpty
2d98 : c41f             [ 2]   andb #TileH-1
2d9a : d7a2             [ 4]   stb TempPosY
                             
2d9c : 1f10             [ 6]   tfr x,d
2d9e : c41f             [ 2]   andb #TileW-1
2da0 : d7a1             [ 4]   stb TempPosX
                             
                               mGetLevelTile
                            >  ;calc tile pointer: x = tiles + (CurLevelSizeX 
2da2 : 1f10             [ 6]>  tfr x,d               ;x
                            >  mDivTileW
                            >  if TileW > 32
                            >    asra
                            >    rorb
                            >  endif
                            >  if TileW > 16
2da4 : 47               [ 2]>    asra
2da5 : 56               [ 2]>    rorb
                            >  endif
                            >  if TileW > 8
2da6 : 47               [ 2]>    asra
2da7 : 56               [ 2]>    rorb
                            >  endif
                            >  if TileW > 4
2da8 : 47               [ 2]>    asra
2da9 : 56               [ 2]>    rorb
                            >  endif
                            >  if TileW > 2
2daa : 47               [ 2]>    asra
2dab : 56               [ 2]>    rorb
                            >  endif
                            >  if TileW > 1
2dac : 47               [ 2]>    asra
2dad : 56               [ 2]>    rorb
                            >  endif
                            >
2dae : 9eca             [ 5]>  ldx CurLevelEntry
2db0 : ae02             [ 6]>  ldx leTiles,x
2db2 : 3a               [ 3]>  abx
2db3 : 1f20             [ 6]>  tfr y,d               ;y
                            >  mDivTileH
                            >  if TileH > 32
                            >    asra
                            >    rorb
                            >  endif
                            >  if TileH > 16
2db5 : 47               [ 2]>    asra
2db6 : 56               [ 2]>    rorb
                            >  endif
                            >  if TileH > 8
2db7 : 47               [ 2]>    asra
2db8 : 56               [ 2]>    rorb
                            >  endif
                            >  if TileH > 4
2db9 : 47               [ 2]>    asra
2dba : 56               [ 2]>    rorb
                            >  endif
                            >  if TileH > 2
2dbb : 47               [ 2]>    asra
2dbc : 56               [ 2]>    rorb
                            >  endif
                            >  if TileH > 1
2dbd : 47               [ 2]>    asra
2dbe : 56               [ 2]>    rorb
                            >  endif
                            >
2dbf : 96cc             [ 4]>  lda CurLevelSizeX
2dc1 : 3d               [11]>  mul
2dc2 : 308b             [ 8]>  leax d,x
                             
                             
2dc4 : e684             [ 4]   ldb ,x
2dc6 : 270c             [ 3]   beq tcEmpty  ;0 = no tile
                             
2dc8 : 8606             [ 2]   lda #TileEntry
2dca : 3d               [11]   mul
2dcb : 8e2ec5           [ 3]   ldx #TileTable + teCollisionSub
2dce : 308b             [ 8]   leax d,x
                             
                               ;a,b = x,y coordinates within tile
2dd0 : dca1             [ 5]   ldd TempPosX
                             
2dd2 : 6e94             [ 6]   jmp [,x]
                               ;exit through subroutine
                             
                             
                             ;Tile collision routines, set carry if hit
2dd4 :                       tcEmpty:
2dd4 : 1cfe             [ 3]   andcc #$fe
2dd6 : 39               [ 5]   rts
2dd7 :                       tcFull:
2dd7 : 1a01             [ 3]   orcc #1
2dd9 : 39               [ 5]   rts
                             ;X.
                             ;XX
2dda :                       tcTile02:
2dda : c110             [ 2]   cmpb #TileH/2
2ddc : 2cf9             [ 3]   bge tcFull
2dde : 47               [ 2]   asra
2ddf : 91a2             [ 4]   cmpa TempPosY
2de1 : 2cf1             [ 3]   bge tcEmpty
2de3 : 1a01             [ 3]   orcc #1
2de5 : 39               [ 5]   rts
                             ;..
                             ;X.
2de6 :                       tcTile03:
2de6 : c110             [ 2]   cmpb #TileH/2
2de8 : 2fea             [ 3]   ble tcEmpty
2dea : c010             [ 2]   subb #TileH/2
2dec : 58               [ 2]   aslb
2ded : d1a1             [ 4]   cmpb TempPosX
2def : 2fe3             [ 3]   ble tcEmpty
2df1 : 1a01             [ 3]   orcc #1
2df3 : 39               [ 5]   rts
                             ;..
                             ;.X
2df4 :                       tcTile04:
2df4 : c110             [ 2]   cmpb #TileH/2
2df6 : 2f10             [ 3]   ble tcMiss04
2df8 : c010             [ 2]   subb #TileH/2
2dfa : 8620             [ 2]   lda #TileW
2dfc : 90a1             [ 4]   suba TempPosX
2dfe : 47               [ 2]   asra
2dff : a77f             [ 5]   sta -1,s
2e01 : e17f             [ 5]   cmpb -1,s
2e03 : 2f03             [ 3]   ble tcMiss04
2e05 :                       tcHit04:
2e05 : 1a01             [ 3]   orcc #1
2e07 : 39               [ 5]   rts
2e08 :                       tcMiss04:
2e08 : 1cfe             [ 3]   andcc #$fe
2e0a : 39               [ 5]   rts
                             ;.X
                             ;XX
2e0b :                       tcTile05:
2e0b : c110             [ 2]   cmpb #TileH/2
2e0d : 2c0e             [ 3]   bge tcHit05
2e0f : 8620             [ 2]   lda #TileW
2e11 : 90a1             [ 4]   suba TempPosX
2e13 : 47               [ 2]   asra
2e14 : a77f             [ 5]   sta -1,s
2e16 : e17f             [ 5]   cmpb -1,s
2e18 : 2c03             [ 3]   bge tcHit05
2e1a :                       tcMiss05:
2e1a : 1cfe             [ 3]   andcc #$fe
2e1c : 39               [ 5]   rts
2e1d :                       tcHit05:
2e1d : 1a01             [ 3]   orcc #1
2e1f : 39               [ 5]   rts
                             ;XX
                             ;X.
2e20 :                       tcTile06:
2e20 : c110             [ 2]   cmpb #TileH/2
2e22 : 2fb3             [ 3]   lble tcFull
2e24 : c010             [ 2]   subb #TileH/2
2e26 : 8620             [ 2]   lda #TileW
2e28 : 90a1             [ 4]   suba TempPosX
2e2a : 47               [ 2]   asra
2e2b : a77f             [ 5]   sta -1,s
2e2d : e17f             [ 5]   cmpb -1,s
2e2f : 25a6             [ 3]   lblo tcFull
2e31 : 1cfe             [ 3]   andcc #$fe
2e33 : 39               [ 5]   rts
                             ;X.
                             ;..
2e34 :                       tcTile07:
2e34 : c110             [ 2]   cmpb #TileH/2
2e36 : 2c9c             [ 3]   lbge tcEmpty
2e38 : 8620             [ 2]   lda #TileW
2e3a : 90a1             [ 4]   suba TempPosX
2e3c : 47               [ 2]   asra
2e3d : a77f             [ 5]   sta -1,s
2e3f : e17f             [ 5]   cmpb -1,s
2e41 : 2594             [ 3]   lblo tcFull
2e43 : 1cfe             [ 3]   andcc #$fe
2e45 : 39               [ 5]   rts
                             ;.X
                             ;..
2e46 :                       tcTile08:
2e46 : c110             [ 2]   cmpb #TileH/2
2e48 : 2c8a             [ 3]   lbge tcEmpty
2e4a : 58               [ 2]   aslb
2e4b : d1a1             [ 4]   cmpb TempPosX
2e4d : 2588             [ 3]   lblo tcFull
2e4f : 1cfe             [ 3]   andcc #$fe
2e51 : 39               [ 5]   rts
                             ;XX
                             ;.X
2e52 :                       tcTile09:
2e52 : c010             [ 2]   subb #TileH/2
2e54 : 2b81             [ 3]   lbmi tcFull
2e56 : 58               [ 2]   aslb
2e57 : d1a1             [ 4]   cmpb TempPosX
2e59 : 1025ff7a         [ 6]   lblo tcFull
2e5d : 1cfe             [ 3]   andcc #$fe
2e5f : 39               [ 5]   rts
                             
                             ;Tiles for door collision
                             ;Test is adjusted with amount door is open
2e60 :                       tcTile33:       ;horiz door 1 of 2
2e60 : 96f2             [ 4]   lda DoorCounter
2e62 :                       tc33jumpin:
2e62 : 2722             [ 3]   beq tcHitDoor
                             
2e64 : 847f             [ 2]   anda #%01111111
2e66 : 40               [ 2]   nega
2e67 : 8b20             [ 2]   adda #DoorSize
2e69 : 07a1             [ 6]   asr TempPosX
2e6b : 91a1             [ 4]   cmpa TempPosX
2e6d : 2c17             [ 3]   bge tcHitDoor
                             
2e6f : 1cfe             [ 3]   andcc #$fe
2e71 : 39               [ 5]   rts
                             
2e72 :                       tcTile34:       ;horiz door 2 of 2
2e72 : 96f2             [ 4]   lda DoorCounter
2e74 :                       tc34jumpin:
2e74 : 2710             [ 3]   beq tcHitDoor
                             
2e76 : 847f             [ 2]   anda #%01111111
2e78 : 40               [ 2]   nega
2e79 : 8b20             [ 2]   adda #DoorSize
2e7b : 8020             [ 2]   suba #TileW
2e7d : 07a1             [ 6]   asr TempPosX
2e7f : 91a1             [ 4]   cmpa TempPosX
2e81 : 2c03             [ 3]   bge tcHitDoor
                             
2e83 : 1cfe             [ 3]   andcc #$fe
2e85 : 39               [ 5]   rts
2e86 :                       tcHitDoor:
2e86 : 1a01             [ 3]   orcc #1
2e88 : 39               [ 5]   rts
                             
2e89 :                       tcTile35:       ;vert door 1 of 2
2e89 : 96f2             [ 4]   lda DoorCounter
2e8b : 847f             [ 2]   anda #%01111111
2e8d : 07a2             [ 6]   asr TempPosY
2e8f : 91a2             [ 4]   cmpa TempPosY
2e91 : 25f3             [ 3]   blo tcHitDoor
2e93 : 1cfe             [ 3]   andcc #$fe
2e95 : 39               [ 5]   rts
                             
2e96 :                       tcTile36:       ;vert door 2 of 2
2e96 : 96f2             [ 4]   lda DoorCounter
2e98 : 847f             [ 2]   anda #%01111111
2e9a : 8110             [ 2]   cmpa #TileH/2
2e9c : 25e8             [ 3]   blo tcHitDoor
2e9e : 8010             [ 2]   suba #TileH/2
2ea0 : 07a2             [ 6]   asr TempPosY
2ea2 : 91a2             [ 4]   cmpa TempPosY
2ea4 : 25e0             [ 3]   blo tcHitDoor
2ea6 : 1cfe             [ 3]   andcc #$fe
2ea8 : 39               [ 5]   rts
                             
2ea9 :                       tcTile37:       ;inverted horiz door 1 of 2
                               ;invert door open value and call normal horiz d
2ea9 : 96f2             [ 4]   lda DoorCounter
2eab : 847f             [ 2]   anda #%01111111
2ead : 40               [ 2]   nega
2eae : 8b20             [ 2]   adda #DoorSize
2eb0 : 2a01             [ 3]   bpl tc37_1
2eb2 : 4f               [ 2]     clra
2eb3 :                       tc37_1:
2eb3 : 20ad             [ 3]   jmp tc33jumpin
                             
2eb5 :                       tcTile38:       ;inverted horiz door 2 of 2
                               ;invert door open value and call normal horiz d
2eb5 : 96f2             [ 4]   lda DoorCounter
2eb7 : 847f             [ 2]   anda #%01111111
2eb9 : 40               [ 2]   nega
2eba : 8b20             [ 2]   adda #DoorSize
2ebc : 2a01             [ 3]   bpl tc38_1
2ebe : 4f               [ 2]     clra
2ebf :                       tc38_1:
2ebf : 20b3             [ 3]   jmp tc34jumpin
                             
                               direct -1
                             
                             
                             
                             ; Tiles, see struct TileEntry
2ec1 :                       TileTable:
2ec1 : 000000000000            dw 0,0,0    ;tile 0 is blank
2ec7 : 2fab2fb02dd7            dw Tile01_LinesRel,Tile01_LinesAbs,tcFull
2ecd : 2fb62fbb2dda            dw Tile02_LinesRel,Tile02_LinesAbs,tcTile02
2ed3 : 2fc12fc62de6            dw Tile03_LinesRel,Tile03_LinesAbs,tcTile03
2ed9 : 2fcc2fd12df4            dw Tile04_LinesRel,Tile04_LinesAbs,tcTile04
2edf : 2fd72fdc2e0b            dw Tile05_LinesRel,Tile05_LinesAbs,tcTile05
2ee5 : 2fe22fe72e20            dw Tile06_LinesRel,Tile06_LinesAbs,tcTile06
2eeb : 2fed2ff22e34            dw Tile07_LinesRel,Tile07_LinesAbs,tcTile07
2ef1 : 2ff82ffd2e46            dw Tile08_LinesRel,Tile08_LinesAbs,tcTile08
2ef7 : 300330082e52            dw Tile09_LinesRel,Tile09_LinesAbs,tcTile09
2efd : 300e30132dd7            dw Tile10_LinesRel,Tile10_LinesAbs,tcFull
2f03 : 3019301e2dd7            dw Tile11_LinesRel,Tile11_LinesAbs,tcFull
2f09 : 3024302b2e46            dw Tile12_LinesRel,Tile12_LinesAbs,tcTile08
2f0f : 3036303d2e52            dw Tile13_LinesRel,Tile13_LinesAbs,tcTile09
2f15 : 3048304f2dda            dw Tile14_LinesRel,Tile14_LinesAbs,tcTile02
2f1b : 305a30612dd7            dw Tile15_LinesRel,Tile15_LinesAbs,tcFull
2f21 : 306c30732dd7            dw Tile16_LinesRel,Tile16_LinesAbs,tcFull
2f27 : 307e30832dd7            dw Tile17_LinesRel,Tile17_LinesAbs,tcFull
2f2d : 308930902dd7            dw Tile18_LinesRel,Tile18_LinesAbs,tcFull
2f33 : 309b30a22e34            dw Tile19_LinesRel,Tile19_LinesAbs,tcTile07
2f39 : 30ad30b42df4            dw Tile20_LinesRel,Tile20_LinesAbs,tcTile04
2f3f : 30bf30c62dd7            dw Tile21_LinesRel,Tile21_LinesAbs,tcFull
2f45 : 30d130d82de6            dw Tile22_LinesRel,Tile22_LinesAbs,tcTile03
2f4b : 30e330ea2e20            dw Tile23_LinesRel,Tile23_LinesAbs,tcTile06
2f51 : 30f530fc2e0b            dw Tile24_LinesRel,Tile24_LinesAbs,tcTile05
                             
2f57 : 000000000000            dw 0,0,0   ;25 = not yet used
2f5d : 000000000000            dw 0,0,0   ;26 = not yet used
2f63 : 000000000000            dw 0,0,0   ;27 = not yet used
2f69 : 000000000000            dw 0,0,0   ;28 = not yet used
2f6f : 000000000000            dw 0,0,0   ;29 = not yet used
2f75 : 000000000000            dw 0,0,0   ;30 = not yet used
2f7b : 000000000000            dw 0,0,0   ;31 = not yet used
                             
2f81 : 000000002dd7            dw 0,0,tcFull               ;a 32 = empty solid
2f87 : 000000002e60            dw 0,0,tcTile33             ;b 33 = horiz door 
2f8d : 000000002e72            dw 0,0,tcTile34             ;c 34 = horiz door 
2f93 : 000000002e89            dw 0,0,tcTile35             ;d 35 = vert door 1
2f99 : 000000002e96            dw 0,0,tcTile36             ;e 36 = vert door 2
2f9f : 000000002ea9            dw 0,0,tcTile37             ;f 37 = horiz inver
2fa5 : 000000002eb5            dw 0,0,tcTile38             ;g 38 = horiz inver
                             
                             
                             
                             
0020 =                       FullW equ ((TileW))
0010 =                       HalfW equ ((TileW/2))
0020 =                       FullH equ ((TileH))
0010 =                       HalfH equ ((TileH/2))
                             
                             ;--
                             ;XX
                             ;XX
2fab :                       Tile01_LinesRel:
2fab : 0000                    db 0,0  ;start pos
2fad : 01                      db 1    ;line count
2fae : 0020                    db 0, FullW
2fb0 :                       Tile01_LinesAbs:
2fb0 : 01                      db 1  ;line count
2fb1 : 01                      db 1  ;linetype, 0=vert, 1=horiz, 2=slope
2fb2 : 0000                    db 0,0      ;x0,y0
2fb4 : 2000                    db FullW,0  ;x1,y1
                             
                             ;X.
                             ;XX
2fb6 :                       Tile02_LinesRel:
2fb6 : 0000                    db 0,0  ;start pos
2fb8 : 01                      db 1    ;line count
2fb9 : f020                    db -HalfH, FullW
2fbb :                       Tile02_LinesAbs:
2fbb : 01                      db 1  ;line count
2fbc : 02                      db 2  ;linetype, 0=vert, 1=horiz, 2=slope
2fbd : 0000                    db 0,0      ;x0,y0
2fbf : 2010                    db FullW,HalfH  ;x1,y1
                             
                             ;..
                             ;X.
2fc1 :                       Tile03_LinesRel:
2fc1 : f000                    db -HalfH,0  ;start pos
2fc3 : 01                      db 1    ;line count
2fc4 : f020                    db -HalfH, FullW
2fc6 :                       Tile03_LinesAbs:
2fc6 : 01                      db 1  ;line count
2fc7 : 02                      db 2  ;linetype, 0=vert, 1=horiz, 2=slope
2fc8 : 0010                    db 0,HalfH      ;x0,y0
2fca : 2020                    db FullW,FullH  ;x1,y1
                             
                             ;..
                             ;.X
2fcc :                       Tile04_LinesRel:
2fcc : e000                    db -FullH,0  ;start pos
2fce : 01                      db 1    ;line count
2fcf : 1020                    db HalfH, FullW
2fd1 :                       Tile04_LinesAbs:
2fd1 : 01                      db 1  ;line count
2fd2 : 02                      db 2  ;linetype, 0=vert, 1=horiz, 2=slope
2fd3 : 0020                    db 0,FullH      ;x0,y0
2fd5 : 2010                    db FullW,HalfH  ;x1,y1
                             
                             
                             ;.X
                             ;XX
2fd7 :                       Tile05_LinesRel:
2fd7 : 0020                    db 0,FullW  ;start pos
2fd9 : 01                      db 1    ;line count
2fda : f0e0                    db -HalfH, -FullW
2fdc :                       Tile05_LinesAbs:
2fdc : 01                      db 1  ;line count
2fdd : 02                      db 2  ;linetype, 0=vert, 1=horiz, 2=slope
2fde : 2000                    db FullW,0  ;x0,y0
2fe0 : 0010                    db 0,HalfH  ;x1,y1
                             
                             ;XX
                             ;X.
2fe2 :                       Tile06_LinesRel:
2fe2 : e000                    db -FullH,0  ;start pos
2fe4 : 01                      db 1    ;line count
2fe5 : 1020                    db HalfH, FullW
2fe7 :                       Tile06_LinesAbs:
2fe7 : 01                      db 1  ;line count
2fe8 : 02                      db 2  ;linetype, 0=vert, 1=horiz, 2=slope
2fe9 : 0020                    db 0,FullH  ;x0,y0
2feb : 2010                    db FullW,HalfH  ;x1,y1
                             
                             ;X.
                             ;..
2fed :                       Tile07_LinesRel:
2fed : f000                    db -HalfH,0  ;start pos
2fef : 01                      db 1    ;line count
2ff0 : 1020                    db HalfH, FullW
2ff2 :                       Tile07_LinesAbs:
2ff2 : 01                      db 1  ;line count
2ff3 : 02                      db 2  ;linetype, 0=vert, 1=horiz, 2=slope
2ff4 : 0010                    db 0,HalfH  ;x0,y0
2ff6 : 2000                    db FullW,0  ;x1,y1
                             
                             ;.X
                             ;..
2ff8 :                       Tile08_LinesRel:
2ff8 : 0000                    db 0,0  ;start pos
2ffa : 01                      db 1    ;line count
2ffb : f020                    db -HalfH, FullW
2ffd :                       Tile08_LinesAbs:
2ffd : 01                      db 1  ;line count
2ffe : 02                      db 2  ;linetype, 0=vert, 1=horiz, 2=slope
2fff : 0000                    db 0,0  ;x0,y0
3001 : 2010                    db FullW,HalfH  ;x1,y1
                             
                             ;XX
                             ;.X
3003 :                       Tile09_LinesRel:
3003 : f000                    db -HalfH,0  ;start pos
3005 : 01                      db 1    ;line count
3006 : f020                    db -HalfH, FullW
3008 :                       Tile09_LinesAbs:
3008 : 01                      db 1  ;line count
3009 : 02                      db 2  ;linetype, 0=vert, 1=horiz, 2=slope
300a : 0010                    db 0,HalfH  ;x0,y0
300c : 2020                    db FullW,FullH  ;x1,y1
                             
                             ;|XX
                             ;|XX
300e :                       Tile10_LinesRel:  ;A
300e : 0000                    db 0,0  ;start pos
3010 : 01                      db 1    ;line count
3011 : e000                    db -FullH, 0
3013 :                       Tile10_LinesAbs:
3013 : 01                      db 1  ;line count
3014 : 00                      db 0  ;linetype, 0=vert, 1=horiz, 2=slope
3015 : 0000                    db 0,0  ;x0,y0
3017 : 0020                    db 0,FullH  ;x1,y1
                             
                             ;XX|
                             ;XX|
3019 :                       Tile11_LinesRel:  ;B
3019 : 0020                    db 0,FullW  ;start pos
301b : 01                      db 1    ;line count
301c : e000                    db -FullH, 0
301e :                       Tile11_LinesAbs:
301e : 01                      db 1  ;line count
301f : 00                      db 0  ;linetype, 0=vert, 1=horiz, 2=slope
3020 : 2000                    db FullW,0  ;x0,y0
3022 : 2020                    db FullW,FullH  ;x1,y1
                             
                             ;.X
                             ;..|
3024 :                       Tile12_LinesRel:  ;C
3024 : 0000                    db 0,0  ;start pos
3026 : 02                      db 2    ;line count
3027 : f020                    db -HalfH, FullW
3029 : f000                    db -HalfH, 0
302b :                       Tile12_LinesAbs:
302b : 02                      db 2  ;line count
302c : 02                      db 2  ;linetype, 0=vert, 1=horiz, 2=slope
302d : 0000                    db 0,0  ;x0,y0
302f : 2010                    db FullW,HalfH  ;x1,y1
3031 : 00                      db 0  ;linetype, 0=vert, 1=horiz, 2=slope
3032 : 2010                    db FullW,HalfH  ;x0,y0
3034 : 2020                    db FullW,FullH  ;x1,y1
                             
                             ;|XX
                             ; .X
3036 :                       Tile13_LinesRel:  ;D
3036 : 0000                    db 0,0  ;start pos
3038 : 02                      db 2    ;line count
3039 : f000                    db -HalfH, 0
303b : f020                    db -HalfH, FullW
303d :                       Tile13_LinesAbs:
303d : 02                      db 2  ;line count
303e : 00                      db 0  ;linetype, 0=vert, 1=horiz, 2=slope
303f : 0000                    db 0,0      ;x0,y0
3041 : 0010                    db 0,HalfH  ;x1,y1
3043 : 02                      db 2  ;linetype, 0=vert, 1=horiz, 2=slope
3044 : 0010                    db 0,HalfH      ;x0,y0
3046 : 2020                    db FullW,FullH  ;x1,y1
                             
                             ;X.
                             ;XX|
3048 :                       Tile14_LinesRel:  ;E
3048 : 0000                    db 0,0  ;start pos
304a : 02                      db 2    ;line count
304b : f020                    db -HalfH, FullW
304d : f000                    db -HalfH, 0
304f :                       Tile14_LinesAbs:
304f : 02                      db 2  ;line count
3050 : 02                      db 2  ;linetype, 0=vert, 1=horiz, 2=slope
3051 : 0000                    db 0,0      ;x0,y0
3053 : 2010                    db FullW,HalfH  ;x1,y1
3055 : 00                      db 0  ;linetype, 0=vert, 1=horiz, 2=slope
3056 : 2010                    db FullW,HalfH      ;x0,y0
3058 : 2020                    db FullW,FullH  ;x1,y1
                             
                             ;--
                             ;XX|
                             ;XX|
305a :                       Tile15_LinesRel:  ;F
305a : 0000                    db 0,0  ;start pos
305c : 02                      db 2    ;line count
305d : 0020                    db 0, FullW
305f : e000                    db -FullH, 0
3061 :                       Tile15_LinesAbs:
3061 : 02                      db 2  ;line count
3062 : 01                      db 1  ;linetype, 0=vert, 1=horiz, 2=slope
3063 : 0000                    db 0,0      ;x0,y0
3065 : 2000                    db FullW,0  ;x1,y1
3067 : 00                      db 0  ;linetype, 0=vert, 1=horiz, 2=slope
3068 : 2000                    db FullW,0      ;x0,y0
306a : 2020                    db FullW,FullH  ;x1,y1
                             
                             ; --
                             ;|XX
                             ;|XX
306c :                       Tile16_LinesRel:  ;G
306c : e000                    db -FullH,0  ;start pos
306e : 02                      db 2    ;line count
306f : 2000                    db FullH, 0
3071 : 0020                    db 0, FullW
3073 :                       Tile16_LinesAbs:
3073 : 02                      db 2  ;line count
3074 : 01                      db 1  ;linetype, 0=vert, 1=horiz, 2=slope
3075 : 0000                    db 0,0      ;x0,y0
3077 : 2000                    db FullW,0  ;x1,y1
3079 : 00                      db 0  ;linetype, 0=vert, 1=horiz, 2=slope
307a : 0000                    db 0,0      ;x0,y0
307c : 0020                    db 0,FullH  ;x1,y1
                             
                             ;XX
                             ;XX
                             ;--
307e :                       Tile17_LinesRel:  ;H
307e : e000                    db -FullH,0  ;start pos
3080 : 01                      db 1    ;line count
3081 : 0020                    db 0, FullW
3083 :                       Tile17_LinesAbs:
3083 : 01                      db 1  ;line count
3084 : 01                      db 1  ;linetype, 0=vert, 1=horiz, 2=slope
3085 : 0020                    db 0,FullH      ;x0,y0
3087 : 2020                    db FullW,FullH  ;x1,y1
                             
                             ;|XX
                             ;|XX
                             ; --
3089 :                       Tile18_LinesRel:  ;I
3089 : 0000                    db 0,0  ;start pos
308b : 02                      db 2    ;line count
308c : e000                    db -FullH, 0
308e : 0020                    db 0, FullW
3090 :                       Tile18_LinesAbs:
3090 : 02                      db 2  ;line count
3091 : 00                      db 0  ;linetype, 0=vert, 1=horiz, 2=slope
3092 : 0000                    db 0,0      ;x0,y0
3094 : 0020                    db 0,FullH  ;x1,y1
3096 : 01                      db 1  ;linetype, 0=vert, 1=horiz, 2=slope
3097 : 0020                    db 0,FullH      ;x0,y0
3099 : 2020                    db FullW,FullH  ;x1,y1
                             
                             ; X.
                             ;|..
309b :                       Tile19_LinesRel:  ;J
309b : 0020                    db 0,FullW   ;start pos
309d : 02                      db 2    ;line count
309e : f0e0                    db -HalfH, -FullW
30a0 : f000                    db -HalfH, 0
30a2 :                       Tile19_LinesAbs:
30a2 : 02                      db 2  ;line count
30a3 : 02                      db 2  ;linetype, 0=vert, 1=horiz, 2=slope
30a4 : 2000                    db FullW,0  ;x0,y0
30a6 : 0010                    db 0,HalfH  ;x1,y1
30a8 : 00                      db 0  ;linetype, 0=vert, 1=horiz, 2=slope
30a9 : 0010                    db 0,HalfH  ;x0,y0
30ab : 0020                    db 0,FullH  ;x1,y1
                             
                             ;..|
                             ;.X
30ad :                       Tile20_LinesRel:  ;K
30ad : 0020                    db 0,FullW  ;start pos
30af : 02                      db 2    ;line count
30b0 : f000                    db -HalfH,0
30b2 : f0e0                    db -HalfH, -FullW
30b4 :                       Tile20_LinesAbs:
30b4 : 02                      db 2  ;line count
30b5 : 00                      db 0  ;linetype, 0=vert, 1=horiz, 2=slope
30b6 : 2000                    db FullW,0      ;x0,y0
30b8 : 2010                    db FullW,HalfH  ;x1,y1
30ba : 02                      db 2  ;linetype, 0=vert, 1=horiz, 2=slope
30bb : 2010                    db FullW,HalfH  ;x0,y0
30bd : 0020                    db 0,FullH      ;x1,y1
                             
                             ;XX|
                             ;XX|
                             ;--
30bf :                       Tile21_LinesRel:  ;L
30bf : 0020                    db 0,FullW  ;start pos
30c1 : 02                      db 2    ;line count
30c2 : e000                    db -FullH, 0
30c4 : 00e0                    db 0, -FullW
30c6 :                       Tile21_LinesAbs:
30c6 : 02                      db 2  ;line count
30c7 : 00                      db 0  ;linetype, 0=vert, 1=horiz, 2=slope
30c8 : 2000                    db FullW,0      ;x0,y0
30ca : 2020                    db FullW,FullH  ;x1,y1
30cc : 01                      db 1  ;linetype, 0=vert, 1=horiz, 2=slope
30cd : 2020                    db FullW,FullH      ;x0,y0
30cf : 0020                    db 0,FullH  ;x1,y1
                             
                             ;|..
                             ; X.
30d1 :                       Tile22_LinesRel:  ;M
30d1 : 0000                    db 0,0  ;start pos
30d3 : 02                      db 2    ;line count
30d4 : f000                    db -HalfH,0
30d6 : f020                    db -HalfH, FullW
30d8 :                       Tile22_LinesAbs:
30d8 : 02                      db 2  ;line count
30d9 : 00                      db 0  ;linetype, 0=vert, 1=horiz, 2=slope
30da : 0000                    db 0,0      ;x0,y0
30dc : 0010                    db 0,HalfH  ;x1,y1
30de : 02                      db 2  ;linetype, 0=vert, 1=horiz, 2=slope
30df : 0010                    db 0,HalfH  ;x0,y0
30e1 : 2020                    db FullW,FullH      ;x1,y1
                             
                             ;XX|
                             ;X.
30e3 :                       Tile23_LinesRel:   ;N
30e3 : e000                    db -FullH,0  ;start pos
30e5 : 02                      db 2    ;line count
30e6 : 1020                    db HalfH, FullW
30e8 : 1000                    db HalfH, 0
30ea :                       Tile23_LinesAbs:
30ea : 02                      db 2  ;line count
30eb : 02                      db 2  ;linetype, 0=vert, 1=horiz, 2=slope
30ec : 0020                    db 0,FullH  ;x0,y0
30ee : 2010                    db FullW,HalfH  ;x1,y1
30f0 : 00                      db 0  ;linetype, 0=vert, 1=horiz, 2=slope
30f1 : 2010                    db FullW,HalfH  ;x0,y0
30f3 : 2000                    db FullW,0  ;x1,y1
                             
                             ; .X
                             ;|XX
30f5 :                       Tile24_LinesRel:   ;O
30f5 : 0020                    db 0,FullW  ;start pos
30f7 : 02                      db 2    ;line count
30f8 : f0e0                    db -HalfH, -FullW
30fa : f000                    db -HalfH, 0
30fc :                       Tile24_LinesAbs:
30fc : 02                      db 2  ;line count
30fd : 02                      db 2  ;linetype, 0=vert, 1=horiz, 2=slope
30fe : 2000                    db FullW,0  ;x0,y0
3100 : 0010                    db 0,HalfH  ;x1,y1
3102 : 00                      db 0  ;linetype, 0=vert, 1=horiz, 2=slope
3103 : 0010                    db 0,HalfH  ;x0,y0
3105 : 0020                    db 0,FullH  ;x1,y1
                             
                             
                             ;-----------------
                             ;LEVELS
                             ;-----------------
                             
                               include "Thrust_Levels.asm"
                             ; Level-definitions
                             ; Copyright (C) 2004  Ville Krumlinde
                             
                             ;Macro for defining a level, see struct LevelEntr
                             LevelDef macro LevelNo, SizeX,SizeY, PodX, PodY, 
                               db SizeX,SizeY
                               dw Level\1_Tiles,Level\1_Guns,Level\1_Fuel
                               dw PodX * TileW + HalfW, PodY * TileH + HalfH +
                               dw PowerX * TileW + HalfW, PowerY * TileH + Hal
                               dw Level\1_Restart
                               dw Level\1_Doors
                               dw Level\1_Switches
                              endm
                             
0006 =                       LevelCountNormal = 6    ;6 levels in normal mode
0008 =                       LevelCount = 8          ;hard+ and timeattack mod
3107 :                       Levels:
                               LevelDef 1, 32,8 ,  16, 5,  19, 3
3107 : 2008                 >  db  32,8 
3109 : 31b732b732bd         >  dw Level1_Tiles,Level1_Guns,Level1_Fuel
310f : 021000b5             >  dw   16 * TileW + HalfW,  5 * TileH + HalfH + (
3113 : 02700075             >  dw   19 * TileW + HalfW,  3 * TileH + HalfH + (
3117 : 32c2                 >  dw Level1_Restart
3119 : 32c5                 >  dw Level1_Doors
311b : 32c6                 >  dw Level1_Switches
                             
                               if Level1Only!=1
                               LevelDef 2, 25,18,  8,15,   3, 3
311d : 1912                 >  db  25,18
311f : 32c734893494         >  dw Level2_Tiles,Level2_Guns,Level2_Fuel
3125 : 011001f5             >  dw   8 * TileW + HalfW, 15 * TileH + HalfH + (H
3129 : 00700075             >  dw    3 * TileW + HalfW,  3 * TileH + HalfH + (
312d : 3499                 >  dw Level2_Restart
312f : 349c                 >  dw Level2_Doors
3131 : 349d                 >  dw Level2_Switches
                             
                               LevelDef 3, 22,30,  2,27,   17, 5
3133 : 161e                 >  db  22,30
3135 : 349e3732374c         >  dw Level3_Tiles,Level3_Guns,Level3_Fuel
313b : 00500375             >  dw   2 * TileW + HalfW, 27 * TileH + HalfH + (H
313f : 023000b5             >  dw    17 * TileW + HalfW,  5 * TileH + HalfH + 
3143 : 3765                 >  dw Level3_Restart
3145 : 376c                 >  dw Level3_Doors
3147 : 376d                 >  dw Level3_Switches
                             
                               LevelDef 4, 24,34,  17,32,  7,19
3149 : 1822                 >  db  24,34
314b : 376e3a9e3ac2         >  dw Level4_Tiles,Level4_Guns,Level4_Fuel
3151 : 02300415             >  dw   17 * TileW + HalfW, 32 * TileH + HalfH + (
3155 : 00f00275             >  dw   7 * TileW + HalfW, 19 * TileH + HalfH + (H
3159 : 3ac7                 >  dw Level4_Restart
315b : 3ad0                 >  dw Level4_Doors
315d : 3ad6                 >  dw Level4_Switches
                             
                               LevelDef 5, 22,43,  17,41,  11,11
315f : 162b                 >  db  22,43
3161 : 3ae13e933eb7         >  dw Level5_Tiles,Level5_Guns,Level5_Fuel
3167 : 02300535             >  dw   17 * TileW + HalfW, 41 * TileH + HalfH + (
316b : 01700175             >  dw   11 * TileW + HalfW, 11 * TileH + HalfH + (
316f : 3ed8                 >  dw Level5_Restart
3171 : 3ee3                 >  dw Level5_Doors
3173 : 3ee9                 >  dw Level5_Switches
                             
                               LevelDef 6, 30,52,  22,50,  27,50
3175 : 1e34                 >  db  30,52
3177 : 3ef4450c453f         >  dw Level6_Tiles,Level6_Guns,Level6_Fuel
317d : 02d00655             >  dw   22 * TileW + HalfW, 50 * TileH + HalfH + (
3181 : 03700655             >  dw   27 * TileW + HalfW, 50 * TileH + HalfH + (
3185 : 4548                 >  dw Level6_Restart
3187 : 4553                 >  dw Level6_Doors
3189 : 4559                 >  dw Level6_Switches
                             
                               LevelDef 7, 23,20,  13,15,  19,15
318b : 1714                 >  db  23,20
318d : 456447304754         >  dw Level7_Tiles,Level7_Guns,Level7_Fuel
3193 : 01b001f5             >  dw   13 * TileW + HalfW, 15 * TileH + HalfH + (
3197 : 027001f5             >  dw   19 * TileW + HalfW, 15 * TileH + HalfH + (
319b : 4761                 >  dw Level7_Restart
319d : 4768                 >  dw Level7_Doors
319f : 4782                 >  dw Level7_Switches
                             
                               LevelDef 8, 25,36,  8,34,   16,23
31a1 : 1924                 >  db  25,36
31a3 : 47924b164b3f         >  dw Level8_Tiles,Level8_Guns,Level8_Fuel
31a9 : 01100455             >  dw   8 * TileW + HalfW, 34 * TileH + HalfH + (H
31ad : 021002f5             >  dw    16 * TileW + HalfW, 23 * TileH + HalfH + 
31b1 : 4b44                 >  dw Level8_Restart
31b3 : 4b53                 >  dw Level8_Doors
31b5 : 4b59                 >  dw Level8_Switches
                             
                               endif
                             
                               cmap "0",0,1,2,3,4,5,6,7,8,9    ; decode ASCII 
                               cmap "A",10,11,12,13,14,15,16,17,18,19,20,21,22
                               cmap "a",32,33,34,35,36,37,38,39,40,41,42,43,44
                             
0015 =                       FuelY = HalfH + 5                       ;Fuel pod
0008 =                       GunY = (HalfH/2)                        ;Gun Y of
                             
                             ;Off is 1 or -1, meaning to adjust Y quarter of a
                             ;0=NE,1=NW,2=SE,3=SW
                             GunDef macro Type,Off,X1,Y1             ;Gun defi
                                dw (TileW * X1) + HalfW, (TileH * Y1) + HalfH 
                                db Type
                              endm
                             
                             FuelDef macro X1,Y1                     ;Fuel pod
                                dw (TileW * X1) + HalfW, (TileH * Y1) + FuelY
                              endm
                             
                             RestartDef macro X1,Y1                  ;Restart 
                                db X1,Y1
                              endm
                             
                             DoorDef macro Type, X1,Y1               ;Door def
                                db Type
                                dw (TileW * X1), (TileH * Y1)
                              endm
                             
                             SwitchDef macro Type, X1,Y1
                                if Type=0
                                  dw (TileW * X1)                    ;left wal
                                else
                                  dw (TileW * X1) + TileW            ;right wa
                                endif
                                dw (TileH * Y1) + HalfH
                                db Type
                              endm
                             
                             
                             ;**todo level data restrictions:
                             ; - level must be at least TileCountY high or Ref
                             ; - doors must have x > TileCountX or they won't 
                             
31b7 :                       Level1_Tiles:
31b7 : 00000000000000..        db "00000000000000000000000000000000"
31d7 : 00000000000000..        db "00000000000000000000000000000000"
31f7 : 00000000000000..        db "00000000000000000000000000000000"
3217 : 00000000000000..        db "00000000000000000000000000000000"
3237 : 01010101010203..        db "111112300000000000G1111111111111"
3257 : 20202020202020..        db "aaaaaaa11112300000Aaaaaaaaaaaaaa"
3277 : 00000000000020..        db "000000aaaaaaa11111aa000000000000"
3297 : 00000000000000..        db "000000000000aaaaaaaa000000000000"
32b7 :                       Level1_Guns:
32b7 : 01                      db 1  ;count
                               GunDef 0,1, 12,5
32b8 : 019000b8             >   dw (TileW *  12) + HalfW, (TileH * 5) + HalfH 
32bc : 00                   >   db 0
                             
32bd :                       Level1_Fuel:
32bd : 01                      db 1  ;count
                               FuelDef 9,4
32be : 01300095             >   dw (TileW * 9) + HalfW, (TileH * 4) + FuelY
                             
32c2 :                       Level1_Restart:
32c2 : 01                      db 1  ;count
                               RestartDef 9,2
32c3 : 0902                 >   db 9,2
                             
32c5 :                       Level1_Doors:   ;also need mapchange for collisio
32c5 : 00                      db 0  ;count
                             ;  DoorDef 2, 10,2
32c6 :                       Level1_Switches:
32c6 : 00                      db 0  ;count
                             ;  SwitchDef 0, 13,2
                             
                              if Level1Only!=1
                             
32c7 :                       Level2_Tiles:
32c7 : 00000000000000..        db "0000000000000000000000000"
32e0 : 00000000000000..        db "0000000000000000000000000"
32f9 : 00000000000000..        db "0000000000000000000000000"
3312 : 00000000000000..        db "0000000000000000045111123"
332b : 01010101010203..        db "11111230000000045aa000000"
3344 : 00000000000020..        db "000000a23000045aaa0000000"
335d : 00000000000020..        db "000000aaaE000Aaa000000000"
3376 : 00000000000000..        db "00000000aB000Aa0000000000"
338f : 00000000000000..        db "00000000aB000Aa0000000000"
33a8 : 00000000000000..        db "00000000aB000Aa0000000000"
33c1 : 00000000000000..        db "00000000aB000Daaa00000000"
33da : 00000000000000..        db "0000000a67000089aa0000000"
33f3 : 00000000202006..        db "0000aa6700000000Aa0000000"
340c : 00000000200b00..        db "0000aB0000000000Aa0000000"
3425 : 00000000200b00..        db "0000aB0000000045aa0000000"
343e : 00000000202002..        db "0000aa23000045aaa00000000"
3457 : 00000000002020..        db "00000aaa1111aaaa000000000"
3470 : 00000000000000..        db "0000000000000000000000000"
3489 :                       Level2_Guns:
3489 : 02                      db 2  ;count
                               GunDef 2,-1, 7,12
348a : 00f00188             >   dw (TileW *  7) + HalfW, (TileH * 12) + HalfH 
348e : 02                   >   db 2
                             
                               GunDef 3,-1, 14,11
348f : 01d00168             >   dw (TileW *  14) + HalfW, (TileH * 11) + HalfH
3493 : 03                   >   db 3
                             
3494 :                       Level2_Fuel:
3494 : 01                      db 1  ;count
                               FuelDef 11,15
3495 : 017001f5             >   dw (TileW * 11) + HalfW, (TileH * 15) + FuelY
                             
3499 :                       Level2_Restart:
3499 : 01                      db 1  ;count
                               RestartDef 4,1
349a : 0401                 >   db 4,1
                             
349c : 00                    Level2_Doors:     db 0  ;count
349d : 00                    Level2_Switches:  db 0  ;count
                             
                             
349e :                       Level3_Tiles:
349e : 00000000000000..        db "0000000000000000000000"
34b4 : 00000000000000..        db "0000000000000000000000"
34ca : 00000000000000..        db "0000000000000000000000"
34e0 : 00000000000000..        db "0000000000000000000000"
34f6 : 01010101010101..        db "111111111111F000000G11"
350c : 00000000000000..        db "00000000000aB000000Aa0"
3522 : 00000000000000..        db "00000000000aB000G11a00"
3538 : 00000000000000..        db "00000000000aB000Aa0000"
354e : 00000000000000..        db "00000000000aB000Aa0000"
3564 : 00000000000000..        db "00000000000aB000IHHHHa"
357a : 00000000000000..        db "00000000000aJ00000000A"
3590 : 00000000000000..        db "0000000000aB000000000A"
35a6 : 00000000000000..        db "0000000000aB00000000Ka"
35bc : 00000000000000..        db "0000000000aB000G1111a0"
35d2 : 00000000000000..        db "0000000000aB000Aa00000"
35e8 : 00000000000000..        db "0000000HHHHL000Aa00000"
35fe : 00201111110607..        db "0aHHH6700000000Aa00000"
3614 : 20130000000000..        db "aJ0000000000000Aa00000"
362a : 0b000000000000..        db "B00000000000000Aa00000"
3640 : 0b000000000000..        db "B0000000000G111a000000"
3656 : 0b000000000000..        db "B0000000000Aa000000000"
366c : 0b000000000000..        db "B0000000000Aa000000000"
3682 : 0b000000040501..        db "B0004511111a0000000000"
3698 : 0b0000000a2000..        db "B000Aa0000000000000000"
36ae : 0b0000000a2000..        db "B000Aa0000000000000000"
36c4 : 0b0000000a2000..        db "B000Aa0000000000000000"
36da : 0b0000000a2000..        db "B000Aa0000000000000000"
36f0 : 201600000a2000..        db "aM00Aa0000000000000000"
3706 : 00200101200000..        db "0a11a00000000000000000"
371c : 00202020200000..        db "0aaaa00000000000000000"
3732 :                       Level3_Guns:
3732 : 05                      db 5  ;count
                               GunDef 1, 1, 20,12
3733 : 02900198             >   dw (TileW *  20) + HalfW, (TileH * 12) + HalfH
3737 : 01                   >   db 1
                             
                               GunDef 2,-1, 12,10
3738 : 01900148             >   dw (TileW *  12) + HalfW, (TileH * 10) + HalfH
373c : 02                   >   db 2
                             
                               GunDef 2,-1, 6,16
373d : 00d00208             >   dw (TileW *  6) + HalfW, (TileH * 16) + HalfH 
3741 : 02                   >   db 2
                             
                               GunDef 2,-1, 1,17
3742 : 00300228             >   dw (TileW *  1) + HalfW, (TileH * 17) + HalfH 
3746 : 02                   >   db 2
                             
                               GunDef 1,-1, 5,22
3747 : 00b002c8             >   dw (TileW *  5) + HalfW, (TileH * 22) + HalfH 
374b : 01                   >   db 1
                             
374c :                       Level3_Fuel:
374c : 06                      db 6  ;count
                               FuelDef 10,3
374d : 01500075             >   dw (TileW * 10) + HalfW, (TileH * 3) + FuelY
                             
                               FuelDef 16,12
3751 : 02100195             >   dw (TileW * 16) + HalfW, (TileH * 12) + FuelY
                             
                               FuelDef 17,12
3755 : 02300195             >   dw (TileW * 17) + HalfW, (TileH * 12) + FuelY
                             
                               FuelDef 18,12
3759 : 02500195             >   dw (TileW * 18) + HalfW, (TileH * 12) + FuelY
                             
                               FuelDef 12,18
375d : 01900255             >   dw (TileW * 12) + HalfW, (TileH * 18) + FuelY
                             
                               FuelDef 7,21
3761 : 00f002b5             >   dw (TileW * 7) + HalfW, (TileH * 21) + FuelY
                             
3765 :                       Level3_Restart:
3765 : 03                      db 3  ;count
                               RestartDef 9,0
3766 : 0900                 >   db 9,0
                             
                               RestartDef 14,11
3768 : 0e0b                 >   db 14,11
                             
                               RestartDef 4,19
376a : 0413                 >   db 4,19
                             
376c : 00                    Level3_Doors:     db 0  ;count
376d : 00                    Level3_Switches:  db 0  ;count
                             
                             
376e :                       Level4_Tiles:
376e : 00000000000000..        db "000000000000000000000000"
3786 : 01010101010203..        db "11111230000000G111111111"
379e : 00000000000020..        db "000000a2300000Aa00000000"
37b6 : 00000000000000..        db "00000000a11F00Aa00000000"
37ce : 00000000000000..        db "0000000000aB00Aa00000000"
37e6 : 00000000000000..        db "0000000000aB00Aa00000000"
37fe : 00000000000000..        db "0000000000aB00Aa00000000"
3816 : 00000000000000..        db "000000000a6700Aa00000000"
382e : 00000000000000..        db "0000000a670000Aa00000000"
3846 : 00000000002006..        db "00000a67000000Aa00000000"
385e : 00000020060700..        db "000a6700000000Aa00000000"
3876 : 0000200b000000..        db "00aB0000000000Aa00000000"
388e : 0000200b000000..        db "00aB0000000000Aa00000000"
38a6 : 00000020010203..        db "000a12300G1111aa00000000"
38be : 00000000002017..        db "00000aN00Aa0000000000000"
38d6 : 00000020060700..        db "000a6700089a000000000000"
38ee : 0000000b000000..        db "000B000000089a0000000000"
3906 : 0000000b000000..        db "000B00000000089HHHHHHHHa"
391e : 0000000b000000..        db "000B0000000000000000000A"
3936 : 0000000b000000..        db "000B0000000000000000000A"
394e : 00000020010101..        db "000a1111111230000000000A"
3966 : 00000000000000..        db "000000000000a2300000000A"
397e : 00000000000000..        db "00000000000000a11111F00A"
3996 : 00000000000000..        db "0000000000000000000aBbcA"
39ae : 00000000000000..        db "0000000000000000000aB00A"
39c6 : 00000000000000..        db "000000000000000000a6700A"
39de : 00000000000000..        db "0000000000000000a670000A"
39f6 : 00000000000000..        db "00000000000000a67000000A"
3a0e : 00000000000000..        db "0000000000000aB00000000A"
3a26 : 00000000000000..        db "0000000000000aB00000045a"
3a3e : 00000000000000..        db "00000000000000a230045a00"
3a56 : 00000000000000..        db "000000000000000aB00Aa000"
3a6e : 00000000000000..        db "000000000000000aB00Aa000"
3a86 : 00000000000000..        db "0000000000000000a11a0000"
3a9e :                       Level4_Guns:
3a9e : 07                      db 7  ;count
                               GunDef 2,-1, 9,8
3a9f : 01300108             >   dw (TileW *  9) + HalfW, (TileH * 8) + HalfH +
3aa3 : 02                   >   db 2
                             
                               GunDef 2,-1, 5,15
3aa4 : 00b001e8             >   dw (TileW *  5) + HalfW, (TileH * 15) + HalfH 
3aa8 : 02                   >   db 2
                             
                               GunDef 2,-1, 18,26
3aa9 : 02500348             >   dw (TileW *  18) + HalfW, (TileH * 26) + HalfH
3aad : 02                   >   db 2
                             
                               GunDef 3,-1, 13,17
3aae : 01b00228             >   dw (TileW *  13) + HalfW, (TileH * 17) + HalfH
3ab2 : 03                   >   db 3
                             
                               GunDef 1, 1, 21,29
3ab3 : 02b003b8             >   dw (TileW *  21) + HalfW, (TileH * 29) + HalfH
3ab7 : 01                   >   db 1
                             
                               GunDef 0, 1, 6,13
3ab8 : 00d001b8             >   dw (TileW *  6) + HalfW, (TileH * 13) + HalfH 
3abc : 00                   >   db 0
                             
                               GunDef 0, 1, 12,20
3abd : 01900298             >   dw (TileW *  12) + HalfW, (TileH * 20) + HalfH
3ac1 : 00                   >   db 0
                             
3ac2 :                       Level4_Fuel:
3ac2 : 01                      db 1  ;count
                               FuelDef 19,21
3ac3 : 027002b5             >   dw (TileW * 19) + HalfW, (TileH * 21) + FuelY
                             
3ac7 :                       Level4_Restart:
3ac7 : 04                      db 4  ;count
                               RestartDef 11,0
3ac8 : 0b00                 >   db 11,0
                             
                               RestartDef 10,10
3aca : 0a0a                 >   db 10,10
                             
                               RestartDef 18,19
3acc : 1213                 >   db 18,19
                             
                               RestartDef 18,28
3ace : 121c                 >   db 18,28
                             
3ad0 :                       Level4_Doors:   ;also need mapchange for collisio
3ad0 : 01                      db 1  ;count
                               DoorDef 0, 21,23
3ad1 : 00                   >   db 0
3ad2 : 02a002e0             >   dw (TileW *  21), (TileH * 23)
                             
3ad6 :                       Level4_Switches:
3ad6 : 02                      db 2  ;count
                               SwitchDef 1, 22,25
                            >   if 1=0
                            >     dw (TileW *  22)                    ;left wa
                            >   else
3ad7 : 02e0                 >     dw (TileW *  22) + TileW            ;right w
                            >   endif
3ad9 : 0330                 >   dw (TileH * 25) + HalfH
3adb : 01                   >   db 1
                             
                               SwitchDef 1, 22,20
                            >   if 1=0
                            >     dw (TileW *  22)                    ;left wa
                            >   else
3adc : 02e0                 >     dw (TileW *  22) + TileW            ;right w
                            >   endif
3ade : 0290                 >   dw (TileH * 20) + HalfH
3ae0 : 01                   >   db 1
                             
                             
                             
3ae1 :                       Level5_Tiles:
3ae1 : 00000000000000..       db "0000000000000000000000"
3af7 : 01010101020300..       db "111123000000G111111111"
3b0d : 0000000000200e..       db "00000aE00000A000000000"
3b23 : 0000000000200b..       db "00000aB00000A000000000"
3b39 : 00000000000020..       db "000000a11F00A000000000"
3b4f : 00000000000000..       db "000000000B00A000000000"
3b65 : 00000000000000..       db "000000000B00A000000000"
3b7b : 00000000000000..       db "000000000B00A000000000"
3b91 : 00000000000000..       db "00000000HL00IHa0000000"
3ba7 : 00000000000006..       db "0000006700000089a00000"
3bbd : 00000000000b00..       db "00000B0000000000A00000"
3bd3 : 00000000000b00..       db "00000B0000000000A00000"
3be9 : 00000000002001..       db "00000a1F00G11111a00000"
3bff : 00000000000000..       db "0000000B00A00000000000"
3c15 : 00000000000000..       db "0000000B00Ia0000000000"
3c2b : 00000000000020..       db "000000aN000A0000000000"
3c41 : 00201111110607..       db "0aHHH670000A0000000000"
3c57 : 000b0000000000..       db "0B000000000A0000000000"
3c6d : 000b0000000000..       db "0B000000000A0000000000"
3c83 : 000b0000000000..       db "0B00000000Ka0000000000"
3c99 : 000b0000001001..       db "0B000G1111a00000000000"
3caf : 000b0000000a00..       db "0B000A0000000000000000"
3cc5 : 000b0000000809..       db "0B00089a00000000000000"
3cdb : 000b0000000000..       db "0B0000089a000000000000"
3cf1 : 00200203000000..       db "0a230000089a0000000000"
3d07 : 00000020020300..       db "000a2300000A0000000000"
3d1d : 00000000001500..       db "00000L00000A0000000000"
3d33 : 000000000b0000..       db "0000B000000IHa00000000"
3d49 : 000000000b0000..       db "0000B0000000089a000000"
3d5f : 00000000200203..       db "0000a2300000000A000000"
3d75 : 00000000000020..       db "000000a11F00000IHHa000"
3d8b : 00000000000000..       db "000000000B00000000A000"
3da1 : 00000000000000..       db "000000000B00000000A000"
3db7 : 00000000000000..       db "000000000a23000000A000"
3dcd : 00000000000000..       db "00000000000a111FddA000"
3de3 : 00000000000000..       db "000000000000000BeeA000"
3df9 : 00000000000000..       db "000000000000000B0089a0"
3e0f : 00000000000000..       db "000000000000000B0000Ca"
3e25 : 00000000000000..       db "000000000000000B00000A"
3e3b : 00000000000000..       db "000000000000000B00000A"
3e51 : 00000000000000..       db "000000000000000B0000Ka"
3e67 : 00000000000000..       db "000000000000000aM045a0"
3e7d : 00000000000000..       db "0000000000000000a1a000"
3e93 :                       Level5_Guns:
3e93 : 07                      db 7  ;count
                               GunDef 2,-1, 7,9
3e94 : 00f00128             >   dw (TileW *  7) + HalfW, (TileH * 9) + HalfH +
3e98 : 02                   >   db 2
                             
                               GunDef 3,-1, 14,9
3e99 : 01d00128             >   dw (TileW *  14) + HalfW, (TileH * 9) + HalfH 
3e9d : 03                   >   db 3
                             
                               GunDef 1, 1, 10,19
3e9e : 01500278             >   dw (TileW *  10) + HalfW, (TileH * 19) + HalfH
3ea2 : 01                   >   db 1
                             
                               GunDef 3,-1, 13,28
3ea3 : 01b00388             >   dw (TileW *  13) + HalfW, (TileH * 28) + HalfH
3ea7 : 03                   >   db 3
                             
                               GunDef 0, 1, 6,29
3ea8 : 00d003b8             >   dw (TileW *  6) + HalfW, (TileH * 29) + HalfH 
3eac : 00                   >   db 0
                             
                               GunDef 0, 1, 11,33
3ead : 01700438             >   dw (TileW *  11) + HalfW, (TileH * 33) + HalfH
3eb1 : 00                   >   db 0
                             
                               GunDef 3,-1, 20,37
3eb2 : 029004a8             >   dw (TileW *  20) + HalfW, (TileH * 37) + HalfH
3eb6 : 03                   >   db 3
                             
3eb7 :                       Level5_Fuel:
3eb7 : 08                      db 8  ;count
                               FuelDef 8,3
3eb8 : 01100075             >   dw (TileW * 8) + HalfW, (TileH * 3) + FuelY
                             
                               FuelDef 13,11
3ebc : 01b00175             >   dw (TileW * 13) + HalfW, (TileH * 11) + FuelY
                             
                               FuelDef 14,11
3ec0 : 01d00175             >   dw (TileW * 14) + HalfW, (TileH * 11) + FuelY
                             
                               FuelDef 6,19
3ec4 : 00d00275             >   dw (TileW * 6) + HalfW, (TileH * 19) + FuelY
                             
                               FuelDef 8,29
3ec8 : 011003b5             >   dw (TileW * 8) + HalfW, (TileH * 29) + FuelY
                             
                               FuelDef 9,29
3ecc : 013003b5             >   dw (TileW * 9) + HalfW, (TileH * 29) + FuelY
                             
                               FuelDef 13,33
3ed0 : 01b00435             >   dw (TileW * 13) + HalfW, (TileH * 33) + FuelY
                             
                               FuelDef 14,33
3ed4 : 01d00435             >   dw (TileW * 14) + HalfW, (TileH * 33) + FuelY
                             
3ed8 :                       Level5_Restart:
3ed8 : 05                      db 5  ;count
                               RestartDef 8,0
3ed9 : 0800                 >   db 8,0
                             
                               RestartDef 11,9
3edb : 0b09                 >   db 11,9
                             
                               RestartDef 9,16
3edd : 0910                 >   db 9,16
                             
                               RestartDef 8,26
3edf : 081a                 >   db 8,26
                             
                               RestartDef 18,38
3ee1 : 1226                 >   db 18,38
                             
3ee3 :                       Level5_Doors:   ;also need mapchange for collisio
3ee3 : 01                      db 1  ;count
                               DoorDef 1, 16,34
3ee4 : 01                   >   db 1
3ee5 : 02000440             >   dw (TileW *  16), (TileH * 34)
                             
3ee9 :                       Level5_Switches:
3ee9 : 02                      db 2  ;count
                               SwitchDef 1, 17,32
                            >   if 1=0
                            >     dw (TileW *  17)                    ;left wa
                            >   else
3eea : 0240                 >     dw (TileW *  17) + TileW            ;right w
                            >   endif
3eec : 0410                 >   dw (TileH * 32) + HalfH
3eee : 01                   >   db 1
                             
                               SwitchDef 0, 16,39
                            >   if 0=0
3eef : 0200                 >     dw (TileW *  16)                    ;left wa
                            >   else
                            >     dw (TileW *  16) + TileW            ;right w
                            >   endif
3ef1 : 04f0                 >   dw (TileH * 39) + HalfH
3ef3 : 00                   >   db 0
                             
                             
                             
3ef4 :                       Level6_Tiles:
3ef4 : 00000000000000..       db "000000000000000000000000000000"
3f12 : 0f000000000000..       db "F00000000000000000451111111111"
3f30 : 0b000000000000..       db "B00000000000000045a00000000000"
3f4e : 0b000000000000..       db "B000000000000045a0000000000000"
3f6c : 20160000000000..       db "aM000000000000A000000000000000"
3f8a : 00200101010102..       db "0a11112300000089a0000000000000"
3fa8 : 00000000000000..       db "0000000a2300000089a00000000000"
3fc6 : 00000000000000..       db "000000000a2300000089a000000000"
3fe4 : 00000000000000..       db "00000000000a2300000089a0000000"
4002 : 00000000000000..       db "0000000000000a2300000089a00000"
4020 : 00000000000000..       db "000000000000000a2300000089a000"
403e : 00000000000000..       db "00000000000000000a23000000A000"
405c : 00000000000000..       db "0000000000000000000a230000A000"
407a : 00000000000000..       db "000000000000000000000a2300A000"
4098 : 00000000000000..       db "00000000000000000000000B00A000"
40b6 : 00000000000000..       db "00000000000000000000aHHL00Aa00"
40d4 : 00000000000000..       db "0000000000000000000aJ0000089a0"
40f2 : 00000000000000..       db "0000000000000000000B00000000Ca"
4110 : 00000000000000..       db "0000000000000000000B000000000A"
412e : 00000000000000..       db "0000000000000000000B000045111a"
414c : 00000000000000..       db "0000000000000000000B0045a00000"
416a : 00000000000000..       db "0000000000000000000B00A0000000"
4188 : 00000000000000..       db "0000000000000000000B00A0000000"
41a6 : 00000000000000..       db "0000000000000000000B00A0000000"
41c4 : 00000000000000..       db "0000000000000000000B00Da000000"
41e2 : 00000000000000..       db "0000000000000000000B000Ca00000"
4200 : 00000000000000..       db "0000000000000000000B0000A00000"
421e : 00000000000000..       db "0000000000000000000B000Ka00000"
423c : 00000000000000..       db "00000000000000000aHL000A000000"
425a : 00000000000000..       db "00000000000000000B00000A000000"
4278 : 00000000000000..       db "00000000000000000B00000A000000"
4296 : 00000000000000..       db "00000000000000000B00000A000000"
42b4 : 00000000000000..       db "00000000000000000B00G11a000000"
42d2 : 00000000000000..       db "0000000000000000aN00A000000000"
42f0 : 00000000000000..       db "00000000000000a67000A000000000"
430e : 00000000000000..       db "00000000000000B0000089a0000000"
432c : 00000000000000..       db "00000000000000aM00000089a00000"
434a : 00000000000000..       db "000000000000000a2300000089a000"
4368 : 00000000000000..       db "00000000000000000a23000000A000"
4386 : 00000000000000..       db "0000000000000000000a230000A000"
43a4 : 00000000000000..       db "000000000000000000000a2300A000"
43c2 : 00000000000000..       db "00000000000000000000000BbcA000"
43e0 : 00000000000000..       db "000000000000000000000a6700A000"
43fe : 00000000000000..       db "000000000000000000000B0000A000"
441c : 00000000000000..       db "000000000000000000000B0000A000"
443a : 00000000000000..       db "000000000000000000000B0000A000"
4458 : 00000000000000..       db "00000000000000000000aJ0000A000"
4476 : 00000000000000..       db "00000000000000000000B00045a000"
4494 : 00000000000000..       db "00000000000000000000B00Oa00000"
44b2 : 00000000000000..       db "00000000000000000000B00A00HHH0"
44d0 : 00000000000000..       db "00000000000000000000B00A0B000A"
44ee : 00000000000000..       db "00000000000000000000a11a001110"
450c :                       Level6_Guns:
450c : 0a                      db 10  ;count
                               ;0=NE,1=NW,2=SE,3=SW
                               GunDef 3,-1, 16,6
450d : 021000c8             >   dw (TileW *  16) + HalfW, (TileH * 6) + HalfH 
4511 : 03                   >   db 3
                             
                               GunDef 2,-1, 20,16
4512 : 02900208             >   dw (TileW *  20) + HalfW, (TileH * 16) + HalfH
4516 : 02                   >   db 2
                             
                               GunDef 3,-1, 28,17
4517 : 03900228             >   dw (TileW *  28) + HalfW, (TileH * 17) + HalfH
451b : 03                   >   db 3
                             
                               GunDef 3,-1, 23,25
451c : 02f00328             >   dw (TileW *  23) + HalfW, (TileH * 25) + HalfH
4520 : 03                   >   db 3
                             
                               GunDef 1, 1, 23,27
4521 : 02f00378             >   dw (TileW *  23) + HalfW, (TileH * 27) + HalfH
4525 : 01                   >   db 1
                             
                               GunDef 2,-1, 16,34
4526 : 02100448             >   dw (TileW *  16) + HalfW, (TileH * 34) + HalfH
452a : 02                   >   db 2
                             
                               GunDef 3,-1, 22,36
452b : 02d00488             >   dw (TileW *  22) + HalfW, (TileH * 36) + HalfH
452f : 03                   >   db 3
                             
                               GunDef 2,-1, 23,42
4530 : 02f00548             >   dw (TileW *  23) + HalfW, (TileH * 42) + HalfH
4534 : 02                   >   db 2
                             
                               GunDef 2,-1, 21,46
4535 : 02b005c8             >   dw (TileW *  21) + HalfW, (TileH * 46) + HalfH
4539 : 02                   >   db 2
                             
                               GunDef 1, 1, 24,47
453a : 031005f8             >   dw (TileW *  24) + HalfW, (TileH * 47) + HalfH
453e : 01                   >   db 1
                             
453f :                       Level6_Fuel:
453f : 02                      db 2  ;count
                               FuelDef 26,18
4540 : 03500255             >   dw (TileW * 26) + HalfW, (TileH * 18) + FuelY
                             
                               FuelDef 21,31
4544 : 02b003f5             >   dw (TileW * 21) + HalfW, (TileH * 31) + FuelY
                             
4548 :                       Level6_Restart:
4548 : 05                      db 5  ;count
                               RestartDef 9,3
4549 : 0903                 >   db 9,3
                             
                               RestartDef 22,18
454b : 1612                 >   db 22,18
                             
                               RestartDef 21,26
454d : 151a                 >   db 21,26
                             
                               RestartDef 18,35
454f : 1223                 >   db 18,35
                             
                               RestartDef 24,44
4551 : 182c                 >   db 24,44
                             
4553 :                       Level6_Doors:   ;also need mapchange for collisio
4553 : 01                      db 1  ;count
                               DoorDef 0, 24,41
4554 : 00                   >   db 0
4555 : 03000520             >   dw (TileW *  24), (TileH * 41)
                             
                               ;**todo horiz pointy -> door
4559 :                       Level6_Switches:
4559 : 02                      db 2  ;count
                               SwitchDef 1, 25,40
                            >   if 1=0
                            >     dw (TileW *  25)                    ;left wa
                            >   else
455a : 0340                 >     dw (TileW *  25) + TileW            ;right w
                            >   endif
455c : 0510                 >   dw (TileH * 40) + HalfH
455e : 01                   >   db 1
                             
                               SwitchDef 0, 22,44
                            >   if 0=0
455f : 02c0                 >     dw (TileW *  22)                    ;left wa
                            >   else
                            >     dw (TileW *  22) + TileW            ;right w
                            >   endif
4561 : 0590                 >   dw (TileH * 44) + HalfH
4563 : 00                   >   db 0
                             
                             
4564 :                       Level7_Tiles:
4564 : 00000000000000..        db "00000000000000000000000"
457b : 00000000000000..        db "00000000045F00000000000"
4592 : 01010101010101..        db "111111111a0BbcG11111111"
45a9 : 00000000000000..        db "00000000000BbcA00000000"
45c0 : 00000000000000..        db "00000000000B00A00000000"
45d7 : 00000000000000..        db "00000000000B00A00000000"
45ee : 00000000000000..        db "00000000000BfgA00000000"
4605 : 00000000000000..        db "00000000000BfgA00000000"
461c : 20000000000000..        db "a0000000000B00DHHHHHHHH"
4633 : 08092000000000..        db "89a00000000B00000000dd0"
464a : 00000809200000..        db "0089a000000B00000000ee0"
4661 : 03000000080920..        db "300089a0000a111E0G11112"
4678 : 2002030000000a..        db "a23000A0000000aN0Da0000"
468f : 00200b0000000a..        db "0aB000A0000000B000A0000"
46a6 : 00000b0000000a..        db "00B000A00000aHN000DHa00"
46bd : 00000b0000000a..        db "00B000A00000B0000000A00"
46d4 : 00000b0000000a..        db "00B000A00000a1230451a00"
46eb : 00000b0000000a..        db "00B000A00000000a1a00000"
4702 : 00002001010120..        db "00a111a0000000000000000"
4719 : 00000000000000..        db "00000000000000000000000"
4730 :                       Level7_Guns: ;0=NE,1=NW,2=SE,3=SW
4730 : 07                      db 7  ;count
                               GunDef 3, 1, 14,8
4731 : 01d00118             >   dw (TileW *  14) + HalfW, (TileH * 8) + HalfH 
4735 : 03                   >   db 3
                             
                               GunDef 2, 1, 14,14
4736 : 01d001d8             >   dw (TileW *  14) + HalfW, (TileH * 14) + HalfH
473a : 02                   >   db 2
                             
                               GunDef 3, 1, 18,14
473b : 025001d8             >   dw (TileW *  18) + HalfW, (TileH * 14) + HalfH
473f : 03                   >   db 3
                             
                               GunDef 0,-1, 14,16
4740 : 01d00208             >   dw (TileW *  14) + HalfW, (TileH * 16) + HalfH
4744 : 00                   >   db 0
                             
                               GunDef 0, 1, 15,16
4745 : 01f00218             >   dw (TileW *  15) + HalfW, (TileH * 16) + HalfH
4749 : 00                   >   db 0
                             
                               GunDef 1, 1, 17,16
474a : 02300218             >   dw (TileW *  17) + HalfW, (TileH * 16) + HalfH
474e : 01                   >   db 1
                             
                               GunDef 1,-1, 18,16
474f : 02500208             >   dw (TileW *  18) + HalfW, (TileH * 16) + HalfH
4753 : 01                   >   db 1
                             
4754 :                       Level7_Fuel:
4754 : 03                      db 3  ;count
                               FuelDef 3,17
4755 : 00700235             >   dw (TileW * 3) + HalfW, (TileH * 17) + FuelY
                             
                               FuelDef 4,17
4759 : 00900235             >   dw (TileW * 4) + HalfW, (TileH * 17) + FuelY
                             
                               FuelDef 5,17
475d : 00b00235             >   dw (TileW * 5) + HalfW, (TileH * 17) + FuelY
                             
4761 :                       Level7_Restart:
4761 : 03                      db 3  ;count
                               RestartDef 13,0
4762 : 0d00                 >   db 13,0
                             
                               RestartDef 13,9
4764 : 0d09                 >   db 13,9
                             
                               RestartDef 16,15
4766 : 100f                 >   db 16,15
                             
4768 :                       Level7_Doors:   ;also need mapchange for collisio
4768 : 05                      db 5  ;count
                               DoorDef 0, 12,2
4769 : 00                   >   db 0
476a : 01800040             >   dw (TileW *  12), (TileH * 2)
                             
                               DoorDef 0, 12,3
476e : 00                   >   db 0
476f : 01800060             >   dw (TileW *  12), (TileH * 3)
                             
                               DoorDef 2, 12,6
4773 : 02                   >   db 2
4774 : 018000c0             >   dw (TileW *  12), (TileH * 6)
                             
                               DoorDef 2, 12,7
4778 : 02                   >   db 2
4779 : 018000e0             >   dw (TileW *  12), (TileH * 7)
                             
                               DoorDef 3, 20,9
477d : 03                   >   db 3
477e : 02800120             >   dw (TileW *  20), (TileH * 9)
                             
4782 :                       Level7_Switches:
4782 : 03                      db 3  ;count
                               SwitchDef 0, 12,1
                            >   if 0=0
4783 : 0180                 >     dw (TileW *  12)                    ;left wa
                            >   else
                            >     dw (TileW *  12) + TileW            ;right w
                            >   endif
4785 : 0030                 >   dw (TileH * 1) + HalfH
4787 : 00                   >   db 0
                             
                               SwitchDef 1, 13,4
                            >   if 1=0
                            >     dw (TileW *  13)                    ;left wa
                            >   else
4788 : 01c0                 >     dw (TileW *  13) + TileW            ;right w
                            >   endif
478a : 0090                 >   dw (TileH * 4) + HalfH
478c : 01                   >   db 1
                             
                               SwitchDef 1, 5,16
                            >   if 1=0
                            >     dw (TileW *  5)                    ;left wal
                            >   else
478d : 00c0                 >     dw (TileW *  5) + TileW            ;right wa
                            >   endif
478f : 0210                 >   dw (TileH * 16) + HalfH
4791 : 01                   >   db 1
                             
                             
                             
4792 :                       Level8_Tiles:
4792 : 00000000000000..        db "0000000000000000000000000"
47ab : 01010101010f00..        db "11111F00G11111111FbcG1111"
47c4 : 00000000000b00..        db "00000B00A00000000B00A0000"
47dd : 00000000000b00..        db "00000B00A00000000B30A0000"
47f6 : 00000000201304..        db "0000aJ43Ca0000000B70A0000"
480f : 000000000b0008..        db "0000B0870A0000000B00A0000"
4828 : 000000000b0004..        db "0000B0430A0000000B00A0000"
4841 : 00000000201608..        db "0000aM87Ka0000000B00A0000"
485a : 00000000000b00..        db "00000B00A00000000B00A0000"
4873 : 00000000000b00..        db "00000B00A00000000B04A0000"
488c : 00000000000b00..        db "00000B00A00000000B08A0000"
48a5 : 00000000000b00..        db "00000B00A00000000B00A0000"
48be : 00000000000b00..        db "00000B00D00000000B00A0000"
48d7 : 00000000000b00..        db "00000B00O00000000B00A0000"
48f0 : 00000000000b00..        db "00000B00A00000000B00A0000"
4909 : 00000000000b00..        db "00000B00A00000000B30A0000"
4922 : 00000000200b00..        db "0000aB00Aa0000000B70A0000"
493b : 00000020060704..        db "000a674389a000000B00A0000"
4954 : 00200607040308..        db "0a6743874389a0000B00A0000"
496d : 00200203080704..        db "0a2387438745a0000B00A0000"
4986 : 00000020020308..        db "000a238745a000000B00A0000"
499f : 00000000200b00..        db "0000aB00Aa0000000B00A0000"
49b8 : 00000000000b00..        db "00000B00A00000aHHL00A0000"
49d1 : 00000000000b00..        db "00000B00A00000B00000A0000"
49ea : 00000000001700..        db "00000N00A00000a11F00A0000"
4a03 : 00000000000e00..        db "00000E00A0000000aB00Aa000"
4a1c : 00000000000b00..        db "00000B00A000000a670089a00"
4a35 : 00000000000b00..        db "00000B00A0000a6700430089a"
4a4e : 00000000000b00..        db "00000B00A0000a2300870045a"
4a67 : 00000000201300..        db "0000aJ00Ca00000a230045a00"
4a80 : 00000000201600..        db "0000aM00Ka00aa000B00Aa000"
4a99 : 00000000000b00..        db "00000B00DHHH69HHHN00A0000"
4ab2 : 00000000000b00..        db "00000B00000000000000A0000"
4acb : 00000000000b00..        db "00000B00000000000000A0000"
4ae4 : 00000000000b00..        db "00000B00000043000000A0000"
4afd : 00000000002001..        db "00000a111111aa111111a0000"
4b16 :                       Level8_Guns: ;0=NE,1=NW,2=SE,3=SW
4b16 : 08                      db 8  ;count
                               GunDef 1,-1,  8,13
4b17 : 011001a8             >   dw (TileW *   8) + HalfW, (TileH * 13) + HalfH
4b1b : 01                   >   db 1
                             
                               GunDef 0,-1,  5,25
4b1c : 00b00328             >   dw (TileW *   5) + HalfW, (TileH * 25) + HalfH
4b20 : 00                   >   db 0
                             
                               GunDef 1, 1,  8,30
4b21 : 011003d8             >   dw (TileW *   8) + HalfW, (TileH * 30) + HalfH
4b25 : 01                   >   db 1
                             
                               GunDef 2, 1, 17,31
4b26 : 023003f8             >   dw (TileW *  17) + HalfW, (TileH * 31) + HalfH
4b2a : 02                   >   db 2
                             
                               GunDef 2,-1, 19,28
4b2b : 02700388             >   dw (TileW *  19) + HalfW, (TileH * 28) + HalfH
4b2f : 02                   >   db 2
                             
                               GunDef 2,-1, 18,16
4b30 : 02500208             >   dw (TileW *  18) + HalfW, (TileH * 16) + HalfH
4b34 : 02                   >   db 2
                             
                               GunDef 2,-1, 17,26
4b35 : 02300348             >   dw (TileW *  17) + HalfW, (TileH * 26) + HalfH
4b39 : 02                   >   db 2
                             
                               GunDef 3,-1, 20,26
4b3a : 02900348             >   dw (TileW *  20) + HalfW, (TileH * 26) + HalfH
4b3e : 03                   >   db 3
                             
4b3f :                       Level8_Fuel:
4b3f : 01                      db 1  ;count
                               FuelDef 17,34
4b40 : 02300455             >   dw (TileW * 17) + HalfW, (TileH * 34) + FuelY
                             
4b44 :                       Level8_Restart:
4b44 : 07                      db 7  ;count
                               RestartDef 7,0
4b45 : 0700                 >   db 7,0
                             
                               RestartDef 7,11
4b47 : 070b                 >   db 7,11
                             
                               RestartDef 7,25
4b49 : 0719                 >   db 7,25
                             
                               RestartDef 9,33
4b4b : 0921                 >   db 9,33
                             
                               RestartDef 19,11
4b4d : 130b                 >   db 19,11
                             
                               RestartDef 19,25
4b4f : 1319                 >   db 19,25
                             
                               RestartDef 18,33
4b51 : 1221                 >   db 18,33
                             
4b53 :                       Level8_Doors:   ;also need mapchange for collisio
4b53 : 01                      db 1  ;count
                               DoorDef 0, 18,1
4b54 : 00                   >   db 0
4b55 : 02400020             >   dw (TileW *  18), (TileH * 1)
                             
4b59 :                       Level8_Switches:
4b59 : 01                      db 1  ;count
                               SwitchDef 1, 19,4
                            >   if 1=0
                            >     dw (TileW *  19)                    ;left wa
                            >   else
4b5a : 0280                 >     dw (TileW *  19) + TileW            ;right w
                            >   endif
4b5c : 0090                 >   dw (TileH * 4) + HalfH
4b5e : 01                   >   db 1
                             
                             
                              endif ;if Level1Only
                             
                             
                               cmap ;reset mapping
                             
                             
                             ; END OF LEVELS
                             ;--------------
                             
                             
                             
000c =                       ShipUnit equ 12
4b5f :                       ShipVectorList:
                               ;rel y, rel x. first coord is not drawn, only m
                               ;negative y is down, negative x is left
4b5f : 3000                    db  (ShipUnit * 4), (ShipUnit * 0)
4b61 : b8dc                    db -(ShipUnit * 6),-(ShipUnit * 3)
4b63 : 00f4                    db  (ShipUnit * 0),-(ShipUnit * 1)
4b65 : e818                    db -(ShipUnit * 2), (ShipUnit * 2)
4b67 : 0c0c                    db  (ShipUnit * 1), (ShipUnit * 1)
4b69 : 0018                    db  (ShipUnit * 0), (ShipUnit * 2)
4b6b : f40c                    db -(ShipUnit * 1), (ShipUnit * 1)
4b6d : 1818                    db  (ShipUnit * 2), (ShipUnit * 2)
4b6f : 00f4                    db  (ShipUnit * 0),-(ShipUnit * 1)
4b71 : 48dc                    db  (ShipUnit * 6),-(ShipUnit * 3)
                               ;Extra points for thrust-effect at ships tail
                               ;\/
4b73 : acf7                    db -(ShipUnit * 7),-(ShipUnit * 1 - 3) ;invisib
4b75 : e809                    db -(ShipUnit * 2), (ShipUnit * 1 - 3)
4b77 : 1809                    db  (ShipUnit * 2), (ShipUnit * 1 - 3)
                             
                             
0008 =                       SU=8
4b79 :                       OrbVectorList:
4b79 : 08                      db  8                 ;count-1
4b7a : 20f0                    db  (SU * 4),-(SU * 2)
4b7c : 0020                    db  (SU * 0), (SU * 4)
4b7e : f010                    db -(SU * 2), (SU * 2)
4b80 : e000                    db -(SU * 4), (SU * 0)
4b82 : f0f0                    db -(SU * 2),-(SU * 2)
4b84 : 00e0                    db  (SU * 0),-(SU * 4)
4b86 : 10f0                    db  (SU * 2),-(SU * 2)
4b88 : 2000                    db  (SU * 4), (SU * 0)
4b8a : 1010                    db  (SU * 2), (SU * 2)
                             
                             ;/\
                             ;\/
0018 =                       SU=24
4b8c :                       WarpVectorList:
4b8c : 04                      db  4                 ;count-1
4b8d : 3000                    db  (SU * 2), (SU * 0)
4b8f : d0d0                    db -(SU * 2),-(SU * 2)
4b91 : d030                    db -(SU * 2), (SU * 2)
4b93 : 3030                    db  (SU * 2), (SU * 2)
4b95 : 30d0                    db  (SU * 2),-(SU * 2)
4b97 : ff                      db  $ff       ;end byte so it can be drawn with
                             
0011 =                       ShieldUnit = 17
4b98 :                       ShieldVectorList:
4b98 : 44de                    db  (ShieldUnit * 4),-(ShieldUnit * 2)
4b9a : 0044                    db  (ShieldUnit * 0), (ShieldUnit * 4)
4b9c : de22                    db -(ShieldUnit * 2), (ShieldUnit * 2)
4b9e : bc00                    db -(ShieldUnit * 4), (ShieldUnit * 0)
4ba0 : dede                    db -(ShieldUnit * 2),-(ShieldUnit * 2)
4ba2 : 00bc                    db  (ShieldUnit * 0),-(ShieldUnit * 4)
4ba4 : 22de                    db  (ShieldUnit * 2),-(ShieldUnit * 2)
4ba6 : 4400                    db  (ShieldUnit * 4), (ShieldUnit * 0)
4ba8 : 2222                    db  (ShieldUnit * 2), (ShieldUnit * 2)
                             
000f =                       SU=15
4baa :                       RefuelVectorList:
4baa : 3cc4                    db  (SU * 4),-(SU * 4)
4bac : 0078                    db  (SU * 0), (SU * 8)
4bae : 8800                    db -(SU * 8), (SU * 0)
4bb0 : 0088                    db  (SU * 0),-(SU * 8)
4bb2 : 7800                    db  (SU * 8), (SU * 0)
                             
                             
                             ;-----------------
                             ;Lines for sprites that use the DrawSprite-routin
                             ;-----------------
                             
                             ;Sprite scale factor. Set to a value that makes t
0004 =                       SF set 4
                             
                             ;Sprite unit Height and Width. Relative to size o
                             ;The "-1" allows a 8x8 -128 -- 127 resolution wit
000f =                       SH set ((TileH/8) * SF)-1
000f =                       SW set ((TileW/8) * SF)-1
                             
4bb4 :                       SpriteGunNE:
4bb4 : 06                      db 6                  ;count-1
4bb5 : 1ec4                    db  (SH*2),-(SW*4)    ;start pos
4bb7 : 003c                    db  (SH*0), (SW*4)
4bb9 : f100                    db -(SH*1), (SW*0)
4bbb : 001e                    db  (SH*0), (SW*2)
4bbd : f100                    db -(SH*1), (SW*0)
4bbf : 001e                    db  (SH*0), (SW*2)
4bc1 : e200                    db -(SH*2), (SW*0)
4bc3 : ff                      db $FF                ;end
                             
4bc4 :                       SpriteGunNW:
4bc4 : 06                      db 6                  ;count-1
4bc5 : 1e3c                    db  (SH*2), (SW*4)    ;start pos
4bc7 : 00c4                    db  (SH*0),-(SW*4)
4bc9 : f100                    db -(SH*1), (SW*0)
4bcb : 00e2                    db  (SH*0),-(SW*2)
4bcd : f100                    db -(SH*1), (SW*0)
4bcf : 00e2                    db  (SH*0),-(SW*2)
4bd1 : e200                    db -(SH*2), (SW*0)
4bd3 : ff                      db $FF                ;end
                             
4bd4 :                       SpriteGunSE:
4bd4 : 06                      db 6                  ;count-1
4bd5 : e2c4                    db -(SH*2),-(SW*4)    ;start pos
4bd7 : 003c                    db  (SH*0), (SW*4)
4bd9 : 0f00                    db  (SH*1), (SW*0)
4bdb : 001e                    db  (SH*0), (SW*2)
4bdd : 0f00                    db  (SH*1), (SW*0)
4bdf : 001e                    db  (SH*0), (SW*2)
4be1 : 1e00                    db  (SH*2), (SW*0)
4be3 : ff                      db $FF                ;end
                             
4be4 :                       SpriteGunSW:
4be4 : 06                      db 6                  ;count-1
4be5 : e23c                    db -(SH*2), (SW*4)    ;start pos
4be7 : 00c4                    db  (SH*0),-(SW*4)
4be9 : 0f00                    db  (SH*1), (SW*0)
4beb : 00e2                    db  (SH*0),-(SW*2)
4bed : 0f00                    db  (SH*1), (SW*0)
4bef : 00e2                    db  (SH*0),-(SW*2)
4bf1 : 1e00                    db  (SH*2), (SW*0)
4bf3 : ff                      db $FF                ;end
                             
                             
4bf4 :                       SpriteFuelCell:
4bf4 : 05                      db 5                  ;count-1
4bf5 : c4c4                    db -(SH*4),-(SW*4)    ;start pos
4bf7 : 6900                    db  (SH*7), (SW*0)
4bf9 : 0f0f                    db  (SH*1), (SW*1)
4bfb : 005a                    db  (SH*0), (SW*6)
4bfd : f10f                    db -(SH*1), (SW*1)
4bff : 9700                    db -(SH*7), (SW*0)
4c01 : 02                      db 2                  ;count-1
4c02 : 1eb5                    db  (SH*2),-(SW*5)    ;start pos
4c04 : 2d00                    db  (SH*3), (SW*0)
4c06 : 001e                    db  (SH*0), (SW*2)
4c08 : 01                      db 1                  ;count-1
4c09 : f1f1                    db -(SH*1),-(SW*1)    ;start pos
4c0b : 00f1                    db  (SH*0),-(SW*1)
4c0d : ff                      db $FF                ;end
                             
                             
                             mVec macro yy,xx
                               db (yy*SH),(xx*SW)
                               endm
                             
                             
                             
                             ; /\
                             ; \/
                             ;|  |
                             ;|  |
4c0e :                       SpriteStationaryPod:
4c0e : 04                      db 4
                               mVec 0,0
4c0f : 0000                 >  db (0*SH),(0*SW)
                             
                               mVec 2,2
4c11 : 1e1e                 >  db (2*SH),(2*SW)
                             
                               mVec 2,-2
4c13 : 1ee2                 >  db (2*SH),(-2*SW)
                             
                               mVec -2,-2
4c15 : e2e2                 >  db (-2*SH),(-2*SW)
                             
                               mVec -2,2
4c17 : e21e                 >  db (-2*SH),(2*SW)
                             
4c19 : 06                      db 6
                               mVec -4,-4
4c1a : c4c4                 >  db (-4*SH),(-4*SW)
                             
                               mVec 4,0
4c1c : 3c00                 >  db (4*SH),(0*SW)
                             
                               mVec 0,2
4c1e : 001e                 >  db (0*SH),(2*SW)
                             
                               mVec -2,2
4c20 : e21e                 >  db (-2*SH),(2*SW)
                             
                               mVec 2,2
4c22 : 1e1e                 >  db (2*SH),(2*SW)
                             
                               mVec 0,2
4c24 : 001e                 >  db (0*SH),(2*SW)
                             
                               mVec -4,0
4c26 : c400                 >  db (-4*SH),(0*SW)
                             
4c28 : ff                      db $FF
                             
                             
4c29 :                       SpritePowerplant:
4c29 : 06                      db 6
                               mVec 4,3
4c2a : 3c2d                 >  db (4*SH),(3*SW)
                             
                               mVec -6,0
4c2c : a600                 >  db (-6*SH),(0*SW)
                             
                               mVec 0,-7
4c2e : 0097                 >  db (0*SH),(-7*SW)
                             
                               mVec -2,0
4c30 : e200                 >  db (-2*SH),(0*SW)
                             
                               mVec 0,8
4c32 : 0078                 >  db (0*SH),(8*SW)
                             
                               mVec 8,0
4c34 : 7800                 >  db (8*SH),(0*SW)
                             
                               mVec 0,-1
4c36 : 00f1                 >  db (0*SH),(-1*SW)
                             
4c38 : 05                      db 5
                               mVec -1,0
4c39 : f100                 >  db (-1*SH),(0*SW)
                             
                               mVec 1,-1
4c3b : 0ff1                 >  db (1*SH),(-1*SW)
                             
                               mVec 0,-4
4c3d : 00c4                 >  db (0*SH),(-4*SW)
                             
                               mVec -2,-2
4c3f : e2e2                 >  db (-2*SH),(-2*SW)
                             
                               mVec -3,0
4c41 : d300                 >  db (-3*SH),(0*SW)
                             
                               mVec -1,1
4c43 : f10f                 >  db (-1*SH),(1*SW)
                             
4c45 : ff                      db $FF
                             
                             
                             ;\
                             ;/
4c46 :                       SpriteSwitchLeft:
4c46 : 02                      db 2
                               mVec -2,0
4c47 : e200                 >  db (-2*SH),(0*SW)
                             
                               mVec 2,2
4c49 : 1e1e                 >  db (2*SH),(2*SW)
                             
                               mVec 2,-2
4c4b : 1ee2                 >  db (2*SH),(-2*SW)
                             
4c4d : ff                      db $FF
4c4e :                       SpriteSwitchRight:
4c4e : 02                      db 2
                               mVec -2,0
4c4f : e200                 >  db (-2*SH),(0*SW)
                             
                               mVec 2,-2
4c51 : 1ee2                 >  db (2*SH),(-2*SW)
                             
                               mVec 2,2
4c53 : 1e1e                 >  db (2*SH),(2*SW)
                             
4c55 : ff                      db $FF
                             
                             
4c56 :                       Score150_Lines:
                               ;1
4c56 : 01                      db 1
                               mVec 2,-5
4c57 : 1eb5                 >  db (2*SH),(-5*SW)
                             
                               mVec -4,0
4c59 : c400                 >  db (-4*SH),(0*SW)
                             
                             
                               ;5
4c5b : 05                      db 5
                               mVec 4,6
4c5c : 3c5a                 >  db (4*SH),(6*SW)
                             
                               mVec 0,-4
4c5e : 00c4                 >  db (0*SH),(-4*SW)
                             
                               mVec -2,0
4c60 : e200                 >  db (-2*SH),(0*SW)
                             
                               mVec 0,4
4c62 : 003c                 >  db (0*SH),(4*SW)
                             
                               mVec -2,0
4c64 : e200                 >  db (-2*SH),(0*SW)
                             
                               mVec 0,-4
4c66 : 00c4                 >  db (0*SH),(-4*SW)
                             
                             
                               ;0
4c68 : 04                      db 4
                               mVec 4,5
4c69 : 3c4b                 >  db (4*SH),(5*SW)
                             
                               mVec 0,4
4c6b : 003c                 >  db (0*SH),(4*SW)
                             
                               mVec -4,0
4c6d : c400                 >  db (-4*SH),(0*SW)
                             
                               mVec 0,-4
4c6f : 00c4                 >  db (0*SH),(-4*SW)
                             
                               mVec 4,0
4c71 : 3c00                 >  db (4*SH),(0*SW)
                             
                             
4c73 : ff                      db $ff
                             
4c74 :                       Score300_Lines:
                               ;3
4c74 : 03                      db 3
                               mVec 2,-6
4c75 : 1ea6                 >  db (2*SH),(-6*SW)
                             
                               mVec 0,4
4c77 : 003c                 >  db (0*SH),(4*SW)
                             
                               mVec -4,0
4c79 : c400                 >  db (-4*SH),(0*SW)
                             
                               mVec 0,-4
4c7b : 00c4                 >  db (0*SH),(-4*SW)
                             
4c7d : 01                      db 1
                               mVec 2,0
4c7e : 1e00                 >  db (2*SH),(0*SW)
                             
                               mVec 0,4
4c80 : 003c                 >  db (0*SH),(4*SW)
                             
                             
                               ;0
4c82 : 04                      db 4
                               mVec 2,1
4c83 : 1e0f                 >  db (2*SH),(1*SW)
                             
                               mVec 0,4
4c85 : 003c                 >  db (0*SH),(4*SW)
                             
                               mVec -4,0
4c87 : c400                 >  db (-4*SH),(0*SW)
                             
                               mVec 0,-4
4c89 : 00c4                 >  db (0*SH),(-4*SW)
                             
                               mVec 4,0
4c8b : 3c00                 >  db (4*SH),(0*SW)
                             
                             
                               ;0
4c8d : 04                      db 4
                               mVec 0,5
4c8e : 004b                 >  db (0*SH),(5*SW)
                             
                               mVec 0,4
4c90 : 003c                 >  db (0*SH),(4*SW)
                             
                               mVec -4,0
4c92 : c400                 >  db (-4*SH),(0*SW)
                             
                               mVec 0,-4
4c94 : 00c4                 >  db (0*SH),(-4*SW)
                             
                               mVec 4,0
4c96 : 3c00                 >  db (4*SH),(0*SW)
                             
                             
4c98 : ff                      db $ff
                             
4c99 :                       Score750_Lines:
                               ;7
4c99 : 02                      db 2
                               mVec 2,-6
4c9a : 1ea6                 >  db (2*SH),(-6*SW)
                             
                               mVec 0,4
4c9c : 003c                 >  db (0*SH),(4*SW)
                             
                               mVec -4,-4
4c9e : c4c4                 >  db (-4*SH),(-4*SW)
                             
                             
                               ;5
4ca0 : 05                      db 5
                               mVec 4,7
4ca1 : 3c69                 >  db (4*SH),(7*SW)
                             
                               mVec 0,-4
4ca3 : 00c4                 >  db (0*SH),(-4*SW)
                             
                               mVec -2,0
4ca5 : e200                 >  db (-2*SH),(0*SW)
                             
                               mVec 0,4
4ca7 : 003c                 >  db (0*SH),(4*SW)
                             
                               mVec -2,0
4ca9 : e200                 >  db (-2*SH),(0*SW)
                             
                               mVec 0,-4
4cab : 00c4                 >  db (0*SH),(-4*SW)
                             
                             
                               ;0
4cad : 04                      db 4
                               mVec 4,5
4cae : 3c4b                 >  db (4*SH),(5*SW)
                             
                               mVec 0,4
4cb0 : 003c                 >  db (0*SH),(4*SW)
                             
                               mVec -4,0
4cb2 : c400                 >  db (-4*SH),(0*SW)
                             
                               mVec 0,-4
4cb4 : 00c4                 >  db (0*SH),(-4*SW)
                             
                               mVec 4,0
4cb6 : 3c00                 >  db (4*SH),(0*SW)
                             
                             
4cb8 : ff                      db $ff
                             
                             
                             ;END OF SPRITES
                             ;-----------------
                             
                             
                               include "Thrust_Text.asm"
                             ; Thrust text constants and text/menu display cod
                             ; Copyright (C) 2004  Ville Krumlinde
                             
                             mMakeTextCoord macro lineY,lengthX
                              mCombine d, (-(10*(lineY))), (0 - ((lengthX*8)/2
                              endm
                             
                             
                             ;From x to u, until (and including) end byte
f8de =                       Text_CopyString = $F8DE
                             
                             
                             ;*****************
4cb9 :                       Text_Print:   ;x=string pointer, a/b screen coord
                               mDecLocals 0,2,0
                            >  nolist
                             
                             
4cbb : ede4             [ 5]   std LocalW1,s
4cbd : af62             [ 6]   stx LocalW2,s
                             
4cbf : ccfc30           [ 3]   ldd   #0xFC30    ;#0xFC38
4cc2 : fdc82a           [ 6]   std   $C82A           ;Specify height and width
4cc5 : bdf354           [ 8]   jsr reset0ref
                               mSetScale $7f
                            >  if 1=1
4cc8 : 867f             [ 2]>    lda #$7f                  ;if argument exists
                            >  endif
4cca : 9704             [ 4]>  sta <$04
                             
                               mSetIntensity $40
                            >  if 1=1
4ccc : 8640             [ 2]>    lda   #$40            ;if argument exists, lo
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
4cce : 9701             [ 4]>  sta   <01
4cd0 : cc0401           [ 3]>  ldd   #$0401
4cd3 : 9700             [ 4]>  sta   <00
4cd5 : d700             [ 4]>  stb   <00
                             
4cd7 : ece4             [ 5]   ldd LocalW1,s
4cd9 : bdf312           [ 8]   jsr move_pen_d
                             
4cdc : ee62             [ 6]   ldu LocalW2,s
4cde : bdf495           [ 8]   jsr display_string    ;rom struntar i scale
                             
                               mFreeLocals
4ce1 : 3264             [ 5]>  leas FrameSize,s
                             
4ce3 : 39               [ 5]   rts
                             
                             
                             ;*****************
4ce4 :                       Text_Print_Intensity:   ;x=string pointer, y scre
                               mDecLocals 1,1,0
                            >  nolist
                             
                             
4ce6 : a7e4             [ 4]   sta LocalB1,s
4ce8 : af61             [ 6]   stx LocalW1,s
                             
4cea : ccfc30           [ 3]   ldd   #0xFC30    ;#0xFC38
4ced : fdc82a           [ 6]   std   $C82A           ;Specify height and width
4cf0 : bdf354           [ 8]   jsr reset0ref
                               mSetScale $7f
                            >  if 1=1
4cf3 : 867f             [ 2]>    lda #$7f                  ;if argument exists
                            >  endif
4cf5 : 9704             [ 4]>  sta <$04
                             
4cf7 : a6e4             [ 4]   lda LocalB1,s
                               mSetIntensity
                            >  if 0=1
                            >    lda   #            ;if argument exists, load 
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
4cf9 : 9701             [ 4]>  sta   <01
4cfb : cc0401           [ 3]>  ldd   #$0401
4cfe : 9700             [ 4]>  sta   <00
4d00 : d700             [ 4]>  stb   <00
                             
4d02 : 1f20             [ 6]   tfr y,d
4d04 : bdf312           [ 8]   jsr move_pen_d
                             
4d07 : ee61             [ 6]   ldu LocalW1,s
4d09 : bdf495           [ 8]   jsr display_string    ;rom-code ignores current
                             
                               mFreeLocals
4d0c : 3263             [ 5]>  leas FrameSize,s
                             
4d0e : 39               [ 5]   rts
                             
                             
                             
                             ;*****************
4d0f :                       Text_PrintWait:   ;waits for one second
                             ;x = pointer to list: {1},coords,stringptr,coords
                             ;if first byte is 1, then wait for keypress
000a =                       MaxLines = 10
                               mDecLocals 3,4,MaxLines
                            >  nolist
                             
0001 =                       LocalExitType = LocalB2
0002 =                       LocalSaveDP = LocalB3
0009 =                       LocalCallback = LocalW4
                             
4d12 : 336b             [ 5]   leau LocalBuffer,s    ;init wait-buffer
4d14 : 86fe             [ 2]   lda #-2
4d16 : c60a             [ 2]   ldb #MaxLines
4d18 :                       tpwInitWait:
4d18 : a7c0             [ 6]   sta ,u+
4d1a : 801a             [ 2]   suba #26
4d1c : 5a               [ 2]   decb
4d1d : 26f9             [ 3]   bne tpwInitWait
                             
4d1f : 5f               [ 2]   clrb
4d20 : a684             [ 4]   lda ,x
4d22 : 8101             [ 2]   cmpa #1
4d24 : 2603             [ 3]   bne tpwNoMenu         ;check for first byte 1: 
4d26 : 3001             [ 5]     leax 1,x
4d28 : 5c               [ 2]     incb
4d29 :                       tpwNoMenu:
4d29 : e761             [ 5]   stb LocalExitType,s
                             
4d2b : a684             [ 4]   lda ,x
4d2d : 8102             [ 2]   cmpa #2
4d2f : 260d             [ 3]   bne tpwNoQuick        ;check for first byte 2: 
4d31 : 3001             [ 5]     leax 1,x
4d33 : 8640             [ 2]     lda #$40
4d35 : 336b             [ 5]     leau LocalBuffer,s    ;init wait-buffer
4d37 : c60a             [ 2]     ldb #MaxLines
4d39 :                       tpwInitQuick:
4d39 : a7c0             [ 6]     sta ,u+
4d3b : 5a               [ 2]     decb
4d3c : 26fb             [ 3]     bne tpwInitQuick
4d3e :                       tpwNoQuick:
                             
4d3e : 4f               [ 2]   clra
4d3f : 5f               [ 2]   clrb
4d40 : ed69             [ 6]   std LocalCallback,s
4d42 : a684             [ 4]   lda ,x
4d44 : 8103             [ 2]   cmpa #3
4d46 : 2606             [ 3]   bne tpwNoCallback     ;check for first byte 3: 
4d48 : ec01             [ 6]     ldd 1,x
4d4a : ed69             [ 6]     std LocalCallback,s
4d4c : 3003             [ 5]     leax 3,x
4d4e :                       tpwNoCallback:
                             
4d4e : af63             [ 6]   stx LocalW1,s
                             
                               ;Save dp, meny is called from both title (d0) a
4d50 : 1fb8             [ 6]   tfr dp,a
4d52 : a762             [ 5]   sta LocalSaveDP,s
                               mDptoD0
4d54 : 86d0             [ 2]>  lda   #0xD0
4d56 : 1f8b             [ 6]>  tfr   a,dp
                            >  direct -1
                             
                             
4d58 : 8678             [ 2]   lda #120
4d5a : a7e4             [ 4]   sta LocalB1,s
4d5c :                       tpwWait:
4d5c : bdf192           [ 8]   jsr waitrecal         ;Wait for screen sync
4d5f : bdf289           [ 8]   jsr UpdateSoundChip
                             
4d62 : ae69             [ 6]   ldx LocalCallback,s
4d64 : 2702             [ 3]   beq tpwNoCallCallback
4d66 : ad84             [ 7]     jsr ,x
4d68 :                       tpwNoCallCallback:
                             
4d68 : 336b             [ 5]   leau LocalBuffer,s
4d6a : ef67             [ 6]   stu LocalW3,s
                             
4d6c : 10ae63           [ 7]   ldy LocalW1,s
4d6f :                       tpwNextLine:
4d6f : eca1             [ 8]   ldd ,y++
4d71 : 2737             [ 3]   beq tpwNoMoreLines
4d73 : aea1             [ 8]   ldx ,y++
4d75 : 10af65           [ 7]   sty LocalW2,s
4d78 : 1f02             [ 6]   tfr d,y
                             
4d7a : ee67             [ 6]   ldu LocalW3,s         ;update wait-buffer for e
4d7c : a6c0             [ 6]   lda ,u+
4d7e : ef67             [ 6]   stu LocalW3,s
4d80 : 8140             [ 2]   cmpa #$40
4d82 : 2706             [ 3]   beq tpwSkipInc
4d84 : 4c               [ 2]   inca
4d85 : 4c               [ 2]   inca
4d86 : a75f             [ 5]   sta -1,u
4d88 : 2b1b             [ 3]   bmi tpwSkipLine
4d8a :                       tpwSkipInc:
                             
                               ;value from wait-buffer is used for intensity a
4d8a : a77f             [ 5]   sta -1,s
4d8c : 40               [ 2]   nega
4d8d : 8b40             [ 2]   adda #$40
4d8f : ce6d2c           [ 3]   ldu #SineTable
4d92 : a6c6             [ 5]   lda a,u
                             ; asra
4d94 : a77e             [ 5]   sta -2,s
4d96 : 1f20             [ 6]   tfr y,d
4d98 : ab7e             [ 5]   adda -2,s
4d9a : eb7e             [ 5]   addb -2,s
4d9c : 1f02             [ 6]   tfr d,y
4d9e : a67f             [ 5]   lda -1,s
4da0 : 8b10             [ 2]   adda #$10
4da2 : bd4ce4           [ 8]   jsr Text_Print_Intensity
                             
4da5 :                       tpwSkipLine:
4da5 : 10ae65           [ 7]   ldy LocalW2,s
4da8 : 20c5             [ 3]   bra tpwNextLine
4daa :                       tpwNoMoreLines:
                             
4daa : bd049b           [ 8]   jsr UpdateSound
                             
4dad : 6d61             [ 7]   tst LocalExitType,s
4daf : 2713             [ 3]   beq tpwTestDelayExit
                             
4db1 : 860f             [ 2]   lda #1 + 2 + 4 + 8    ;exit after keypress (men
4db3 : bdf1b4           [ 8]   jsr read_switches
                             
4db6 : 8ec812           [ 3]   ldx #$C812
4db9 : c603             [ 2]   ldb #3
4dbb :                       tpwNextButton:
4dbb : 6d85             [ 7]   tst b,x
4dbd : 260b             [ 3]   bne tpwExit           ;exit with key in B
4dbf : 5a               [ 2]   decb
4dc0 : 2af9             [ 3]   bpl tpwNextButton
                             
4dc2 : 2098             [ 3]   bra tpwWait
                             
4dc4 :                       tpwTestDelayExit:       ;exit after 1 second
4dc4 : 6ae4             [ 6]   dec LocalB1,s
4dc6 : 2702             [ 3]   beq tpwExit
                             
4dc8 : 2092             [ 3]   bra tpwWait
                             
4dca :                       tpwExit:
                               ;Restore dp
4dca : a662             [ 5]   lda LocalSaveDP,s
4dcc : 1f8b             [ 6]   tfr a,dp
                             
                               mFreeLocals
4dce : 32e815           [ 5]>  leas FrameSize,s
                             
4dd1 : 39               [ 5]   rts
                             
                             
                             ;*****************
4dd2 :                       Text_PrintX:            ;x holds value to be prin
                               mDecLocals 0,1,5
                            >  nolist
                             
                             
4dd4 : ede4             [ 5]   std LocalW1,s
                             
4dd6 : 3362             [ 5]   leau LocalBuffer,s
4dd8 : 8d0e             [ 7]   bsr Text_ConvertX
                             
4dda : c680             [ 2]   ldb #$80              ;add end byte
4ddc : e744             [ 5]   stb 4,u
                             
4dde : ece4             [ 5]   ldd LocalW1,s
4de0 : 3062             [ 5]   leax LocalBuffer,s
4de2 : bd4cb9           [ 8]   jsr Text_Print
                             
                               mFreeLocals
4de5 : 3267             [ 5]>  leas FrameSize,s
                             
4de7 : 39               [ 5]   rts
                             
                             
                             ;*****************
4de8 :                       Text_ConvertX           ;x holds value to be conv
                               ;NOTE: this subroutine has two entry-points, be
4de8 : cc2020           [ 3]   ldd #'  '
4deb : edc4             [ 5]   std ,u
4ded : ed42             [ 6]   std 2,u
                             
4def : 8c0064           [ 4]   cmpx #100
4df2 : 10250118         [ 6]   lblo tlsBelow100
4df6 : 8c03e8           [ 4]   cmpx #1000
4df9 : 10250087         [ 6]   lblo tlsBelow1000
                             
                             m_1 macro max,digit
                               cmpx #max-1
                               bls tpd\1
                               leax -max,x
                               lda #'digit'
                               sta 0,u
                               bra tlsBelow1000
                             tpd\1:
                               endm
                             
                               m_1 9000,9
4dfd : 8c2327           [ 4]>  cmpx #9000-1
4e00 : 230a             [ 3]>  bls tpd9000
4e02 : 3089dcd8         [ 8]>  leax -9000,x
4e06 : 8639             [ 2]>  lda #'9'
4e08 : a7c4             [ 4]>  sta 0,u
4e0a : 2078             [ 3]>  bra tlsBelow1000
4e0c :                      >tpd9000:
                             
                               m_1 8000,8
4e0c : 8c1f3f           [ 4]>  cmpx #8000-1
4e0f : 230a             [ 3]>  bls tpd8000
4e11 : 3089e0c0         [ 8]>  leax -8000,x
4e15 : 8638             [ 2]>  lda #'8'
4e17 : a7c4             [ 4]>  sta 0,u
4e19 : 2069             [ 3]>  bra tlsBelow1000
4e1b :                      >tpd8000:
                             
                               m_1 7000,7
4e1b : 8c1b57           [ 4]>  cmpx #7000-1
4e1e : 230a             [ 3]>  bls tpd7000
4e20 : 3089e4a8         [ 8]>  leax -7000,x
4e24 : 8637             [ 2]>  lda #'7'
4e26 : a7c4             [ 4]>  sta 0,u
4e28 : 205a             [ 3]>  bra tlsBelow1000
4e2a :                      >tpd7000:
                             
                               m_1 6000,6
4e2a : 8c176f           [ 4]>  cmpx #6000-1
4e2d : 230a             [ 3]>  bls tpd6000
4e2f : 3089e890         [ 8]>  leax -6000,x
4e33 : 8636             [ 2]>  lda #'6'
4e35 : a7c4             [ 4]>  sta 0,u
4e37 : 204b             [ 3]>  bra tlsBelow1000
4e39 :                      >tpd6000:
                             
                               m_1 5000,5
4e39 : 8c1387           [ 4]>  cmpx #5000-1
4e3c : 230a             [ 3]>  bls tpd5000
4e3e : 3089ec78         [ 8]>  leax -5000,x
4e42 : 8635             [ 2]>  lda #'5'
4e44 : a7c4             [ 4]>  sta 0,u
4e46 : 203c             [ 3]>  bra tlsBelow1000
4e48 :                      >tpd5000:
                             
                               m_1 4000,4
4e48 : 8c0f9f           [ 4]>  cmpx #4000-1
4e4b : 230a             [ 3]>  bls tpd4000
4e4d : 3089f060         [ 8]>  leax -4000,x
4e51 : 8634             [ 2]>  lda #'4'
4e53 : a7c4             [ 4]>  sta 0,u
4e55 : 202d             [ 3]>  bra tlsBelow1000
4e57 :                      >tpd4000:
                             
                               m_1 3000,3
4e57 : 8c0bb7           [ 4]>  cmpx #3000-1
4e5a : 230a             [ 3]>  bls tpd3000
4e5c : 3089f448         [ 8]>  leax -3000,x
4e60 : 8633             [ 2]>  lda #'3'
4e62 : a7c4             [ 4]>  sta 0,u
4e64 : 201e             [ 3]>  bra tlsBelow1000
4e66 :                      >tpd3000:
                             
                               m_1 2000,2
4e66 : 8c07cf           [ 4]>  cmpx #2000-1
4e69 : 230a             [ 3]>  bls tpd2000
4e6b : 3089f830         [ 8]>  leax -2000,x
4e6f : 8632             [ 2]>  lda #'2'
4e71 : a7c4             [ 4]>  sta 0,u
4e73 : 200f             [ 3]>  bra tlsBelow1000
4e75 :                      >tpd2000:
                             
                               m_1 1000,1
4e75 : 8c03e7           [ 4]>  cmpx #1000-1
4e78 : 230a             [ 3]>  bls tpd1000
4e7a : 3089fc18         [ 8]>  leax -1000,x
4e7e : 8631             [ 2]>  lda #'1'
4e80 : a7c4             [ 4]>  sta 0,u
4e82 : 2000             [ 3]>  bra tlsBelow1000
4e84 :                      >tpd1000:
                             
                             
                             m_2 macro max,digit
                               cmpx #max-1
                               bls tpd\1
                               leax -max,x
                               lda #'digit'
                               sta 1,u
                               bra tlsBelow100
                             tpd\1:
                               endm
                             
4e84 :                       tlsBelow1000:
                               m_2 900,9
4e84 : 8c0383           [ 4]>  cmpx #900-1
4e87 : 230a             [ 3]>  bls tpd900
4e89 : 3089fc7c         [ 8]>  leax -900,x
4e8d : 8639             [ 2]>  lda #'9'
4e8f : a741             [ 5]>  sta 1,u
4e91 : 207b             [ 3]>  bra tlsBelow100
4e93 :                      >tpd900:
                             
                               m_2 800,8
4e93 : 8c031f           [ 4]>  cmpx #800-1
4e96 : 230a             [ 3]>  bls tpd800
4e98 : 3089fce0         [ 8]>  leax -800,x
4e9c : 8638             [ 2]>  lda #'8'
4e9e : a741             [ 5]>  sta 1,u
4ea0 : 206c             [ 3]>  bra tlsBelow100
4ea2 :                      >tpd800:
                             
                               m_2 700,7
4ea2 : 8c02bb           [ 4]>  cmpx #700-1
4ea5 : 230a             [ 3]>  bls tpd700
4ea7 : 3089fd44         [ 8]>  leax -700,x
4eab : 8637             [ 2]>  lda #'7'
4ead : a741             [ 5]>  sta 1,u
4eaf : 205d             [ 3]>  bra tlsBelow100
4eb1 :                      >tpd700:
                             
                               m_2 600,6
4eb1 : 8c0257           [ 4]>  cmpx #600-1
4eb4 : 230a             [ 3]>  bls tpd600
4eb6 : 3089fda8         [ 8]>  leax -600,x
4eba : 8636             [ 2]>  lda #'6'
4ebc : a741             [ 5]>  sta 1,u
4ebe : 204e             [ 3]>  bra tlsBelow100
4ec0 :                      >tpd600:
                             
                               m_2 500,5
4ec0 : 8c01f3           [ 4]>  cmpx #500-1
4ec3 : 230a             [ 3]>  bls tpd500
4ec5 : 3089fe0c         [ 8]>  leax -500,x
4ec9 : 8635             [ 2]>  lda #'5'
4ecb : a741             [ 5]>  sta 1,u
4ecd : 203f             [ 3]>  bra tlsBelow100
4ecf :                      >tpd500:
                             
                               m_2 400,4
4ecf : 8c018f           [ 4]>  cmpx #400-1
4ed2 : 230a             [ 3]>  bls tpd400
4ed4 : 3089fe70         [ 8]>  leax -400,x
4ed8 : 8634             [ 2]>  lda #'4'
4eda : a741             [ 5]>  sta 1,u
4edc : 2030             [ 3]>  bra tlsBelow100
4ede :                      >tpd400:
                             
                               m_2 300,3
4ede : 8c012b           [ 4]>  cmpx #300-1
4ee1 : 230a             [ 3]>  bls tpd300
4ee3 : 3089fed4         [ 8]>  leax -300,x
4ee7 : 8633             [ 2]>  lda #'3'
4ee9 : a741             [ 5]>  sta 1,u
4eeb : 2021             [ 3]>  bra tlsBelow100
4eed :                      >tpd300:
                             
                               m_2 200,2
4eed : 8c00c7           [ 4]>  cmpx #200-1
4ef0 : 230a             [ 3]>  bls tpd200
4ef2 : 3089ff38         [ 8]>  leax -200,x
4ef6 : 8632             [ 2]>  lda #'2'
4ef8 : a741             [ 5]>  sta 1,u
4efa : 2012             [ 3]>  bra tlsBelow100
4efc :                      >tpd200:
                             
                               m_2 100,1
4efc : 8c0063           [ 4]>  cmpx #100-1
4eff : 2309             [ 3]>  bls tpd100
4f01 : 30889c           [ 5]>  leax -100,x
4f04 : 8631             [ 2]>  lda #'1'
4f06 : a741             [ 5]>  sta 1,u
4f08 : 2004             [ 3]>  bra tlsBelow100
4f0a :                      >tpd100:
                             
                             
4f0a : 8630             [ 2]   lda #'0'
4f0c : a741             [ 5]   sta 1,u
                             
                             m_3 macro max,digit
                               cmpb #max-1
                               bls tpd\1
                               subb #max
                               addb #'0'
                               lda #'digit'
                               std 2,u
                               bra tlsExit
                             tpd\1:
                               endm
                             
4f0e :                       Text_ConvertX2:           ;x holds value to be co
                             
4f0e :                       tlsBelow100:
4f0e : 1f10             [ 6]   tfr x,d
                               m_3 90,9
4f10 : c159             [ 2]>  cmpb #90-1
4f12 : 230a             [ 3]>  bls tpd90
4f14 : c05a             [ 2]>  subb #90
4f16 : cb30             [ 2]>  addb #'0'
4f18 : 8639             [ 2]>  lda #'9'
4f1a : ed42             [ 6]>  std 2,u
4f1c : 2076             [ 3]>  bra tlsExit
4f1e :                      >tpd90:
                             
                               m_3 80,8
4f1e : c14f             [ 2]>  cmpb #80-1
4f20 : 230a             [ 3]>  bls tpd80
4f22 : c050             [ 2]>  subb #80
4f24 : cb30             [ 2]>  addb #'0'
4f26 : 8638             [ 2]>  lda #'8'
4f28 : ed42             [ 6]>  std 2,u
4f2a : 2068             [ 3]>  bra tlsExit
4f2c :                      >tpd80:
                             
                               m_3 70,7
4f2c : c145             [ 2]>  cmpb #70-1
4f2e : 230a             [ 3]>  bls tpd70
4f30 : c046             [ 2]>  subb #70
4f32 : cb30             [ 2]>  addb #'0'
4f34 : 8637             [ 2]>  lda #'7'
4f36 : ed42             [ 6]>  std 2,u
4f38 : 205a             [ 3]>  bra tlsExit
4f3a :                      >tpd70:
                             
                               m_3 60,6
4f3a : c13b             [ 2]>  cmpb #60-1
4f3c : 230a             [ 3]>  bls tpd60
4f3e : c03c             [ 2]>  subb #60
4f40 : cb30             [ 2]>  addb #'0'
4f42 : 8636             [ 2]>  lda #'6'
4f44 : ed42             [ 6]>  std 2,u
4f46 : 204c             [ 3]>  bra tlsExit
4f48 :                      >tpd60:
                             
                               m_3 50,5
4f48 : c131             [ 2]>  cmpb #50-1
4f4a : 230a             [ 3]>  bls tpd50
4f4c : c032             [ 2]>  subb #50
4f4e : cb30             [ 2]>  addb #'0'
4f50 : 8635             [ 2]>  lda #'5'
4f52 : ed42             [ 6]>  std 2,u
4f54 : 203e             [ 3]>  bra tlsExit
4f56 :                      >tpd50:
                             
                               m_3 40,4
4f56 : c127             [ 2]>  cmpb #40-1
4f58 : 230a             [ 3]>  bls tpd40
4f5a : c028             [ 2]>  subb #40
4f5c : cb30             [ 2]>  addb #'0'
4f5e : 8634             [ 2]>  lda #'4'
4f60 : ed42             [ 6]>  std 2,u
4f62 : 2030             [ 3]>  bra tlsExit
4f64 :                      >tpd40:
                             
                               m_3 30,3
4f64 : c11d             [ 2]>  cmpb #30-1
4f66 : 230a             [ 3]>  bls tpd30
4f68 : c01e             [ 2]>  subb #30
4f6a : cb30             [ 2]>  addb #'0'
4f6c : 8633             [ 2]>  lda #'3'
4f6e : ed42             [ 6]>  std 2,u
4f70 : 2022             [ 3]>  bra tlsExit
4f72 :                      >tpd30:
                             
                               m_3 20,2
4f72 : c113             [ 2]>  cmpb #20-1
4f74 : 230a             [ 3]>  bls tpd20
4f76 : c014             [ 2]>  subb #20
4f78 : cb30             [ 2]>  addb #'0'
4f7a : 8632             [ 2]>  lda #'2'
4f7c : ed42             [ 6]>  std 2,u
4f7e : 2014             [ 3]>  bra tlsExit
4f80 :                      >tpd20:
                             
                               m_3 10,1
4f80 : c109             [ 2]>  cmpb #10-1
4f82 : 230a             [ 3]>  bls tpd10
4f84 : c00a             [ 2]>  subb #10
4f86 : cb30             [ 2]>  addb #'0'
4f88 : 8631             [ 2]>  lda #'1'
4f8a : ed42             [ 6]>  std 2,u
4f8c : 2006             [ 3]>  bra tlsExit
4f8e :                      >tpd10:
                             
                             
4f8e : 8630             [ 2]   lda #'0'
4f90 : cb30             [ 2]   addb #'0'
4f92 : ed42             [ 6]   std 2,u
                             
4f94 :                       tlsExit:
4f94 : 39               [ 5]   rts
                             
                             
                             
                             ;*****************
4f95 :                       Text_LevelExit:         ;returns z set if level i
                               direct $c8
                               mDecLocals 1,1,50
                            >  nolist
                             
0015 =                       LocalString1 = LocalBuffer + 18
0029 =                       LocalString2 = LocalString1 + 20
0000 =                       LocalLevelFin = LocalB1
0001 =                       LocalBonus = LocalW1
                             
                             ;
                             ;  hasPod
                             ;    line 0: "planet destroyed" (if planteddestro
                             ;    line 1: "mission 2 complete"
                             ;    line 2: "bonus xxx" (2000 + (400 * levelno))
                             ;
                             ; level exit utan orb men planetdestroyed
                             ; samma ifall planet destroyed, ej exit
                             ;(vid loselife, testa destroyed, ta bort orb, och
                             ;          PLANET DESTROYED
                             ;          MISSION 1 FAILED
                             ;          NO BONUS
                             ;          (level++)
                             ;
                             
4f98 : 6fe4             [ 6]   clr LocalLevelFin,s           ;level completed 
                             
                               mTestFlag HasOrbFlag
                            >  if 255>HasOrbFlag
4f9a : 96e5             [ 4]>    lda GameFlags1
4f9c : 8504             [ 2]>    bita #HasOrbFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(HasOrbFlag)>>8
                            >  endif
                             
4f9e : 102700d5         [ 6]   lbeq txlNoOrb
                             
4fa2 : 8e50cc           [ 3]   ldx #CompleteString
4fa5 : 33e815           [ 5]   leau LocalString1,s
4fa8 : bdf8de           [ 8]   jsr Text_CopyString
                             
4fab : d6d1             [ 4]   ldb CurLevel                  ;insert level no
4fad : 5c               [ 2]   incb
4fae : 1d               [ 2]   sex
4faf : 1f01             [ 6]   tfr d,x
4fb1 : 33e81b           [ 5]   leau LocalString1+8-2,s
4fb4 : bd4f0e           [ 8]   jsr Text_ConvertX2
                             
4fb7 : 3163             [ 5]   leay LocalBuffer,s
                               mCombine d,30,-70
4fb9 : cc1eba           [ 3]>  ldd #(lo 30)<<8 | (lo -70)
                             
4fbc : eda1             [ 8]   std ,y++
4fbe : 30e815           [ 5]   leax LocalString1,s
4fc1 : afa1             [ 8]   stx ,y++
                             
4fc3 : cc07d0           [ 3]   ldd #2000
4fc6 : ed61             [ 6]   std LocalBonus,s
                             
4fc8 : 0df3             [ 6]   tst PowerLife
4fca : 2a11             [ 3]   bpl txlPlanetAlive
                                 mCombine d,50,-60
4fcc : cc32c4           [ 3]>  ldd #(lo 50)<<8 | (lo -60)
                             
4fcf : eda1             [ 8]     std ,y++
4fd1 : 8e50f2           [ 3]     ldx #PlanetString
4fd4 : afa1             [ 8]     stx ,y++
4fd6 : cc07d0           [ 3]     ldd #2000
4fd9 : e361             [ 7]     addd LocalBonus,s
4fdb : ed61             [ 6]     std LocalBonus,s
4fdd :                       txlPlanetAlive:
                             
4fdd : 8e5103           [ 3]   ldx #BonusString              ;bonus string
4fe0 : 33e829           [ 5]   leau LocalString2,s
4fe3 : bdf8de           [ 8]   jsr Text_CopyString
                             
                               ;detect 'perfect'
4fe6 : 967a             [ 4]   lda GameMode
4fe8 : 8100             [ 2]   cmpa #NormalGame
4fea : 273e             [ 3]   beq txlNoPerfect      ;no perfect for normal ga
                             
4fec : 0df3             [ 6]   tst PowerLife
4fee : 2a3a             [ 3]   bpl txlNoPerfect
                             
4ff0 : deca             [ 5]   ldu CurLevelEntry     ;check all guns destroyed
4ff2 : ee44             [ 6]   ldu leGuns,u
4ff4 : a6c4             [ 4]   lda ,u
4ff6 : a77f             [ 5]   sta -1,s
4ff8 : dce7             [ 5]   ldd GunsActive
4ffa :                       txlGunLoop:
4ffa : 47               [ 2]   asra
4ffb : 56               [ 2]   rorb
4ffc : 252c             [ 3]   bcs txlNoPerfect
4ffe : 6a7f             [ 7]   dec -1,s
5000 : 26f8             [ 3]   bne txlGunLoop
                             
5002 : deca             [ 5]   ldu CurLevelEntry     ;check all fuel collected
5004 : ee46             [ 6]   ldu leFuel,u
5006 : a6c4             [ 4]   lda ,u
5008 : d6e9             [ 4]   ldb FuelActive
500a :                       txlFuelLoop:
500a : 57               [ 2]   asrb
500b : 251d             [ 3]   bcs txlNoPerfect
500d : 4a               [ 2]   deca
500e : 26fa             [ 3]   bne txlFuelLoop
                                 ;perfect: all guns, all fuel, pod collected, 
                                 ;ldd #2000
5010 : 96f5             [ 4]     lda PerfectBonus
5012 : 2716             [ 3]     beq txlNoPerfect            ;no perfect, lost
5014 : c664             [ 2]     ldb #100
5016 : 3d               [11]     mul
5017 : e361             [ 7]     addd LocalBonus,s
5019 : ed61             [ 6]     std LocalBonus,s
                                 mMakeTextCoord 6,8
                            > mCombine d, (-(10*(6))), (0 - ((8*8)/2))
501b : ccc4e0           [ 3]>  ldd #(lo  (-(10*(6))))<<8 | (lo  (0 - ((8*8)/2)
                            >
                             
501e : eda1             [ 8]     std ,y++
5020 : cc5130           [ 3]     ldd #PerfectString
5023 : eda1             [ 8]     std ,y++
                                 mEmitSound PerfectBonusSoundId
                            >  if 1=1
5025 : 8635             [ 2]>    lda #PerfectBonusSoundId
                            >  endif
5027 : bd0476           [ 8]>  jsr EmitSound
                             
502a :                       txlNoPerfect:
                             
                             
                               ;levelno*400 = (levelno*2)*200
502a : bd2824           [ 8]   jsr SplitLevelNo              ;bonus is calced 
502d : 48               [ 2]   lsla
502e : c6c8             [ 2]   ldb #200
5030 : 3d               [11]   mul
5031 : e361             [ 7]   addd LocalBonus,s
5033 : ed61             [ 6]   std LocalBonus,s
                             
5035 : ae61             [ 6]   ldx LocalBonus,s
5037 : 33e82f           [ 5]   leau LocalString2+6,s
503a : bd4de8           [ 8]   jsr Text_ConvertX
                             
                               mCombine d,10,-40
503d : cc0ad8           [ 3]>  ldd #(lo 10)<<8 | (lo -40)
                             
5040 : eda1             [ 8]   std ,y++
5042 : 30e829           [ 5]   leax LocalString2,s
5045 : afa1             [ 8]   stx ,y++
                             
5047 : 4f               [ 2]   clra
5048 : 5f               [ 2]   clrb
5049 : eda4             [ 5]   std ,y                        ;end word
                             
                               ;Add bonus to player score
                               ;Givescore only handles 8-bit values so add the
                               ;Not pretty but it works
504b :                       txlGiveBonus:
504b : ec61             [ 6]   ldd LocalBonus,s
504d : 108307d0         [ 5]   cmpd #2000
5051 : 250c             [ 3]   blo txlRestBonus
5053 : 8307d0           [ 4]   subd #2000
5056 : ed61             [ 6]   std LocalBonus,s
                               mGiveScore 2000
5058 : 86c8             [ 2]>  lda #2000 / 10
505a : bd1acf           [ 8]>  jsr GiveScoreA
                             
505d : 20ec             [ 3]   bra txlGiveBonus
505f :                       txlRestBonus:
505f : 10830064         [ 5]   cmpd #100
5063 : 250e             [ 3]   blo txlBonusFin
5065 : 830064           [ 4]   subd #100
5068 : 3406             [ 7]   pshs d
                               mGiveScore 100
506a : 860a             [ 2]>  lda #100 / 10
506c : bd1acf           [ 8]>  jsr GiveScoreA
                             
506f : 3506             [ 7]   puls d
5071 : 20ec             [ 3]   bra txlRestBonus
5073 :                       txlBonusFin:
                             
5073 : 3063             [ 5]   leax LocalBuffer,s
5075 : 2046             [ 3]   bra txlPrintAndExit
                             
                             
5077 :                       txlNoOrb:
5077 : 0df3             [ 6]   tst PowerLife
5079 : 2a3d             [ 3]   bpl txlInComplete
                             
                               ;Planet destroyed, no orb: no bonus, advance mi
507b : 8e50e0           [ 3]   ldx #FailedString
507e : 33e815           [ 5]   leau LocalString1,s
5081 : bdf8de           [ 8]   jsr Text_CopyString
                             
5084 : d6d1             [ 4]   ldb CurLevel                  ;insert level no
5086 : 5c               [ 2]   incb
5087 : 1d               [ 2]   sex
5088 : 1f01             [ 6]   tfr d,x
508a : 33e81b           [ 5]   leau LocalString1+8-2,s
508d : bd4f0e           [ 8]   jsr Text_ConvertX2
                             
5090 : 3163             [ 5]   leay LocalBuffer,s
                               mCombine d,50,-60
5092 : cc32c4           [ 3]>  ldd #(lo 50)<<8 | (lo -60)
                             
5095 : eda1             [ 8]   std ,y++
5097 : 8e50f2           [ 3]   ldx #PlanetString
509a : afa1             [ 8]   stx ,y++
                             
                               mCombine d,30,-70 + 6
509c : cc1ec0           [ 3]>  ldd #(lo 30)<<8 | (lo -70 + 6)
                             
509f : eda1             [ 8]   std ,y++
50a1 : 30e815           [ 5]   leax LocalString1,s
50a4 : afa1             [ 8]   stx ,y++
                             
                               mCombine d,10,-40 + 6
50a6 : cc0ade           [ 3]>  ldd #(lo 10)<<8 | (lo -40 + 6)
                             
50a9 : eda1             [ 8]   std ,y++
50ab : 8e510e           [ 3]   ldx #NoBonusString
50ae : afa1             [ 8]   stx ,y++
                             
50b0 : 4f               [ 2]   clra
50b1 : 5f               [ 2]   clrb
50b2 : eda4             [ 5]   std ,y
50b4 : 3063             [ 5]   leax LocalBuffer,s
50b6 : 2005             [ 3]   bra txlPrintAndExit
                             
50b8 :                       txlInComplete:
                               ;Exit without orb: stay on same mission
50b8 : 8e512a           [ 3]   ldx #InCompletePtr
50bb : 6ce4             [ 6]   inc LocalLevelFin,s           ;level incomplete
                             
50bd :                       txlPrintAndExit:
                             
50bd : 967a             [ 4]   lda GameMode
50bf : 8102             [ 2]   cmpa #TimeAttackGame          ;skip text if tim
50c1 : 2703             [ 3]   beq txlSkipWait
50c3 : bd4d0f           [ 8]     jsr Text_PrintWait
50c6 :                       txlSkipWait:
                             
50c6 :                       txlExit:
50c6 : 6de4             [ 6]   tst LocalLevelFin,s
                               mFreeLocals
50c8 : 32e835           [ 5]>  leas FrameSize,s
                             
                               direct -1
50cb : 39               [ 5]   rts
50cc :                       CompleteString:
50cc : 4d495353494f4e..        db "MISSION __ COMPLETE",$80
50e0 :                       FailedString:
50e0 : 4d495353494f4e..        db "MISSION __ FAILED",$80
50f2 :                       PlanetString:
50f2 : 504c414e455420..        db "PLANET DESTROYED",$80
5103 :                       BonusString:
5103 : 424f4e5553205f..        db "BONUS ____",$80
510e :                       NoBonusString:
510e : 4e4f20424f4e55..        db "NO BONUS",$80
5117 :                       InCompleteString:
5117 : 4d495353494f4e..        db "MISSION INCOMPLETE",$80
512a :                       InCompletePtr:
512a : 08ce                    db 8,-50
512c : 5117                    dw InCompleteString
512e : 0000                    dw 0
5130 :                       PerfectString:
5130 : 50455246454354..        db "PERFECT!",$80
                             
                             ;*****************
5139 :                       Text_GameOver:
                               direct $c8
                               mDecLocals 0,1,60
                            >  nolist
                             
001a =                       LocalString1 = LocalBuffer + 24
002e =                       LocalString2 = LocalString1 + 20
                             
                             ;   GAME OVER
                             ;
                             ;   HARD GAME
                             ;
                             ;FINAL SCORE 20000
                             ;    LEVEL 5
                             ;
                             ;  PRESS BUTTON
                             
                               ;test for highscore and bonusgame
513c : dc6a             [ 5]   ldd Cheat
513e : 262c             [ 3]   bne tgoNoHighscore    ;no test if cheating
                             
                               ;enable bonusgame
5140 : 0d81             [ 6]   tst BonusGameEnabled
5142 : 260c             [ 3]   bne tgoSkipBonusGame        ;skip if already en
5144 : 0d7a             [ 6]   tst GameMode
5146 : 2608             [ 3]   bne tgoSkipBonusGame        ;must be normal gam
5148 : 96d1             [ 4]   lda CurLevel
514a : 8105             [ 2]   cmpa #LevelCountNormal-1    ;must have complete
514c : 2f02             [ 3]   ble tgoSkipBonusGame
514e : 0c81             [ 6]     inc BonusGameEnabled
5150 :                       tgoSkipBonusGame:
                             
5150 : cec882           [ 3]   ldu #Highscores
5153 : c607             [ 2]   ldb #HighscoreEntry
5155 : 967a             [ 4]   lda GameMode
5157 : 3d               [11]   mul
5158 : 33cb             [ 8]   leau d,u
515a : 8ec8da           [ 3]   ldx #PlayerScore
515d : 8680             [ 2]   lda #$80              ;temporarily store an end
515f : a706             [ 5]   sta DigitCount,x
                               ;check x vs u, copy to u if higher
5161 : bdf8d8           [ 8]   jsr check_4_new_hi_score
5164 : 4d               [ 2]   tsta
5165 : 2a05             [ 3]   bpl tgoNoHighscore
                                 ;new highscore
                                 mEmitSound PerfectBonusSoundId
                            >  if 1=1
5167 : 8635             [ 2]>    lda #PerfectBonusSoundId
                            >  endif
5169 : bd0476           [ 8]>  jsr EmitSound
                             
516c :                       tgoNoHighscore:
                             
516c : 8e51f0           [ 3]   ldx #FinalScoreString         ;'final score'
516f : 33e81a           [ 5]   leau LocalString1,s
5172 : bdf8de           [ 8]   jsr Text_CopyString
                             
5175 : 8ec8da           [ 3]   ldx #PlayerScore              ;insert score
5178 : 31e826           [ 5]   leay LocalString1+12,s
517b : ec81             [ 8]   ldd ,x++
517d : eda1             [ 8]   std ,y++
517f : ec81             [ 8]   ldd ,x++
5181 : eda1             [ 8]   std ,y++
5183 : ec81             [ 8]   ldd ,x++
5185 : eda1             [ 8]   std ,y++
                             
                             
5187 : 3162             [ 5]   leay LocalBuffer,s
5189 : 8601             [ 2]   lda #1
518b : a7a0             [ 6]   sta ,y+                       ;wait for keypres
                             
                               mMakeTextCoord 1,19
                            > mCombine d, (-(10*(1))), (0 - ((19*8)/2))
518d : ccf6b4           [ 3]>  ldd #(lo  (-(10*(1))))<<8 | (lo  (0 - ((19*8)/2
                            >
                             
                             ;  mCombine d,-12,-70
5190 : eda1             [ 8]   std ,y++
5192 : 30e81a           [ 5]   leax LocalString1,s
5195 : afa1             [ 8]   stx ,y++
                             
5197 : 8e523f           [ 3]   ldx #LevelReachedString       ;'level reached x
519a : 33e82e           [ 5]   leau LocalString2,s
519d : bdf8de           [ 8]   jsr Text_CopyString
51a0 : d6d1             [ 4]   ldb CurLevel                  ;insert level no
51a2 : 5c               [ 2]   incb
51a3 : 1d               [ 2]   sex
51a4 : 1f01             [ 6]   tfr d,x
51a6 : 33e832           [ 5]   leau LocalString2+6-2,s
51a9 : bd4f0e           [ 8]   jsr Text_ConvertX2
                               mMakeTextCoord 2,8
                            > mCombine d, (-(10*(2))), (0 - ((8*8)/2))
51ac : ccece0           [ 3]>  ldd #(lo  (-(10*(2))))<<8 | (lo  (0 - ((8*8)/2)
                            >
                             
51af : eda1             [ 8]   std ,y++
51b1 : 30e82e           [ 5]   leax LocalString2,s
51b4 : afa1             [ 8]   stx ,y++
                             
                             ;  ldd ShipFuel
                             ;  bne tgoFuelOk
                             ;  mCombine d,-22,-39
                             ;  std ,y++
                             ;  ldd #FuelString
                             ;  std ,y++
                             ;tgoFuelOk:
                             
                             ;  mCombine d,8,-32
                               mMakeTextCoord -3,9
                            > mCombine d, (-(10*(-3))), (0 - ((9*8)/2))
51b6 : cc1edc           [ 3]>  ldd #(lo  (-(10*(-3))))<<8 | (lo  (0 - ((9*8)/2
                            >
                             
51b9 : eda1             [ 8]   std ,y++
51bb : cc51e6           [ 3]   ldd #GameOverString
51be : eda1             [ 8]   std ,y++
                             
                             ;  mCombine d,-2,-40
                               mMakeTextCoord -1,11
                            > mCombine d, (-(10*(-1))), (0 - ((11*8)/2))
51c0 : cc0ad4           [ 3]>  ldd #(lo  (-(10*(-1))))<<8 | (lo  (0 - ((11*8)/
                            >
                             
51c3 : eda1             [ 8]   std ,y++                      ;display game mod
51c5 : 967a             [ 4]   lda GameMode
51c7 : 48               [ 2]   asla
51c8 : 8e522a           [ 3]   ldx #GameModeStringList
51cb : ae86             [ 6]   ldx a,x
51cd : afa1             [ 8]   stx ,y++
                             
                             ;  mCombine d,-116,-50
                               mMakeTextCoord 10,12
                            > mCombine d, (-(10*(10))), (0 - ((12*8)/2))
51cf : cc9cd0           [ 3]>  ldd #(lo  (-(10*(10))))<<8 | (lo  (0 - ((12*8)/
                            >
                             
51d2 : eda1             [ 8]   std ,y++
51d4 : cc5232           [ 3]   ldd #PressButtonString
51d7 : eda1             [ 8]   std ,y++
                             
51d9 : 6fa0             [ 8]   clr ,y+                       ;end word
51db : 6fa0             [ 8]   clr ,y+
                             
51dd : 3062             [ 5]   leax LocalBuffer,s
51df : bd4d0f           [ 8]   jsr Text_PrintWait
                             
                               mFreeLocals
51e2 : 32e83e           [ 5]>  leas FrameSize,s
                             
                               direct -1
51e5 : 39               [ 5]   rts
51e6 : 47414d45204f56..      GameOverString:   db "GAME OVER",$80
                             ;FuelString:       db "OUT OF FUEL",$80
51f0 : 46494e414c2053..      FinalScoreString: db "FINAL SCORE ______0",$80
                             ;NOTE 11 chars strings assumed by display highsco
5204 : 4e4f524d414c20..      GameModeString1: db "NORMAL GAME",$80
5210 : 20484152442b20..      GameModeString2: db " HARD+ GAME",$80
521c : 54494d45204154..      GameModeString3: db "TIME ATTACK",$80
5228 : 2080                  GameModeString4: db " ",$80     ;no title in bonu
522a :                       GameModeStringList:
522a : 52045210521c5228        dw GameModeString1,GameModeString2,GameModeStri
5232 : 50524553532042..      PressButtonString: db "PRESS BUTTON",$80
523f : 4c4556454c205f..      LevelReachedString: db "LEVEL __",$80
                             
                             
                             ;*****************
5248 :                       Text_Special:
                               mDecLocals 0,0,20
                            >  nolist
                             
524b : 31e4             [ 4]   leay LocalBuffer,s
                             
524d : 8e528e           [ 3]   ldx #SpecialStringsList
5250 : 48               [ 2]   lsla
5251 : ae86             [ 6]   ldx a,x
                             
5253 : 8608             [ 2]   lda #8
5255 : e680             [ 6]   ldb ,x+
5257 : eda1             [ 8]   std ,y++
                             
5259 : afa1             [ 8]   stx ,y++
525b : 6fa0             [ 8]   clr ,y+
525d : 6fa0             [ 8]   clr ,y+
525f : 30e4             [ 4]   leax LocalBuffer,s
5261 : bd4d0f           [ 8]   jsr Text_PrintWait
                             
                               mFreeLocals
5264 : 32e814           [ 5]>  leas FrameSize,s
                             
5267 : 39               [ 5]   rts
5268 : ce524556455253..      SpecialString1: db -50,'REVERSE GRAVITY',$80
5279 : c2494e56495349..      SpecialString2: db -62,'INVISIBLE LANDSCAPE',$80
528e :                       SpecialStringsList:
528e : 52685279                dw SpecialString1,SpecialString2
                             
                             
                             mLine macro yy,str,xx
                               db (-yy * 10)+30
                               if \0=3
                                 db -60 + xx
                               else
                                 db -60
                               endif
                               dw str
                               endm
                             
                             
                             ;*****************
5292 :                       Text_ShowDemoMenu:      ;dp=d0
5292 : 8e52cd           [ 3]   ldx #DemoMenuPtr
5295 : bd4d0f           [ 8]   jsr Text_PrintWait
                               ;B holds key pressed
5298 : 39               [ 5]   rts
                             
5299 : 44454d4f80            DemoMenu0: db "DEMO",$80
529e : 312e204d495353..      DemoMenu1: db "1. MISSION 1",$80
52ab : 322e204d495353..      DemoMenu2: db "2. MISSION 2",$80
52b8 : 332e204d495353..      DemoMenu3: db "3. MISSION 3",$80
52c5 : 342e204558495480      DemoMenu4: db "4. EXIT",$80
52cd :                       DemoMenuPtr:
52cd : 01                      db 1
                               mLine 1,DemoMenu0
52ce : 14                   >  db (-1 * 10)+30
                            >  if 2=3
                            >    db -60 + 
                            >  else
52cf : c4                   >    db -60
                            >  endif
52d0 : 5299                 >  dw DemoMenu0
                             
                               mLine 2,DemoMenu1
52d2 : 0a                   >  db (-2 * 10)+30
                            >  if 2=3
                            >    db -60 + 
                            >  else
52d3 : c4                   >    db -60
                            >  endif
52d4 : 529e                 >  dw DemoMenu1
                             
                               mLine 3,DemoMenu2
52d6 : 00                   >  db (-3 * 10)+30
                            >  if 2=3
                            >    db -60 + 
                            >  else
52d7 : c4                   >    db -60
                            >  endif
52d8 : 52ab                 >  dw DemoMenu2
                             
                               mLine 4,DemoMenu3
52da : f6                   >  db (-4 * 10)+30
                            >  if 2=3
                            >    db -60 + 
                            >  else
52db : c4                   >    db -60
                            >  endif
52dc : 52b8                 >  dw DemoMenu3
                             
                               mLine 5,DemoMenu4
52de : ec                   >  db (-5 * 10)+30
                            >  if 2=3
                            >    db -60 + 
                            >  else
52df : c4                   >    db -60
                            >  endif
52e0 : 52c5                 >  dw DemoMenu4
                             
52e2 : 0000                    dw 0
                             
                             ;*****************
52e4 :                       Text_ShowOptionsMenu:      ;dp=d0
52e4 : 8e5323           [ 3]   ldx #OptionsMenuPtr
52e7 : bd4d0f           [ 8]   jsr Text_PrintWait
                               ;B holds key pressed
52ea : 39               [ 5]   rts
                             
52eb : 4f5054494f4e5380      OptionsMenu0: db "OPTIONS",$80
52f3 : 312e20434f4e54..      OptionsMenu1: db "1. CONTROLS",$80
52ff : 322e2044454d4f80      OptionsMenu2: db "2. DEMO",$80
5307 : 332e2052455345..      OptionsMenu3: db "3. RESET HIGHSCORES",$80
531b : 342e204558495480      OptionsMenu4: db "4. EXIT",$80
5323 :                       OptionsMenuPtr:
5323 : 0102                    db 1,2
                               mLine 1,OptionsMenu0
5325 : 14                   >  db (-1 * 10)+30
                            >  if 2=3
                            >    db -60 + 
                            >  else
5326 : c4                   >    db -60
                            >  endif
5327 : 52eb                 >  dw OptionsMenu0
                             
                               mLine 2,OptionsMenu1
5329 : 0a                   >  db (-2 * 10)+30
                            >  if 2=3
                            >    db -60 + 
                            >  else
532a : c4                   >    db -60
                            >  endif
532b : 52f3                 >  dw OptionsMenu1
                             
                               mLine 3,OptionsMenu2
532d : 00                   >  db (-3 * 10)+30
                            >  if 2=3
                            >    db -60 + 
                            >  else
532e : c4                   >    db -60
                            >  endif
532f : 52ff                 >  dw OptionsMenu2
                             
                               mLine 4,OptionsMenu3
5331 : f6                   >  db (-4 * 10)+30
                            >  if 2=3
                            >    db -60 + 
                            >  else
5332 : c4                   >    db -60
                            >  endif
5333 : 5307                 >  dw OptionsMenu3
                             
                               mLine 5,OptionsMenu4
5335 : ec                   >  db (-5 * 10)+30
                            >  if 2=3
                            >    db -60 + 
                            >  else
5336 : c4                   >    db -60
                            >  endif
5337 : 531b                 >  dw OptionsMenu4
                             
5339 : 0000                    dw 0
                             
                             ;*****************
c8a0 =                       CheatTemp = TemporaryArea ;Temp memory used by me
533b :                       Text_ShowCheatMenu:      ;dp=d0
                             
533b : cec8a0           [ 3]   ldu #CheatTemp
533e : 7dc86a           [ 7]   tst CheatLives
5341 : 2707             [ 3]   beq tcmOff
5343 : cc4f4e           [ 3]     ldd #'ON'
5346 : edc1             [ 8]     std ,u++
5348 : 2007             [ 3]     bra tcmLivesFin
534a :                       tcmOff:
534a : cc4f46           [ 3]     ldd #'OF'
534d : edc1             [ 8]     std ,u++
534f : e7c0             [ 6]     stb ,u+
5351 :                       tcmLivesFin:
5351 : 8680             [ 2]   lda #$80
5353 : a7c0             [ 6]   sta ,u+
                             
5355 : cec8a2           [ 3]   ldu #CheatTemp+4-2
5358 : f6c86b           [ 5]   ldb CheatLevel
535b : 5c               [ 2]   incb
535c : 1d               [ 2]   sex
535d : 1f01             [ 6]   tfr d,x
535f : bd4f0e           [ 8]   jsr Text_ConvertX2
5362 : c680             [ 2]   ldb #$80
5364 : e744             [ 5]   stb 4,u
                             
5366 : 8e537f           [ 3]   ldx #CheatMenuPtr
5369 : bd4d0f           [ 8]   jsr Text_PrintWait
                               ;B holds key pressed
536c : 39               [ 5]   rts
                             
536d : 434845415480          CheatMenu0: db "CHEAT",$80
5373 : 5354415254204c..      CheatMenu1: db "START LEVEL",$80
537f :                       CheatMenuPtr:
537f : 0102                    db 1,2
                               mLine 3,CheatMenu0
5381 : 00                   >  db (-3 * 10)+30
                            >  if 2=3
                            >    db -60 + 
                            >  else
5382 : c4                   >    db -60
                            >  endif
5383 : 536d                 >  dw CheatMenu0
                             
                                 mLine 3,CheatTemp,100
5385 : 00                   >  db (-3 * 10)+30
                            >  if 3=3
5386 : 28                   >    db -60 + 100
                            >  else
                            >    db -60
                            >  endif
5387 : c8a0                 >  dw CheatTemp
                             
                               mLine 4,CheatMenu1
5389 : f6                   >  db (-4 * 10)+30
                            >  if 2=3
                            >    db -60 + 
                            >  else
538a : c4                   >    db -60
                            >  endif
538b : 5373                 >  dw CheatMenu1
                             
                                 mLine 4,CheatTemp+4,100
538d : f6                   >  db (-4 * 10)+30
                            >  if 3=3
538e : 28                   >    db -60 + 100
                            >  else
                            >    db -60
                            >  endif
538f : c8a4                 >  dw CheatTemp+4
                             
5391 : 0000                    dw 0
                             
                             ;*****************
5393 :                       Text_ShowGameMenu:      ;dp=d0
5393 : 8e541d           [ 3]   ldx #GameMenuPtr
5396 : bd4d0f           [ 8]   jsr Text_PrintWait
                               ;B holds key pressed
5399 : 39               [ 5]   rts
                             
539a :                       GameMenuCallback:
                               mDecLocals 2,1,0
                            >  nolist
                             
                             
539c : 8ef0fd           [ 3]   ldx #$F0FD
539f : b6c826           [ 5]   lda LoopCounterLow
53a2 : 44               [ 2]   lsra
53a3 : 8403             [ 2]   anda #3
53a5 : a686             [ 5]   lda a,x
53a7 : b7c829           [ 5]   sta Pattern
                             
53aa : b6c826           [ 5]   lda LoopCounterLow
53ad : 847f             [ 2]   anda #127
53af : a761             [ 5]   sta LocalB2,s
                             
53b1 : 8604             [ 2]   lda #4
53b3 : a7e4             [ 4]   sta LocalB1,s
53b5 :                       gmcLoop:
53b5 : bdf354           [ 8]   jsr reset0ref
                               mSetIntensity $40
                            >  if 1=1
53b8 : 8640             [ 2]>    lda   #$40            ;if argument exists, lo
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
53ba : 9701             [ 4]>  sta   <01
53bc : cc0401           [ 3]>  ldd   #$0401
53bf : 9700             [ 4]>  sta   <00
53c1 : d700             [ 4]>  stb   <00
                             
                             
53c3 : a661             [ 5]   lda LocalB2,s
53c5 : 8e6d2c           [ 3]   ldx #SineTable
53c8 : a686             [ 5]   lda a,x
                             
53ca : 47               [ 2]   asra
53cb : 8b1f             [ 2]   adda #31
53cd : 8b80             [ 2]   adda #128
                             
                               mSetScale
                            >  if 0=1
                            >    lda #                  ;if argument exists, l
                            >  endif
53cf : 9704             [ 4]>  sta <$04
                             
                             
53d1 : 8e4baa           [ 3]   ldx #RefuelVectorList
53d4 : 8603             [ 2]   lda #4-1
53d6 : bd0810           [ 8]   jsr FxMoveDrawPattern
                             
53d9 : a661             [ 5]   lda LocalB2,s
53db : 8b04             [ 2]   adda #4
53dd : 2a02             [ 3]   bpl gmcNoWrap
53df : 8080             [ 2]     suba #128
53e1 :                       gmcNoWrap:
53e1 : a761             [ 5]   sta LocalB2,s
                             
53e3 : 6ae4             [ 6]   dec LocalB1,s
53e5 : 26ce             [ 3]   bne gmcLoop
                             
                               mFreeLocals
53e7 : 3264             [ 5]>  leas FrameSize,s
                             
53e9 : 39               [ 5]   rts
                             
53ea : 53454c45435420..      GameMenu0: db "SELECT GAME MODE",$80
53fb : 312e204e4f524d..      GameMenu1: db "1. NORMAL",$80
5405 : 322e2048415244..      GameMenu2: db "2. HARD+",$80
540e : 332e2054494d45..      GameMenu3: db "3. TIME ATTACK",$80
541d :                       GameMenuPtr:
541d : 0102                    db 1,2
541f : 03                      db 3
5420 : 539a                    dw GameMenuCallback
                               mLine 1,GameMenu0
5422 : 14                   >  db (-1 * 10)+30
                            >  if 2=3
                            >    db -60 + 
                            >  else
5423 : c4                   >    db -60
                            >  endif
5424 : 53ea                 >  dw GameMenu0
                             
                               mLine 2,GameMenu1
5426 : 0a                   >  db (-2 * 10)+30
                            >  if 2=3
                            >    db -60 + 
                            >  else
5427 : c4                   >    db -60
                            >  endif
5428 : 53fb                 >  dw GameMenu1
                             
                               mLine 3,GameMenu2
542a : 00                   >  db (-3 * 10)+30
                            >  if 2=3
                            >    db -60 + 
                            >  else
542b : c4                   >    db -60
                            >  endif
542c : 5405                 >  dw GameMenu2
                             
                               mLine 4,GameMenu3
542e : f6                   >  db (-4 * 10)+30
                            >  if 2=3
                            >    db -60 + 
                            >  else
542f : c4                   >    db -60
                            >  endif
5430 : 540e                 >  dw GameMenu3
                             
5432 : 0000                    dw 0
                             
                             
                             ;*****************
5434 :                       Text_ShowWellDone:      ;game completed
                               mEmitSound PerfectBonusSoundId
                            >  if 1=1
5434 : 8635             [ 2]>    lda #PerfectBonusSoundId
                            >  endif
5436 : bd0476           [ 8]>  jsr EmitSound
                             
5439 : 8e545c           [ 3]   ldx #WellDonePtr
543c : bd4d0f           [ 8]   jsr Text_PrintWait
543f : 39               [ 5]   rts
                             
5440 :                       WellDoneCallback:
5440 : 8664             [ 2]   lda #100
5442 : b7c8a0           [ 5]   sta TitleLogoY
5445 : bd6232           [ 8]   jsr DrawTitleLogo
5448 : 869c             [ 2]   lda #-100
544a : b7c8a0           [ 5]   sta TitleLogoY
544d : bd6232           [ 8]   jsr DrawTitleLogo
5450 : 39               [ 5]   rts
                             
5451 : 57454c4c20444f..      WellDone0: db 'WELL DONE!',$80
545c :                       WellDonePtr:
545c : 0102                    db 1,2
545e : 03                      db 3
545f : 5440                    dw WellDoneCallback
5461 : 08d8                    db 8,-40
5463 : 5451                    dw WellDone0
5465 : 0000                    dw 0
                             
                             
                             ;*****************
5467 :                       Text_ShowControlMenu:      ;dp=d0, a=button to se
                               mDecLocals 1,0,20
                            >  nolist
                             
                             
546a : a7e4             [ 4]   sta LocalB1,s
                             
546c : 3061             [ 5]   leax LocalBuffer,s
546e : 8601             [ 2]   lda #1
5470 : a780             [ 6]   sta ,x+
                               mMakeTextCoord 0,32
                            > mCombine d, (-(10*(0))), (0 - ((32*8)/2))
5472 : cc0080           [ 3]>  ldd #(lo  (-(10*(0))))<<8 | (lo  (0 - ((32*8)/2
                            >
                             
5475 : ed81             [ 8]   std ,x++
5477 : cc5498           [ 3]   ldd #ControlMenu0
547a : ed81             [ 8]   std ,x++
                             
                               mMakeTextCoord 0,1
                            > mCombine d, (-(10*(0))), (0 - ((1*8)/2))
547c : cc00fc           [ 3]>  ldd #(lo  (-(10*(0))))<<8 | (lo  (0 - ((1*8)/2)
                            >
                             
547f : ed81             [ 8]   std ,x++
5481 : a6e4             [ 4]   lda LocalB1,s
5483 : 48               [ 2]   asla
5484 : ce54ca           [ 3]   ldu #ControlStringList
5487 : ecc6             [ 6]   ldd a,u
5489 : ed81             [ 8]   std ,x++
548b : 4f               [ 2]   clra
548c : 5f               [ 2]   clrb
548d : ed84             [ 5]   std ,x
                             
548f : 3061             [ 5]   leax LocalBuffer,s
5491 : bd4d0f           [ 8]   jsr Text_PrintWait
                               ;B holds key pressed
                               mFreeLocals
5494 : 32e815           [ 5]>  leas FrameSize,s
                             
5497 : 39               [ 5]   rts
                             
5498 : 50524553532042..      ControlMenu0: db "PRESS BUTTON FOR:",$80
54aa : 4649524580            ControlMenu1: db "FIRE",$80
54af : 534849454c442f..      ControlMenu2: db "SHIELD/TRACTOR",$80
54be : 54485255535480        ControlMenu3: db "THRUST",$80
54c5 : 4c4f434b80            ControlMenu4: db "LOCK",$80
54ca :                       ControlStringList:
54ca : 54aa54af54be54c5        dw ControlMenu1,ControlMenu2,ControlMenu3,Contr
                             
                             ;*****************
54d2 :                       Text_ShowResetMenu:      ;dp=d0
54d2 : 8e54ea           [ 3]   ldx #ResetMenuPtr
54d5 : bd4d0f           [ 8]   jsr Text_PrintWait
                               ;B holds key pressed
54d8 : 39               [ 5]   rts
                             
54d9 : 50524553532032..      ResetMenu0: db "PRESS 2 TO RESET",$80
54ea :                       ResetMenuPtr:
54ea : 0102                    db 1,2
                               mLine 1,ResetMenu0
54ec : 14                   >  db (-1 * 10)+30
                            >  if 2=3
                            >    db -60 + 
                            >  else
54ed : c4                   >    db -60
                            >  endif
54ee : 54d9                 >  dw ResetMenu0
                             
54f0 : 0000                    dw 0
                             
                               include "Thrust_BonusGame.asm"
                             ; Zzap Strikes Back - Bonusgame hidden inside Thr
                             ; Copyright (C) 2004  Ville Krumlinde
                             
                             ;todo optimize size
                             ;   skip all y-coords, assume 0?
                             ;   direct c9 instead?
                             ;   macros instead of subroutines
                             ;   gör subs av mMove_to_d i hela, mMove_to_d=jsr
                             ;
                             ;fixlist
                             ;  coolare bullet for homing shots
                             ;  svårare
                             ;    1 extra headträff
                             ;    öka level every two walkers
                             ;    öka hitpoints baserat på levelhi?
                             ;  radar plot base
                             ;  thrust flame
                             ; *highscore visas /10
                             ;
                             ;  activate vid 50.000?
                             ;    har nått 93000 i normal game
                             ; --> testa:   har nått level 6 i normal game
                             ;  smalare huvud för varje round
                             ;  lägre intensity på bakre berg
                             ;  walker mer hitpoints
                             ;  kortare värld
                             ;  större diff på shotintensities
                             ;  walker fler shots
                             ;  walker lysande shots
                             ;  svårare att träffa head
                             ;
                             ;  skip ship vs walker collision?
                             ;  rewrite setview-code
                             ;    om ship right
                             ;      opt = shipx + velocx - edge
                             ;      diff=opt-view
                             ;      om diff<>0
                             ;        asr diff, minst 1
                             ;        öka view med diff
                             ;  defender style control: flip dir med button? a
                             ;  öka shipshot speed efter tid, så att man inte 
                             ;  gameover, öka shipy tills utanför skärm, gameo
                             ;  roligt ljud vid explode walker
                             ;  pulse-sound
                             ;  jump-sound
                             ;  score
                             ;    score för headshot
                             ;    score för bodyshot
                             ;    blinka weakspot i ryggen, om hit döda direkt
                             ;  radar
                             ;    world length 8192 / 64 = 0..128
                             ;    loop walkers
                             ;    screenx=walkerx >> 6
                             ;      lo rol2 in i ny byte
                             ;      b|=hi shl2
                             ;    screeny=walkery >> 3
                             ;    RadarGetScreenCoords x,y
                             ; *eget gamemode
                             ;    titlescreen
                             ;    save highscore
                             ;    egen text i gameover
                             ; *collision ship är inte centrerad
                             ; *slide left/right ska bara påverka viewx, ej sh
                             ;
                             ;optimize speed
                             ;  mountain och ship ritas i scale $7f
                             ;
                             ;tillåt att skepp åker ovan skärmen 32 koords
                             ;  och under 32 koords
                             ;  då måste viewy följa
                             ;  drawstars
                             ;  flytta ship,mountains och stjärnor separat? pa
                             ;
                             ;title
                             ;  'ZZAP STRIKES BACK'
                             ;  'PRESS FIRE'
                             ;  HIGHSCORE
                             ;
                             ;activate
                             ;  om cheatactive visa som alternativ 4 i modesel
                             ;  alt vid highscore i normal game
                             ;  tst BonusGameActivated (eeprom)
                             ;    sätts efter nytt highscore
                             ;    samt vid enable cheat
                             ;  alt
                             ;    som nu helt hidden
                             ;  GameMode = 3 BonusGame
                             ;    save highscore also
                             ;    hur visa highscore?
                             ;      egen titlescreen
                             ;  1 start, 2 options, 3 zzgf
                             ;    3 visar ny titlescreen
                             ;
                             ;walker
                             ;  dela upp i body och huvud
                             ;  animera ben och huvud
                             ;  hittest mod body och huvud, mer sårbar på huvu
                             ;    gör först generellt hittest, sedan på separa
                             ;
                             ;  WalkerWidth
                             ;    WalkerBaseW = (WalkerWidth/4)*3
                             ;    WalkerLegW = (WalkerBaseW/6) * 2
                             ;
                             ;  WalkerBaseW = 128
                             ;  WalkerNeckW = 32
                             ;  WalkerHeadW = 32
                             ;
                             ;  WalkerTotalWidth = WalkerBaseW + WalkerNeckW +
                             ;  CopyLinesAddY
                             ;  DrawLeg offsetx,length
                             ;
                             ;  /------\
                             ;  |      |-/\
                             ;  |      |-\/
                             ;  --------
                             ;  | |  | |
                             ;  |_|  |_|
                             ;
                             ; 6 bytes stack per line, 18 lines, 108 bytes sta
                             ;  ;positive y is down, positive x is right
                             ;  ;  db 1  ;line count
                             ;  ;  db 1  ;linetype, 0=vert, 1=horiz, 2=slope
                             ;  ;  db FullW,0  ;x0,y0
                             ;  ;  db 0,HalfH  ;x1,y1
                             ;
                             ;  hotspot
                             ;    träffar man denna så dör walker direkt
                             ;
                             ;  explode
                             ;    FxTargetWalker index, obs ny emit får ej ske
                             ;    sänk walker långsamt genom att öka dess y
                             ;
                             ;walker damage
                             ;  inital life 64
                             ;  headshot minska med 8
                             ;    emit explosion i head vart 32:e
                             ;  base minska med 2
                             ;  flash if low?
                             ;
                             ;difficulty
                             ;  zzappace är 32-0, börjar på 32, minskar 1 vart
                             ;  zzappace är 255-0, börjar på 255, shr 1 vart 1
                             ;  både Pace och PaceMask?
                             ;  alt.
                             ;    öka pace för varje dödad walker
                             ;    ha en klocka för varje behov
                             ;    återgå till långsamt tempo efter snabbaste
                             ;      flytta fram walkeremitpoint vid varje varv
                             ;    WalkerSpeed mask8frame,6,4,3,2,1
                             ;    ShootDelay 8,7,6,5,4,3,2,1 (multipliceras me
                             ;    JumpDelay
                             ;    JumpHeight
                             ;    ShotYSpread, ShotXSpeed
                             ;    ZzapIncDifficulty, ZzapResetDifficulty
                             ;  IncreaseDifficulty()
                             ;    anropa flera ggr för att testa
                             ;    ZzapShotDelay
                             ;    inc ZzapLevelNo
                             ;      om mod 8=0
                             ;      InitDifficulty()
                             ;      IncreaseDifficulty() för att inte börja på
                             ;      move forward walker emitpoint
                             ;    lsr ZzapShotDelay
                             ;  ZzapLevel
                             ;  ZzapDifficultyEntry
                             ;    zdShotDelay
                             ;  InitDifficulty
                             ;    allt noll
                             ;    mSetByte ZzapShotDelay,$ff
                             ;    mSetByte ZzapWalkerSpeed,0
                             ;  updatewalkers
                             ;    updatera x med två ifall framecounter and (4
                             ;
                             ;    lda zzapshotdelay
                             ;    anda loopcounterlow
                             ;    bne skipshots
                             ;
                             ;    om jumping
                             ;      updatera y
                             ;      använd jumpscale för att öka y
                             ;    annars
                             ;      lda jumpdelay
                             ;      anda framecounter
                             ;      bne nojump
                             ;      set jumping
                             ;      jumpscale -2 -- 2
                             ;
                             ;    walkerentry
                             ;      jumpIndex 0--63, -1=not jumping
                             ;      jumpScale init med rnd * zdconfig.jumpscal
                             ;    zdconfig
                             ;      jumpIndex 0--64, -1=not jumping
                             ;      jumpIndexIncrease 1--4
                             ;      jumpIndexIncreaseRange 2
                             ;      jumpScale
                             ;      jumpScaleRange
                             ;      jumpDelay only randomize jumpdelay
                             ;      för scale ta walkerindex
                             ;
                             ;
                             ;move walkers
                             ;  loopcounter and (zzappace and 15)
                             ;
                             ;sound
                             ;  "puls" ljud när walkers rör sig
                             ;  ökar i takt med zzapclock
                             ;  zc=zzappace shl 4
                             ;  (loopcounter and (255 shl zc))
                             ;
                             ;draw walker
                             ;  walkervisible-flag
                             ;    då ritas ej score och radar
                             ;  sätt upp headrect och baserect
                             ;  shots vs walkers
                             ;    endast om visible
                             ;    testa mot head och base
                             ;
                             ;
                             ;walker-shots
                             ;  klocka styr hur ofta walker skjuter, samt dess
                             ;  träff med skepp, drain energy vänd riktning oc
                             ;    ZzapClock ds ökar med 1 varje sekund
                             ;      alt ZzapPace ökar med 1 vart 8:e sekund, s
                             ;    WalkerShotTimer (dec vart 8:e frame) 8=1 sek
                             ;      max 5 sekunder, min 1 sekund
                             ;      rnd +/- 1 sekund
                             ;      (8-zzapPace)*4 + (rnd and 15 - 7)
                             ;      alt span 1 skott vart 4:e sekund -- 1 vart
                             ;        timer range 1 -- (4*8)
                             ;        timer = 33 - (zzappace<<1)
                             ;    homingness
                             ;      mask = 32 - zzappace<<1
                             ;      mask = zzappace-1
                             ;  emit
                             ;    om !walkerVisible exit
                             ;    emit ifrån headrect
                             ;    xveloc=fast speed * zzapclock
                             ;    WalkerShotEntry
                             ;      wsActive
                             ;      wsVelocX +/-
                             ;      wsWalkerShotX
                             ;      wsWalkerShotY
                             ;  DrawWalkerShots
                             ;    remove ifall utanför skärm
                             ;  UpdateWalkerShot
                             ;    loop
                             ;      om active
                             ;        flytta
                             ;        remove ifall utanför skärm
                             ;        collision vs ship
                             ;      annars lagra i ledig slot
                             ;    om ledig slot
                             ;      och timer=0
                             ;      och walkervisible
                             ;      emit
                             ;        origin HeadX
                             ;        sätt wsVelocX i riktning mot skepp
                             ;
                             ;
                             ;base
                             ;  rita stationarypod som base
                             ;  ifall walker når pod, gameover
                             ;    sätt viewx till base, loop med waitcalc, emi
                             ;
                             ;score
                             ;  använd samma rutiner som vanliga spelet? eget 
                             ;
                             ;radar
                             ;  display med radar o score, fadas bort när walk
                             ;
                             
                               code
                             
                             ; Relative coordinates for mountain.
54f2 :                       Zzap_MountainYCoords:
54f2 : 050af6fb14030405        db 5,10,-10,-5,20,3,4,5
54fa : f600f600140000e0        db -10,0,-10,0,20,0,0,-32
                             
                             
                             ; For each of the values in MountainYCoords there
                             ; saying where to start drawing. This could be ca
                             ; relative values, but it's easier having a list.
5502 :                       Zzap_MountainABSYCoords:
5502 : 00050f050014171b        db 0,5,15,5,0,20,23,27
550a : 2016160c0c202020        db 32,22,22,12,12,32,32,32
                             
                             
                             
                             
                             ; Vectors for ship facing left.
5512 :                       Zzap_ShipLeftVectorList:
5512 : e7ce                    db  -25,-50
5514 : 3264                    db  50,100
5516 : ddd8                    db  -35,-40
5518 : f114                    db  -15,20
551a : 00ab                    db  0,-85
                               ;thrust flame
551c : 0852                    db 8,82
551e : 0818                    db 8,24
5520 : 08e8                    db 8,-24
                             
                             
                             ; Vectors for ship facing right.
5522 :                       Zzap_ShipRightVectorList:
5522 : e732                    db  -25,50
5524 : 329c                    db  50,-100
5526 : dd28                    db  -35,40
5528 : f1ec                    db  -15,-20
552a : 0055                    db  0,85
                               ;thrust flame
552c : 08ae                    db 8,-82
552e : 08e8                    db 8,-24
5530 : 0818                    db 8,24
                             
0064 =                       ZzShipWidth = 100
                             
                             
                               bss
                             
                             ;Start memory in drawlist to avoid collisions wit
c946 =                       Zzap_RamStart = DrawList
c946 =                         org Zzap_RamStart
                             
                             ; Ship coordinates.
                             ; The Y values is a direct Vectrex coordinate use
                             ; The X value is a position in game world.
c8bd =                       Zzap_ShipY = ShipY
c8bb =                       Zzap_ShipX = ShipX
                             
c8b7 =                       Zzap_ShipVelocX = ShipSpeedX
c8b9 =                       Zzap_ShipVelocY = ShipSpeedY
                             
                             ; Direction ship is facing.
c8b6 =                       Zzap_ShipDir = ShipAngle        ;1=left, -1=right
                             
                             
                             ; X coordinate in game world for left edge of scr
                             ; This value is subtracted from ship and shot x c
c8c6 =                       Zzap_LeftOffsetX = ViewX
                             
                             
                             ; Ship shots.
                             
                             ; Max nr of shots visible at one time. This value
0004 =                       Zzap_ShipShotCount = 4
                             
                             ; A shot is growing from the nose of the ship unt
0032 =                       Zzap_ShipShotMaxLength = 50
                             
                             ; Structure holding info about one shot.
0000 =                         struct Zzap_ShipShotEntry
0000 =                           db Zzap_ssShotActive       ;Flag: is shot act
0001 =                           db Zzap_ssShotDir          ;Direction for sho
0002 =                           dw Zzap_ssShotY            ;Y game world coor
0004 =                           dw Zzap_ssShotX            ;X game world coor
0006 =                           db Zzap_ssShotLength       ;Current length of
                               end struct
                             
                             ; Array with shots.
c946 =                       Zzap_ShipShotList: ds Zzap_ShipShotEntry * Zzap_S
                             
c8f2 =                       ZzapShipTookDamage=DoorCounter
c8e0 =                       ZzapShipLives=ShipLives
                             
                             
                             ;8192 is the length the radar assumes
0100 =                       ZzapWorldStartX = 256
2100 =                       ZzapWorldEndX = ZzapWorldStartX + 8192
                             ;ViewX for new game
2000 =                       ZzapViewStartX = ZzapWorldEndX - 256
                             
ff80 =                       ZzapWorldTopY = 0-128
00ff =                       ZzapWorldEndY = 255
                             
00df =                       WalkerFloorY = ZzapWorldEndY - 32
                             
                             
                             ;Walkers (enemies)
0008 =                       WalkerCount = 8
                             
0000 =                         struct WalkerEntry
0000 =                           db weWalkerActive           ;-1=active, 0=dea
0001 =                           db weWalkerLife
0002 =                           dw weWalkerX
0004 =                           dw weWalkerY                ;sprite center co
0006 =                           db weJumpIndex              ;-1=not jumping, 
                               end struct
                             
c962 =                       WalkerList: ds WalkerEntry * WalkerCount
                             
                             ;Walker measurements
0030 =                       WalkerBaseH=48
0054 =                       WalkerBaseW=84 ;120-32
0030 =                       WalkerLegH=64-16
0010 =                       WalkerLegW=(WalkerBaseW/7)*1 + 4
0020 =                       HeadW = 32
                             ;Default head height, shrinks for each level
0018 =                       DefaultHeadH = 32-8
                             ;Total width/height of walker sprite
0074 =                       WalkerWidth=WalkerBaseW+HeadW
0060 =                       WalkerHeight=WalkerBaseH + WalkerLegH
                             
02ee =                       WalkerDistance = 750            ;Distance between
                             
                             ;Walker shots
0005 =                       WalkerShotCount=5
0000 =                        struct WalkerShotEntry
0000 =                          db wsActive
0001 =                          db wsVelocX
0002 =                          db wsVelocY
0003 =                          dw wsWalkerShotX
0005 =                          dw wsWalkerShotY
                              end struct
                             
c99a =                       WalkerShotList: ds WalkerShotEntry * WalkerShotCo
                             
                             ;Coordinates for base
2080 =                       BaseX = ZzapWorldEndX - 128
00d5 =                       BaseY = WalkerFloorY - 10
                             
0010 =                       ZzapShipH = 16
0020 =                       ZzapShipW = 32
                             
0008 =                       ZzapShipArea = 8                    ;Hit area for
                             
                             ; 0 = no walker visible, else points to visible w
c8c3 =                       WalkerVisible = ScrollX  ;2 bytes
c9bd =                       WalkerVisibleI: ds 1    ;index of visible walker
c9be =                       VisibleHeadX: ds 2
c9c0 =                       VisibleHeadY: ds 2
c9c2 =                       VisibleBaseX: ds 2
c9c4 =                       VisibleBaseY: ds 2
                             
                             ;Game difficulty configuration, increased by each
0000 =                        struct ZzapConfigEntry
0000 =                          db zcShotDelay
0001 =                          db zcShotYSpread
0002 =                          db zcWalkerSpeedMask
0003 =                          db zcJumpDelay
0004 =                          db zcJumping
0005 =                          db zcJumpScale
0006 =                          db zcHeadH
0007 =                          db zcHalfHeadH
0008 =                          db zcWalkerLife
                              end struct
c9c6 =                       ZzapConfig: ds ZzapConfigEntry
                             
                             ; Use same level as maingame, levelno is displaye
c8d1 =                       ZzapLevel = CurLevel
                             
                             ; Dynamic length, keep at end of BSS-section
c9cf =                       WalkerDrawList:
                             
                             
                             ;*******************
                               code
                             
5532 :                       Zzap_Start:
5532 : 8ec946           [ 3]   ldx #Zzap_RamStart
5535 : bdf545           [ 8]   jsr clear_256_bytes   ;Clear buffer
                             
                               mDptoC8
5538 : 86c8             [ 2]>  lda   #0xC8
553a : 1f8b             [ 6]>  tfr   a,dp
                            >  direct $c8
                             
553c : bd57d7           [ 8]   jsr Zzap_InitNewGame
                             
                             ; jsr Text_ShowWellDone
553f : bd5588           [ 8]   jsr ZzapTitleScreen
                             
5542 :                       Zzap_MainLoop:
                               mDptoC8
5542 : 86c8             [ 2]>  lda   #0xC8
5544 : 1f8b             [ 6]>  tfr   a,dp
                            >  direct $c8
                             
5546 : bd59bc           [ 8]   jsr Zzap_ControlShip
5549 : bd58e5           [ 8]   jsr Zzap_UpdateShipShots
554c : bd1a0e           [ 8]   jsr UpdateFrameCounter
554f : bd049b           [ 8]   jsr UpdateSound
5552 : bd5c45           [ 8]   jsr UpdateWalkers
5555 : bd56be           [ 8]   jsr UpdateWalkerShots
5558 : bd074e           [ 8]   jsr UpdateFx
                             
                               mTestFlag GameOverFlag
                            >  if 255>GameOverFlag
555b : 96e5             [ 4]>    lda GameFlags1
555d : 8540             [ 2]>    bita #GameOverFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(GameOverFlag)>>8
                            >  endif
                             
555f : 2623             [ 3]   bne ZzapGameOver
                             
5561 : bdf192           [ 8]   jsr waitrecal         ;Wait for screen sync
                               ;DP is now D0
                             
5564 : bdf289           [ 8]   jsr UpdateSoundChip
                             
5567 : bd5b89           [ 8]   jsr Zzap_DrawMountain
556a : bd5838           [ 8]   jsr Zzap_DrawShip
556d : bd5899           [ 8]   jsr Zzap_DrawShipShots
5570 : bd5d22           [ 8]   jsr DrawWalkers
5573 : bd57a6           [ 8]   jsr DrawWalkerShots
5576 : bd5ef6           [ 8]   jsr DrawBase
5579 : bd070c           [ 8]   jsr DrawFx
557c : bd1a27           [ 8]   jsr DrawDisplay
557f : bd55de           [ 8]   jsr DrawRadar
                             ;  jsr DrawStars
                             
5582 : 20be             [ 3]   bra Zzap_MainLoop
                             
5584 :                       ZzapGameOver:
5584 : bd5139           [ 8]   jsr Text_GameOver
5587 : 39               [ 5]   rts
                             
5588 :                       ZzapTitleScreen:
                               mDecLocals 0,0,40
                            >  nolist
                             
                             
558b : 30e4             [ 4]   leax LocalBuffer,s
                               mCombine d,1,2
558d : cc0102           [ 3]>  ldd #(lo 1)<<8 | (lo 2)
                             
5590 : ed81             [ 8]   std ,x++
                             
5592 : 8603             [ 2]   lda #3
5594 : a780             [ 6]   sta ,x+
5596 : cc539a           [ 3]   ldd #GameMenuCallback
5599 : ed81             [ 8]   std ,x++
                             
                               mMakeTextCoord -2,4
                            > mCombine d, (-(10*(-2))), (0 - ((4*8)/2))
559b : cc14f0           [ 3]>  ldd #(lo  (-(10*(-2))))<<8 | (lo  (0 - ((4*8)/2
                            >
                             
559e : ed81             [ 8]   std ,x++
55a0 : cc55ce           [ 3]   ldd #ZzapGameText1
55a3 : ed81             [ 8]   std ,x++
                             
                               mMakeTextCoord 0,16
                            > mCombine d, (-(10*(0))), (0 - ((16*8)/2))
55a5 : cc00c0           [ 3]>  ldd #(lo  (-(10*(0))))<<8 | (lo  (0 - ((16*8)/2
                            >
                             
55a8 : ed81             [ 8]   std ,x++
55aa : cc55d3           [ 3]   ldd #ZzapGameText2
55ad : ed81             [ 8]   std ,x++
                             
                               mMakeTextCoord 0,-2
                            > mCombine d, (-(10*(0))), (0 - ((-2*8)/2))
55af : cc0008           [ 3]>  ldd #(lo  (-(10*(0))))<<8 | (lo  (0 - ((-2*8)/2
                            >
                             
55b2 : ed81             [ 8]   std ,x++
55b4 : 3304             [ 5]   leau 4,x
55b6 : ef81             [ 8]   stu ,x++
                             
55b8 : cc0000           [ 3]   ldd #0
55bb : ed84             [ 5]   std ,x
                             
55bd : 8ec897           [ 3]   ldx #Highscores + (HighscoreEntry * 3)
55c0 : c680             [ 2]   ldb #$80
55c2 : bd1aba           [ 8]   jsr CopyScoreFromXtoU
                             
55c5 : 30e4             [ 4]   leax LocalBuffer,s
55c7 : bd4d0f           [ 8]   jsr Text_PrintWait
                             
                               mFreeLocals
55ca : 32e828           [ 5]>  leas FrameSize,s
                             
55cd : 39               [ 5]   rts
55ce : 5a53422180            ZzapGameText1: db "ZSB!",$80
55d3 : 4849474853434f..      ZzapGameText2: db "HIGHSCORE:",$80
                             
                             
                             ;*****************
55de :                       DrawRadar:
                               direct -1
                               mDecLocals 1,1,4
                            >  nolist
                             
55e0 : cec962           [ 3]   ldu #WalkerList
55e3 : 8608             [ 2]   lda #WalkerCount
55e5 : a7e4             [ 4]   sta LocalB1,s
55e7 :                       zdrLoop:
55e7 : a6c4             [ 4]   lda weWalkerActive,u
55e9 : 270b             [ 3]   beq zdrNext
                             
55eb : 3042             [ 5]   leax weWalkerX,u
55ed : 866f             [ 2]   lda #$7f-16
55ef : 8d2e             [ 7]   bsr RadarPlotCoords
55f1 : 8605             [ 2]   lda #5
55f3 : bd225e           [ 8]   jsr DrawPlusAtCurrentPosition
                             
55f6 :                       zdrNext:
55f6 : 3347             [ 5]   leau WalkerEntry,u
55f8 : 6ae4             [ 6]   dec LocalB1,s
55fa : 26eb             [ 3]   bne zdrLoop
                             
55fc : 8ec8bb           [ 3]   ldx #Zzap_ShipX
55ff : 866f             [ 2]   lda #$7f-16
5601 : 8d1c             [ 7]   bsr RadarPlotCoords
                               mDot_at_current_position
                            >  ; From vectrex.txt
                            >  ;    "(WARNING! high intensity and long Vec_Dot
                            >  ;     your vectrex monitor, be carefull while e
5603 : 86ff             [ 2]>       lda   #0xFF
5605 : 970a             [ 4]>       sta   <0x0A
                            >;       ldb   #         ; is a value for how long
                            >;PF2CC1304: decb                     ;dwell is no
                            >;       bne   PF2CC1304
5607 : 0f0a             [ 6]>       clr   <0x0A
                             
                             
5609 : 3063             [ 5]   leax LocalBuffer,s
560b : cc2080           [ 3]   ldd #BaseX
560e : ed84             [ 5]   std ,x
5610 : cc00d5           [ 3]   ldd #BaseY
5613 : ed02             [ 6]   std 2,x
5615 : 865f             [ 2]   lda #$7f-32
5617 : 8d06             [ 7]   bsr RadarPlotCoords
                             ;  lda #3
5619 : bd21de           [ 8]   jsr DrawBulletAtCurrentPosition
                             ;  mDot_at_current_position
                             
                               mFreeLocals
561c : 3267             [ 5]>  leas FrameSize,s
                             
561e : 39               [ 5]   rts
                             
561f :                       RadarPlotCoords: ;x points to world coords X,Y, a
561f : 3402             [ 6]   pshs a
5621 : bdf354           [ 8]   jsr reset0ref
                             
5624 : ec84             [ 5]   ldd ,x
                             
                               ;div 8192
5626 : 59               [ 2]   rolb
5627 : 49               [ 2]   rola
5628 : 59               [ 2]   rolb
5629 : 49               [ 2]   rola
562a : 8040             [ 2]   suba #64
562c : a77f             [ 5]   sta -1,s
                             
562e : ec02             [ 6]   ldd 2,x
5630 : 47               [ 2]   asra
5631 : 56               [ 2]   rorb
5632 : 47               [ 2]   asra
5633 : 56               [ 2]   rorb
5634 : 47               [ 2]   asra
5635 : 56               [ 2]   rorb
5636 : 47               [ 2]   asra
5637 : 56               [ 2]   rorb
5638 : 1f98             [ 6]   tfr b,a
563a : 40               [ 2]   nega
563b : 8b64             [ 2]   adda #100
                             
563d : e67f             [ 5]   ldb -1,s
                             
563f : bdf2fc           [ 8]   jsr move_pen7f_to_d
5642 : 3502             [ 6]   puls a
                               mSetIntensity
                            >  if 0=1
                            >    lda   #            ;if argument exists, load 
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
5644 : 9701             [ 4]>  sta   <01
5646 : cc0401           [ 3]>  ldd   #$0401
5649 : 9700             [ 4]>  sta   <00
564b : d700             [ 4]>  stb   <00
                             
564d : 39               [ 5]   rts
                             ;  mDot_at_current_position
                             ;  lda #3
                             ;  jmp DrawPlusAtCurrentPosition
                             ;  rts
                             
                             ;*****************
564e :                       SetDifficulty:  ;set difficulty based on value in
                               direct $c8
                               mDecLocals 2,0,0
                            >  nolist
                             
0000 =                       LocalLevelLo = LocalB1
0001 =                       LocalLevelHi = LocalB2
                             
5650 : 96d1             [ 4]   lda ZzapLevel
5652 : 44               [ 2]  lsra          ;increase difficulty every two wal
5653 : 1f89             [ 6]   tfr a,b
5655 : 8407             [ 2]   anda #7
5657 : a7e4             [ 4]   sta LocalLevelLo,s
5659 : 54               [ 2]   lsrb
565a : 54               [ 2]   lsrb
565b : 54               [ 2]   lsrb
                               ;b=level high
                               ;locallevelo is never lower than hi
                               ;this makes the base difficulty increase after 
565c : c107             [ 2]   cmpb #7
565e : 2f02             [ 3]   ble *+4
5660 : c607             [ 2]     ldb #7      ;level 64 = difficulty at max
5662 : e761             [ 5]   stb LocalLevelHi,s
5664 : e1e4             [ 4]   cmpb LocalLevelLo,s
5666 : 2f02             [ 3]   ble *+4
5668 : e7e4             [ 4]     stb LocalLevelLo,s
                             
566a : 8ec9c6           [ 3]   ldx #ZzapConfig
                             
566d : a6e4             [ 4]   lda LocalLevelLo,s
566f : ce56b2           [ 3]   ldu #WalkerShotDelayTable
5672 : e6c6             [ 5]   ldb a,u
5674 : e784             [ 4]   stb zcShotDelay,x
                             
5676 : ce56ba           [ 3]   ldu #WalkerJumpDelayTable
5679 : a6e4             [ 4]   lda LocalLevelLo,s
567b : 44               [ 2]   lsra
567c : e6c6             [ 5]   ldb a,u
567e : e703             [ 5]   stb zcJumpDelay,x
                             
5680 : a6e4             [ 4]   lda LocalLevelLo,s
5682 : 44               [ 2]   lsra
5683 : ce56ae           [ 3]   ldu #WalkerSpreadTable
5686 : a6c6             [ 5]   lda a,u
5688 : a701             [ 5]   sta zcShotYSpread,x
                             
568a : ce56aa           [ 3]   ldu #WalkerSpeedTable
568d : a6e4             [ 4]   lda LocalLevelLo,s
568f : 44               [ 2]   lsra
5690 : a6c6             [ 5]   lda a,u
5692 : a702             [ 5]   sta zcWalkerSpeedMask,x
                             
5694 : a661             [ 5]   lda LocalLevelHi,s
5696 : 48               [ 2]   lsla
5697 : 40               [ 2]   nega
5698 : 8b18             [ 2]   adda #DefaultHeadH
569a : a706             [ 5]   sta zcHeadH,x
569c : 47               [ 2]   asra
569d : a707             [ 5]   sta zcHalfHeadH,x
                             
                               ;Walker life
569f : a661             [ 5]   lda LocalLevelHi,s
56a1 : 48               [ 2]   lsla
56a2 : 48               [ 2]   lsla
56a3 : 8b3a             [ 2]   adda #58
56a5 : a708             [ 5]   sta zcWalkerLife,x
                             
                               mFreeLocals
56a7 : 3262             [ 5]>  leas FrameSize,s
                             
                               direct -1
56a9 : 39               [ 5]   rts
56aa : 03c00100              WalkerSpeedTable: db FRAME4MASK,FRAME3MASK,FRAME2
56ae : 01020408              WalkerSpreadTable: db 1,2,4,8
56b2 :                       WalkerShotDelayTable:
56b2 : ffdf3fcf                db FRAME192MASK,FRAME96MASK,FRAME64MASK,FRAME48
56b6 : 1f0fc3c1                db FRAME32MASK,FRAME16MASK,FRAME12MASK,FRAME6MA
56ba :                       WalkerJumpDelayTable:
56ba : 00ff3f07                db 0,FRAME192MASK,FRAME64MASK,FRAME8MASK
                             
                             ;*****************
56be :                       UpdateWalkerShots:
                             ;  UpdateWalkerShot
                             ;    loop
                             ;      active?
                             ;        move
                             ;        collision vs ship
                             ;      else save free slot index
                             ;    if free slot
                             ;      and timer=0
                             ;      and walkervisible
                             ;      emit
                             ;        origin HeadX
                             ;        set wsVelocX in direction towards ship
                               direct $c8
                               mDecLocals 1,1,0
                            >  nolist
                             
0001 =                       LocalFree=LocalW1
                             
56c0 : 6f61             [ 7]   clr LocalFree,s
                             
56c2 : cec99a           [ 3]   ldu #WalkerShotList
56c5 : 8605             [ 2]   lda #WalkerShotCount
56c7 : a7e4             [ 4]   sta LocalB1,s
56c9 :                       zuwsLoop:
56c9 : 6dc4             [ 6]   tst wsActive,u
56cb : 10270082         [ 6]   lbeq zuwsInactive
                             
56cf : e641             [ 5]   ldb wsVelocX,u      ;update x
56d1 : 1d               [ 2]   sex
56d2 : e343             [ 7]   addd wsWalkerShotX,u
56d4 : ed43             [ 6]   std wsWalkerShotX,u
                             
56d6 : 9626             [ 4]   lda LoopCounterLow
56d8 : 840f             [ 2]   anda #15
56da : 2605             [ 3]   bne zuwsSkipIncVelocX
56dc : e641             [ 5]     ldb wsVelocX,u
56de : 58               [ 2]     aslb
56df : e741             [ 5]     stb wsVelocX,u
56e1 :                       zuwsSkipIncVelocX:
                             
0174 =                       ZuwsMaxDistance = 256 + WalkerWidth
56e1 : dcbb             [ 5]   ldd Zzap_ShipX
56e3 : c30174           [ 4]   addd #ZuwsMaxDistance
56e6 : 10a343           [ 8]   cmpd wsWalkerShotX,u
56e9 : 2f64             [ 3]   ble zuwsRemove
56eb : 8302e8           [ 4]   subd #ZuwsMaxDistance*2
56ee : 10a343           [ 8]   cmpd wsWalkerShotX,u
56f1 : 2c5c             [ 3]   bge zuwsRemove
                             
56f3 : ae45             [ 6]   ldx wsWalkerShotY,u
                             
56f5 : e642             [ 5]   ldb wsVelocY,u
56f7 : 3085             [ 5]   leax b,x
                             
56f9 : a6e4             [ 4]   lda LocalB1,s
56fb : 8401             [ 2]   anda #1
56fd : 2713             [ 3]   beq zuwsNoHome
56ff : 96e4             [ 4]   lda FrameCounter
5701 : 84c0             [ 2]   anda #FRAME3MASK
5703 : 260d             [ 3]   bne zuwsNoHome
5705 : c601             [ 2]     ldb #1      ;slightly homing shots
5707 : 9cbd             [ 6]     cmpx Zzap_ShipY
5709 : 2707             [ 3]     beq zuwsNoHome
570b : 2501             [ 3]       bcs *+3
570d : 50               [ 2]         negb
570e : eb42             [ 5]       addb wsVelocY,u
5710 : e742             [ 5]       stb wsVelocY,u
5712 :                       zuwsNoHome:
                             
5712 : 9626             [ 4]   lda LoopCounterLow
5714 : 8401             [ 2]   anda #1
5716 : 2602             [ 3]   bne zuwsSkipY
                             
5718 : af45             [ 6]   stx wsWalkerShotY,u
571a :                       zuwsSkipY:
                             
                                 ;collision vs ship
571a : 108ec8bb         [ 4]     ldy #Zzap_ShipX
                                 mPointVsRect ZzapShipArea,ZzapShipArea,zuwsMi
571e : ae43             [ 6]>  ldx     wsWalkerShotX,u
5720 : eca4             [ 5]>  ldd     0,y
5722 : 830004           [ 4]>  subd    #ZzapShipArea/2
5725 : ed7e             [ 6]>  std -2,s
5727 : ac7e             [ 7]>  cmpx -2,s
5729 : 2d22             [ 3]>  blt    zuwsMiss
572b : c30008           [ 4]>  addd    #ZzapShipArea
572e : ed7e             [ 6]>  std -2,s
5730 : ac7e             [ 7]>  cmpx -2,s
5732 : 2e19             [ 3]>  bgt    zuwsMiss
5734 : ae45             [ 6]>  ldx     wsWalkerShotY,u
5736 : ec22             [ 6]>  ldd     2,y
5738 : 830004           [ 4]>  subd    #ZzapShipArea/2
573b : ed7e             [ 6]>  std -2,s
573d : ac7e             [ 7]>  cmpx -2,s
573f : 2d0c             [ 3]>  blt    zuwsMiss
5741 : c30008           [ 4]>  addd    #ZzapShipArea
5744 : ed7e             [ 6]>  std -2,s
5746 : ac7e             [ 7]>  cmpx -2,s
5748 : 2e03             [ 3]>  bgt    zuwsMiss
                             
574a : bd5b6b           [ 8]       jsr ZzapShipTakeDamage
574d :                       zuwsMiss:
574d : 2004             [ 3]     bra zuwsNext
574f :                       zuwsRemove:
574f : 6fc4             [ 6]     clr wsActive,u
5751 :                       zuwsInactive:
5751 : ef61             [ 6]     stu LocalFree,s
5753 :                       zuwsNext:
5753 : 3347             [ 5]   leau WalkerShotEntry,u
5755 : 6ae4             [ 6]   dec LocalB1,s
5757 : 1026ff6e         [ 6]   bne zuwsLoop
                             
                               ;test if emit
575b : cec9c6           [ 3]   ldu #ZzapConfig
575e : a6c4             [ 4]   lda zcShotDelay,u
5760 : 94e4             [ 4]   anda FrameCounter
5762 : 263f             [ 3]   bne zuwsNoEmit
5764 : 6d61             [ 7]   tst LocalFree,s
5766 : 273b             [ 3]   beq zuwsNoEmit
5768 : 0dc3             [ 6]   tst WalkerVisible
576a : 2737             [ 3]   beq zuwsNoEmit
576c : 10ae61           [ 7]     ldy LocalFree,s
576f : 8601             [ 2]     lda #1
5771 : a7a4             [ 4]     sta wsActive,y
5773 : 8ec9be           [ 3]     ldx #VisibleHeadX
5776 : ec02             [ 6]     ldd 2,x
5778 : eb47             [ 5]     addb zcHalfHeadH,u
577a : ed25             [ 6]     std wsWalkerShotY,y
577c : ae84             [ 5]     ldx ,x
577e : 308810           [ 5]     leax HeadW/2,x
5781 : af23             [ 6]     stx wsWalkerShotX,y
5783 : 9cbb             [ 6]     cmpx Zzap_ShipX
5785 : 8603             [ 2]     lda #3
5787 : 2501             [ 3]     bcs *+3
5789 : 40               [ 2]       nega
578a : a721             [ 5]     sta wsVelocX,y
                                 mRandomToA
578c : bdf511           [ 8]>  jsr random                    ;call rom
                             
                             
578f : e641             [ 5]     ldb zcShotYSpread,u
5791 : 5a               [ 2]     decb
5792 : e77f             [ 5]     stb -1,s
5794 : a47f             [ 5]     anda -1,s
5796 : 5c               [ 2]     incb
5797 : 54               [ 2]     lsrb
5798 : e77f             [ 5]     stb -1,s
579a : a07f             [ 5]     suba -1,s
                             
                             ;    anda #7
                             ;    suba #4
579c : a722             [ 5]     sta wsVelocY,y
                                 mEmitSound GunFireSoundId
                            >  if 1=1
579e : 8608             [ 2]>    lda #GunFireSoundId
                            >  endif
57a0 : bd0476           [ 8]>  jsr EmitSound
                             
57a3 :                       zuwsNoEmit:
                             
                               mFreeLocals
57a3 : 3263             [ 5]>  leas FrameSize,s
                             
                               direct -1
57a5 : 39               [ 5]   rts
                             
                             ;*****************
57a6 :                       DrawWalkerShots:
                               ;DP must be D0
                               mDecLocals 1,0,4
                            >  nolist
                             
                             
                               mSetScale $7f                 ;Scale $7f is req
                            >  if 1=1
57a8 : 867f             [ 2]>    lda #$7f                                   ;i
                            >  endif
57aa : 9704             [ 4]>  sta <$04
                             
                             
57ac : 8ec99a           [ 3]   ldx #WalkerShotList
57af : 8605             [ 2]   lda #WalkerShotCount
57b1 : a7e4             [ 4]   sta LocalB1,s
57b3 :                       zdwsLoop:
57b3 : 6d84             [ 6]   tst wsActive,x
57b5 : 2717             [ 3]   beq zdwsNotActive
                             
57b7 : 3361             [ 5]   leau LocalBuffer,s
57b9 : ec03             [ 6]   ldd wsWalkerShotX,x
57bb : edc4             [ 5]   std ,u
57bd : ec05             [ 6]   ldd wsWalkerShotY,x
57bf : ed42             [ 6]   std 2,u
57c1 : 3410             [ 7]   pshs x
57c3 : 8e4b8c           [ 3]   ldx #WarpVectorList
                               mCombine d,6,$7f
57c6 : cc067f           [ 3]>  ldd #(lo 6)<<8 | (lo $7f)
                             
57c9 : bd07c3           [ 8]   jsr FxDrawSpriteVL                 ;Draw a sing
57cc : 3510             [ 7]   puls x
                             
                             ;  tsta
                             ;  beq zdwsNotOnScreen
                             ;    jsr DrawBulletAtCurrentPosition
                             ;    jsr DrawBulletAtCurrentPosition
                             ;    jsr DrawBulletAtCurrentPosition
                             ;zdwsNotOnScreen:
                             
57ce :                       zdwsNotActive:
57ce : 3007             [ 5]   leax WalkerShotEntry,x
57d0 : 6ae4             [ 6]   dec LocalB1,s
57d2 : 26df             [ 3]   bne zdwsLoop
                             
                               mFreeLocals
57d4 : 3265             [ 5]>  leas FrameSize,s
                             
57d6 : 39               [ 5]   rts
                             
                             ;*****************
57d7 :                       Zzap_InitNewGame:
                               direct $c8
                             
                               mSetByte GameMode,BonusGame
                            > if 0=BonusGame
                            >   clr GameMode
                            > else
57d7 : 8603             [ 2]>   lda #BonusGame
57d9 : 977a             [ 4]>   sta GameMode
                            > endif
                             
                             
57db : 4f               [ 2]   clra
57dc : bd296a           [ 8]   jsr InitNewGame
57df : 0ce0             [ 6]   inc ShipLives
57e1 : bd283d           [ 8]   jsr PrepareLevel
                             
                               mSetByte ZzapLevel,0
                            > if 0=0
57e4 : 0fd1             [ 6]>   clr ZzapLevel
                            > else
                            >   lda #0
                            >   sta ZzapLevel
                            > endif
                             
57e6 : bd564e           [ 8]   jsr SetDifficulty
                             
57e9 : cc7d00           [ 3]   ldd #32000
57ec : ddcd             [ 5]   std CurLevelEndX              ;CurLevelEndX = (
57ee : cc0000           [ 3]   ldd #0
57f1 : ddcf             [ 5]   std CurLevelEndY              ;CurLevelEndY = l
                             
57f3 : 8e2000           [ 3]   ldx #ZzapViewStartX
57f6 : 9fc6             [ 5]   stx Zzap_LeftOffsetX
57f8 : 30890080         [ 8]   leax 128,x
57fc : 9fbb             [ 5]   stx Zzap_ShipX
                             
57fe : ccffe0           [ 3]   ldd #WalkerFloorY-255
5801 : ddc8             [ 5]   std ViewY
                             
5803 : cc0032           [ 3]   ldd #50
5806 : ddbd             [ 5]   std Zzap_ShipY
                             
5808 : 8601             [ 2]   lda #1
580a : 97b6             [ 4]   sta Zzap_ShipDir
                             
                               ;Init walkers
580c : 8e2000           [ 3]   ldx #ZzapViewStartX
580f : cec962           [ 3]   ldu #WalkerList
5812 : c608             [ 2]   ldb #WalkerCount
5814 :                       zngWLoop:
5814 : 3404             [ 6]   pshs b
5816 : 3089fd12         [ 8]   leax -WalkerDistance,x
581a : 8d08             [ 7]   bsr InitOneWalker
581c : 3347             [ 5]   leau WalkerEntry,u
581e : 3504             [ 6]   puls b
5820 : 5a               [ 2]   decb
5821 : 26f1             [ 3]   bne zngWLoop
                             
                             ;  jsr clear_sound_chip
                               direct -1
5823 : 39               [ 5]   rts
                             
5824 :                       InitOneWalker: ;x=X coord, u=entry
5824 : 86ff             [ 2]   lda #-1
5826 : a7c4             [ 4]   sta weWalkerActive,u
                             ;  lda #100 + 16
5828 : 108ec9c6         [ 4]   ldy #ZzapConfig
582c : a628             [ 5]   lda zcWalkerLife,y
582e : a741             [ 5]   sta weWalkerLife,u
5830 : cc00af           [ 3]   ldd #WalkerFloorY - (WalkerHeight/2)
5833 : ed44             [ 6]   std weWalkerY,u
5835 : af42             [ 6]   stx weWalkerX,u
5837 : 39               [ 5]   rts
                             
                             ;*****************
5838 :                       Zzap_DrawShip:
                               direct -1
                             
                               mTestFlag InactiveFlag
                            >  if 255>InactiveFlag
5838 : b6c8e5           [ 5]>    lda GameFlags1
583b : 8510             [ 2]>    bita #InactiveFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(InactiveFlag)>>8
                            >  endif
                             
583d : 2701             [ 3]   beq *+3
583f : 39               [ 5]     rts
                             
5840 : 7dc8f2           [ 7]   tst ZzapShipTookDamage
5843 : 270a             [ 3]   beq zdsShipOk
5845 : 7ac8f2           [ 7]     dec ZzapShipTookDamage
5848 : b6c826           [ 5]     lda LoopCounterLow
584b : 8402             [ 2]     anda #2
584d : 2649             [ 3]     bne zdsNoDraw
584f :                       zdsShipOk:
                             
                               ;DP must be D0
584f : bdf354           [ 8]   jsr reset0ref         ;Reset pen
                             
5852 : bec8bb           [ 6]   ldx Zzap_ShipX
5855 : 10bec8bd         [ 7]   ldy Zzap_ShipY
5859 : bd078c           [ 8]   jsr FxGetScreenCoords
585c : bdf2fc           [ 8]   jsr  move_pen7f_to_d    ;Set pen position to va
                             
                               mSetIntensity $5f
                            >  if 1=1
585f : 865f             [ 2]>    lda   #$5f            ;if argument exists, lo
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
5861 : 9701             [ 4]>  sta   <01
5863 : cc0401           [ 3]>  ldd   #$0401
5866 : 9700             [ 4]>  sta   <00
5868 : d700             [ 4]>  stb   <00
                             
                             
586a : 7dc8b6           [ 7]   tst  Zzap_ShipDir
586d : 2b05             [ 3]   bmi  Zzap_dsSkip1
586f : 8e5512           [ 3]   ldx  #Zzap_ShipLeftVectorList
5872 : 2003             [ 3]   bra  Zzap_dsSkip2
5874 :                       Zzap_dsSkip1:
5874 : 8e5522           [ 3]   ldx  #Zzap_ShipRightVectorList
5877 :                       Zzap_dsSkip2:
                             
5877 : 8604             [ 2]   lda   #4              ;Nr of vectors in list
5879 : c620             [ 2]   ldb   #32             ;Scale
587b : bdf3b7           [ 8]   jsr   move_draw_VL4   ;Draw list
                             
587e : 7dc814           [ 7]   tst stick1_button3
5881 : 2715             [ 3]   beq zdsNoThrust
                                 mRandomToA
5883 : bdf511           [ 8]>  jsr random                    ;call rom
                             
5886 : 847f             [ 2]     anda #127
5888 : 8a20             [ 2]     ora #32
                                 mSetIntensity
                            >  if 0=1
                            >    lda   #            ;if argument exists, load 
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
588a : 9701             [ 4]>  sta   <01
588c : cc0401           [ 3]>  ldd   #$0401
588f : 9700             [ 4]>  sta   <00
5891 : d700             [ 4]>  stb   <00
                             
5893 : 8602             [ 2]     lda #2
5895 : bdf3b9           [ 8]     jsr $F3B9   ;move draw, use current scale
5898 :                       zdsNoThrust:
5898 :                       zdsNoDraw:
5898 : 39               [ 5]   rts
                             
                             
                             
                             ;*****************
5899 :                       Zzap_DrawShipShots:
                               direct -1
                             
5899 : 7fc823           [ 7]   clr $c823     ;set up draw with pattern
                             ;  lda #%10101010
                             ;  sta Pattern
                             
                               ;DP must be D0
                             ;  mSetIntensity $4f
                             
                               ;Draw all active shots.
589c : cec946           [ 3]   ldu #Zzap_ShipShotList
589f : 8604             [ 2]   lda #Zzap_ShipShotCount
58a1 :                       Zzap_dssLoop:
58a1 : 3406             [ 7]   pshs d
                             
58a3 : 6dc4             [ 6]   tst Zzap_ssShotActive,u
58a5 : 2736             [ 3]   beq Zzap_dssNext
                             
                               ;vary pattern and intensity for each shot
58a7 : 8ef00b           [ 3]   ldx #$F00B
58aa : a686             [ 5]   lda a,x
58ac : b7c829           [ 5]   sta Pattern
58af : 847f             [ 2]   anda #127
                               mSetIntensity
                            >  if 0=1
                            >    lda   #            ;if argument exists, load 
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
58b1 : 9701             [ 4]>  sta   <01
58b3 : cc0401           [ 3]>  ldd   #$0401
58b6 : 9700             [ 4]>  sta   <00
58b8 : d700             [ 4]>  stb   <00
                             
                             
58ba : ae44             [ 6]   ldx Zzap_ssShotX,u
58bc : 10ae42           [ 7]   ldy Zzap_ssShotY,u
58bf : bd078c           [ 8]   jsr FxGetScreenCoords
58c2 : 2717             [ 3]   beq Zzap_dssRemove    ;remove if offscreen
                             
58c4 : 3406             [ 7]   pshs d
58c6 : bdf354           [ 8]   jsr reset0ref
58c9 : 3506             [ 7]   puls d
58cb : bdf2fc           [ 8]   jsr move_pen7f_to_d
58ce : e646             [ 5]   ldb Zzap_ssShotLength,u
58d0 : 6d41             [ 7]   tst Zzap_ssShotDir,u
58d2 : 2a01             [ 3]   bpl *+3
58d4 : 50               [ 2]     negb
58d5 : 4f               [ 2]   clra
58d6 : bdf439           [ 8]   jsr $F439 ;draw pattern
                             
58d9 : 2002             [ 3]   bra Zzap_dssNext
                             
58db :                       Zzap_dssRemove:
58db : 6fc4             [ 6]   clr Zzap_ssShotActive,u
                             
58dd :                       Zzap_dssNext:
58dd : 3506             [ 7]   puls d
58df : 3347             [ 5]   leau Zzap_ShipShotEntry,u
58e1 : 4a               [ 2]   deca
58e2 : 26bd             [ 3]   bne Zzap_dssLoop
58e4 : 39               [ 5]   rts
                             
                             
                             ;*****************
58e5 :                       Zzap_UpdateShipShots:
                               direct $c8
                               mDecLocals 2,0,0
                            >  nolist
                             
                             
                               ;Move all active shots.
                               ;Increase length of shots that haven't reached 
                               ;Remove shots that have left screen.
                             
58e7 : cec946           [ 3]   ldu #Zzap_ShipShotList
58ea : 8604             [ 2]   lda #Zzap_ShipShotCount
58ec : a7e4             [ 4]   sta LocalB1,s
58ee :                       Zzap_ussLoop:
58ee : 6dc4             [ 6]   tst Zzap_ssShotActive,u
58f0 : 102700bd         [ 6]   lbeq Zzap_ussNext
                             
                               ;Update x and length
58f4 : c632             [ 2]   ldb #Zzap_ShipShotMaxLength
58f6 : e146             [ 5]   cmpb Zzap_ssShotLength,u
58f8 : 2506             [ 3]   blo Zzap_ussLenMax
58fa : e646             [ 5]     ldb Zzap_ssShotLength,u
58fc : cb10             [ 2]     addb #16
58fe : e746             [ 5]     stb Zzap_ssShotLength,u
5900 :                       Zzap_ussLenMax:
5900 : ae44             [ 6]   ldx Zzap_ssShotX,u
5902 : 8611             [ 2]   lda #17
5904 : 6d41             [ 7]   tst Zzap_ssShotDir,u
5906 : 2b01             [ 3]   bmi *+3
5908 : 40               [ 2]     nega
5909 : 3086             [ 5]   leax a,x
590b : af44             [ 6]   stx Zzap_ssShotX,u
590d :                       zussXFin:
                             
                               ;Collision vs enemies
590d : 0dc3             [ 6]   tst WalkerVisible
590f : 1027009e         [ 6]   lbeq zussSkipWalkers
                             
5913 : 108ec9c6         [ 4]   ldy #ZzapConfig
                               ;  mPointVsRect HeadW,HeadH,zussWalkerHeadMiss,
5917 : ae44             [ 6]   ldx     Zzap_ssShotX,u
5919 : fcc9be           [ 6]   ldd     VisibleHeadX
591c : 830010           [ 4]   subd    #HeadW/2
591f : ed7e             [ 6]   std -2,s
5921 : ac7e             [ 7]   cmpx -2,s
5923 : 2d2c             [ 3]   blt    zussWalkerHeadMiss
5925 : c30020           [ 4]   addd    #HeadW
5928 : ed7e             [ 6]   std -2,s
592a : ac7e             [ 7]   cmpx -2,s
592c : 2e23             [ 3]   bgt    zussWalkerHeadMiss
592e : ae42             [ 6]   ldx     Zzap_ssShotY,u
5930 : fcc9c0           [ 6]   ldd     VisibleHeadY
5933 : e027             [ 5]   subb    zcHalfHeadH,y
5935 : ed7e             [ 6]   std -2,s
5937 : ac7e             [ 7]   cmpx -2,s
5939 : 2d16             [ 3]   blt    zussWalkerHeadMiss
593b : eb26             [ 5]   addb    zcHeadH,y
593d : ed7e             [ 6]   std -2,s
593f : ac7e             [ 7]   cmpx -2,s
5941 : 2e0e             [ 3]   bgt    zussWalkerHeadMiss
                             
                             
                               ;walker has been hit by head-shot
                                 mEmitSound WarpOutSoundId
                            >  if 1=1
5943 : 861d             [ 2]>    lda #WarpOutSoundId
                            >  endif
5945 : bd0476           [ 8]>  jsr EmitSound
                             
                                 mGiveScore 30
5948 : 8603             [ 2]>  lda #30 / 10
594a : bd1acf           [ 8]>  jsr GiveScoreA
                             
594d : 86fb             [ 2]     lda #-5
594f : 2039             [ 3]     bra zussWalkerTakeDamage
5951 :                       zussWalkerHeadMiss:
                             
5951 : 108ec9c2         [ 4]   ldy #VisibleBaseX
                               mPointVsRect WalkerBaseW,WalkerBaseH,zussWalker
5955 : ae44             [ 6]>  ldx     Zzap_ssShotX,u
5957 : eca4             [ 5]>  ldd      0,y
5959 : 83002a           [ 4]>  subd    #WalkerBaseW/2
595c : ed7e             [ 6]>  std -2,s
595e : ac7e             [ 7]>  cmpx -2,s
5960 : 2d4f             [ 3]>  blt    zussWalkerBaseMiss
5962 : c30054           [ 4]>  addd    #WalkerBaseW
5965 : ed7e             [ 6]>  std -2,s
5967 : ac7e             [ 7]>  cmpx -2,s
5969 : 2e46             [ 3]>  bgt    zussWalkerBaseMiss
596b : ae42             [ 6]>  ldx     Zzap_ssShotY,u
596d : ec22             [ 6]>  ldd     2,y
596f : 830018           [ 4]>  subd    #WalkerBaseH/2
5972 : ed7e             [ 6]>  std -2,s
5974 : ac7e             [ 7]>  cmpx -2,s
5976 : 2d39             [ 3]>  blt    zussWalkerBaseMiss
5978 : c30030           [ 4]>  addd    #WalkerBaseH
597b : ed7e             [ 6]>  std -2,s
597d : ac7e             [ 7]>  cmpx -2,s
597f : 2e30             [ 3]>  bgt    zussWalkerBaseMiss
                             
                                 mGiveScore 10
5981 : 8601             [ 2]>  lda #10 / 10
5983 : bd1acf           [ 8]>  jsr GiveScoreA
                             
5986 : 86ff             [ 2]     lda #-1
5988 : 2000             [ 3]     bra zussWalkerTakeDamage
                             
598a :                       zussWalkerTakeDamage:
598a : 9ec3             [ 5]   ldx WalkerVisible
598c : ab01             [ 5]   adda weWalkerLife,x
598e : a701             [ 5]   sta weWalkerLife,x
5990 : 2a1d             [ 3]   bpl zussWalkerAlive
                             ;    lda #1
                             ;    sta weWalkerActive,x        ;start death ani
5992 : 6084             [ 6]     neg weWalkerActive,x        ;-1 becomes 1, st
5994 : f6c9bd           [ 5]     ldb WalkerVisibleI
                                 mEmitFx FxTargetWalker,FxTypeDotShatter,b
                            >  if ('b'!='0') && ('b'!='b')
                            >    tfr b,b
                            >  endif
5997 : 8606             [ 2]>  lda #FxTargetWalker | (FxTypeDotShatter<<4)
5999 : bd06bb           [ 8]>  jsr EmitFx
                             
                                 mGiveScore 100
599c : 860a             [ 2]>  lda #100 / 10
599e : bd1acf           [ 8]>  jsr GiveScoreA
                             
                                 mEmitSound WalkerDestroyedSoundId
                            >  if 1=1
59a1 : 863a             [ 2]>    lda #WalkerDestroyedSoundId
                            >  endif
59a3 : bd0476           [ 8]>  jsr EmitSound
                             
59a6 : 0cd1             [ 6]     inc ZzapLevel
59a8 : 3440             [ 7]     pshs u  ;SetDifficulty overwrites U
59aa : bd564e           [ 8]     jsr SetDifficulty
59ad : 3540             [ 7]     puls u
59af :                       zussWalkerAlive:
                             
                               ;Remove shot
59af : 6fc4             [ 6]   clr Zzap_ssShotActive,u
                             
59b1 :                       zussWalkerBaseMiss:
                             
59b1 :                       zussSkipWalkers:
                             
59b1 :                       Zzap_ussNext:
59b1 : 3347             [ 5]   leau Zzap_ShipShotEntry,u
59b3 : 6ae4             [ 6]   dec LocalB1,s
59b5 : 1026ff35         [ 6]   bne Zzap_ussLoop
                             
                               mFreeLocals
59b9 : 3262             [ 5]>  leas FrameSize,s
                             
59bb : 39               [ 5]   rts
                             
                             
                             
                             
                             ;*****************
59bc :                       Zzap_ControlShip:
                               direct $c8
                             
                               mTestFlag InactiveFlag
                            >  if 255>InactiveFlag
59bc : 96e5             [ 4]>    lda GameFlags1
59be : 8510             [ 2]>    bita #InactiveFlag
                            >  else
                            >    lda GameFlags2
                            >    bita #(InactiveFlag)>>8
                            >  endif
                             
59c0 : 2701             [ 3]   beq *+3
59c2 : 39               [ 5]     rts
                             
                             ;  mDecLocals 0,0,0
                             
                               ;Read input from joystick.
                               ;Update ship velocity values and move ship.
                               ;Emit new shot if fired.
                             
                               ;DP must be D0
59c3 : 3408             [ 6]   pshs dp
                               mDptoD0
59c5 : 86d0             [ 2]>  lda   #0xD0
59c7 : 1f8b             [ 6]>  tfr   a,dp
                            >  direct -1
                             
59c9 : bdf1f8           [ 8]   jsr read_joystick
59cc : 860a             [ 2]   lda #$8 + 2
59ce : bdf1b4           [ 8]   jsr read_switches
59d1 : 3508             [ 6]   puls dp
                               direct $c8
                             
0004 =                       ZzapShipMaxY=4
59d3 : d6b9             [ 4]   ldb Zzap_ShipVelocY
59d5 : 0d1c             [ 6]   tst $c81c
59d7 : 2710             [ 3]   beq Zzap_csUDMoveCentered
59d9 : 2d07             [ 3]   blt Zzap_csMoveDown
                               ;MoveUp
59db : c1fc             [ 2]     cmpb #-ZzapShipMaxY
59dd : 2f12             [ 3]     ble Zzap_csUDApplyVeloc
                             ;    decb
59df : 5a               [ 2]     decb
59e0 : 200f             [ 3]     bra Zzap_csUDApplyVeloc
59e2 :                       Zzap_csMoveDown:
59e2 : c104             [ 2]     cmpb #ZzapShipMaxY
59e4 : 2c0b             [ 3]     bge Zzap_csUDApplyVeloc
                             ;    incb
59e6 : 5c               [ 2]     incb
59e7 : 2008             [ 3]     bra Zzap_csUDApplyVeloc
59e9 :                       Zzap_csUDMoveCentered:
                                 ;dampen when centered
59e9 : 5d               [ 2]    tstb
59ea : 2705             [ 3]    beq Zzap_csUDApplyVeloc
59ec : 2a02             [ 3]    bpl *+4
59ee : 5c               [ 2]      incb
59ef : 86                         db $86 ;eat next byte
59f0 : 5a               [ 2]      decb
59f1 :                       Zzap_csUDApplyVeloc:
59f1 : d7b9             [ 4]   stb Zzap_ShipVelocY
                             ;  asrb
                             ;  asrb
                             ;  asrb
59f3 : 1d               [ 2]   sex
59f4 : d3bd             [ 6]   addd Zzap_ShipY
59f6 : 1083ff88         [ 5]   cmpd #ZzapWorldTopY+(ZzapShipH/2)
59fa : 2c07             [ 3]   bge Zzap_csTestFloor
59fc : 0fb9             [ 6]     clr Zzap_ShipVelocY
59fe : ccff88           [ 3]     ldd #ZzapWorldTopY+(ZzapShipH/2)
5a01 : 200b             [ 3]     bra Zzap_csStoreY
5a03 :                       Zzap_csTestFloor:
5a03 : 108300f7         [ 5]   cmpd #ZzapWorldEndY-(ZzapShipH/2)
5a07 : 2f05             [ 3]   ble Zzap_csStoreY
5a09 : 0fb9             [ 6]     clr Zzap_ShipVelocY
5a0b : cc00f7           [ 3]     ldd #ZzapWorldEndY-(ZzapShipH/2)
5a0e :                       Zzap_csStoreY:
5a0e : ddbd             [ 5]   std Zzap_ShipY
                             
5a10 : 8ec8c8           [ 3]   ldx #ViewY
5a13 : 10a384           [ 7]   cmpd ,x
5a16 : 2e04             [ 3]   bgt Zzap_csViewTopOk
5a18 : ed84             [ 5]     std ,x
5a1a : 200a             [ 3]     bra Zzap_csViewYFin
5a1c :                       Zzap_csViewTopOk:
5a1c : 8300ff           [ 4]   subd #255
5a1f : 10a384           [ 7]   cmpd ,x
5a22 : 2f02             [ 3]   ble Zzap_csViewYFin
5a24 : ed84             [ 5]     std ,x
5a26 :                       Zzap_csViewYFin:
                             
                               ;inc Zzap_ShipVelocY ;todo more gravity?
                             
                             ; lda LoopCounterLow
                             ; anda #1
                             ; beq Zzap_csLRMoveFinished
                             
0030 =                       ZzapShipMaxX=48
                             
5a26 : 0d14             [ 6]   tst stick1_button3
5a28 : 2721             [ 3]   beq Zzap_csLRMoveCentered
5a2a : 8602             [ 2]   lda #2
5a2c : c630             [ 2]   ldb #ZzapShipMaxX
5a2e : 0db6             [ 6]   tst Zzap_ShipDir
5a30 : 2b02             [ 3]   bmi *+4
5a32 : 40               [ 2]     nega
5a33 : 50               [ 2]     negb
5a34 : 9bb7             [ 4]   adda Zzap_ShipVelocX
5a36 : 8130             [ 2]   cmpa #ZzapShipMaxX
5a38 : 2f02             [ 3]   ble *+4
5a3a : 1f98             [ 6]     tfr b,a
5a3c : 81d0             [ 2]   cmpa #-ZzapShipMaxX
5a3e : 2c02             [ 3]   bge *+4
5a40 : 1f98             [ 6]     tfr b,a
5a42 :                       zcsLRMoveStore:
                             ;    stb Zzap_ShipDir
5a42 : 97b7             [ 4]     sta Zzap_ShipVelocX
                                 mEmitSound ThrustSoundId
                            >  if 1=1
5a44 : 8606             [ 2]>    lda #ThrustSoundId
                            >  endif
5a46 : bd0476           [ 8]>  jsr EmitSound
                             
5a49 : 200b             [ 3]     bra Zzap_csLRMoveFinished
5a4b :                       Zzap_csLRMoveCentered:
5a4b : 96b7             [ 4]   lda Zzap_ShipVelocX  ;dampen veloc x
5a4d : 2707             [ 3]   beq Zzap_csLRMoveFinished
5a4f : 2a02             [ 3]   bpl *+4
5a51 : 4c               [ 2]     inca
5a52 : c6                        db $c6 ;eat next byte
5a53 : 4a               [ 2]     deca
5a54 : 97b7             [ 4]   sta Zzap_ShipVelocX
5a56 :                       Zzap_csLRMoveFinished:
                             
5a56 : 0d13             [ 6]   tst stick1_button2
5a58 : 2702             [ 3]   beq zcsNoFlip
5a5a : 00b6             [ 6]     neg Zzap_ShipDir
5a5c :                       zcsNoFlip:
                             
5a5c : 0d15             [ 6]   tst stick1_button4
5a5e : 2727             [ 3]   beq Zzap_csFireFinish
                                 ;Find free
5a60 : cec946           [ 3]     ldu #Zzap_ShipShotList
5a63 : 8604             [ 2]     lda #Zzap_ShipShotCount
5a65 :                       Zzap_csFire1:
5a65 : 6dc4             [ 6]     tst Zzap_ssShotActive,u
5a67 : 2707             [ 3]     beq Zzap_csFreeFound
5a69 : 3347             [ 5]     leau Zzap_ShipShotEntry,u
5a6b : 4a               [ 2]     deca
5a6c : 26f7             [ 3]     bne Zzap_csFire1
5a6e : 2017             [ 3]     bra Zzap_csFireFinish  ;No free found
5a70 :                       Zzap_csFreeFound:
                                 ;lda #1
5a70 : 63c4             [ 6]     com Zzap_ssShotActive,u
5a72 : 96b6             [ 4]     lda Zzap_ShipDir
5a74 : a741             [ 5]     sta Zzap_ssShotDir,u
5a76 : 9ebb             [ 5]     ldx Zzap_ShipX
5a78 : af44             [ 6]     stx Zzap_ssShotX,u
5a7a : 9ebd             [ 5]     ldx Zzap_ShipY
5a7c : 3006             [ 5]     leax 6,x
5a7e : af42             [ 6]     stx Zzap_ssShotY,u
5a80 : 6f46             [ 7]     clr Zzap_ssShotLength,u
                             ;    mEmitSound WalkerDestroyedSoundId
                                 mEmitSound ShipFireSoundId
                            >  if 1=1
5a82 : 860c             [ 2]>    lda #ShipFireSoundId
                            >  endif
5a84 : bd0476           [ 8]>  jsr EmitSound
                             
5a87 :                       Zzap_csFireFinish:
                             
5a87 : 96b7             [ 4]   lda Zzap_ShipVelocX
5a89 : 47               [ 2]   asra
5a8a : 47               [ 2]   asra
                             
                               ;Move ship X
5a8b : 9ebb             [ 5]   ldx Zzap_ShipX
5a8d : 3086             [ 5]   leax a,x
                             
5a8f : 8c20ce           [ 4]   cmpx #ZzapWorldEndX-(ZzShipWidth/2)
5a92 : 2d03             [ 3]   blt *+5
5a94 : 8e20ce           [ 3]     ldx #ZzapWorldEndX-(ZzShipWidth/2)
5a97 : 8c0132           [ 4]   cmpx #ZzapWorldStartX+(ZzShipWidth/2)
5a9a : 2e03             [ 3]   bgt *+5
5a9c : 8e0132           [ 3]     ldx #ZzapWorldStartX+(ZzShipWidth/2)
                             
5a9f : 9fbb             [ 5]   stx Zzap_ShipX
                             
                               ;Update view coordinate
                               ;Add ship velocity and test for world ends
5aa1 : 9ec6             [ 5]   ldx Zzap_LeftOffsetX
5aa3 : 3086             [ 5]   leax a,x
5aa5 : 8c2000           [ 4]   cmpx #ZzapWorldEndX-256
5aa8 : 2d03             [ 3]   blt *+5
5aaa : 8e2000           [ 3]     ldx #ZzapWorldEndX-256
5aad : 8c0100           [ 4]   cmpx #ZzapWorldStartX
5ab0 : 2e03             [ 3]   bgt *+5
5ab2 : 8e0100           [ 3]     ldx #ZzapWorldStartX
                             
                               ;slide viewx to left or right edge depending on
5ab5 : debb             [ 5]   ldu Zzap_ShipX
5ab7 : 96b7             [ 4]   lda Zzap_ShipVelocX
5ab9 : 40               [ 2]   nega
5aba : 33c6             [ 5]   leau a,u
5abc : af7e             [ 6]   stx -2,s
5abe : 0db6             [ 6]   tst Zzap_ShipDir
5ac0 : 2a0c             [ 3]   bpl zcsSlideLeft
5ac2 : 33c8c0           [ 5]     leau -64,u
5ac5 : 11a37e           [ 8]     cmpu -2,s
5ac8 : 2f11             [ 3]     ble zcsSlideMax
5aca : 3002             [ 5]       leax 2,x
5acc : 200f             [ 3]       bra zcsSlideStoreX
5ace :                       zcsSlideLeft:
5ace : 33c9ff20         [ 8]     leau -(256-32),u
5ad2 : 11a37e           [ 8]     cmpu -2,s
5ad5 : 2c04             [ 3]     bge zcsSlideMax
5ad7 : 301e             [ 5]       leax -2,x
5ad9 : 2002             [ 3]       bra zcsSlideStoreX
5adb :                       zcsSlideMax:
5adb : 1f31             [ 6]   tfr u,x
5add :                       zcsSlideStoreX:
5add : 9fc6             [ 5]   stx Zzap_LeftOffsetX
                             
5adf : 8d6e             [ 7]   bsr ZzapUpdateClipView
                             
                               ;Collision ship vs walkers
5ae1 : 0dc3             [ 6]   tst WalkerVisible
5ae3 : 2769             [ 3]   beq zcsWalkerFinish
5ae5 : cec8bb           [ 3]     ldu #ShipX
5ae8 : 108ec9c6         [ 4]     ldy #ZzapConfig
                             ;    mPointVsRect HeadW,HeadH,zcsWalkerHeadMiss,0
5aec : aec4             [ 5]     ldx     0,u
5aee : fcc9be           [ 6]     ldd     VisibleHeadX
5af1 : 830010           [ 4]     subd    #HeadW/2
5af4 : ed7e             [ 6]     std -2,s
5af6 : ac7e             [ 7]     cmpx -2,s
5af8 : 2d22             [ 3]     blt    zcsWalkerHeadMiss
5afa : c30020           [ 4]     addd    #HeadW
5afd : ed7e             [ 6]     std -2,s
5aff : ac7e             [ 7]     cmpx -2,s
5b01 : 2e19             [ 3]     bgt    zcsWalkerHeadMiss
5b03 : ae42             [ 6]     ldx     2,u
5b05 : fcc9c0           [ 6]     ldd     VisibleHeadY
5b08 : e027             [ 5]     subb    zcHalfHeadH,y
5b0a : ed7e             [ 6]     std -2,s
5b0c : ac7e             [ 7]     cmpx -2,s
5b0e : 2d0c             [ 3]     blt    zcsWalkerHeadMiss
5b10 : eb26             [ 5]     addb    zcHeadH,y
5b12 : ed7e             [ 6]     std -2,s
5b14 : ac7e             [ 7]     cmpx -2,s
5b16 : 2e04             [ 3]     bgt    zcsWalkerHeadMiss
5b18 : 8d51             [ 7]       bsr ZzapShipTakeDamage
5b1a : 2032             [ 3]       bra zcsWalkerFinish
5b1c :                       zcsWalkerHeadMiss:
5b1c : 108ec9c2         [ 4]     ldy #VisibleBaseX
                                 mPointVsRect WalkerBaseW,WalkerBaseH,zcsWalke
5b20 : aec4             [ 5]>  ldx     0,u
5b22 : eca4             [ 5]>  ldd      0,y
5b24 : 83002a           [ 4]>  subd    #WalkerBaseW/2
5b27 : ed7e             [ 6]>  std -2,s
5b29 : ac7e             [ 7]>  cmpx -2,s
5b2b : 2d21             [ 3]>  blt    zcsWalkerFinish
5b2d : c30054           [ 4]>  addd    #WalkerBaseW
5b30 : ed7e             [ 6]>  std -2,s
5b32 : ac7e             [ 7]>  cmpx -2,s
5b34 : 2e18             [ 3]>  bgt    zcsWalkerFinish
5b36 : ae42             [ 6]>  ldx     2,u
5b38 : ec22             [ 6]>  ldd     2,y
5b3a : 830018           [ 4]>  subd    #WalkerBaseH/2
5b3d : ed7e             [ 6]>  std -2,s
5b3f : ac7e             [ 7]>  cmpx -2,s
5b41 : 2d0b             [ 3]>  blt    zcsWalkerFinish
5b43 : c30030           [ 4]>  addd    #WalkerBaseH
5b46 : ed7e             [ 6]>  std -2,s
5b48 : ac7e             [ 7]>  cmpx -2,s
5b4a : 2e02             [ 3]>  bgt    zcsWalkerFinish
                             
5b4c : 8d1d             [ 7]       bsr ZzapShipTakeDamage
5b4e :                       zcsWalkerFinish:
                             
                             ;  mFreeLocals
                               direct -1
5b4e : 39               [ 5]   rts
                             
5b4f :                       ZzapUpdateClipView:
                               ;Update clip-region used by drawenemies
                               direct $c8
5b4f : c6ff             [ 2]   ldb #255
5b51 : 9ec6             [ 5]   ldx ViewX
5b53 : cec8d2           [ 3]   ldu #_clip_xmin
5b56 : afc4             [ 5]   stx ,u
5b58 : 3a               [ 3]   abx
5b59 : af44             [ 6]   stx 4,u
5b5b : 9ec8             [ 5]   ldx ViewY
5b5d : af42             [ 6]   stx 2,u
5b5f : 3a               [ 3]   abx
                               ;clip walkers at floor level, makes their death
5b60 : 8c00df           [ 4]   cmpx #WalkerFloorY
5b63 : 2f03             [ 3]   ble *+5
5b65 : 8e00df           [ 3]     ldx #WalkerFloorY
5b68 : af46             [ 6]   stx 6,u
                               direct -1
5b6a : 39               [ 5]   rts
                             
                             ;*****************
5b6b :                       ZzapShipTakeDamage:
                               direct $c8
                             
5b6b : 0df2             [ 6]   tst ZzapShipTookDamage        ;skip if already 
5b6d : 2619             [ 3]   bne zstNotGameOver
                             
5b6f : 8632             [ 2]   lda #50
5b71 : 00b6             [ 6]   neg Zzap_ShipDir
5b73 : 2b01             [ 3]   bmi *+3
5b75 : 40               [ 2]     nega
5b76 : 97b7             [ 4]   sta Zzap_ShipVelocX
                             
                               mEmitSound ExplosionSoundId
                            >  if 1=1
5b78 : 8621             [ 2]>    lda #ExplosionSoundId
                            >  endif
5b7a : bd0476           [ 8]>  jsr EmitSound
                             
                               mSetByte ZzapShipTookDamage,255
                            > if 0=255
                            >   clr ZzapShipTookDamage
                            > else
5b7d : 86ff             [ 2]>   lda #255
5b7f : 97f2             [ 4]>   sta ZzapShipTookDamage
                            > endif
                             
5b81 : 0ae0             [ 6]   dec ZzapShipLives
5b83 : 2603             [ 3]   bne zstNotGameOver
5b85 : bd2af7           [ 8]     jsr ExplodeShip
5b88 :                       zstNotGameOver:
                               direct -1
5b88 : 39               [ 5]   rts
                             
                             ;*****************
5b89 :                       Zzap_DrawMountain:
                               ;Draw background mountain.
                               ;The mountain is drawn twice at different heigh
                               mDecLocals 2,0,0
                            >  nolist
                             
0001 =                       LocalOffset = LocalB2
                             
                               ;DP must be D0
                               mSetIntensity $3f
                            >  if 1=1
5b8b : 863f             [ 2]>    lda   #$3f            ;if argument exists, lo
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
5b8d : 9701             [ 4]>  sta   <01
5b8f : cc0401           [ 3]>  ldd   #$0401
5b92 : 9700             [ 4]>  sta   <00
5b94 : d700             [ 4]>  stb   <00
                             
                             
                               ;Calc start in ycoord table.
5b96 : 108e54f2         [ 4]   ldy  #Zzap_MountainYCoords
                             
5b9a : b6c8c7           [ 5]   lda  Zzap_LeftOffsetX+1
5b9d : 44               [ 2]   lsra
5b9e : 44               [ 2]   lsra
5b9f : 44               [ 2]   lsra
5ba0 : 44               [ 2]   lsra
5ba1 : 840f             [ 2]   anda #15
5ba3 : a761             [ 5]   sta LocalOffset,s
                             
5ba5 : 8e5502           [ 3]   ldx  #Zzap_MountainABSYCoords
5ba8 : a686             [ 5]   lda  a,x
5baa : f6c8c9           [ 5]   ldb ViewY+1
                             ;  asrb
                             ;  asrb
5bad : 57               [ 2]   asrb
5bae : e77f             [ 5]   stb -1,s
5bb0 : ab7f             [ 5]   adda -1,s
5bb2 : 8b14             [ 2]   adda #20
                             
5bb4 : f6c8c7           [ 5]   ldb  Zzap_LeftOffsetX+1
5bb7 : c40f             [ 2]   andb #15
5bb9 : 50               [ 2]   negb
5bba : c06f             [ 2]   subb #111
5bbc : bdf2fc           [ 8]   jsr  move_pen7f_to_d
                             
5bbf : 8610             [ 2]   lda  #16    ;Nr of segments to draw
5bc1 : a7e4             [ 4]   sta LocalB1,s
5bc3 : a661             [ 5]   lda LocalOffset,s
5bc5 :                       Zzap_dmLoop1:
5bc5 : 3402             [ 6]   pshs a
5bc7 : c610             [ 2]   ldb  #16    ;X increment
5bc9 : a6a6             [ 5]   lda  a,y
                               mDrawToD
5bcb : 9701             [ 4]>  sta   <$01
5bcd : 0f00             [ 6]>  clr   <$00
                            >;  leax  2,x
                            >  ;Ev. måste flera nop läggas till här för att ko
                            >  ;kommenterats bort
                            >;  nop
5bcf : 0c00             [ 6]>  inc   <$00
5bd1 : d701             [ 4]>  stb   <$01
5bd3 : ccff00           [ 3]>  ldd   #$FF00
5bd6 : 970a             [ 4]>  sta   <$0A
5bd8 : d705             [ 4]>  stb   <$05
5bda : 8640             [ 2]>  lda   #$40
5bdc :                      >wait11403:
5bdc : 950d             [ 4]>  bita  <$0D
5bde : 27fc             [ 3]>  beq   wait11403
                            >;  nop
5be0 : d70a             [ 4]>  stb   <$0A
                             
5be2 : 3502             [ 6]   puls a
5be4 : 4c               [ 2]   inca
5be5 : 840f             [ 2]   anda #15      ;keep index within table-size
5be7 : 6ae4             [ 6]   dec LocalB1,s
5be9 : 26da             [ 3]   bne Zzap_dmLoop1
                             
                               ;****
                             
                             
                             
                             
5beb : bdf354           [ 8]   jsr   reset0ref             ;Reset pen
                               mSetIntensity $10
                            >  if 1=1
5bee : 8610             [ 2]>    lda   #$10            ;if argument exists, lo
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
5bf0 : 9701             [ 4]>  sta   <01
5bf2 : cc0401           [ 3]>  ldd   #$0401
5bf5 : 9700             [ 4]>  sta   <00
5bf7 : d700             [ 4]>  stb   <00
                             
                             
5bf9 : a661             [ 5]   lda LocalOffset,s
5bfb : 8e5502           [ 3]   ldx  #Zzap_MountainABSYCoords
5bfe : a686             [ 5]   lda  a,x
5c00 : f6c8c9           [ 5]   ldb ViewY+1
                             ;  asrb
                             ;  asrb
                             ;  asrb
5c03 : 57               [ 2]   asrb
5c04 : e77f             [ 5]   stb -1,s
5c06 : ab7f             [ 5]   adda -1,s
5c08 : 8b50             [ 2]   adda #80
                             
5c0a : f6c8c7           [ 5]   ldb  Zzap_LeftOffsetX+1
5c0d : c40f             [ 2]   andb #15
5c0f : 54               [ 2]   lsrb
5c10 : 50               [ 2]   negb
5c11 : c06f             [ 2]   subb #111
5c13 : bdf2fc           [ 8]   jsr  move_pen7f_to_d
                             
                             ;  mSetScale $3f
                             
5c16 : 8620             [ 2]   lda  #32    ;Nr of segments to draw
5c18 : a7e4             [ 4]   sta LocalB1,s
5c1a : a661             [ 5]   lda LocalOffset,s
5c1c :                       Zzap_dmLoop11:
5c1c : 3402             [ 6]   pshs a
5c1e : a6a6             [ 5]   lda  a,y
5c20 : c608             [ 2]   ldb  #8     ;X increment
                               mDrawToD
5c22 : 9701             [ 4]>  sta   <$01
5c24 : 0f00             [ 6]>  clr   <$00
                            >;  leax  2,x
                            >  ;Ev. måste flera nop läggas till här för att ko
                            >  ;kommenterats bort
                            >;  nop
5c26 : 0c00             [ 6]>  inc   <$00
5c28 : d701             [ 4]>  stb   <$01
5c2a : ccff00           [ 3]>  ldd   #$FF00
5c2d : 970a             [ 4]>  sta   <$0A
5c2f : d705             [ 4]>  stb   <$05
5c31 : 8640             [ 2]>  lda   #$40
5c33 :                      >wait11405:
5c33 : 950d             [ 4]>  bita  <$0D
5c35 : 27fc             [ 3]>  beq   wait11405
                            >;  nop
5c37 : d70a             [ 4]>  stb   <$0A
                             
5c39 : 3502             [ 6]   puls a
5c3b : 4c               [ 2]   inca
5c3c : 840f             [ 2]   anda #15      ;keep index within table-size
5c3e : 6ae4             [ 6]   dec LocalB1,s
5c40 : 26da             [ 3]   bne Zzap_dmLoop11
                             
                               mFreeLocals
5c42 : 3262             [ 5]>  leas FrameSize,s
                             
5c44 : 39               [ 5]   rts
                             
                             
                             
                             ;*****************
5c45 :                       UpdateWalkers:
                               direct $c8
                               mDecLocals 2,2,0
                            >  nolist
                             
0001 =                       LocalJumpY = LocalB2
0002 =                       LocalFree = LocalW1
0004 =                       LocalMinX = LocalW2
                             
                             ;   loop walkers
                             ;     move right
                             ;     game over if reached right edge
                             ;     keep track of walker with lowest x
                             ;   if lowest x<threshold
                             ;     emit new walker at left edge
                             
                             
5c47 : 108ec9c6         [ 4]   ldy #ZzapConfig
                             
                             ;  lda zcWalkerSpeedMask,y
                             ;  anda FrameCounter
                             ;  bne zuwNoPulse
                             ;  lda LoopCounterLow
                             ;  anda #7
                             ;  bne zuwNoPulse
                             ;    mEmitSound GunFireSoundId
                             ;zuwNoPulse:
                             
5c4b : a624             [ 5]   lda zcJumping,y
5c4d : 2b1f             [ 3]   bmi zuwNoJumping
5c4f : 1f89             [ 6]     tfr a,b
5c51 : 4c               [ 2]     inca
5c52 : 8140             [ 2]     cmpa #64
5c54 : 2602             [ 3]     bne *+4
5c56 : 86ff             [ 2]       lda #-1
5c58 : a724             [ 5]     sta zcJumping,y
5c5a : 8e6d2c           [ 3]     ldx #SineTable
5c5d : e685             [ 5]     ldb b,x
5c5f : 57               [ 2]     asrb
5c60 : 57               [ 2]     asrb
                             
5c61 : a625             [ 5]     lda zcJumpScale,y
5c63 : 3d               [11]     mul
                             
5c64 : 50               [ 2]     negb
                             
5c65 : e761             [ 5]     stb LocalJumpY,s
                                 mEmitSound WalkerBounceSoundId
                            >  if 1=1
5c67 : 8615             [ 2]>    lda #WalkerBounceSoundId
                            >  endif
5c69 : bd0476           [ 8]>  jsr EmitSound
                             
5c6c : 2016             [ 3]     bra zuwJumpFin
5c6e :                       zuwNoJumping:
5c6e : 6f61             [ 7]     clr LocalJumpY,s
5c70 : a623             [ 5]     lda zcJumpDelay,y
5c72 : 2710             [ 3]     beq zuwJumpFin
5c74 : 94e4             [ 4]     anda FrameCounter
5c76 : 260c             [ 3]     bne zuwJumpFin
                                   mRandomToA
5c78 : bdf511           [ 8]>  jsr random                    ;call rom
                             
5c7b : 8407             [ 2]       anda #7
5c7d : 2705             [ 3]       beq zuwJumpFin
                                   ;Range: 1..8
5c7f : 4c               [ 2]       inca
5c80 : a725             [ 5]       sta zcJumpScale,y
5c82 : 6f24             [ 7]       clr zcJumping,y
5c84 :                       zuwJumpFin:
                             
5c84 : 6f62             [ 7]   clr LocalFree,s
5c86 : 867f             [ 2]   lda #$7F      ;high signed value
5c88 : a764             [ 5]   sta LocalMinX,s
                             
5c8a : cec962           [ 3]   ldu #WalkerList
5c8d : 8608             [ 2]   lda #WalkerCount
5c8f : a7e4             [ 4]   sta LocalB1,s
5c91 :                       zuwLoop:
5c91 : a6c4             [ 4]   lda weWalkerActive,u
5c93 : 2737             [ 3]   beq zuwInactive
5c95 : 2b0f             [ 3]   bmi zuwNotDying
5c97 : ae44             [ 6]     ldx weWalkerY,u
5c99 : 3002             [ 5]     leax 2,x
5c9b : af44             [ 6]     stx weWalkerY,u
5c9d : 8c010f           [ 4]     cmpx #WalkerFloorY + (WalkerHeight/2)       ;
5ca0 : 2f02             [ 3]     ble *+4
5ca2 : 6fc4             [ 6]       clr weWalkerActive,u
5ca4 : 2028             [ 3]     bra zuwNext
5ca6 :                       zuwNotDying:
                             
                               ;Move X-coord
5ca6 : ae42             [ 6]   ldx weWalkerX,u
                             
5ca8 : a622             [ 5]   lda zcWalkerSpeedMask,y
5caa : 94e4             [ 4]   anda FrameCounter
5cac : 260d             [ 3]   bne zuwDontWalk
                             
5cae : 3003             [ 5]   leax 3,x
5cb0 : af42             [ 6]   stx weWalkerX,u
5cb2 : 8c2046           [ 4]   cmpx #BaseX - WalkerWidth/2
5cb5 : 2504             [ 3]   blo zuwNotReachedBase
5cb7 : 8d31             [ 7]     bsr WalkerHitBase
5cb9 : 202c             [ 3]     bra zuwExit
5cbb :                       zuwNotReachedBase:
                             
5cbb :                       zuwDontWalk:
                             
5cbb : ac64             [ 7]   cmpx LocalMinX,s
5cbd : 2c02             [ 3]   bge zuwNotLowest
5cbf : af64             [ 6]     stx LocalMinX,s
5cc1 :                       zuwNotLowest:
                             
                             
                               ;Update Y
5cc1 : e661             [ 5]   ldb LocalJumpY,s
5cc3 : 8e00af           [ 3]   ldx #WalkerFloorY - (WalkerHeight/2)
5cc6 : 3085             [ 5]   leax b,x
5cc8 : af44             [ 6]   stx weWalkerY,u
                             
5cca : 2002             [ 3]   bra zuwNext
                             
5ccc :                       zuwInactive:
5ccc : ef62             [ 6]   stu LocalFree,s
                             
5cce :                       zuwNext:
5cce : 3347             [ 5]   leau WalkerEntry,u
5cd0 : 6ae4             [ 6]   dec LocalB1,s
5cd2 : 26bd             [ 3]   bne zuwLoop
                             
                               ;emit new if free and minx<threshold
5cd4 : 6d62             [ 7]   tst LocalFree,s
5cd6 : 270f             [ 3]   beq zuwNoEmit
5cd8 : ae64             [ 6]   ldx LocalMinX,s
5cda : 8c037a           [ 4]   cmpx #ZzapWorldStartX-WalkerWidth+WalkerDistanc
5cdd : 2f08             [ 3]   ble zuwNoEmit
5cdf : ee62             [ 6]     ldu LocalFree,s
5ce1 : 8e008c           [ 3]     ldx #ZzapWorldStartX-WalkerWidth
5ce4 : bd5824           [ 8]     jsr InitOneWalker
5ce7 :                       zuwNoEmit:
                             
5ce7 :                       zuwExit:
                             
                               mFreeLocals
5ce7 : 3266             [ 5]>  leas FrameSize,s
                             
                               direct -1
5ce9 : 39               [ 5]   rts
                             
5cea :                       WalkerHitBase:
                               direct $c8
5cea : 8664             [ 2]   lda #100
5cec : 340a             [ 7]   pshs a,dp
5cee : cc2000           [ 3]   ldd #BaseX - 128
5cf1 : ddc6             [ 5]   std ViewX
5cf3 : ccffe0           [ 3]   ldd #WalkerFloorY-255
5cf6 : ddc8             [ 5]   std ViewY
5cf8 : bd5b4f           [ 8]   bsr ZzapUpdateClipView
                               mEmitSound PlanetExplodeSoundId
                            >  if 1=1
5cfb : 8631             [ 2]>    lda #PlanetExplodeSoundId
                            >  endif
5cfd : bd0476           [ 8]>  jsr EmitSound
                             
                               mSetFlag GameOverFlag
                            >  if 255>GameOverFlag
5d00 : 8640             [ 2]>    lda #GameOverFlag
5d02 : 9ae5             [ 4]>    ora GameFlags1
5d04 : 97e5             [ 4]>    sta GameFlags1
                            >  else
                            >    lda #(GameOverFlag)>>8
                            >    ora GameFlags2
                            >    sta GameFlags2
                            >  endif
                             
5d06 :                       whsMainLoop:
                               mDptoC8
5d06 : 86c8             [ 2]>  lda   #0xC8
5d08 : 1f8b             [ 6]>  tfr   a,dp
                            >  direct $c8
                             
5d0a : bd049b           [ 8]   jsr UpdateSound
5d0d : bdf192           [ 8]   jsr waitrecal         ;Wait for screen sync
                               ;DP is now D0
5d10 : bdf289           [ 8]   jsr UpdateSoundChip
5d13 : bd5b89           [ 8]   jsr Zzap_DrawMountain
5d16 : bd5d22           [ 8]   jsr DrawWalkers
5d19 : bd5ef6           [ 8]   jsr DrawBase
5d1c : 6ae4             [ 6]   dec ,s
5d1e : 26e6             [ 3]   bne whsMainLoop
5d20 : 358a             [ 9]   puls a,dp,pc
                               direct -1
                             
                             ;*****************
0012 =                       WalkerLineCount = 18
5d22 :                       DrawWalkers:
                               mDecLocals 2,2,WalkerLineCount * 5
                            >  nolist
                             
0006 =                       LocalLines = LocalBuffer
0000 =                       LocalDist = LocalB1
0001 =                       LocalInt = LocalB2
0002 =                       LocalXMin = LocalW1
0004 =                       LocalXMax = LocalW2
                               direct -1
                             
                             ;    loop enemies
                             ;      check if on screen
                             ;        clip and draw
                             ;        break (only one can be visible at a time
                             
                               ;No walker is visible as default
                               mSetByte WalkerVisible,0
                            > if 0=0
5d25 : 7fc8c3           [ 7]>   clr WalkerVisible
                            > else
                            >   lda #0
                            >   sta WalkerVisible
                            > endif
                             
                             
5d28 : fcc8c6           [ 6]   ldd ViewX
5d2b : 83003a           [ 4]   subd #WalkerWidth/2
5d2e : ed62             [ 6]   std LocalXMin,s
5d30 : c30174           [ 4]   addd #256 + WalkerWidth
5d33 : ed64             [ 6]   std LocalXMax,s
                             
5d35 : cec962           [ 3]   ldu #WalkerList
5d38 : 8608             [ 2]   lda #WalkerCount
5d3a : a7e4             [ 4]   sta LocalB1,s
5d3c :                       zdwLoop:
5d3c : 6dc4             [ 6]   tst weWalkerActive,u
5d3e : 271c             [ 3]   beq zdwNext
                             
5d40 : ec42             [ 6]   ldd weWalkerX,u
5d42 : 10a362           [ 8]   cmpd LocalXMin,s
5d45 : 2d15             [ 3]   blt zdwNext
5d47 : 10a364           [ 8]   cmpd LocalXMax,s
5d4a : 2e10             [ 3]   bgt zdwNext
                             
                               ;Store info about visible walker, if not dying
5d4c : 6dc4             [ 6]   tst weWalkerActive,u
5d4e : 2a03             [ 3]   bpl zdwVisibleIsDying
5d50 : ffc8c3           [ 6]     stu WalkerVisible
5d53 :                       zdwVisibleIsDying:
5d53 : 8608             [ 2]   lda #WalkerCount
5d55 : a0e4             [ 4]   suba LocalB1,s
5d57 : b7c9bd           [ 5]   sta WalkerVisibleI
                             
5d5a : 2009             [ 3]   bra dwDraw
                             
5d5c :                       zdwNext:
5d5c : 3347             [ 5]   leau WalkerEntry,u
5d5e : 6ae4             [ 6]   dec LocalB1,s
5d60 : 26da             [ 3]   bne zdwLoop
                             
5d62 : 7e5ef2           [ 4]   jmp dwExit
                             
5d65 :                       dwDraw:
                             
                             
0000 =                       _off=0
                             mWa macro value
                              if \0=1
                                lda #value
                              endif
                              sta _off,x
                             _off=_off+1
                              endm
                             mWd macro
                              if \0=2
                                mCombine d,\1,\2
                              endif
                              std _off,x
                             _off=_off+2
                              if _off>$e
                                ;Avoid extra byte for offsets>$f
                                ;Accumulate offset to x, reset offset
                                leax _off,x
                             _off=0
                              endif
                              endm
                             
5d65 : 8660             [ 2]   lda #$60              ;intensity
5d67 : 6dc4             [ 6]   tst weWalkerActive,u
5d69 : 2b03             [ 3]   bmi zdwAliveInt
                                 mRandomToA
5d6b : bdf511           [ 8]>  jsr random                    ;call rom
                             
5d6e :                       zdwAliveInt:
5d6e : a761             [ 5]   sta LocalInt,s
                             
                               ;Leg and head animation
                               mTicToc 64
5d70 : b6c826           [ 5]>  lda LoopCounterLow
5d73 : 843f             [ 2]>  anda #64-1
5d75 : 8120             [ 2]>  cmpa #64/2
5d77 : 2402             [ 3]>  bcc l11441
5d79 : 883f             [ 2]>  eora #64-1
5d7b :                      >l11441:
                             
5d7b : 47               [ 2]   asra
5d7c : 47               [ 2]   asra
5d7d : a7e4             [ 4]   sta LocalDist,s
                             
5d7f : 3066             [ 5]   leax LocalLines,s
5d81 : ccc9cf           [ 3]   ldd #WalkerDrawList   ;write result buffer
                               mWd
                            > if 0=2
                            >   mCombine d,,
                            > endif
5d84 : ed84             [ 5]> std _off,x
0002 =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                             
5d86 : ec44             [ 6]   ldd weWalkerY,u       ;write top-left coords
5d88 : 830030           [ 4]   subd #WalkerHeight/2
                               mWd
                            > if 0=2
                            >   mCombine d,,
                            > endif
5d8b : ed02             [ 6]> std _off,x
0004 =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
5d8d : c30018           [ 4]   addd #WalkerBaseH/2   ;also store visible base 
5d90 : fdc9c4           [ 6]   std VisibleBaseY
5d93 : ec42             [ 6]   ldd weWalkerX,u
5d95 : 83003a           [ 4]   subd #WalkerWidth/2
                               mWd
                            > if 0=2
                            >   mCombine d,,
                            > endif
5d98 : ed04             [ 6]> std _off,x
0006 =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
5d9a : c3002a           [ 4]   addd #WalkerBaseW/2   ;also store visible base 
5d9d : fdc9c2           [ 6]   std VisibleBaseX
                             
                             
                               ;Linecount
                               mWa 12
                            > if 1=1
5da0 : 860c             [ 2]>   lda #12
                            > endif
5da2 : a706             [ 5]> sta _off,x
0007 =                      >_off=_off+1
                             
                             
                               ;Base top
                               mWa 2
                            > if 1=1
5da4 : 8602             [ 2]>   lda #2
                            > endif
5da6 : a707             [ 5]> sta _off,x
0008 =                      >_off=_off+1
                             
                               mWd 0,WalkerBaseH/8
                            > if 2=2
                            >   mCombine d,0,WalkerBaseH/8
5da8 : cc0006           [ 3]>  ldd #(lo 0)<<8 | (lo WalkerBaseH/8)
                            >
                            > endif
5dab : ed08             [ 6]> std _off,x
000a =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                               mWd WalkerBaseW/7,0
                            > if 2=2
                            >   mCombine d,WalkerBaseW/7,0
5dad : cc0c00           [ 3]>  ldd #(lo WalkerBaseW/7)<<8 | (lo 0)
                            >
                            > endif
5db0 : ed0a             [ 6]> std _off,x
000c =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                             
                               mWa 1
                            > if 1=1
5db2 : 8601             [ 2]>   lda #1
                            > endif
5db4 : a70c             [ 5]> sta _off,x
000d =                      >_off=_off+1
                             
                               mWd WalkerBaseW/7,0
                            > if 2=2
                            >   mCombine d,WalkerBaseW/7,0
5db6 : cc0c00           [ 3]>  ldd #(lo WalkerBaseW/7)<<8 | (lo 0)
                            >
                            > endif
5db9 : ed0d             [ 6]> std _off,x
000f =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
5dbb : 300f             [ 5]>   leax _off,x
0000 =                      >_off=0
                            > endif
                             
                               mWd (WalkerBaseW/7)*6,0
                            > if 2=2
                            >   mCombine d,(WalkerBaseW/7)*6,0
5dbd : cc4800           [ 3]>  ldd #(lo (WalkerBaseW/7)*6)<<8 | (lo 0)
                            >
                            > endif
5dc0 : ed84             [ 5]> std _off,x
0002 =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                             
                               mWa 2
                            > if 1=1
5dc2 : 8602             [ 2]>   lda #2
                            > endif
5dc4 : a702             [ 5]> sta _off,x
0003 =                      >_off=_off+1
                             
                               mWd (WalkerBaseW/7)*6,0
                            > if 2=2
                            >   mCombine d,(WalkerBaseW/7)*6,0
5dc6 : cc4800           [ 3]>  ldd #(lo (WalkerBaseW/7)*6)<<8 | (lo 0)
                            >
                            > endif
5dc9 : ed03             [ 6]> std _off,x
0005 =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                               mWd (WalkerBaseW/7)*7,WalkerBaseH/8
                            > if 2=2
                            >   mCombine d,(WalkerBaseW/7)*7,WalkerBaseH/8
5dcb : cc5406           [ 3]>  ldd #(lo (WalkerBaseW/7)*7)<<8 | (lo WalkerBase
                            >
                            > endif
5dce : ed05             [ 6]> std _off,x
0007 =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                             
                               ;Base lower
                               mWa 0
                            > if 1=1
5dd0 : 8600             [ 2]>   lda #0
                            > endif
5dd2 : a707             [ 5]> sta _off,x
0008 =                      >_off=_off+1
                             
                               mWd 0,WalkerBaseH/8
                            > if 2=2
                            >   mCombine d,0,WalkerBaseH/8
5dd4 : cc0006           [ 3]>  ldd #(lo 0)<<8 | (lo WalkerBaseH/8)
                            >
                            > endif
5dd7 : ed08             [ 6]> std _off,x
000a =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                               mWd 0,WalkerBaseH
                            > if 2=2
                            >   mCombine d,0,WalkerBaseH
5dd9 : cc0030           [ 3]>  ldd #(lo 0)<<8 | (lo WalkerBaseH)
                            >
                            > endif
5ddc : ed0a             [ 6]> std _off,x
000c =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                             
                               mWa 1
                            > if 1=1
5dde : 8601             [ 2]>   lda #1
                            > endif
5de0 : a70c             [ 5]> sta _off,x
000d =                      >_off=_off+1
                             
                               mWd 0,WalkerBaseH
                            > if 2=2
                            >   mCombine d,0,WalkerBaseH
5de2 : cc0030           [ 3]>  ldd #(lo 0)<<8 | (lo WalkerBaseH)
                            >
                            > endif
5de5 : ed0d             [ 6]> std _off,x
000f =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
5de7 : 300f             [ 5]>   leax _off,x
0000 =                      >_off=0
                            > endif
                             
                               mWd WalkerBaseW,WalkerBaseH
                            > if 2=2
                            >   mCombine d,WalkerBaseW,WalkerBaseH
5de9 : cc5430           [ 3]>  ldd #(lo WalkerBaseW)<<8 | (lo WalkerBaseH)
                            >
                            > endif
5dec : ed84             [ 5]> std _off,x
0002 =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                             
                               mWa 0
                            > if 1=1
5dee : 8600             [ 2]>   lda #0
                            > endif
5df0 : a702             [ 5]> sta _off,x
0003 =                      >_off=_off+1
                             
                               mWd WalkerBaseW,WalkerBaseH/8
                            > if 2=2
                            >   mCombine d,WalkerBaseW,WalkerBaseH/8
5df2 : cc5406           [ 3]>  ldd #(lo WalkerBaseW)<<8 | (lo WalkerBaseH/8)
                            >
                            > endif
5df5 : ed03             [ 6]> std _off,x
0005 =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                               mWd WalkerBaseW,WalkerBaseH
                            > if 2=2
                            >   mCombine d,WalkerBaseW,WalkerBaseH
5df7 : cc5430           [ 3]>  ldd #(lo WalkerBaseW)<<8 | (lo WalkerBaseH)
                            >
                            > endif
5dfa : ed05             [ 6]> std _off,x
0007 =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                             
                               ;Legs
0004 =                       LegX=4  ;Offset X from WalkerBase that leg is att
                             
                               ;Left leg
                             
                               mWa 0
                            > if 1=1
5dfc : 8600             [ 2]>   lda #0
                            > endif
5dfe : a707             [ 5]> sta _off,x
0008 =                      >_off=_off+1
                             
                               mWd LegX,WalkerBaseH
                            > if 2=2
                            >   mCombine d,LegX,WalkerBaseH
5e00 : cc0430           [ 3]>  ldd #(lo LegX)<<8 | (lo WalkerBaseH)
                            >
                            > endif
5e03 : ed08             [ 6]> std _off,x
000a =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                               mCombine d,LegX,WalkerBaseH+WalkerLegH
5e05 : cc0460           [ 3]>  ldd #(lo LegX)<<8 | (lo WalkerBaseH+WalkerLegH)
                             
5e08 : e0e4             [ 4]   subb LocalDist,s
                               mWd
                            > if 0=2
                            >   mCombine d,,
                            > endif
5e0a : ed0a             [ 6]> std _off,x
000c =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                             
                               mWa 1
                            > if 1=1
5e0c : 8601             [ 2]>   lda #1
                            > endif
5e0e : a70c             [ 5]> sta _off,x
000d =                      >_off=_off+1
                             
                               mCombine d,LegX,WalkerBaseH+WalkerLegH
5e10 : cc0460           [ 3]>  ldd #(lo LegX)<<8 | (lo WalkerBaseH+WalkerLegH)
                             
5e13 : e0e4             [ 4]   subb LocalDist,s
                               mWd
                            > if 0=2
                            >   mCombine d,,
                            > endif
5e15 : ed0d             [ 6]> std _off,x
000f =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
5e17 : 300f             [ 5]>   leax _off,x
0000 =                      >_off=0
                            > endif
                             
                               mCombine d,LegX+WalkerLegW,WalkerBaseH+WalkerLe
5e19 : cc1460           [ 3]>  ldd #(lo LegX+WalkerLegW)<<8 | (lo WalkerBaseH+
                             
5e1c : e0e4             [ 4]   subb LocalDist,s
                               mWd
                            > if 0=2
                            >   mCombine d,,
                            > endif
5e1e : ed84             [ 5]> std _off,x
0002 =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                             
                               mWa 0
                            > if 1=1
5e20 : 8600             [ 2]>   lda #0
                            > endif
5e22 : a702             [ 5]> sta _off,x
0003 =                      >_off=_off+1
                             
                               mWd LegX+WalkerLegW,WalkerBaseH
                            > if 2=2
                            >   mCombine d,LegX+WalkerLegW,WalkerBaseH
5e24 : cc1430           [ 3]>  ldd #(lo LegX+WalkerLegW)<<8 | (lo WalkerBaseH)
                            >
                            > endif
5e27 : ed03             [ 6]> std _off,x
0005 =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                               mCombine d,LegX+WalkerLegW,WalkerBaseH+WalkerLe
5e29 : cc1460           [ 3]>  ldd #(lo LegX+WalkerLegW)<<8 | (lo WalkerBaseH+
                             
5e2c : e0e4             [ 4]   subb LocalDist,s
                               mWd
                            > if 0=2
                            >   mCombine d,,
                            > endif
5e2e : ed05             [ 6]> std _off,x
0007 =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                             
                               ;Right leg
5e30 : 8610             [ 2]   lda #16
5e32 : a0e4             [ 4]   suba LocalDist,s
5e34 : a7e4             [ 4]   sta LocalDist,s
                             
                               mWa 0
                            > if 1=1
5e36 : 8600             [ 2]>   lda #0
                            > endif
5e38 : a707             [ 5]> sta _off,x
0008 =                      >_off=_off+1
                             
                               mWd WalkerBaseW-WalkerLegW-LegX,WalkerBaseH
                            > if 2=2
                            >   mCombine d,WalkerBaseW-WalkerLegW-LegX,WalkerB
5e3a : cc4030           [ 3]>  ldd #(lo WalkerBaseW-WalkerLegW-LegX)<<8 | (lo 
                            >
                            > endif
5e3d : ed08             [ 6]> std _off,x
000a =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                               mCombine d,WalkerBaseW-WalkerLegW-LegX,WalkerBa
5e3f : cc4060           [ 3]>  ldd #(lo WalkerBaseW-WalkerLegW-LegX)<<8 | (lo 
                             
5e42 : e0e4             [ 4]   subb LocalDist,s
                               mWd
                            > if 0=2
                            >   mCombine d,,
                            > endif
5e44 : ed0a             [ 6]> std _off,x
000c =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                             
                               mWa 1
                            > if 1=1
5e46 : 8601             [ 2]>   lda #1
                            > endif
5e48 : a70c             [ 5]> sta _off,x
000d =                      >_off=_off+1
                             
                               mCombine d,WalkerBaseW-WalkerLegW-LegX,WalkerBa
5e4a : cc4060           [ 3]>  ldd #(lo WalkerBaseW-WalkerLegW-LegX)<<8 | (lo 
                             
5e4d : e0e4             [ 4]   subb LocalDist,s
                               mWd
                            > if 0=2
                            >   mCombine d,,
                            > endif
5e4f : ed0d             [ 6]> std _off,x
000f =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
5e51 : 300f             [ 5]>   leax _off,x
0000 =                      >_off=0
                            > endif
                             
                               mCombine d,WalkerBaseW-LegX,WalkerBaseH+WalkerL
5e53 : cc5060           [ 3]>  ldd #(lo WalkerBaseW-LegX)<<8 | (lo WalkerBaseH
                             
5e56 : e0e4             [ 4]   subb LocalDist,s
                               mWd
                            > if 0=2
                            >   mCombine d,,
                            > endif
5e58 : ed84             [ 5]> std _off,x
0002 =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                             
                               mWa 0
                            > if 1=1
5e5a : 8600             [ 2]>   lda #0
                            > endif
5e5c : a702             [ 5]> sta _off,x
0003 =                      >_off=_off+1
                             
                               mWd WalkerBaseW-LegX,WalkerBaseH
                            > if 2=2
                            >   mCombine d,WalkerBaseW-LegX,WalkerBaseH
5e5e : cc5030           [ 3]>  ldd #(lo WalkerBaseW-LegX)<<8 | (lo WalkerBaseH
                            >
                            > endif
5e61 : ed03             [ 6]> std _off,x
0005 =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                               mCombine d,WalkerBaseW-LegX,WalkerBaseH+WalkerL
5e63 : cc5060           [ 3]>  ldd #(lo WalkerBaseW-LegX)<<8 | (lo WalkerBaseH
                             
5e66 : e0e4             [ 4]   subb LocalDist,s
                               mWd
                            > if 0=2
                            >   mCombine d,,
                            > endif
5e68 : ed05             [ 6]> std _off,x
0007 =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                             
5e6a : 3166             [ 5]   leay LocalLines,s
5e6c : a661             [ 5]   lda LocalInt,s      ;intensity
5e6e : bd20eb           [ 8]   jsr ClipDraw
                             
                             
                               ;Neck and head are drawn separately
                             
                               ;This is needed because a single clipdraw call 
                               ;total width of a walker is >128
                             
                               ;Head
5e71 : 3066             [ 5]   leax LocalLines,s
0002 =                       _off=2                  ;skip write result buffer
                             
5e73 : 108ec9c6         [ 4]   ldy #ZzapConfig
                             
5e77 : e6e4             [ 4]   ldb LocalDist,s       ;animate head Y
5e79 : cb04             [ 2]   addb #4
5e7b : e7e4             [ 4]   stb LocalDist,s
                             
5e7d : ec44             [ 6]   ldd weWalkerY,u       ;write top-left coords, o
5e7f : 830030           [ 4]   subd #WalkerHeight/2
5e82 : ebe4             [ 4]   addb LocalDist,s      ;add bounce
5e84 : cb06             [ 2]   addb #WalkerBaseH/8   ;add an offset from base 
                               mWd
                            > if 0=2
                            >   mCombine d,,
                            > endif
5e86 : ed02             [ 6]> std _off,x
0004 =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
5e88 : eb27             [ 5]   addb zcHalfHeadH,y
5e8a : fdc9c0           [ 6]   std VisibleHeadY      ;also store visible head 
5e8d : ec42             [ 6]   ldd weWalkerX,u
5e8f : 83003a           [ 4]   subd #WalkerWidth/2
5e92 : c30054           [ 4]   addd #WalkerBaseW
                               mWd
                            > if 0=2
                            >   mCombine d,,
                            > endif
5e95 : ed04             [ 6]> std _off,x
0006 =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
5e97 : c30010           [ 4]   addd #HeadW/2
5e9a : fdc9be           [ 6]   std VisibleHeadX      ;also store visible head 
                             
                               ;Linecount for head
                               mWa 5
                            > if 1=1
5e9d : 8605             [ 2]>   lda #5
                            > endif
5e9f : a706             [ 5]> sta _off,x
0007 =                      >_off=_off+1
                             
                             
0007 =                       HeadSlopeH = 7
000e =                       HeadSlopeW = HeadSlopeH*2
                               mWa 1
                            > if 1=1
5ea1 : 8601             [ 2]>   lda #1
                            > endif
5ea3 : a707             [ 5]> sta _off,x
0008 =                      >_off=_off+1
                             
                               mWd 0,0
                            > if 2=2
                            >   mCombine d,0,0
5ea5 : cc0000           [ 3]>  ldd #(lo 0)<<8 | (lo 0)
                            >
                            > endif
5ea8 : ed08             [ 6]> std _off,x
000a =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                               mWd HeadW-HeadSlopeW,0
                            > if 2=2
                            >   mCombine d,HeadW-HeadSlopeW,0
5eaa : cc1200           [ 3]>  ldd #(lo HeadW-HeadSlopeW)<<8 | (lo 0)
                            >
                            > endif
5ead : ed0a             [ 6]> std _off,x
000c =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                             
                               mWa 2
                            > if 1=1
5eaf : 8602             [ 2]>   lda #2
                            > endif
5eb1 : a70c             [ 5]> sta _off,x
000d =                      >_off=_off+1
                             
5eb3 : 4f               [ 2]   clra
5eb4 : e626             [ 5]   ldb zcHeadH,y
5eb6 : c007             [ 2]   subb #HeadSlopeH
                               mWd
                            > if 0=2
                            >   mCombine d,,
                            > endif
5eb8 : ed0d             [ 6]> std _off,x
000f =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
5eba : 300f             [ 5]>   leax _off,x
0000 =                      >_off=0
                            > endif
                             
                             
5ebc : e626             [ 5]   ldb zcHeadH,y
5ebe : 860e             [ 2]   lda #HeadSlopeW
                               mWd
                            > if 0=2
                            >   mCombine d,,
                            > endif
5ec0 : ed84             [ 5]> std _off,x
0002 =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                             
                               mWa 1
                            > if 1=1
5ec2 : 8601             [ 2]>   lda #1
                            > endif
5ec4 : a702             [ 5]> sta _off,x
0003 =                      >_off=_off+1
                             
5ec6 : 860e             [ 2]   lda #HeadSlopeW
                               mWd
                            > if 0=2
                            >   mCombine d,,
                            > endif
5ec8 : ed03             [ 6]> std _off,x
0005 =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
5eca : 8620             [ 2]   lda #HeadW
                               mWd
                            > if 0=2
                            >   mCombine d,,
                            > endif
5ecc : ed05             [ 6]> std _off,x
0007 =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                             
                               mWa 0
                            > if 1=1
5ece : 8600             [ 2]>   lda #0
                            > endif
5ed0 : a707             [ 5]> sta _off,x
0008 =                      >_off=_off+1
                             
5ed2 : 8620             [ 2]   lda #HeadW
                               mWd
                            > if 0=2
                            >   mCombine d,,
                            > endif
5ed4 : ed08             [ 6]> std _off,x
000a =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                               mWd HeadW,HeadSlopeH
                            > if 2=2
                            >   mCombine d,HeadW,HeadSlopeH
5ed6 : cc2007           [ 3]>  ldd #(lo HeadW)<<8 | (lo HeadSlopeH)
                            >
                            > endif
5ed9 : ed0a             [ 6]> std _off,x
000c =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                             
                               mWa 2
                            > if 1=1
5edb : 8602             [ 2]>   lda #2
                            > endif
5edd : a70c             [ 5]> sta _off,x
000d =                      >_off=_off+1
                             
                               mWd HeadW-HeadSlopeW,0
                            > if 2=2
                            >   mCombine d,HeadW-HeadSlopeW,0
5edf : cc1200           [ 3]>  ldd #(lo HeadW-HeadSlopeW)<<8 | (lo 0)
                            >
                            > endif
5ee2 : ed0d             [ 6]> std _off,x
000f =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
5ee4 : 300f             [ 5]>   leax _off,x
0000 =                      >_off=0
                            > endif
                             
                               mWd HeadW,HeadSlopeH
                            > if 2=2
                            >   mCombine d,HeadW,HeadSlopeH
5ee6 : cc2007           [ 3]>  ldd #(lo HeadW)<<8 | (lo HeadSlopeH)
                            >
                            > endif
5ee9 : ed84             [ 5]> std _off,x
0002 =                      >_off=_off+2
                            > if _off>$e
                            >   ;Avoid extra byte for offsets>$f
                            >   ;Accumulate offset to x, reset offset
                            >   leax _off,x
                            >_off=0
                            > endif
                             
                             
5eeb : 3166             [ 5]   leay LocalLines,s
5eed : a661             [ 5]   lda LocalInt,s      ;intensity
5eef : bd20eb           [ 8]   jsr ClipDraw
                             
5ef2 :                       dwExit:
                               mFreeLocals
5ef2 : 32e860           [ 5]>  leas FrameSize,s
                             
5ef5 : 39               [ 5]   rts
                             
                             
                             ;*****************
5ef6 :                       DrawBase:
                               mDecLocals 0,0,4
                            >  nolist
                             
                               ;DP must be D0
                               mSetIntensity $5f
                            >  if 1=1
5ef8 : 865f             [ 2]>    lda   #$5f            ;if argument exists, lo
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
5efa : 9701             [ 4]>  sta   <01
5efc : cc0401           [ 3]>  ldd   #$0401
5eff : 9700             [ 4]>  sta   <00
5f01 : d700             [ 4]>  stb   <00
                             
                             
                               ;Draw base
5f03 : 33e4             [ 4]   leau LocalBuffer,s
5f05 : cc2080           [ 3]   ldd #BaseX
5f08 : edc4             [ 5]   std ,u
5f0a : cc00d5           [ 3]   ldd #BaseY
5f0d : ed42             [ 6]   std 2,u
5f0f : 8e4c0e           [ 3]   ldx #SpriteStationaryPod
5f12 : bd2378           [ 8]   jsr DrawSprite
                             
                               ;Draw floor
5f15 : bec8c6           [ 6]   ldx ViewX
5f18 : 3004             [ 5]   leax 4,x
5f1a : 108e00df         [ 4]   ldy #WalkerFloorY
5f1e : bd078c           [ 8]   jsr FxGetScreenCoords
5f21 : 2714             [ 3]   beq dbFloorOffscreen
5f23 : ede4             [ 5]     std LocalBuffer,s
5f25 : bdf354           [ 8]     jsr reset0ref
5f28 : ece4             [ 5]     ldd LocalBuffer,s
5f2a : bdf2fc           [ 8]     jsr move_pen7f_to_d
                                 ;scale $ff to draw full width
                                 mSetScale $ff
                            >  if 1=1
5f2d : 86ff             [ 2]>    lda #$ff                  ;if argument exists
                            >  endif
5f2f : 9704             [ 4]>  sta <$04
                             
                                 mCombine d,0,127
5f31 : cc007f           [ 3]>  ldd #(lo 0)<<8 | (lo 127)
                             
5f34 : bdf3df           [ 8]     jsr draw_to_d
5f37 :                       dbFloorOffscreen:
                             
                               mFreeLocals
5f37 : 3264             [ 5]>  leas FrameSize,s
                             
5f39 : 39               [ 5]   rts
                             
                               include "Thrust_Title.asm"
                             ; Thrust title screen
                             ; Copyright (C) 2004  Ville Krumlinde
                             
                             mSine macro index,freq,amp,first
                              local ok
                              if first=1
                                ldx #SineTable
                              endif
                              ldb index
                              addb #freq
                              bpl ok
                                subb #128
                             ok:
                              stb index
                              ldb b,x
                              if amp>2
                                asrb
                              endif
                              if amp>1
                                asrb
                              endif
                              if amp>0
                                asrb
                              endif
                              if first=1
                                tfr b,a
                              else
                                stb -1,s
                                adda -1,s
                              endif
                              endm
                             
                             
                             ;*****************
5f3a :                       ShowTitleScreen:                ;dp=d0
                               mDecLocals 7,0,0
                            >  nolist
                             
0000 =                       LocalTextTimer = LocalB1
0001 =                       LocalTextInt = LocalB2
0002 =                       LocalMusicTimer = LocalB3
0003 =                       LocalVolumeTimer = LocalB4
0004 =                       LocalMode = LocalB5
0005 =                       LocalModeClock = LocalB6
0006 =                       LocalBonusGame = LocalB7
                             
5f3c :                       tiReset:
5f3c : bdf272           [ 8]   jsr clear_sound_chip
                             
5f3f : bd6dac           [ 8]   jsr InitMusic
                             
5f42 : 866e             [ 2]   lda #110
5f44 : b7c8a0           [ 5]   sta TitleLogoY
                             
5f47 : 8664             [ 2]   lda #100
5f49 : a7e4             [ 4]   sta LocalTextTimer,s
5f4b : 4f               [ 2]   clra
5f4c : a761             [ 5]   sta LocalTextInt,s
                             
5f4e : 8664             [ 2]   lda #100
5f50 : a762             [ 5]   sta LocalMusicTimer,s
                             
5f52 : 8664             [ 2]   lda #100
5f54 : a763             [ 5]   sta LocalVolumeTimer,s
                             
5f56 : 6f64             [ 7]   clr LocalMode,s
5f58 : 8696             [ 2]   lda #150
5f5a : a765             [ 5]   sta LocalModeClock,s
                             
                               ;test if bonusgame is enabled
5f5c : b6c881           [ 5]   lda BonusGameEnabled
5f5f : bbc86a           [ 5]   adda Cheat
5f62 : a766             [ 5]   sta LocalBonusGame,s
                             
5f64 :                       tiMain:
5f64 : bdf192           [ 8]   jsr waitrecal
                             
5f67 : 6d62             [ 7]   tst LocalMusicTimer,s
5f69 : 2704             [ 3]   beq tiGoMusic
5f6b : 6a62             [ 7]     dec LocalMusicTimer,s
5f6d : 2003             [ 3]     bra tiSkipMusic
5f6f :                       tiGoMusic:
5f6f : bd6e4d           [ 8]   jsr UpdateMusic
5f72 :                       tiSkipMusic:
                             
5f72 : b6c826           [ 5]   lda LoopCounterLow
5f75 : 8401             [ 2]   anda #1
5f77 : 2702             [ 3]   beq tiNoDecClock
5f79 : 6a65             [ 7]     dec LocalModeClock,s
5f7b :                       tiNoDecClock:
                             
5f7b : a664             [ 5]   lda LocalMode,s
5f7d : 273f             [ 3]   beq tiModeLogo        ;0
5f7f : 4a               [ 2]   deca
5f80 : 272d             [ 3]   beq tiModeLevel       ;1
5f82 : 4a               [ 2]   deca
5f83 : 2714             [ 3]   beq tiModeHighscores  ;2
                             
                               ;ModeCredits          ;3
5f85 : bd62d6           [ 8]   jsr DrawCreditsScroller
5f88 : fcc8a3           [ 6]   ldd ScrollTextPtr
5f8b : 108363dc         [ 5]   cmpd #CreditsTextEnd - Chars - 1
5f8f : 2606             [ 3]   bne tiKeepCreditsMode
                                 ;Switch to logo + volume mode
5f91 : 6f64             [ 7]     clr LocalMode,s
5f93 : 86fa             [ 2]     lda #250
5f95 : a765             [ 5]     sta LocalModeClock,s
5f97 :                       tiKeepCreditsMode:
5f97 : 207c             [ 3]   bra tiModeFin
                             
5f99 :                       tiModeHighscores:
                               ;Mode highscores
5f99 : bd60d1           [ 8]   jsr DisplayHighscores
5f9c : 6d65             [ 7]   tst LocalModeClock,s
5f9e : 2675             [ 3]   bne tiModeFin
                                 ;Switch to credits mode
5fa0 : 8603             [ 2]     lda #3
5fa2 : a764             [ 5]     sta LocalMode,s
5fa4 : cc6346           [ 3]     ldd #CreditsText
5fa7 : fdc8a3           [ 6]     std ScrollTextPtr
5faa : 7fc8a2           [ 7]     clr ScrollInt
5fad : 2066             [ 3]     bra tiModeFin
                             
5faf :                       tiModeLevel:
5faf : bd613e           [ 8]   jsr TitleDrawLevel
5fb2 : 6d65             [ 7]   tst LocalModeClock,s
5fb4 : 265f             [ 3]   bne tiModeFin
                                 ;Switch mode to highscores
5fb6 : 6c64             [ 7]     inc LocalMode,s
5fb8 : 86fa             [ 2]     lda #250
5fba : a765             [ 5]     sta LocalModeClock,s
5fbc : 2057             [ 3]     bra tiModeFin
                             
5fbe :                       tiModeLogo:
5fbe : 6d65             [ 7]   tst LocalModeClock,s
5fc0 : 2645             [ 3]   bne tiKeepLogoMode
                                 ;Switch to level mode
                                 mDptoC8
5fc2 : 86c8             [ 2]>  lda   #0xC8
5fc4 : 1f8b             [ 6]>  tfr   a,dp
                            >  direct $c8
                             
                             
5fc6 : 8601             [ 2]     lda #1
5fc8 : bd296a           [ 8]     jsr InitNewGame     ;call init game, keep val
                             
                                 mRandomToA
5fcb : bdf511           [ 8]>  jsr random                    ;call rom
                             
5fce : 8403             [ 2]     anda #3
5fd0 : 97d1             [ 4]     sta CurLevel
5fd2 : bd283d           [ 8]     jsr PrepareLevel
5fd5 : 8601             [ 2]     lda #1
5fd7 : a764             [ 5]     sta LocalMode,s
5fd9 : 86fa             [ 2]     lda #250
5fdb : a765             [ 5]     sta LocalModeClock,s
                             
5fdd : deca             [ 5]     ldu CurLevelEntry ;center view around pod
5fdf : ec4a             [ 6]     ldd leOrbY,u
5fe1 : 830080           [ 4]     subd #ScreenH / 2
5fe4 : 1093cf           [ 7]     cmpd CurLevelEndY
5fe7 : 2d03             [ 3]     blt *+5
5fe9 : dccf             [ 5]       ldd CurLevelEndY
5feb : ddc8             [ 5]     std ViewY
5fed : ec48             [ 6]     ldd leOrbX,u
5fef : 830080           [ 4]     subd #ScreenW / 2
5ff2 : cec8c6           [ 3]     ldu #ViewX
5ff5 : edc4             [ 5]     std ,u
5ff7 : bd12a5           [ 8]     jsr ValidateX
                             
                                 mSetByte NeedRefresh,1
                            > if 0=1
                            >   clr NeedRefresh
                            > else
5ffa : 8601             [ 2]>   lda #1
5ffc : 97c5             [ 4]>   sta NeedRefresh
                            > endif
                             
5ffe : bd2b18           [ 8]     jsr RefreshDrawList
                             
                                 mDptoD0
6001 : 86d0             [ 2]>  lda   #0xD0
6003 : 1f8b             [ 6]>  tfr   a,dp
                            >  direct -1
                             
                             
6005 : 200e             [ 3]     bra tiModeFin
6007 :                       tiKeepLogoMode:
6007 : bd6232           [ 8]   jsr DrawTitleLogo
                             
600a : 6d63             [ 7]   tst LocalVolumeTimer,s
600c : 2605             [ 3]   bne tiVolumeNotYet
600e : bd61df           [ 8]   jsr DrawTitleVolume
6011 : 2002             [ 3]   bra tiVolumeFin
6013 :                       tiVolumeNotYet:
6013 : 6a63             [ 7]   dec LocalVolumeTimer,s
6015 :                       tiVolumeFin:
                             
6015 :                       tiModeFin:
                             
6015 : a6e4             [ 4]   lda LocalTextTimer,s
6017 : 2705             [ 3]   beq tiShowText
6019 : 4a               [ 2]     deca
601a : a7e4             [ 4]     sta LocalTextTimer,s
601c : 2039             [ 3]     bra tiSkipText
601e :                       tiShowText
601e : 8e60c9           [ 3]     ldx #TitleStringsList
                             
6021 : 5f               [ 2]     clrb
6022 : b6c825           [ 5]     lda LoopCounterHigh
6025 : 47               [ 2]     asra
6026 : 59               [ 2]     rolb
6027 : 6d66             [ 7]     tst LocalBonusGame,s
6029 : 2705             [ 3]     beq tiNoBonusText
602b : b6c826           [ 5]     lda LoopCounterLow
602e : 48               [ 2]     asla
602f : 59               [ 2]     rolb
6030 :                       tiNoBonusText:
6030 : 58               [ 2]     lslb
6031 : ae85             [ 6]     ldx b,x
                             
6033 : b6c826           [ 5]     lda LoopCounterLow
6036 : 44               [ 2]     lsra
6037 : 44               [ 2]     lsra
6038 : 108e6d2c         [ 4]     ldy #SineTable
603c : a6a6             [ 5]     lda a,y
603e : 47               [ 2]     asra
603f : 47               [ 2]     asra
6040 : 47               [ 2]     asra
6041 : 8b8c             [ 2]     adda #-116
                             
                             ;    lda #-116
6043 : e680             [ 6]     ldb ,x+
6045 : 1f02             [ 6]     tfr d,y
                             
                                 mTicToc 32
6047 : b6c826           [ 5]>  lda LoopCounterLow
604a : 841f             [ 2]>  anda #32-1
604c : 8110             [ 2]>  cmpa #32/2
604e : 2402             [ 3]>  bcc l11564
6050 : 881f             [ 2]>  eora #32-1
6052 :                      >l11564:
                             
6052 : 48               [ 2]     lsla
6053 : 48               [ 2]     lsla
6054 : bd4ce4           [ 8]     jsr Text_Print_Intensity
                                 ;Text_Print_Intensity:   ;x=string pointer, y
6057 :                       tiSkipText:
                             
6057 : 860f             [ 2]   lda #1 + 2 + 4 + 8
6059 : bdf1b4           [ 8]   jsr read_switches
605c : 8ec812           [ 3]   ldx #$C812
605f : 8601             [ 2]   lda #1
6061 : 6d66             [ 7]   tst LocalBonusGame,s
6063 : 2701             [ 3]   beq *+3
6065 : 4c               [ 2]     inca
6066 :                       tiNextButton:
6066 : 6d86             [ 7]   tst a,x
6068 : 260d             [ 3]   bne tiExit
606a : 4a               [ 2]   deca
606b : 2af9             [ 3]   bpl tiNextButton
                             
606d : b6c87a           [ 5]   lda GameMode  ;test if music has set demogame (
6070 : 8104             [ 2]   cmpa #DemoGame
6072 : 2734             [ 3]   beq tiFin
                             
6074 : 7e5f64           [ 4]   bra tiMain
                             
6077 :                       tiExit:
                             
                               ;Exit with key pressed in A (0=button1 etc)
                             
                               ;need to clear soundworks-buffer because update
                               ;textwait, and that memory may have been writte
6077 : 3402             [ 6]   pshs a
6079 : 8ec8e5           [ 3]   ldx #LevelClearLabel
607c : bdf545           [ 8]   jsr clear_256_bytes
607f : 3502             [ 6]   puls a
                             
6081 : 8101             [ 2]   cmpa #1
6083 : 260d             [ 3]   bne tiNoOptions
6085 : bd615e           [ 8]     jsr OptionsMenu
6088 : b6c87a           [ 5]     lda GameMode
608b : 8104             [ 2]     cmpa #DemoGame
608d : 2719             [ 3]     beq tiFin
608f : 7e5f3c           [ 4]     bra tiReset
6092 :                       tiNoOptions:
                             
6092 : 8102             [ 2]   cmpa #2
6094 : 2606             [ 3]   bne tiNoBonusGame
6096 : bd5532           [ 8]     jsr Zzap_Start
6099 : 7e5f3c           [ 4]     bra tiReset
609c :                       tiNoBonusGame
                             
609c : bd5393           [ 8]   jsr Text_ShowGameMenu
609f : c103             [ 2]   cmpb #3
60a1 : 1027fe97         [ 6]   beq tiReset
60a5 : f7c87a           [ 5]   stb GameMode          ;Menu return selected Gam
                             
60a8 :                       tiFin:
                             
                               mFreeLocals
60a8 : 3267             [ 5]>  leas FrameSize,s
                             
60aa : 39               [ 5]   rts
                             
60ab : e0313a20535441..      TitleString1: db -32,'1: START',$80
60b5 : d8323a204f5054..      TitleString2: db -40,'2: OPTIONS',$80
60c1 : e8333a205a534280      TitleString3: db -24,'3: ZSB',$80
60c9 :                       TitleStringsList:
60c9 : 60ab60b560c160c1        dw TitleString1,TitleString2,TitleString3,Title
                             
                             
                             ;*****************
60d1 :                       DisplayHighscores:
                             ;   text_write med fixed list
                             ;   text_write med scores
                             ;
                             ;   stackspace
                             ;   x+y sine offset
                             ;
                             ;   display 'highscores'
                             ;   x=gamemodestringlist
                             ;   u=highscorelist
                             ;   get start sineoffset
                             ;   loop gamemodes
                             ;     copy to stack gamemodestring + highscore + 
                             ;     calc x,y with sineoffset
                             ;     call displaystring
                             ;     inc sineoffset
                             ;   set viewy till -255
                             ;   call drawstars
                             ;
                             ; Stars and 'highscore' string causes framedrop a
                             ; Skip them for now.
                             ;
                               mDecLocals 4,2,11 + 1 + HighscoreEntry + 1
                            >  nolist
                             
0002 =                       LocalSineY = LocalB3
0003 =                       LocalSineX = LocalB4
                             
                             ;  ldx #HighscoreString
                             ;  mCombine d,80,-40
                             ;  jsr Text_Print
                             
60d4 : 8e522a           [ 3]   ldx #GameModeStringList
60d7 : cec882           [ 3]   ldu #Highscores
60da : 8628             [ 2]   lda #40
60dc : a761             [ 5]   sta LocalB2,s
60de : 8603             [ 2]   lda #3
60e0 : a7e4             [ 4]   sta LocalB1,s
60e2 : b6c826           [ 5]   lda LoopCounterLow
60e5 : a762             [ 5]   sta LocalSineY,s
60e7 : bbc825           [ 5]   adda LoopCounterHigh
60ea : 8b1e             [ 2]   adda #30
60ec : a763             [ 5]   sta LocalSineX,s
60ee :                       dhsLoop:
60ee : af64             [ 6]   stx LocalW1,s
60f0 : ef66             [ 6]   stu LocalW2,s
                             
60f2 : ae84             [ 5]   ldx ,x
60f4 : 3368             [ 5]   leau LocalBuffer,s
60f6 : bdf8de           [ 8]   jsr Text_CopyString
60f9 : ae66             [ 6]   ldx LocalW2,s
60fb : c680             [ 2]   ldb #$80
60fd : bd1aba           [ 8]   jsr CopyScoreFromXtoU
                             ;  jsr Text_CopyString
                             
6100 : 3068             [ 5]   leax LocalBuffer,s
6102 : 8620             [ 2]   lda #' '
6104 : a70b             [ 5]   sta 11,x
                             ;  mCombine d,'0',$80
                             ;  std 18,x
                             
6106 : ce6d2c           [ 3]   ldu #SineTable
6109 : a662             [ 5]   lda LocalSineY,s
610b : 44               [ 2]   lsra
610c : a6c6             [ 5]   lda a,u
610e : 47               [ 2]   asra
610f : ab61             [ 5]   adda LocalB2,s
                             
6111 : e663             [ 5]   ldb LocalSineX,s
6113 : 54               [ 2]   lsrb
6114 : e6c5             [ 5]   ldb b,u
6116 : 57               [ 2]   asrb
6117 : cbc4             [ 2]   addb #-60
6119 : bd4cb9           [ 8]   jsr Text_Print
                             
611c : a661             [ 5]   lda LocalB2,s ;move y
611e : 801e             [ 2]   suba #30
6120 : a761             [ 5]   sta LocalB2,s
                             
6122 : a662             [ 5]   lda LocalSineY,s
6124 : 8b0a             [ 2]   adda #10
6126 : a762             [ 5]   sta LocalSineY,s
                             
6128 : a663             [ 5]   lda LocalSineX,s
612a : 8b11             [ 2]   adda #17
612c : a763             [ 5]   sta LocalSineX,s
                             
612e : ae64             [ 6]   ldx LocalW1,s
6130 : ee66             [ 6]   ldu LocalW2,s
6132 : 3002             [ 5]   leax 2,x
6134 : 3347             [ 5]   leau HighscoreEntry,u
                             
6136 : 6ae4             [ 6]   dec LocalB1,s
6138 : 26b4             [ 3]   bne dhsLoop
                             
                             ;  ldd #-255
                             ;  std ViewY
                             ;  jsr DrawStars
                             
                               mFreeLocals
613a : 32e81c           [ 5]>  leas FrameSize,s
                             
613d : 39               [ 5]   rts
                             ;HighscoreString: db 'HIGHSCORES',$80
                             
                             ;*****************
613e :                       TitleDrawLevel:
613e : bd2a7a           [ 8]   jsr DrawLevel
6141 : bd1dfa           [ 8]   jsr DrawFuel
6144 : bd1f0c           [ 8]   jsr DrawGuns
6147 : bd1e28           [ 8]   jsr DrawOrb
614a : 7e1e46           [ 4]   jmp DrawPowerplant
                             
                             ;*****************
614d :                       DemoMenu:               ;returns with Z set, and 
                               direct $d0
                             
614d : bd5292           [ 8]   jsr Text_ShowDemoMenu
6150 : c103             [ 2]   cmpb #3
6152 : 2709             [ 3]   beq dmExit
                             
6154 : 8604             [ 2]   lda #DemoGame
6156 : b7c87a           [ 5]   sta GameMode
                             
6159 : f7c86c           [ 5]   stb DemoSelected
615c : 53               [ 2]   comb
                             
615d :                       dmExit:
                               direct -1
615d : 39               [ 5]   rts
                             
                             ;*****************
615e :                       OptionsMenu:
                             
615e : bd52e4           [ 8]   jsr Text_ShowOptionsMenu
                             
6161 : 5d               [ 2]   tstb
6162 : 2604             [ 3]   bne omNoControls
6164 : 8d55             [ 7]     bsr ControlsMenu
6166 : 202a             [ 3]     bra omExit
6168 :                       omNoControls:
                             
6168 : 5a               [ 2]   decb
6169 : 2604             [ 3]   bne omNoDemo
616b : 8de0             [ 7]     bsr DemoMenu
616d : 2023             [ 3]     bra omExit
616f :                       omNoDemo:
                             
616f : 5a               [ 2]  decb
6170 : 260c             [ 3]  bne omNoResetHi
6172 : bd54d2           [ 8]    jsr Text_ShowResetMenu
6175 : c101             [ 2]    cmpb #1
6177 : 2619             [ 3]    bne omExit
6179 : bd7eb2           [ 8]      jsr eeprom_format
617c : 2014             [ 3]    bra omExit
617e :                       omNoResetHi:
                             
617e : 5a               [ 2]  decb
617f : 2611             [ 3]  bne omNoCheat
                                ;Hidden cheat menu
6181 : bdf1f8           [ 8]    jsr read_joystick
6184 : 7dc81c           [ 7]    tst $c81c
6187 : 2a09             [ 3]    bpl omNoCheat
                                mEmitSound WarpInSoundId
                            >  if 1=1
6189 : 8629             [ 2]>    lda #WarpInSoundId
                            >  endif
618b : bd0476           [ 8]>  jsr EmitSound
                             
618e : 8d03             [ 7]    bsr CheatMenu
6190 : 2000             [ 3]    bra omExit
6192 :                       omNoCheat:
                             
6192 :                       omExit:
6192 : 39               [ 5]   rts
                             
                             ;*****************
6193 :                       CheatMenu:
6193 :                       cmShow:
6193 : bd533b           [ 8]   jsr Text_ShowCheatMenu
                             
6196 : 5d               [ 2]   tstb
6197 : 260a             [ 3]   bne cmNoLives
6199 : 73c86a           [ 7]     com CheatLives
                                 mEmitSound ShipFireSoundId
                            >  if 1=1
619c : 860c             [ 2]>    lda #ShipFireSoundId
                            >  endif
619e : bd0476           [ 8]>  jsr EmitSound
                             
61a1 : 20f0             [ 3]     bra cmShow
61a3 :                       cmNoLives:
                             
61a3 : 5a               [ 2]   decb
61a4 : 2614             [ 3]   bne cmNoLevel
61a6 : b6c86b           [ 5]     lda CheatLevel
61a9 : 8117             [ 2]     cmpa #(LevelCountNormal*4)-1
61ab : 2602             [ 3]     bne cmIncLevel
61ad : 86ff             [ 2]       lda #-1
61af :                       cmIncLevel:
61af : 4c               [ 2]     inca
61b0 : b7c86b           [ 5]     sta CheatLevel
                                 mEmitSound GunFireSoundId
                            >  if 1=1
61b3 : 8608             [ 2]>    lda #GunFireSoundId
                            >  endif
61b5 : bd0476           [ 8]>  jsr EmitSound
                             
61b8 : 20d9             [ 3]     bra cmShow
61ba :                       cmNoLevel
                             
61ba : 39               [ 5]   rts
                             
                             ;*****************
61bb :                       ControlsMenu:
                               mDecLocals 2,0,0
                            >  nolist
                             
                               direct $d0
                             
61bd : 4f               [ 2]   clra
61be : a7e4             [ 4]   sta LocalB1,s
61c0 : a761             [ 5]   sta LocalB2,s
61c2 :                       cmLoop:
61c2 : bd5467           [ 8]   jsr Text_ShowControlMenu
61c5 : a6e4             [ 4]   lda LocalB1,s
61c7 : 48               [ 2]   lsla
61c8 : 48               [ 2]   lsla
61c9 : e77f             [ 5]   stb -1,s
61cb : aa7f             [ 5]   ora -1,s
61cd : a7e4             [ 4]   sta LocalB1,s
61cf : 6c61             [ 7]   inc LocalB2,s
61d1 : a661             [ 5]   lda LocalB2,s
61d3 : 8104             [ 2]   cmpa #4
61d5 : 26eb             [ 3]   bne cmLoop
                             
61d7 : a6e4             [ 4]   lda LocalB1,s
61d9 : b7c880           [ 5]   sta ButtonConfig
                             
                               direct -1
                               mFreeLocals
61dc : 3262             [ 5]>  leas FrameSize,s
                             
61de : 39               [ 5]   rts
                             
                             
                             ;*****************
61df :                       DrawTitleVolume:
                               mDecLocals 3,1,(ShipVectorCount*2)
                            >  nolist
                             
0001 =                       LocalX = LocalB2
0002 =                       LocalMod = LocalB3
0003 =                       LocalVol = LocalW1
                             
61e2 : 8681             [ 2]   lda #-127  ;start x
61e4 : a761             [ 5]   sta LocalX,s
                             
61e6 : 8ec800           [ 3]   ldx #$c800 + 0
61e9 : af63             [ 6]   stx LocalVol,s
                             
61eb : 8603             [ 2]   lda #3
61ed : a7e4             [ 4]   sta LocalB1,s
61ef :                       dtvLoop:
61ef : 10ae63           [ 7]   ldy LocalVol,s
61f2 : a6a0             [ 6]   lda ,y+  ;fine (lo)
61f4 : e6a0             [ 6]   ldb ,y+  ;course (hi)
61f6 : 44               [ 2]   lsra
61f7 : 44               [ 2]   lsra
61f8 : 44               [ 2]   lsra
61f9 : 44               [ 2]   lsra
61fa : 10af63           [ 7]   sty LocalVol,s
61fd : a762             [ 5]   sta LocalMod,s
                             
61ff : bdf354           [ 8]   jsr reset0ref                 ;Reset pen
                             
                               mSetScale 16
                            >  if 1=1
6202 : 8610             [ 2]>    lda #16                  ;if argument exists,
                            >  endif
6204 : 9704             [ 4]>  sta <$04
                             
6206 : e661             [ 5]   ldb LocalX,s
6208 : 8681             [ 2]   lda #-127 ;y
                             ;  mMove_pen_d
620a : bdf312           [ 8]   jsr move_pen_d
                             ;  mMove_pen_d_Quick
                             ;  jsr move_pen7f_to_d           ;Set pen positio
                             
                               mSetIntensity $4f
                            >  if 1=1
620d : 864f             [ 2]>    lda   #$4f            ;if argument exists, lo
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
620f : 9701             [ 4]>  sta   <01
6211 : cc0401           [ 3]>  ldd   #$0401
6214 : 9700             [ 4]>  sta   <00
6216 : d700             [ 4]>  stb   <00
                             
                             
6218 : 8e4b5f           [ 3]   ldx #ShipVectorList
621b : 8609             [ 2]   lda   #ShipVectorCount-1      ;Nr of vectors in
621d : c608             [ 2]   ldb   #8                      ;Scale
621f : eb62             [ 5]   addb LocalMod,s
6221 : bdf3b7           [ 8]   jsr   move_draw_VL4           ;Draw list
                             
6224 : a661             [ 5]   lda LocalX,s
6226 : 8b7f             [ 2]   adda #127
6228 : a761             [ 5]   sta LocalX,s
                             
622a : 6ae4             [ 6]   dec LocalB1,s
622c : 26c1             [ 3]   bne dtvLoop
                             
                               mFreeLocals
622e : 32e819           [ 5]>  leas FrameSize,s
                             
6231 : 39               [ 5]   rts
                             
                             
                             ;*****************
6232 :                       DrawTitleLogo:
                             ;   att testa
                             ;     gör verktyg som genererar kod ifrån bmp
                             ;       mPattern, mRow
                             ;       PacmanLines: dw Pacman_DrawLine01,Pacman_
                             ;       subs anropas av generell drawrutin
                             ;       generar intensity change vid behov
                             ;     dela upp line i två horizontella, då kan sc
                             ;     kan man bumpa upp x-length innan den är kla
                             ;
                             ;     läs igenom "SHIFT REGISTER OPERATION" i vec
                             ;     skriv $18 till 0B för att stänga av andra i
                             ;     se rom DISPLAY_STRING
                               mDecLocals 2,1,0
                            >  nolist
                             
0008 =                       LocalLine=8             ;
001c =                       LocalH=28               ;these were local, but ch
0001 =                       LocalRepeat = LocalB2
0002 =                       LocalBitmap = LocalW1
                             
6234 : 8e6ca5           [ 3]   ldx #TitleBitmap
                             
6237 : a680             [ 6]   lda ,x+               ;load repeat
6239 : a761             [ 5]   sta LocalRepeat,s
                             
623b : af62             [ 6]   stx LocalBitmap,s
                             
623d : 4f               [ 2]   clra                  ;for a=0 to height-1
623e :                       dbiLoop:
623e : a7e4             [ 4]   sta LocalB1,s
                             
                               ;Set intensity
                               ;lda #$60
                               ;Increase/decrease intensity for this line
6240 : b6c826           [ 5]   lda LoopCounterLow
6243 : 2a01             [ 3]   bpl dbiIntOk
6245 : 40               [ 2]   nega
6246 :                       dbiIntOk:
6246 : e6e4             [ 4]   ldb LocalB1,s         ;öka varannan rad, minska
6248 : c501             [ 2]   bitb #1
624a : 2706             [ 3]   beq dbiInt1
624c : a0e4             [ 4]     suba LocalB1,s
624e : a0e4             [ 4]     suba LocalB1,s
6250 : 2002             [ 3]     bra dbiIntSet
6252 :                       dbiInt1:
6252 : abe4             [ 4]     adda LocalB1,s
6254 :                       dbiIntSet:
                               mSetIntensity
                            >  if 0=1
                            >    lda   #            ;if argument exists, load 
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
6254 : 9701             [ 4]>  sta   <01
6256 : cc0401           [ 3]>  ldd   #$0401
6259 : 9700             [ 4]>  sta   <00
625b : d700             [ 4]>  stb   <00
                             
                             
625d : bdf354           [ 8]   jsr reset0ref
                             
6260 : 8602             [ 2]   lda #2                ;loop twice
6262 : a77f             [ 5]   sta -1,s
                             
                               ;Scale 64 for positioning, otherwise y skips ev
                               mSetScale 64
                            >  if 1=1
6264 : 8640             [ 2]>    lda #64                  ;if argument exists,
                            >  endif
6266 : 9704             [ 4]>  sta <$04
                             
                             
6268 : c681             [ 2]   ldb #-127
626a : 860e             [ 2]   lda #LocalH/2          ;set y to vertical cente
626c : a0e4             [ 4]   suba LocalB1,s
626e : bbc8a0           [ 5]   adda TitleLogoY
                             
6271 :                       dbiMoveLine:
                               mMove_pen_d_Quick
6271 : 9701             [ 4]>  sta   <0x01
6273 : 0f00             [ 6]>  clr   <0x00
6275 : 86ce             [ 2]>  lda   #0xCE
6277 : 970c             [ 4]>  sta   <0x0C
6279 : 0f0a             [ 6]>  clr   <0x0A
627b : 0c00             [ 6]>  inc   <0x00
627d : d701             [ 4]>  stb   <0x01
627f : 0f05             [ 6]>  clr   <0x05
6281 : c640             [ 2]>  ldb   #0x40
6283 : d50d             [ 4]>PF33D1628: bitb  <0x0D
6285 : 27fc             [ 3]>  beq   PF33D1628
                            >;PF33B1628: lda   #0x04
                            >;PF3411628: deca
                            >;  bne   PF3411628
                             
                               ;to reach left edge, another x move is needed. 
                               mCombine d,0,-24
6287 : cc00e8           [ 3]>  ldd #(lo 0)<<8 | (lo -24)
                             
628a : 6a7f             [ 7]   dec -1,s
628c : 26e3             [ 3]   bne dbiMoveLine
                             
                               ;Max scale for drawing
                               mSetScale 255
                            >  if 1=1
628e : 86ff             [ 2]>    lda #255                  ;if argument exists
                            >  endif
6290 : 9704             [ 4]>  sta <$04
                             
                             
                             
6292 : ae62             [ 6]   ldx LocalBitmap,s
                             
6294 : 867f             [ 2]   lda #127              ;line length
6296 : 1f89             [ 6]   tfr a,b               ;init hw for line drawing
6298 : 4f               [ 2]   clra
6299 : 9701             [ 4]   sta   <0x01
629b : 0f00             [ 6]   clr   <0x00
629d : 0c00             [ 6]   inc   <0x00
629f : d701             [ 4]   stb   <0x01
62a1 : 0f05             [ 6]   clr   <0x05
                             
                               ;rom inner loop
                             ;37c0 :    PF4C7:
                             ;37c0 : a686             [ 5]   lda   a,x
                             ;37c2 : 970a             [ 4]   sta   <0x0A
                             ;37c4 : a6c0             [ 6]   lda   ,u+
                             ;37c6 : 2af8             [ 3]   bpl   PF4C7
                             ;Total 18 cycles
                             
62a3 : c608             [ 2]   ldb #LocalLine
62a5 :                       dbiLineLoop:
62a5 : a680             [ 6]   lda ,x+    ;6
62a7 : 970a             [ 4]   sta <0x0A  ;4
62a9 : 1a00             [ 3]   orcc #0 ;3
62ab : 5a               [ 2]   decb ;2
62ac : 26f7             [ 3]   bne dbiLineLoop  ;3
                             
62ae : 12               [ 2]   nop 1                         ;wait for the las
                             
62af : 0f0a             [ 6]   clr <0x0a                     ;clear pattern
                             
                             ;No need to wait, line is drawn
                             ;**todo: keep this delay if possible, MESS cannot
                             ;  ldb   #0x40                   ;wait timer fini
                             ;dbiWait
                             ;  bitb  <$0D
                             ;  beq   dbiWait
                             
                             
62b1 : ae62             [ 6]   ldx LocalBitmap,s             ;next row
62b3 : 6a61             [ 7]   dec LocalRepeat,s
62b5 : 2606             [ 3]   bne dbiKeepRepeating
62b7 : 3008             [ 5]     leax LocalLine,x
62b9 : a680             [ 6]     lda ,x+
62bb : a761             [ 5]     sta LocalRepeat,s
62bd :                       dbiKeepRepeating:
62bd : af62             [ 6]   stx LocalBitmap,s
                             
62bf : a6e4             [ 4]   lda LocalB1,s
62c1 : 4c               [ 2]   inca
62c2 : 811c             [ 2]   cmpa #LocalH
62c4 : 1026ff76         [ 6]   bne dbiLoop
                             
62c8 : b6c8a0           [ 5]   lda TitleLogoY                ;move logo down
62cb : 8114             [ 2]   cmpa #20
62cd : 2704             [ 3]   beq dbiNoAdjustY
62cf : 4a               [ 2]     deca
62d0 : b7c8a0           [ 5]     sta TitleLogoY
62d3 :                       dbiNoAdjustY:
                             
                               mFreeLocals
62d3 : 3264             [ 5]>  leas FrameSize,s
                             
62d5 : 39               [ 5]   rts
                             
                             
                             
                             
                             ;   custom typsnitt där varje bokstav är två teck
                             ;   scrolla pixels genom att flytta x och maska f
                             ;
                             ;   skapa sträng på stacken
                             ;     skriv start and-mask
                             ;     get char
                             ;     konvertera till två tecken
                             ;       eller ett tecken två pekare
                             ;       x=fonttable1, y=fonttable2
                             ;       om loopcounterlow 8..15
                             ;         börja med y öka 1, x sen y sen öka 1, s
                             ;       0..7
                             ;         x sen y sen öka 1
                             ;       börja med vanlig loop, dista x 0..15
                             ;       gör hela draw till macro, anropa två ggr 
                             ;     skriv till stack
                             ;     ev loopa text
                             ;     skriv slut and-mask
                             ;   display_rom
                             ;     unroll char-loop
                             ;     gör till macro och anropa så många ggr som 
                             ;
                             ;   hämta fatfont.dat
                             ;     räkna hur många tecken den innehåller
                             ;     writebyte(char,value)
                             
                             ;*****************
62d6 :                       DrawCreditsScroller:
0010 =                       Chars = 16  ;Chars visible at the same time
                               mDecLocals 1,0,Chars
                            >  nolist
                             
                             
62d9 : b6c826           [ 5]   lda LoopCounterLow
62dc : 8403             [ 2]   anda #3
62de : 2608             [ 3]   bne dcsNoNewChar
62e0 : bec8a3           [ 6]     ldx ScrollTextPtr
62e3 : 3001             [ 5]     leax 1,x
                             ;    cmpx #CreditsTextEnd - Chars
                             ;    bne dcsNoWrap
                             ;      ldx #CreditsText
                             ;dcsNoWrap:
62e5 : bfc8a3           [ 6]     stx ScrollTextPtr
62e8 :                       dcsNoNewChar:
62e8 : 48               [ 2]   lsla
62e9 : 48               [ 2]   lsla
62ea : a7e4             [ 4]   sta LocalB1,s
                             
                               ;FC = one space line, FB = one every 4 lines, F
62ec : ccfa38           [ 3]   ldd   #0xFA38
62ef : fdc82a           [ 6]   std   $C82A           ;Specify height and width
62f2 : bdf354           [ 8]   jsr reset0ref
                               mSetScale $7f
                            >  if 1=1
62f5 : 867f             [ 2]>    lda #$7f                  ;if argument exists
                            >  endif
62f7 : 9704             [ 4]>  sta <$04
                             
                             
62f9 : b6c8a2           [ 5]   lda ScrollInt
62fc : 817f             [ 2]   cmpa #$7f
62fe : 2704             [ 3]   beq dcsNoIncInt
6300 : 4c               [ 2]     inca
6301 : b7c8a2           [ 5]     sta ScrollInt
6304 :                       dcsNoIncInt:
                               mSetIntensity
                            >  if 0=1
                            >    lda   #            ;if argument exists, load 
                            >  endif
                            >  if false
                            >    sta   <01
                            >    ;sta   $C827
                            >    ldd   #$0504
                            >    sta   <00
                            >    stb   <00
                            >    stb   <00
                            >    ldb   #01
                            >    stb   <00
                            >  endif
6304 : 9701             [ 4]>  sta   <01
6306 : cc0401           [ 3]>  ldd   #$0401
6309 : 9700             [ 4]>  sta   <00
630b : d700             [ 4]>  stb   <00
                             
                             
                               ;index,freq,amp,first
                               mSine SineIndex1,2,1,1
                            > if 1=1
630d : 8e6d2c           [ 3]>   ldx #SineTable
                            > endif
6310 : f6c8a5           [ 5]> ldb SineIndex1
6313 : cb02             [ 2]> addb #2
6315 : 2a02             [ 3]> bpl ok1647
6317 : c080             [ 2]>   subb #128
6319 :                      >ok1647:
6319 : f7c8a5           [ 5]> stb SineIndex1
631c : e685             [ 5]> ldb b,x
                            > if 1>2
                            >   asrb
                            > endif
                            > if 1>1
                            >   asrb
                            > endif
                            > if 1>0
631e : 57               [ 2]>   asrb
                            > endif
                            > if 1=1
631f : 1f98             [ 6]>   tfr b,a
                            > else
                            >   stb -1,s
                            >   adda -1,s
                            > endif
                             
                               mSine SineIndex2,1,2,0
                            > if 0=1
                            >   ldx #SineTable
                            > endif
6321 : f6c8a6           [ 5]> ldb SineIndex2
6324 : cb01             [ 2]> addb #1
6326 : 2a02             [ 3]> bpl ok1648
6328 : c080             [ 2]>   subb #128
632a :                      >ok1648:
632a : f7c8a6           [ 5]> stb SineIndex2
632d : e685             [ 5]> ldb b,x
                            > if 2>2
                            >   asrb
                            > endif
                            > if 2>1
632f : 57               [ 2]>   asrb
                            > endif
                            > if 2>0
6330 : 57               [ 2]>   asrb
                            > endif
                            > if 0=1
                            >   tfr b,a
                            > else
6331 : e77f             [ 5]>   stb -1,s
6333 : ab7f             [ 5]>   adda -1,s
                            > endif
                             
                             
6335 : c691             [ 2]   ldb #-127 + 16
                             
6337 : e0e4             [ 4]   subb LocalB1,s
6339 : bdf312           [ 8]   jsr move_pen_d
                             
633c : fec8a3           [ 6]   ldu ScrollTextPtr
633f : bd63ed           [ 8]   jsr Credits_Draw_display_string
                             
                               mFreeLocals
6342 : 32e811           [ 5]>  leas FrameSize,s
                             
6345 : 39               [ 5]   rts
                             
                             
                             
                             
6346 :                       CreditsText:
6346 : 20202020202020..        db '                VECTREX THRUST V1.2 BY VILL
63ed :                       CreditsTextEnd:
                             
                             ;Copied from ROM: display_string
                             ;Modified to draw 16*16 pixel font
63ed :                       Credits_Draw_display_string:
63ed : ffc82c           [ 6]        stu   $C82C     ;/* Save pointer to start 
                             
                             ;       ldx   #0xF9D4
63f0 : 8e6541           [ 3]  ldx #FontTable1-32
63f3 : 108e68e3         [ 4]  ldy #FontTable2-32
                             
63f7 : cc1883           [ 3]        ldd   #0x1883
63fa : 0f01             [ 6]        clr   <0x01
63fc : 970b             [ 4]        sta   <0x0B
                             ;       ldx   #0xF9D4
63fe : 1a00             [ 3]   orcc #0  ;wait 3 cycles
6400 : d700             [ 4] PF4A5: stb   <0x00
6402 : 0a00             [ 6]        dec   <0x00
6404 : cc8081           [ 3]        ldd   #0x8081
6407 : 12               [ 2]        nop
6408 : 0c00             [ 6]        inc   <0x00
640a : d700             [ 4]        stb   <0x00
640c : 9700             [ 4]        sta   <0x00
640e : 7dc800           [ 7]        tst   $C800
6411 : 0c00             [ 6]        inc   <0x00
6413 : b6c82b           [ 5]        lda   $C82B    ;/* Get the string width. *
6416 : 9701             [ 4]        sta   <0x01
6418 : cc0100           [ 3]        ldd   #0x0100
641b : fec82c           [ 6]        ldu   $C82C
641e : 9700             [ 4]        sta   <0x00
                             
                             
                             ;[ 3]        bra   PF4CB
                             ;[ 5] PF4C7: lda   a,x
                             ;[ 4]        sta   <0x0A
                             ;[ 6] PF4CB: lda   ,u+
                             ;[ 3]        bpl   PF4C7
                             
6420 : 1a00             [ 3]   orcc #0  ;wait 3 cycles
                             
                             _m macro
                               lda   ,u+
                               orcc #0  ;wait 3 cycles
                               ldb   a,x
                               stb   <0x0A
                               orcc #0  ;wait 3 cycles
                               tst ,x   ;wait 6 cycles
                               ldb   a,y
                               stb   <0x0A
                              endm
                             
                             ;**todo behövs unroll? om inte, byt tillbaka till
                             
                              _m
6422 : a6c0             [ 6]>  lda   ,u+
6424 : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
6426 : e686             [ 5]>  ldb   a,x
6428 : d70a             [ 4]>  stb   <0x0A
642a : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
642c : 6d84             [ 6]>  tst ,x   ;wait 6 cycles
642e : e6a6             [ 5]>  ldb   a,y
6430 : d70a             [ 4]>  stb   <0x0A
                             
                              _m
6432 : a6c0             [ 6]>  lda   ,u+
6434 : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
6436 : e686             [ 5]>  ldb   a,x
6438 : d70a             [ 4]>  stb   <0x0A
643a : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
643c : 6d84             [ 6]>  tst ,x   ;wait 6 cycles
643e : e6a6             [ 5]>  ldb   a,y
6440 : d70a             [ 4]>  stb   <0x0A
                             
                              _m
6442 : a6c0             [ 6]>  lda   ,u+
6444 : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
6446 : e686             [ 5]>  ldb   a,x
6448 : d70a             [ 4]>  stb   <0x0A
644a : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
644c : 6d84             [ 6]>  tst ,x   ;wait 6 cycles
644e : e6a6             [ 5]>  ldb   a,y
6450 : d70a             [ 4]>  stb   <0x0A
                             
                              _m
6452 : a6c0             [ 6]>  lda   ,u+
6454 : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
6456 : e686             [ 5]>  ldb   a,x
6458 : d70a             [ 4]>  stb   <0x0A
645a : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
645c : 6d84             [ 6]>  tst ,x   ;wait 6 cycles
645e : e6a6             [ 5]>  ldb   a,y
6460 : d70a             [ 4]>  stb   <0x0A
                             
                              _m
6462 : a6c0             [ 6]>  lda   ,u+
6464 : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
6466 : e686             [ 5]>  ldb   a,x
6468 : d70a             [ 4]>  stb   <0x0A
646a : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
646c : 6d84             [ 6]>  tst ,x   ;wait 6 cycles
646e : e6a6             [ 5]>  ldb   a,y
6470 : d70a             [ 4]>  stb   <0x0A
                             
                              _m
6472 : a6c0             [ 6]>  lda   ,u+
6474 : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
6476 : e686             [ 5]>  ldb   a,x
6478 : d70a             [ 4]>  stb   <0x0A
647a : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
647c : 6d84             [ 6]>  tst ,x   ;wait 6 cycles
647e : e6a6             [ 5]>  ldb   a,y
6480 : d70a             [ 4]>  stb   <0x0A
                             
                              _m
6482 : a6c0             [ 6]>  lda   ,u+
6484 : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
6486 : e686             [ 5]>  ldb   a,x
6488 : d70a             [ 4]>  stb   <0x0A
648a : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
648c : 6d84             [ 6]>  tst ,x   ;wait 6 cycles
648e : e6a6             [ 5]>  ldb   a,y
6490 : d70a             [ 4]>  stb   <0x0A
                             
                              _m
6492 : a6c0             [ 6]>  lda   ,u+
6494 : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
6496 : e686             [ 5]>  ldb   a,x
6498 : d70a             [ 4]>  stb   <0x0A
649a : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
649c : 6d84             [ 6]>  tst ,x   ;wait 6 cycles
649e : e6a6             [ 5]>  ldb   a,y
64a0 : d70a             [ 4]>  stb   <0x0A
                             
                             
                              _m
64a2 : a6c0             [ 6]>  lda   ,u+
64a4 : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
64a6 : e686             [ 5]>  ldb   a,x
64a8 : d70a             [ 4]>  stb   <0x0A
64aa : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
64ac : 6d84             [ 6]>  tst ,x   ;wait 6 cycles
64ae : e6a6             [ 5]>  ldb   a,y
64b0 : d70a             [ 4]>  stb   <0x0A
                             
                              _m
64b2 : a6c0             [ 6]>  lda   ,u+
64b4 : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
64b6 : e686             [ 5]>  ldb   a,x
64b8 : d70a             [ 4]>  stb   <0x0A
64ba : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
64bc : 6d84             [ 6]>  tst ,x   ;wait 6 cycles
64be : e6a6             [ 5]>  ldb   a,y
64c0 : d70a             [ 4]>  stb   <0x0A
                             
                              _m
64c2 : a6c0             [ 6]>  lda   ,u+
64c4 : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
64c6 : e686             [ 5]>  ldb   a,x
64c8 : d70a             [ 4]>  stb   <0x0A
64ca : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
64cc : 6d84             [ 6]>  tst ,x   ;wait 6 cycles
64ce : e6a6             [ 5]>  ldb   a,y
64d0 : d70a             [ 4]>  stb   <0x0A
                             
                              _m
64d2 : a6c0             [ 6]>  lda   ,u+
64d4 : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
64d6 : e686             [ 5]>  ldb   a,x
64d8 : d70a             [ 4]>  stb   <0x0A
64da : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
64dc : 6d84             [ 6]>  tst ,x   ;wait 6 cycles
64de : e6a6             [ 5]>  ldb   a,y
64e0 : d70a             [ 4]>  stb   <0x0A
                             
                              _m
64e2 : a6c0             [ 6]>  lda   ,u+
64e4 : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
64e6 : e686             [ 5]>  ldb   a,x
64e8 : d70a             [ 4]>  stb   <0x0A
64ea : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
64ec : 6d84             [ 6]>  tst ,x   ;wait 6 cycles
64ee : e6a6             [ 5]>  ldb   a,y
64f0 : d70a             [ 4]>  stb   <0x0A
                             
                              _m
64f2 : a6c0             [ 6]>  lda   ,u+
64f4 : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
64f6 : e686             [ 5]>  ldb   a,x
64f8 : d70a             [ 4]>  stb   <0x0A
64fa : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
64fc : 6d84             [ 6]>  tst ,x   ;wait 6 cycles
64fe : e6a6             [ 5]>  ldb   a,y
6500 : d70a             [ 4]>  stb   <0x0A
                             
                              _m
6502 : a6c0             [ 6]>  lda   ,u+
6504 : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
6506 : e686             [ 5]>  ldb   a,x
6508 : d70a             [ 4]>  stb   <0x0A
650a : 1a00             [ 3]>  orcc #0  ;wait 3 cycles
650c : 6d84             [ 6]>  tst ,x   ;wait 6 cycles
650e : e6a6             [ 5]>  ldb   a,y
6510 : d70a             [ 4]>  stb   <0x0A
                             
                             
6512 : a6c0             [ 6]   lda ,u+       ;6 cycles, increase u to printed 
6514 : 1a00             [ 3]   orcc #0  ;wait 3 cycles
                             
6516 : 8681             [ 2]        lda   #0x81
6518 : 9700             [ 4]        sta   <0x00
651a : 0001             [ 6]        neg   <0x01
651c : 8601             [ 2]        lda   #0x01
651e : 9700             [ 4]        sta   <0x00
                             
                             ;       cmpx  #0xFBB4  ;/* If not at end of char 
6520 : 8c68a5           [ 4]   cmpx #(FontTable1-32) + (14*62)
6523 : 2737             [ 3]        beq   PF50A    ;/* proceed to next row of 
                             
                             ;       leax  0x50,x     ;add to font definition 
6525 : 30883e           [ 5]   leax 62,x
6528 : 31a83e           [ 5]   leay 62,y
                             
652b : 1f30             [ 6]        tfr   u,d
652d : b3c82c           [ 7]        subd  $C82C    ;/* Point back to first cha
6530 : c002             [ 2]        subb  #0x02      ;waitloop, depending on s
6532 : 58               [ 2]        aslb
                               ;wait*2 because we now use width*2 font
6533 : 58               [ 2]   aslb
6534 : 121212121212     [12]   nop 6
653a : 2100             [ 3]        brn   PF4EB
653c : 8681             [ 2] PF4EB: lda   #0x81
653e : 12               [ 2]        nop
653f : 5a               [ 2]        decb
6540 : 26fa             [ 3]        bne   PF4EB
                             
6542 : 9700             [ 4]        sta   <0x00
6544 : f6c82a           [ 5]        ldb   $C82A      ;height
6547 : d701             [ 4]        stb   <0x01
6549 : 0a00             [ 6]        dec   <0x00
                             
654b : cc8101           [ 3]        ldd   #0x8101
654e : 12               [ 2]        nop
654f : 9700             [ 4]        sta   <0x00
6551 : 0f01             [ 6]        clr   <0x01
6553 : d700             [ 4]        stb   <0x00
6555 : 9700             [ 4]        sta   <0x00
6557 : c603             [ 2]        ldb   #0x03
6559 : 7e6400           [ 4]        bra   PF4A5
655c : 8698             [ 2] PF50A: lda   #0x98
655e : 970b             [ 4]        sta   <0x0B
6560 : 39               [ 5]  rts
                             ;       jmp reset0ref
                             
                             
                             ;todo: many unused letters, save memory by having
6561 :                       FontTable1:
                             ; db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
6561 : 0003060606181f..       db 0,3,6,6,6,24,31,0,3,3,0,0,0,0,0,0,15,7,15,15,
659f : 00070f0e3f3c7f..       db 0,7,15,14,63,60,127,1,7,3,1,3,0,0,0,0,63,15,6
65dd : 00071e0e7f66f9..       db 0,7,30,14,127,102,249,3,15,1,25,3,0,0,0,0,127
661b : 00073c3f7f66f0..       db 0,7,60,63,127,102,240,7,14,0,29,3,0,0,0,0,127
6659 : 0007187f763c79..       db 0,7,24,127,118,60,121,3,30,0,15,3,0,0,0,0,252
6697 : 0007007f7f193f..       db 0,7,0,127,127,25,63,0,28,0,7,63,0,63,0,1,248,
66d5 : 0007000e7f031f..       db 0,7,0,14,127,3,31,0,28,0,63,63,0,63,0,3,248,3
6713 : 0007000e3f071f..       db 0,7,0,14,63,7,31,0,28,0,63,63,0,63,0,7,248,3,
6751 : 0003003f060f3f..       db 0,3,0,63,6,15,63,0,28,0,7,3,0,0,0,15,248,3,3,
678f : 0000007f061f79..       db 0,0,0,127,6,31,121,0,28,0,15,3,0,0,0,31,248,3
67cd : 0000007f7f3ef0..       db 0,0,0,127,127,62,240,0,30,0,29,3,0,0,0,62,252
680b : 0003000e7f7cf8..       db 0,3,0,14,127,124,248,0,14,0,25,3,3,0,3,124,12
6849 : 0007000e7f787f..       db 0,7,0,14,127,120,127,0,15,1,1,0,7,0,7,248,127
6887 : 0007000c06307f..       db 0,7,0,12,6,48,127,0,7,3,0,0,15,0,7,240,63,15,
68c5 : 0003000000001f..       db 0,3,0,0,0,0,31,0,3,3,0,0,30,0,3,96,15,15,127,
6903 :                       FontTable2:
                             ; db 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
6903 : 00801830600c80..       db 0,128,24,48,96,12,128,192,128,128,0,0,0,0,0,1
6941 : 00c03c70fc1ee0..       db 0,192,60,112,252,30,224,224,128,192,128,128,0
697f : 00c07870fc3ef0..       db 0,192,120,112,252,62,240,192,0,224,152,128,0,
69bd : 00c0f0fefc7cf0..       db 0,192,240,254,252,124,240,128,0,224,184,128,0
69fb : 00c060fe60f8e0..       db 0,192,96,254,96,248,224,0,0,240,240,128,0,0,0
6a39 : 00c000fcfcf0c0..       db 0,192,0,252,252,240,192,0,0,112,224,248,0,248
6a77 : 00c00070fee080..       db 0,192,0,112,254,224,128,0,0,112,252,248,0,248
6ab5 : 00c00070fec08c..       db 0,192,0,112,254,192,140,0,0,112,252,248,0,248
6af3 : 008000fe6e98de..       db 0,128,0,254,110,152,222,0,0,112,224,128,0,0,0
6b31 : 000000fe6e3cfc..       db 0,0,0,254,110,60,252,0,0,112,240,128,0,0,0,0,
6b6f : 000000fcfe66f8..       db 0,0,0,252,254,102,248,0,0,240,184,128,0,0,0,0
6bad : 00800070fe66f8..       db 0,128,0,112,254,102,248,0,0,224,152,128,192,0
6beb : 00c00070fc3cfc..       db 0,192,0,112,252,60,252,0,0,224,128,0,192,0,19
6c29 : 00c000606018de..       db 0,192,0,96,96,24,222,0,128,192,0,0,128,0,192,
6c67 : 0080000000008c..       db 0,128,0,0,0,0,140,0,128,128,0,0,0,0,128,0,224
                             
                             
6ca5 :                       TitleBitmap:
                              ;thrust 64*28
                              ;repeatvalue, bitmap
6ca5 : 07ffffffffffff..       db 7, $FF,$FF,$FF,$FF,$FF,$FF,$FF,$FF
6cae : 03000000000000..       db 3, $00,$00,$00,$00,$00,$00,$00,$00
6cb7 : 011e1e39ff78e7..       db 1, $1E,$1E,$39,$FF,$78,$E7,$FC,$FF
6cc0 : 021e1e39ff78ef..       db 2, $1E,$1E,$39,$FF,$78,$EF,$FC,$FF
6cc9 : 011e1e39c778ef..       db 1, $1E,$1E,$39,$C7,$78,$EF,$FC,$FF
6cd2 : 021e1e39c778ef..       db 2, $1E,$1E,$39,$C7,$78,$EF,$00,$3C
6cdb : 011e1ff9c778ef..       db 1, $1E,$1F,$F9,$C7,$78,$EF,$00,$3C
6ce4 : 021e1ff9c778ef..       db 2, $1E,$1F,$F9,$C7,$78,$EF,$FC,$3C
6ced : 011e1ff9ff78e7..       db 1, $1E,$1F,$F9,$FF,$78,$E7,$FC,$3C
6cf6 : 011e1ff9ff78e0..       db 1, $1E,$1F,$F9,$FF,$78,$E0,$1C,$3C
6cff : 011e1e39ff78e0..       db 1, $1E,$1E,$39,$FF,$78,$E0,$1C,$3C
6d08 : 021e1e39fc7fe0..       db 2, $1E,$1E,$39,$FC,$7F,$E0,$1C,$3C
6d11 : 021e1e39de7fef..       db 2, $1E,$1E,$39,$DE,$7F,$EF,$FC,$3C
6d1a : 011e1e39cf3fef..       db 1, $1E,$1E,$39,$CF,$3F,$EF,$FC,$3C
6d23 : 011e1e39cf3fcf..       db 1, $1E,$1E,$39,$CF,$3F,$CF,$FC,$3C
                             
                             ;128 values, range -63 -- +63
6d2c :                       SineTable:
6d2c : 000306090c0f12..       db 0,3,6,9,12,15,18,21,24,27,30,32,35,38,40,42,4
6d47 : 3d3e3e3f3f3f3f..       db 61,62,62,63,63,63,63,63,62,62,61,60,59,58,57,
6d61 : 201e1b1815120f..       db 32,30,27,24,21,18,15,12,9,6,3,0,-3,-6,-9,-12,
6d79 : dad8d6d3d1cfcd..       db -38,-40,-42,-45,-47,-49,-51,-52,-54,-56,-57,-
6d8c : c1c1c1c2c2c3c4..       db -63,-63,-63,-62,-62,-61,-60,-59,-58,-57,-56,-
6d9f : dadde0e2e5e8eb..       db -38,-35,-32,-30,-27,-24,-21,-18,-15,-12,-9,-6
                             
                             
                             
                             
                             ;Music_RAM_Size = 400                  ;Reserve m
                              include "Thrust_music.asm"
                             ; Music player
                             ; Copyright (C) 2004  Ville Krumlinde
                             ;
                             ; Translated from original 68000 code and music d
                             ;
                             
                             ;-----------------
                             ;Vectrex RAM section
                               bss
c880 =                         org $c880
                             
                             ;Uncomment to make music use top of ram
c880 =                         ds 1024 - 392 - $80 - 100
                             
ca14 =                       TEMP_D0: ds 2
ca16 =                       TEMP_D1: ds 2
ca18 =                       TEMP_D4: ds 2
ca1a =                       TEMP_D5: ds 2
ca1c =                       TEMP_D6: ds 2
                             
                               ;Work memory for soundplayer, data is copied fr
ca1e =                       LA5_BASE: ds 76
ca6a =                       L0596E6:  ds 102
cad0 =                       L05974C:  ds 102
cb36 =                       L0597B2:  ds 102
                             
                               code
                             
                             
                             ;----------------------
                             ; Music player
6dac :                       InitMusic:
6dac : bdf1aa           [ 8]   jsr dptoD0
                             
                               ;6809: copy work-data from rom to ram
6daf : ce7c13           [ 3]   ldu #LA5_BASE_ROM
6db2 : 8eca4c           [ 3]   ldx #LA5_BASE+46  ;offset 46 is the first one u
6db5 : 864c             [ 2]   lda #76
6db7 : bdf683           [ 8]   jsr move_block2
                             
6dba : ce7c31           [ 3]   ldu #L0596E6_ROM
6dbd : 8eca6a           [ 3]   ldx #L0596E6
6dc0 : 8666             [ 2]   lda #102
6dc2 : bdf683           [ 8]   jsr move_block2
                             
6dc5 : ce7c97           [ 3]   ldu #L05974C_ROM
6dc8 : 8ecad0           [ 3]   ldx #L05974C
6dcb : 8666             [ 2]   lda #102
6dcd : bdf683           [ 8]   jsr move_block2
                             
6dd0 : ce7cfd           [ 3]   ldu #L0597B2_ROM
6dd3 : 8ecb36           [ 3]   ldx #L0597B2
6dd6 : 8666             [ 2]   lda #102
6dd8 : bdf683           [ 8]   jsr move_block2
                             
                             
                             
                                     ; LEA LA5_BASE,A5
                                     ; CLR.W $2E(A5)
                                     ; MOVEQ #$D,D1
                                     ;L059100:
                                     ; MOVE.B D1,$FF8800
                                     ; CLR.B $FF8802
                                     ; DBRA D1,L059100
6ddb : 108eca1e         [ 4]   ldy #LA5_BASE
6ddf : cc0000           [ 3]   ldd #0
6de2 : eda82e           [ 6]   std $2e,y
6de5 : bdf272           [ 8]   jsr clear_sound_chip
                             
                                     ; MOVE.B #7,$FF8800
                                     ; MOVE.B #-1,$FF8802
                                     ; MOVE.B #-1,$41(A5)
                                     ; NOP
                                     ; LEA LA5_BASE,A5
                                     ; CLR.W $2E(A5)
                               ;set mixer register
6de8 : 8607             [ 2]   lda #7
6dea : c63f             [ 2]   ldb #%00111111  ;init mixer register, notes off
6dec : 108eca1e         [ 4]   ldy #LA5_BASE
6df0 : e7a841           [ 5]   stb $41,y
6df3 : bdf256           [ 8]   jsr byte_2_sound_chip
                             
                                     ; MOVE.B #-8,$38(A5)
                                     ; LEA L0596E6,A1
                                     ; MULU #$C,D0
                                     ; CLR.L D0
                                     ; MOVEQ #2,D7
6df6 : 86f8             [ 2]   lda #-8
6df8 : a7a838           [ 5]   sta $38,y
6dfb : ceca6a           [ 3]   ldu #L0596E6
6dfe : 8603             [ 2]   lda #3  ;nr of channels
6e00 : c600             [ 2]   ldb #0
6e02 :                       L059142:                ;init channel loop
                                     ; LEA L059818,A0
                                     ; MOVEA.L A0,A2
                                     ; ADDA.L 0(A0,D0.W),A2
                                     ; MOVE.L A2,8(A1)
                                     ; MOVE.W #1,$28(A1)
                                     ; CLR.W 0(A1)
                                     ; CLR.B $5C(A1)
                                     ; MOVE.L #4,$C(A1)
6e02 : 3406             [ 7]   pshs d
                             
6e04 : 8e738b           [ 3]   ldx #L059818
6e07 : 10ae85           [ 7]   ldy b,x
                             
6e0a : 1f10             [ 6]   tfr x,d
6e0c : 3420             [ 7]   pshs y
6e0e : e3e1             [ 9]   addd ,s++
6e10 : 1f01             [ 6]   tfr d,x
                             
6e12 : af4a             [ 6]   stx 8+2,u
6e14 : cc0001           [ 3]   ldd #1
6e17 : edc828           [ 6]   std $28,u
6e1a : cc0000           [ 3]   ldd #0
6e1d : edc4             [ 5]   std ,u
6e1f : a7c85c           [ 5]   sta $5c,u
6e22 : cc0002           [ 3]   ldd #4-2
6e25 : ed4e             [ 6]   std $c+2,u
                             
                               ; set up pointer to first pattern
                                     ; LEA L059818,A3
                                     ; ADDA.L (A2),A3
                                     ; MOVE.L A3,4(A1)
6e27 : 108e738b         [ 4]   ldy #L059818
6e2b : ec84             [ 5]   ldd ,x
6e2d : 31ab             [ 8]   leay d,y
6e2f : 10af46           [ 7]   sty 4+2,u
                             
                                     ; ADDQ.W #4,D0
                                     ; ADDA.L #$66,A1         ;+102 = next cha
                                     ; DBRA D7,L059142
6e32 : 8666             [ 2]   lda #102
6e34 : 33c6             [ 5]   leau a,u
6e36 : 3506             [ 7]   puls d
6e38 : 5c               [ 2]   incb
6e39 : 5c               [ 2]   incb
6e3a : 4a               [ 2]   deca
6e3b : 26c5             [ 3]   bne L059142
                             
                                     ; MOVE.W #1,$32(A5)
                                     ; ST.B $2E(A5)
6e3d : 108eca1e         [ 4]   ldy #LA5_BASE
6e41 : cc0001           [ 3]   ldd #1
6e44 : eda832           [ 6]   std $32,y
6e47 : 86ff             [ 2]   lda #$ff
6e49 : a7a82e           [ 5]   sta $2e,y
                             
                                     ; this label is only used to jump directl
                                     ; L059186:
                                     ; RTS
6e4c : 39               [ 5]   rts
                             
                             
6e4d :                       UpdateMusic:  ;call each vbl
                                     ; LEA LA5_BASE,A5
                                     ; TST.W $2E(A5)
                                     ; BEQ.S L059186
6e4d : 108eca1e         [ 4]   ldy #LA5_BASE
6e51 : eca82e           [ 6]   ldd $2e,y
6e54 : 10270093         [ 6]   lbeq EXIT_UPDATE
                             
                                     ; MOVE.B $34(A5),D0
                                     ; MOVE.B D0,$36(A5)
6e58 : a6a834           [ 5]   lda $34,y
6e5b : a7a836           [ 5]   sta $36,y
                             
                                     ; SUBQ.W #1,$32(A5)
                                     ; BNE.S L0591C0
6e5e : eca832           [ 6]   ldd $32,y
6e61 : 830001           [ 4]   subd #1
6e64 : eda832           [ 6]   std $32,y
6e67 : 261c             [ 3]   bne L0591C0
                             
                                     ; LEA L0596E6,A1
                                     ; BSR L059228
                                     ; LEA L05974C,A1
                                     ; BSR L059228
                                     ; LEA L0597B2,A1
                                     ; BSR L059228
6e69 : 8eca6a           [ 3]   ldx #L0596E6
6e6c : bd6eec           [ 8]   jsr L059228
6e6f : 8ecad0           [ 3]   ldx #L05974C
6e72 : bd6eec           [ 8]   jsr L059228
6e75 : 8ecb36           [ 3]   ldx #L0597B2
6e78 : bd6eec           [ 8]   jsr L059228
                             
                                     ; MOVE.W $30(A5),D0
                                     ; MOVE.W D0,$32(A5)
6e7b : 108eca1e         [ 4]   ldy #LA5_BASE
6e7f : eca830           [ 6]   ldd $30,y
6e82 : eda832           [ 6]   std $32,y
                             
6e85 :                       L0591C0:
                               ;L059418 returns three bytes, two bytes in d5, 
                               ;d5 holds channel pitch hi/lo, d4 holds channel
                               ;these values are written to LA5_BASE register 
                                     ; LEA L0596E6,A1
                                     ; BSR L059418
                                     ; MOVE.B D5,$3A(A5)
                                     ; LSR.W #8,D5
                                     ; MOVE.B D5,$3B(A5)
                                     ; MOVE.B D4,$42(A5)
6e85 : 8eca6a           [ 3]   ldx #L0596E6
6e88 : bd70c1           [ 8]   jsr L059418
6e8b : 108eca1e         [ 4]   ldy #LA5_BASE
6e8f : fcca1a           [ 6]   ldd TEMP_D5
6e92 : e7a83a           [ 5]   stb $3a,y
6e95 : a7a83b           [ 5]   sta $3b,y
6e98 : fcca18           [ 6]   ldd TEMP_D4
                             ; ldb #0        ;uncomment to mute channel 1
6e9b : e7a842           [ 5]   stb $42,y
                                     ; LEA L05974C,A1
                                     ; BSR L059418
                                     ; MOVE.B D5,$3C(A5)
                                     ; LSR.W #8,D5
                                     ; MOVE.B D5,$3D(A5)
                                     ; MOVE.B D4,$43(A5)
6e9e : 8ecad0           [ 3]   ldx #L05974C
6ea1 : bd70c1           [ 8]   jsr L059418
6ea4 : 108eca1e         [ 4]   ldy #LA5_BASE
6ea8 : fcca1a           [ 6]   ldd TEMP_D5
6eab : e7a83c           [ 5]   stb $3c,y
6eae : a7a83d           [ 5]   sta $3d,y
6eb1 : fcca18           [ 6]   ldd TEMP_D4
                             ; ldb #0        ;uncomment to mute channel 2
6eb4 : e7a843           [ 5]   stb $43,y
                                     ; LEA L0597B2,A1
                                     ; BSR L059418
                                     ; MOVE.B D5,$3E(A5)
                                     ; LSR.W #8,D5
                                     ; MOVE.B D5,$3F(A5)
                                     ; MOVE.B D4,$44(A5)
6eb7 : 8ecb36           [ 3]   ldx #L0597B2
6eba : bd70c1           [ 8]   jsr L059418
6ebd : 108eca1e         [ 4]   ldy #LA5_BASE
6ec1 : fcca1a           [ 6]   ldd TEMP_D5
6ec4 : e7a83e           [ 5]   stb $3e,y
6ec7 : a7a83f           [ 5]   sta $3f,y
6eca : fcca18           [ 6]   ldd TEMP_D4
                             ; ldb #0        ;uncomment to mute channel 3
6ecd : e7a844           [ 5]   stb $44,y
                             
                                     ; MOVE.B $36(A5),D0
                                     ; MOVE.B D0,$40(A5)
6ed0 : 108eca1e         [ 4]   ldy #LA5_BASE
6ed4 : a6a836           [ 5]   lda $36,y
6ed7 : a7a840           [ 5]   sta $40,y    ;noise pitch
                             
                              ;**debug, force mixer register
                             ; ldb $41,y
                             ; andb #%00000111 ;keep tone
                             ; orb  #%00010000 ;noise off
                             ; stb $41,y
                             
                             
                               ;write all sound chip registers at once
                                     ; MOVEQ #$D,D1
                                     ; MOVEA.L A5,A0
                                     ; ADDA.L #$48,A0  ;a5_offset
                                     ;L059214:
                                     ; MOVE.B D1,$FF8800
                                     ; MOVE.B -(A0),D0
                                     ; MOVE.B D0,$FF8802
                                     ; DBRA D1,L059214
6eda : 860d             [ 2]   lda #$d
6edc : 30a848           [ 5]   leax $48,y
6edf :                       L059214:
6edf : e682             [ 6]   ldb ,-x
6ee1 : 3416             [ 9]   pshs x,d
6ee3 : bdf256           [ 8]   jsr byte_2_sound_chip
6ee6 : 3516             [ 9]   puls x,d
6ee8 : 4a               [ 2]   deca
6ee9 : 2af4             [ 3]   bpl L059214
                             
6eeb :                       EXIT_UPDATE:
                                     ; RTS
6eeb : 39               [ 5]   rts
                             
                             
                             
                              ; First update channel routine
                              ; Read pattern data and updates channel info at 
                              ; x holds pointer to current channel data (A1)
6eec :                       L059228:
                                     ; SUBQ.W #1,$28(A1)
                                     ; BNE L059282
6eec : ec8828           [ 6]   ldd $28,x
6eef : 830001           [ 4]   subd #1
6ef2 : ed8828           [ 6]   std $28,x
6ef5 : 2640             [ 3]   bne L059282
                             
                                     ; CLR.W 0(A1)
                                     ; BCLR #0,$60(A1)
6ef7 : cc0000           [ 3]   ldd #0
6efa : ed84             [ 5]   std ,x
6efc : a68860           [ 5]   lda $60,x
6eff : 84fe             [ 2]   anda #~(1<<0)
6f01 : a78860           [ 5]   sta $60,x
                             
                              ; read data from current pattern
                              ; this is a variable length structure
                                     ; MOVEA.L 4(A1),A6
                                     ;L05923E:
                                     ; MOVE.B (A6)+,D0
                                     ; EXT.W D0
                                     ; BMI L0592A0
6f04 : ee06             [ 6]   ldu 4+2,x
6f06 :                       L05923E:
6f06 : e6c0             [ 6]   ldb ,u+
6f08 : 1d               [ 2]   sex
6f09 : 2b4a             [ 3]   bmi L0592A0
                             
                                     ; MOVE.W D0,$30(A1)
                                     ; BTST #4,0(A1)
                                     ; BNE.S L059276
6f0b : ed8830           [ 6]   std $30,x
6f0e : a684             [ 4]   lda ,x
6f10 : 8510             [ 2]   bita #1<<4
6f12 : 261a             [ 3]   bne L059276
                             
                                     ; MOVE.B $4C(A1),$34(A1)
6f14 : a6884c           [ 5]   lda $4c,x
6f17 : a78834           [ 5]   sta $34,x
                             
                                     ; BSET #5,0(A1)
                                     ; BSET #6,0(A1)
                                     ; BCLR #4,0(A1)
6f1a : a684             [ 4]   lda ,x
6f1c : 8a60             [ 2]   ora #(1<<5) | (1<<6)
6f1e : 84ef             [ 2]   anda #~(1<<4)
6f20 : a784             [ 4]   sta ,x
                             
                                     ; MOVE.B $38(A1),$40(A1)
                                     ; MOVE.B $44(A1),$48(A1)
6f22 : a68838           [ 5]   lda $38,x
6f25 : a78840           [ 5]   sta $40,x
6f28 : a68844           [ 5]   lda $44,x
6f2b : a78848           [ 5]   sta $48,x
                             
6f2e :                       L059276:
                                     ; MOVE.W $2C(A1),$28(A1)
                                     ; MOVE.L A6,4(A1)
6f2e : ec882c           [ 6]   ldd $2c,x
6f31 : ed8828           [ 6]   std $28,x
6f34 : ef06             [ 6]   stu 4+2,x             ;write back pattern point
                             
                                     ; RTS
6f36 : 39               [ 5]   rts
                             
                             
                              ; $28(a1) > 0
                              ; x holds pointer to current channel data (A1)
6f37 :                       L059282:
                                     ; BTST #3,0(A1)
                                     ; BEQ L059186
                                     ; BTST #7,0(A1)
                                     ; BEQ.S L05929A
6f37 : a684             [ 4]   lda ,x
6f39 : 8508             [ 2]   bita #1<<3
6f3b : 270d             [ 3]   beq Exit_L059282
6f3d : 8580             [ 2]   bita #1<<7
6f3f : 270a             [ 3]   beq L05929A
                             
                                     ; ADDQ.W #1,$30(A1)
                                     ; RTS
6f41 : ec8830           [ 6]   ldd $30,x
6f44 : c30001           [ 4]   addd #1
6f47 : ed8830           [ 6]   std $30,x
6f4a :                       Exit_L059282:
6f4a : 39               [ 5]   rts
                             
6f4b :                       L05929A:
                                     ; SUBQ.W #1,$30(A1)
                                     ; RTS
6f4b : ec8830           [ 6]   ldd $30,x
6f4e : 830001           [ 4]   subd #1
6f51 : ed8830           [ 6]   std $30,x
6f54 : 39               [ 5]   rts
                             
                             
                              ; negative value in pattern: register d/D0
                              ; x holds pointer to current channel data (A1)
6f55 :                       L0592A0:
                                     ; CMP.B #-$49,D0
                                     ; BLS L059306
6f55 : c1b7             [ 2]   cmpb #-$49
6f57 : 234d             [ 3]   bls L059306
                             
                               ;add until overflow (d becomes positive)
                                     ; ADDI.W #$20,D0
                                     ; BCS L0592E2
                                     ; ADDI.W #$10,D0
                                     ; BCS L0592EC
                                     ; ADDI.W #$10,D0
                                     ; BCC L0592D6
6f59 : c30020           [ 4]   addd #$20
6f5c : 252a             [ 3]   bcs L0592E2
6f5e : c30010           [ 4]   addd #$10
6f61 : 252e             [ 3]   bcs L0592EC
6f63 : c30010           [ 4]   addd #$10
6f66 : 2413             [ 3]   bcc L0592D6
                             
                              ; d is index to L059642-table
                                     ; LEA L059642,A0
                                     ; LSL.W #2,D0
                                     ; ADDA.L 0(A0,D0.W),A0
6f68 : 108e7321         [ 4]   ldy #L059642
6f6c : 58               [ 2]   lslb  ;*2
6f6d : eca5             [ 6]   ldd b,y
6f6f : 31ab             [ 8]   leay d,y
                             
                                     ; MOVE.L A0,$18(A1)
                                     ; MOVE.L A0,$14(A1)
                                     ; BRA L05923E
6f71 : 10af881a         [ 7]   sty $18+2,x
6f75 : 10af8816         [ 7]   sty $14+2,x
6f79 : 208b             [ 3]   bra L05923E
                             
6f7b :                       L0592D6:
                                     ; ADDI.W #9,D0
                                     ; MOVE.W D0,$30(A5)
                                     ; BRA L05923E
6f7b : c30009           [ 4]   addd #9
6f7e : 108eca1e         [ 4]   ldy #LA5_BASE
6f82 : eda830           [ 6]   std $30,y
6f85 : 7e6f06           [ 4]   bra L05923E
                             
6f88 :                       L0592E2:
                                     ; ADDQ.W #1,D0
                                     ; MOVE.W D0,$2C(A1)
                                     ; BRA L05923E
6f88 : c30001           [ 4]   addd #1
6f8b : ed882c           [ 6]   std $2c,x
6f8e : 7e6f06           [ 4]   bra L05923E
                             
6f91 :                       L0592EC:
                                     ; MOVE.B D0,$4C(A1)
                                     ; MOVE.B (A6)+,D0
                                     ; MOVE.B D0,$38(A1)
                                     ; MOVE.B (A6)+,D0
                                     ; MOVE.B D0,$3C(A1)
                                     ; MOVE.B (A6)+,D0
                                     ; MOVE.B D0,$44(A1)
                                     ; BRA L05923E
6f91 : e7884c           [ 5]   stb $4c,x
6f94 : a6c0             [ 6]   lda ,u+
6f96 : a78838           [ 5]   sta $38,x
6f99 : a6c0             [ 6]   lda ,u+
6f9b : a7883c           [ 5]   sta $3c,x
6f9e : a6c0             [ 6]   lda ,u+
6fa0 : a78844           [ 5]   sta $44,x
6fa3 : 7e6f06           [ 4]   bra L05923E
                             
6fa6 :                       L059306:
                               ;b is index into jumptable L05969E
                                     ; LEA L05969E,A0
                                     ; ANDI.L #$3F,D0
                                     ; LSL.W #2,D0
                                     ;; ADDA.L 0(A0,D0.W),A0
                                     ; move.l (a0,d0.w),a0    ;jumptable now h
                                     ; JMP (A0)
6fa6 : 108e7367         [ 4]   ldy #L05969E
6faa : c43f             [ 2]   andb #$3f
6fac : 8602             [ 2]   lda #2
6fae : 3d               [11]   mul
6faf : 6ebb             [10]   jmp [d,y]
                             
6fb1 :                       L_CMD8:
                               ;New track
                                     ; MOVEA.L 8(A1),A0
                                     ; ADDA.L $C(A1),A0
6fb1 : 10ae0a           [ 7]   ldy 8+2,x
6fb4 : ec0e             [ 6]   ldd $c+2,x
6fb6 : 31ab             [ 8]   leay d,y
                                     ; ADDQ.L #4,$C(A1)
6fb8 : c30002           [ 4]   addd #4-2
6fbb : ed0e             [ 6]   std $c+2,x
                                     ; MOVE.L (A0),D0
                                     ; BNE.S L059336
6fbd : eca4             [ 5]   ldd (0),y
6fbf : 2615             [ 3]   bne L059336
                               ;End of tracks, loop
                                     ; MOVEA.L 8(A1),A0
                                     ; MOVE.L #4,$C(A1)
                                     ; MOVE.L (A0),D0
                             
                              ;we do not loop, instead trigger demo game
                             ;  ldy 8+2,x
                             ;  ldd #4-2
                             ;  std $c+2,x
                             ;  ldd (0),y
                             
6fc1 : 8604             [ 2]   lda #DemoGame ;trigger demo game
6fc3 : b7c87a           [ 5]   sta GameMode
6fc6 : b6c86c           [ 5]   lda DemoSelected
6fc9 : 4c               [ 2]   inca
6fca : 8403             [ 2]   anda #3
6fcc : 8103             [ 2]   cmpa #3
6fce : 2601             [ 3]   bne *+3
6fd0 : 4f               [ 2]     clra
6fd1 : b7c86c           [ 5]   sta DemoSelected
6fd4 : 3586             [ 9]   puls d,pc      ;hack, return from music to titl
                             
6fd6 :                       L059336:
                                     ; LEA L059818,A6
                                     ; ADDA.L D0,A6
                                     ; BRA L05923E
6fd6 : ce738b           [ 3]   ldu #L059818
6fd9 : 33cb             [ 8]   leau d,u
6fdb : 7e6f06           [ 4]   bra L05923E
                             
6fde :                       L_CMD12:
                                     ; MOVE.B $64(A1),D0
                                     ; ANDI.B #7,D0
6fde : a68864           [ 5]   lda $64,x
6fe1 : 8407             [ 2]   anda #7
                                     ; OR.B D0,$38(A5)
6fe3 : 1f89             [ 6]   tfr a,b
6fe5 : 108eca1e         [ 4]   ldy #LA5_BASE
6fe9 : eaa838           [ 5]   orb $38,y
6fec : e7a838           [ 5]   stb $38,y
                                     ; LSL.B #3,D0
6fef : 48               [ 2]   lsla
6ff0 : 48               [ 2]   lsla
6ff1 : 48               [ 2]   lsla
                                     ; NOT.B D0
6ff2 : 43               [ 2]   coma
                                     ; AND.B D0,$38(A5)
6ff3 : e6a838           [ 5]   ldb $38,y
6ff6 : 3402             [ 6]   pshs a
6ff8 : e4e0             [ 6]   andb ,s+
6ffa : e7a838           [ 5]   stb $38,y
                                     ; BRA L05923E
6ffd : 7e6f06           [ 4]   bra L05923E
                             
                             
7000 :                       L_CMD11:
                                     ; MOVE.B $64(A1),D0
                                     ; ANDI.B #$38,D0
                                     ; OR.B D0,$38(A5)
7000 : a68864           [ 5]   lda $64,x
7003 : 8438             [ 2]   anda #$38
7005 : 1f89             [ 6]   tfr a,b
7007 : 108eca1e         [ 4]   ldy #LA5_BASE
700b : eaa838           [ 5]   orb $38,y
700e : e7a838           [ 5]   stb $38,y
                                     ; LSR.B #3,D0
                                     ; NOT.B D0
7011 : 44               [ 2]   lsra
7012 : 44               [ 2]   lsra
7013 : 44               [ 2]   lsra
7014 : 43               [ 2]   coma
                                     ; AND.B D0,$38(A5)
                                     ; BRA L05923E
7015 : e6a838           [ 5]   ldb $38,y
7018 : 3402             [ 6]   pshs a
701a : e4e0             [ 6]   andb ,s+
701c : e7a838           [ 5]   stb $38,y
701f : 7e6f06           [ 4]   bra L05923E
                             
7022 :                       L_CMD13:
                                     ; MOVE.B $64(A1),D0
                                     ; NOT.B D0
7022 : a68864           [ 5]   lda $64,x
7025 : 43               [ 2]   coma
                                     ; AND.B D0,$38(A5)
                                     ; BRA L05923E
7026 : 108eca1e         [ 4]   ldy #LA5_BASE
702a : e6a838           [ 5]   ldb $38,y
702d : 3402             [ 6]   pshs a
702f : e4e0             [ 6]   andb ,s+
7031 : e7a838           [ 5]   stb $38,y
7034 : 7e6f06           [ 4]   bra L05923E
                             
7037 :                       L_CMD5:
                                     ; MOVE.B (A6)+,D0
                                     ; EXT.W D0
                                     ; CLR.W $10(A1)
                                     ; MOVE.W D0,$1C(A1)
7037 : e6c0             [ 6]   ldb ,u+
7039 : 1d               [ 2]   sex
703a : ed881c           [ 6]   std $1c,x
703d : cc0000           [ 3]   ldd #0
7040 : ed8810           [ 6]   std $10,x
                                     ; CLR.W D0
                                     ; MOVE.B (A6)+,D0
                                     ; MOVE.W D0,$20(A1)
7043 : e6c0             [ 6]   ldb ,u+
7045 : ed8820           [ 6]   std $20,x
                                     ; BSET #2,0(A1)
                                     ; BRA L05923E
7048 : a684             [ 4]   lda ,x
704a : 8a04             [ 2]   ora #1<<2
704c : a784             [ 4]   sta ,x
704e : 7e6f06           [ 4]   bra L05923E
                             
7051 :                       L_CMD10:
                                     ; CLR.W D0
                                     ; MOVE.B (A6)+,D0
                                     ; MOVE.B D0,$34(A5)
                                     ; BRA L05923E
7051 : a6c0             [ 6]   lda ,u+
7053 : 108eca1e         [ 4]   ldy #LA5_BASE
7057 : a7a834           [ 5]   sta $34,y
705a : 7e6f06           [ 4]   bra L05923E
                             
705d :                       L_CMD9:
                                     ; CLR.W D0
                                     ; MOVE.B (A6)+,D0
                                     ; MOVE.W D0,$54(A1)
705d : 8600             [ 2]   lda #0
705f : e6c0             [ 6]   ldb ,u+
7061 : ed8854           [ 6]   std $54,x
                                     ; CLR.W D0
                                     ; MOVE.B (A6)+,D0
                                     ; MOVE.W D0,$50(A1)
                                     ; MOVE.W D0,$58(A1)
                                     ; BRA L05923E
7064 : e6c0             [ 6]   ldb ,u+
7066 : ed8850           [ 6]   std $50,x
7069 : ed8858           [ 6]   std $58,x
706c : 7e6f06           [ 4]   bra L05923E
                             
706f :                       L_CMD7:
                                     ; BSET #7,0(A1)
706f : a684             [ 4]   lda ,x
7071 : 8a80             [ 2]   ora #1<<7
7073 : a784             [ 4]   sta ,x
7075 :                       L_CMD6:
                                     ; BSET #3,0(A1)
                                     ; BRA L05923E
7075 : a684             [ 4]   lda ,x
7077 : 8a08             [ 2]   ora #1<<3
7079 : a784             [ 4]   sta ,x
707b : 7e6f06           [ 4]   bra L05923E
                             
707e :                       L_CMD2:
                                     ; CLR.B $5C(A1)
                                     ; BRA L05923E
707e : 8600             [ 2]   lda #0
7080 : a7885c           [ 5]   sta $5c,x
7083 : 7e6f06           [ 4]   bra L05923E
                             
7086 :                       L_CMD3:
                                     ; MOVE.B #$40,$5C(A1)
                                     ; BRA L05923E
7086 : 8640             [ 2]   lda #$40
7088 : a7885c           [ 5]   sta $5c,x
708b : 7e6f06           [ 4]   bra L05923E
                             
708e :                       L_CMD4:
                                     ; MOVE.B #-$40,$5C(A1)
                                     ; BRA L05923E
708e : 86c0             [ 2]   lda #-$40
7090 : a7885c           [ 5]   sta $5c,x
7093 : 7e6f06           [ 4]   bra L05923E
                             
7096 :                       L_CMD14:
                                     ; BSET #1,0(A1)
                                     ; BRA L05923E
7096 : a684             [ 4]   lda ,x
7098 : 8a02             [ 2]   ora #1<<1
709a : a784             [ 4]   sta ,x
709c : 7e6f06           [ 4]   bra L05923E
                             
709f :                       L_CMD1:
                                     ; CLR.B $34(A1)
709f : 8600             [ 2]   lda #0
70a1 : a78834           [ 5]   sta $34,x
70a4 :                       L_CMD16:
                                     ; BCLR #5,0(A1)
                                     ; BRA L059276
70a4 : a684             [ 4]   lda ,x
70a6 : 84df             [ 2]   anda #~(1<<5)
70a8 : a784             [ 4]   sta ,x
70aa : 7e6f2e           [ 4]   bra L059276
                             
70ad :                       L_CMD17:
                                     ; BSET #4,0(A1)
                                     ; BRA L05923E
70ad : a684             [ 4]   lda ,x
70af : 8a10             [ 2]   ora #1<<4
70b1 : a784             [ 4]   sta ,x
70b3 : 7e6f06           [ 4]   bra L05923E
                             
70b6 :                       L_CMD18:
                                     ; BSET #0,$60(A1)
                                     ; BRA L05923E
70b6 : a68860           [ 5]   lda $60,x
70b9 : 8a01             [ 2]   ora #1<<0
70bb : a78860           [ 5]   sta $60,x
70be : 7e6f06           [ 4]   bra L05923E
                             
                             
                              ; Second update channel routine
                              ; Calculate sound register output based on curre
                              ; x holds pointer to current channel data (A1)
                              ; returns values in d4,d5
70c1 :                       L059418:
                              ; D6 is an alias for 0(A1). It is modified and w
                             
                               ;TEMP_D0 - D6 globals are used many times, set 
70c1 : 3408             [ 6]   pshs dp
70c3 : 86ca             [ 2]   lda #hi TEMP_D0
70c5 : 1f8b             [ 6]   tfr a,dp
                               direct hi TEMP_D0
                             
                                     ; MOVE.B 0(A1),D6
                                     ; BTST #5,D6
                                     ; BEQ L059484
70c7 : e684             [ 4]   ldb ,x
70c9 : d71c             [ 4]   stb TEMP_D6
70cb : c520             [ 2]   bitb #1<<5
70cd : 2758             [ 3]   beq L059484
                                     ; MOVE.B $40(A1),D0
                                     ; ADDI.B #-$10,D0
                                     ; BCS.S L059464
70cf : a68840           [ 5]   lda $40,x
70d2 : 8bf0             [ 2]   adda #-$10
70d4 : 252a             [ 3]   bcs L059464
                                     ; BTST #6,D6
                                     ; BEQ.S L05946C
70d6 : c540             [ 2]   bitb #1<<6
70d8 : 272b             [ 3]   beq L05946C
                                     ; ADD.B $34(A1),D0
                                     ; BCC.S L05943C
                                     ; MOVEQ #-1,D0
70da : ab8834           [ 5]   adda $34,x
70dd : 2402             [ 3]   bcc L05943C
70df : 86ff             [ 2]   lda #-1
70e1 :                       L05943C:
                                     ; ADDI.B #$10,D0
                                     ; MOVE.B D0,$34(A1)
70e1 : 8b10             [ 2]   adda #$10
70e3 : a78834           [ 5]   sta $34,x
                                     ; MOVE.B $48(A1),D0
                                     ; ADDI.B #-$10,D0
                                     ; BCS.S L05945C
70e6 : a68848           [ 5]   lda $48,x
70e9 : 8bf0             [ 2]   adda #-$10
70eb : 250e             [ 3]   bcs L05945C
                                     ; BCLR #6,D6
70ed : d61c             [ 4]   ldb TEMP_D6
70ef : c4bf             [ 2]   andb #~(1<<6)
70f1 : d71c             [ 4]   stb TEMP_D6
                                     ; MOVE.B $3C(A1),$40(A1)
                                     ; BRA L059484
70f3 : a6883c           [ 5]   lda $3c,x
70f6 : a78840           [ 5]   sta $40,x
70f9 : 202c             [ 3]   bra L059484
70fb :                       L05945C:
                                     ; MOVE.B D0,$48(A1)
                                     ; BRA L059484
70fb : a78848           [ 5]   sta $48,x
70fe : 2027             [ 3]   bra L059484
7100 :                       L059464:
                                     ; MOVE.B D0,$40(A1)
                                     ; BRA L059484
7100 : a78840           [ 5]   sta $40,x
7103 : 2022             [ 3]   bra L059484
7105 :                       L05946C:
                                     ; ANDI.B #$F,D0
                                     ; SUB.B D0,$34(A1)
                                     ; BPL.S L05947A
7105 : 840f             [ 2]   anda #$f
7107 : e68834           [ 5]   ldb $34,x
710a : 3402             [ 6]   pshs a
710c : e0e0             [ 6]   subb ,s+
710e : e78834           [ 5]   stb $34,x
7111 : 2a05             [ 3]   bpl L05947A
                                     ; CLR.B $34(A1)
7113 : 8600             [ 2]   lda #0
7115 : a78834           [ 5]   sta $34,x
7118 :                       L05947A:
                                     ; SUBQ.B #1,$48(A1)
                                     ; BNE.S L059484
7118 : a68848           [ 5]   lda $48,x
711b : 4a               [ 2]   deca
711c : a78848           [ 5]   sta $48,x
711f : 2606             [ 3]   bne L059484
                                     ; BCLR #5,D6
7121 : d61c             [ 4]   ldb TEMP_D6
7123 : c4df             [ 2]   andb #~(1<<5)
7125 : d71c             [ 4]   stb TEMP_D6
7127 :                       L059484:
                                     ; MOVEA.L $18(A1),A0
                                     ; CLR.W D0
                                     ; MOVE.B (A0)+,D0
7127 : 10ae881a         [ 7]   ldy $18+2,x
712b : 8600             [ 2]   lda #0
712d : e6a0             [ 6]   ldb ,y+
                                     ; CMP.B #-$79,D0
                                     ; BNE.S L05949E
712f : c187             [ 2]   cmpb #-$79
7131 : 260c             [ 3]   bne L05949E
                                     ; MOVE.L $14(A1),$18(A1)
7133 : ee8816           [ 6]   ldu $14+2,x
7136 : ef881a           [ 6]   stu $18+2,x
                                     ; MOVEA.L $18(A1),A0
                                     ; MOVE.B (A0)+,D0
7139 : 10ae881a         [ 7]   ldy $18+2,x
713d : e6a0             [ 6]   ldb ,y+
713f :                       L05949E:
                                     ; MOVE.L A0,$18(A1)
                                     ; ADD.W $30(A1),D0
713f : 10af881a         [ 7]   sty $18+2,x
7143 : e38830           [ 7]   addd $30,x
                                     ; LEA L059582,A0
                                     ; ADD.W D0,D0
                                     ; MOVE.W D0,D4
7146 : 108e7261         [ 4]   ldy #L059582
714a : 3406             [ 7]   pshs d
714c : e3e1             [ 9]   addd ,s++
714e : dd18             [ 5]   std TEMP_D4
                                     ; MOVE.W 0(A0,D0.W),D5
7150 : 31ab             [ 8]   leay d,y
7152 : eca4             [ 5]   ldd ,y
7154 : dd1a             [ 5]   std TEMP_D5
                                     ; BTST #6,$5C(A1)
                                     ; BEQ L059514
7156 : a6885c           [ 5]   lda $5c,x
7159 : 8540             [ 2]   bita #1<<6
715b : 10270081         [ 6]   lbeq L059514
                                     ; MOVE.W $50(A1),D1
                                     ; ADD.W D1,D1
715f : ec8850           [ 6]   ldd $50,x
7162 : 3406             [ 7]   pshs d
7164 : e3e1             [ 9]   addd ,s++
7166 : dd16             [ 5]   std TEMP_D1
                                     ; MOVE.W $58(A1),D0
                                     ; BTST #7,$5C(A1)
                                     ; BEQ.S L0594D4
7168 : ec8858           [ 6]   ldd $58,x
716b : dd14             [ 5]   std TEMP_D0
716d : a6885c           [ 5]   lda $5c,x
7170 : 8580             [ 2]   bita #1<<7
7172 : 2706             [ 3]   beq L0594D4
                                     ; BTST #0,D6
                                     ; BNE.S L059500
7174 : d61c             [ 4]   ldb TEMP_D6
7176 : c501             [ 2]   bitb #1<<0
7178 : 263c             [ 3]   bne L059500
717a :                       L0594D4:
                                     ; BTST #5,$5C(A1)
                                     ; BNE.S L0594EC
717a : a6885c           [ 5]   lda $5c,x
717d : 8520             [ 2]   bita #1<<5
717f : 2618             [ 3]   bne L0594EC
                                     ; SUB.W $54(A1),D0
                                     ; BPL.S L0594FC
7181 : dc14             [ 5]   ldd TEMP_D0
7183 : a38854           [ 7]   subd $54,x
7186 : dd14             [ 5]   std TEMP_D0
7188 : 2a27             [ 3]   bpl L0594FC
                                     ; BSET #5,$5C(A1)
                                     ; MOVEQ #0,D0
                                     ; BRA.S L0594FC
718a : a6885c           [ 5]   lda $5C,x
718d : 8a20             [ 2]   ora #1<<5
718f : a7885c           [ 5]   sta $5c,x
7192 : cc0000           [ 3]   ldd #0
7195 : dd14             [ 5]   std TEMP_D0
7197 : 2018             [ 3]   bra L0594FC
7199 :                       L0594EC:
                                     ; ADD.W $54(A1),D0
                                     ; CMP.W D1,D0
                                     ; BLS.S L0594FC
7199 : dc14             [ 5]   ldd TEMP_D0
719b : e38854           [ 7]   addd $54,x
719e : dd14             [ 5]   std TEMP_D0
71a0 : 109316           [ 7]   cmpd TEMP_D1
71a3 : 230c             [ 3]   bls L0594FC
                                     ; BCLR #5,$5C(A1)
                                     ; MOVE.W D1,D0
71a5 : a6885c           [ 5]   lda $5c,x
71a8 : 84df             [ 2]   anda #~(1<<5)
71aa : a7885c           [ 5]   sta $5c,x
71ad : dc16             [ 5]   ldd TEMP_D1
71af : dd14             [ 5]   std TEMP_D0
71b1 :                       L0594FC:
                                     ; MOVE.W D0,$58(A1)
71b1 : dc14             [ 5]   ldd TEMP_D0
71b3 : ed8858           [ 6]   std $58,x
71b6 :                       L059500:
                                     ; LSR.W #1,D1
71b6 : dc16             [ 5]   ldd TEMP_D1
71b8 : 44               [ 2]   lsra
71b9 : 56               [ 2]   rorb
71ba : dd16             [ 5]   std TEMP_D1
                                     ; SUB.W D1,D0
71bc : dc14             [ 5]   ldd TEMP_D0
71be : 9316             [ 6]   subd TEMP_D1
71c0 : dd14             [ 5]   std TEMP_D0
                                     ; SUBI.W #$60,D4
                                     ; BPL.S L059512
71c2 : dc18             [ 5]   ldd TEMP_D4
71c4 : 830060           [ 4]   subd #$60
71c7 : dd18             [ 5]   std TEMP_D4
71c9 : 2a0f             [ 3]   bpl L059512
71cb :                       L05950A:
                                     ; LSL.W #1,D0
71cb : dc14             [ 5]   ldd TEMP_D0
71cd : 58               [ 2]   lslb
71ce : 49               [ 2]   rola
71cf : dd14             [ 5]   std TEMP_D0
                                     ; ADDI.W #$18,D4
                                     ; BCC.S L05950A
71d1 : dc18             [ 5]   ldd TEMP_D4
71d3 : c30018           [ 4]   addd #$18
71d6 : dd18             [ 5]   std TEMP_D4
71d8 : 24f1             [ 3]   bcc L05950A
71da :                       L059512:
                                     ; ADD.W D0,D5
71da : dc1a             [ 5]   ldd TEMP_D5
71dc : d314             [ 6]   addd TEMP_D0
                               ;TEMP_D0 becomes inactive here
71de : dd1a             [ 5]   std TEMP_D5
71e0 :                       L059514:
                                     ; BCHG #0,D6
                                     ; MOVE.B D6,0(A1)
71e0 : 961c             [ 4]   lda TEMP_D6
71e2 : 8801             [ 2]   eora #1<<0  ;?
71e4 : 971c             [ 4]   sta TEMP_D6
71e6 : a784             [ 4]   sta ,x
                                     ; BTST #2,D6
                                     ; BEQ.S L05953C
71e8 : 8504             [ 2]   bita #1<<2
71ea : 271d             [ 3]   beq L05953C
                                     ; MOVE.W $20(A1),D0
                                     ; SUBQ.W #1,D0
                                     ; BNE.S L059538
71ec : ec8820           [ 6]   ldd $20,x
71ef : 830001           [ 4]   subd #1
71f2 : 2612             [ 3]   bne L059538
                                     ; MOVE.W $1C(A1),D0
                                     ; ADD.W D0,$10(A1)
71f4 : ec881c           [ 6]   ldd $1c,x
71f7 : e38810           [ 7]   addd $10,x
71fa : ed8810           [ 6]   std $10,x
                                     ; ADD.W $10(A1),D5
                                     ; BRA.S L05953C`
71fd : dc1a             [ 5]   ldd TEMP_D5
71ff : e38810           [ 7]   addd $10,x
7202 : dd1a             [ 5]   std TEMP_D5
7204 : 2003             [ 3]   bra L05953C
7206 :                       L059538:
                                     ; MOVE.W D0,$20(A1)
7206 : ed8820           [ 6]   std $20,x
7209 :                       L05953C:
                                     ; BTST #0,$60(A1)
                                     ; BEQ.S L059552
7209 : a68860           [ 5]   lda $60,x
720c : 8501             [ 2]   bita #1<<0
720e : 2716             [ 3]   beq L059552
                                     ; BCLR #0,$60(A1)
                                     ; CLR.B $36(A5)
                                     ; MOVEQ #7,D0
                                     ; BRA.S L05956C
7210 : a68860           [ 5]   lda $60,x
7213 : 84fe             [ 2]   anda #~(1<<0)
7215 : a78860           [ 5]   sta $60,x
7218 : 108eca1e         [ 4]   ldy #LA5_BASE
721c : 8600             [ 2]   lda #0
721e : a7a836           [ 5]   sta $36,y
7221 : cc0007           [ 3]   ldd #7
7224 : 2022             [ 3]   bra L05956C
7226 :                       L059552:
                                     ; MOVE.B $38(A5),D0
                                     ; NOT.W D6
                                     ; ANDI.W #3,D6
                                     ; BNE.S L05956C
7226 : d61c             [ 4]   ldb TEMP_D6
7228 : 53               [ 2]   comb
7229 : c403             [ 2]   andb #3
722b : 8600             [ 2]   lda #0
722d : 1f02             [ 6]   tfr d,y
722f : ceca1e           [ 3]   ldu #LA5_BASE
7232 : e6c838           [ 5]   ldb $38,u
7235 : 31a4             [ 4]   leay ,y
7237 : 260f             [ 3]   bne L05956C
                             
                                     ; MOVE.B $34(A5),D0
                                     ; BCHG #3,D0
                                     ; MOVE.B D0,$36(A5)
7239 : 108eca1e         [ 4]   ldy #LA5_BASE
723d : a6a834           [ 5]   lda $34,y
7240 : 8808             [ 2]   eora #1<<3
7242 : a7a836           [ 5]   sta $36,y
                                     ; MOVEQ #7,D0
7245 : cc0007           [ 3]   ldd #7
7248 :                       L05956C:
                                     ; MOVE.B $41(A5),D1
                                     ; EOR.W D1,D0
7248 : 108eca1e         [ 4]   ldy #LA5_BASE
724c : e8a841           [ 5]   eorb $41,y
                                     ; AND.B $64(A1),D0
                                     ; EOR.W D1,D0
724f : e48864           [ 5]   andb $64,x
7252 : e8a841           [ 5]   eorb $41,y
                                     ; MOVE.B D0,$41(A5)
                                     ; MOVE.B $34(A1),D4
                                     ; RTS
7255 : e7a841           [ 5]   stb $41,y
7258 : e68834           [ 5]   ldb $34,x
725b : 8600             [ 2]   lda #0
725d : dd18             [ 5]   std TEMP_D4
                               ;return values in TEMP_D4, TEMP_D5
725f : 3588             [ 8]   puls dp,pc
                               direct -1
                             ;  rts
                             
                             ;Data
                             
7261 :                       L059582:  ;word-tabell, readonly. Frequenzies.
7261 : 0eee                   dw $EEE
7263 : 0e17                   dw $E17
7265 : 0d4d                   dw $D4D
7267 : 0c8e                   dw $C8E
7269 : 0bd9                   dw $BD9
726b : 0b2f                   dw $B2F
726d : 0a8e                   dw $A8E
726f : 09f7                   dw $9F7
7271 : 0967                   dw $967
7273 : 08e0                   dw $8E0
7275 : 0861                   dw $861
7277 : 07e8                   dw $7E8
7279 : 0777                   dw $777
727b : 070b                   dw $70B
727d : 06a6                   dw $6A6
727f : 0647                   dw $647
7281 : 05ec                   dw $5EC
7283 : 0597                   dw $597
7285 : 0547                   dw $547
7287 : 04fb                   dw $4FB
7289 : 04b3                   dw $4B3
728b : 0470                   dw $470
728d : 0430                   dw $430
728f : 03f4                   dw $3F4
7291 : 03bb                   dw $3BB
7293 : 0385                   dw $385
7295 : 0353                   dw $353
7297 : 0323                   dw $323
7299 : 02f6                   dw $2F6
729b : 02cb                   dw $2CB
729d : 02a3                   dw $2A3
729f : 027d                   dw $27D
72a1 : 0259                   dw $259
72a3 : 0238                   dw $238
72a5 : 0218                   dw $218
72a7 : 01fa                   dw $1FA
72a9 : 01dd                   dw $1DD
72ab : 01c2                   dw $1C2
72ad : 01a9                   dw $1A9
72af : 0191                   dw $191
72b1 : 017b                   dw $17B
72b3 : 0165                   dw $165
72b5 : 0151                   dw $151
72b7 : 013e                   dw $13E
72b9 : 012c                   dw $12C
72bb : 011c                   dw $11C
72bd : 010c                   dw $10C
72bf : 00fd                   dw $FD
72c1 : 00ee                   dw $EE
72c3 : 00e1                   dw $E1
72c5 : 00d4                   dw $D4
72c7 : 00c8                   dw $C8
72c9 : 00bd                   dw $BD
72cb : 00b2                   dw $B2
72cd : 00a8                   dw $A8
72cf : 009f                   dw $9F
72d1 : 0096                   dw $96
72d3 : 008e                   dw $8E
72d5 : 0086                   dw $86
72d7 : 007e                   dw $7E
72d9 : 0077                   dw $77
72db : 0070                   dw $70
72dd : 006a                   dw $6A
72df : 0064                   dw $64
72e1 : 005e                   dw $5E
72e3 : 0059                   dw $59
72e5 : 0054                   dw $54
72e7 : 004f                   dw $4F
72e9 : 004b                   dw $4B
72eb : 0047                   dw $47
72ed : 0043                   dw $43
72ef : 003f                   dw $3F
72f1 : 003b                   dw $3B
72f3 : 0038                   dw $38
72f5 : 0035                   dw $35
72f7 : 0032                   dw $32
72f9 : 002f                   dw $2F
72fb : 002c                   dw $2C
72fd : 002a                   dw $2A
72ff : 0027                   dw $27
7301 : 0025                   dw $25
7303 : 0023                   dw $23
7305 : 0021                   dw $21
7307 : 001f                   dw $1F
7309 : 001d                   dw $1D
730b : 001c                   dw $1C
730d : 001a                   dw $1A
730f : 0019                   dw $19
7311 : 0017                   dw $17
7313 : 0016                   dw $16
7315 : 0015                   dw $15
7317 : 0013                   dw $13
7319 : 0012                   dw $12
731b : 0011                   dw $11
731d : 0010                   dw $10
731f : 000f                   dw $F
                             
                             
7321 :                       L059642:  ;longword-table, readonly
                              ;Offsets from L059642 to data below
                              if false
                              dw 0,$2C
                              dw 0,$2E
                              dw 0,$32
                              dw 0,$35
                              dw 0,$38
                              dw 0,$3B
                              dw 0,$3E
                              dw 0,$41
                              dw 0,$46
                              dw 0,$4A
                              dw 0,$53
                              endif
                             
                              ;Converted to word-table, saved 22-bytes
7321 : 0016                   dw $2C-22
7323 : 0018                   dw $2E-22
7325 : 001c                   dw $32-22
7327 : 001f                   dw $35-22
7329 : 0022                   dw $38-22
732b : 0025                   dw $3B-22
732d : 0028                   dw $3E-22
732f : 002b                   dw $41-22
7331 : 0030                   dw $46-22
7333 : 0034                   dw $4A-22
7335 : 003d                   dw $53-22
                             
                              ;Offset $2c
7337 : 0087                   dw $87
7339 : 0007                   dw 7
733b : 0c87                   dw $C87
733d : 0004                   dw 4
733f : 8700                   dw $8700
7341 : 0287                   dw $287
7343 : 0003                   dw 3
7345 : 8700                   dw $8700
7347 : 0587                   dw $587
7349 : 000e                   dw $E
734b : 870c                   dw $870C
734d : 0c0c                   dw $C0C
734f : 1887                   dw $1887
7351 : 0004                   dw 4
7353 : 0787                   dw $787
7355 : 0000                   dw 0
7357 : 0505                   dw $505
7359 : 0707                   dw $707
735b : 0c0c                   dw $C0C
735d : 8700                   dw $8700
735f : 0006                   dw 6
7361 : 0608                   dw $608
7363 : 080c                   dw $80C
7365 : 0c87                   dw $C87
                             
                             
7367 :                       L05969E:    ;Jumptable, readonly
                                     ; dc.l L_CMD1
                                     ; dc.l L_CMD2
                                     ; dc.l L_CMD3
                                     ; dc.l L_CMD4
                                     ; dc.l L_CMD5
                                     ; dc.l L_CMD6
                                     ; dc.l L_CMD7
                                     ; dc.l L_CMD8
                                     ; dc.l L_CMD9
                                     ; dc.l L_CMD10
                                     ; dc.l L_CMD11
                                     ; dc.l L_CMD12
                                     ; dc.l L_CMD13
                                     ; dc.l L_CMD14
                                     ; ;dw $FFFF ;-1454
                                     ; ;dw $FA52
                                     ; ;$590F0
                                     ; dc.l L0590F0     ;Används denna?
                                     ; dc.l L_CMD16
                                     ; dc.l L_CMD17
                                     ; dc.l L_CMD18
7367 : 709f707e708670..        dw L_CMD1,L_CMD2,L_CMD3,L_CMD4,L_CMD5,L_CMD6,L_
737b : 70006fde702270..        dw L_CMD11,L_CMD12,L_CMD13,L_CMD14,0,L_CMD16,L_
                             
                             
738b :                       L059818:        ;music-data, readonly
                                     ;Song 1, track offsets for each channel
                                     ; dc.l TRACK_DATA_CHANNEL1-L059818
                                     ; dc.l TRACK_DATA_CHANNEL2-L059818
                                     ; dc.l TRACK_DATA_CHANNEL3-L059818
                             
                               ;6809: converted to 16-bit offsets
738b : 000c                    dw TRACK_DATA_CHANNEL1-L059818
738d : 0056                    dw TRACK_DATA_CHANNEL2-L059818
738f : 016c                    dw TRACK_DATA_CHANNEL3-L059818
                             
                               ;make sure offsets stays the same
7391 : 000000000000            ds 6
                             
                             ;Track data has been converted to 16-offsets from
                             ;About 600 bytes were saved.
                             ;Offsets modifed to oldvalue-savedspace.
                             
                             ;Define track. 319 is the sum of entries. 0 is en
                             mDt macro value
                              if 0=value
                                dw 0
                              else
                                dw value - (319*2)
                              endif
                              endm
                             
                              ;Channel 1 track, offset $C, 37 entries
                              ;Longword offsets to patterns
7397 :                       TRACK_DATA_CHANNEL1:
                              mDt $8E5
                            > if 0=$8E5
                            >   dw 0
                            > else
7397 : 0667                 >   dw $8E5 - (319*2)
                            > endif
                             
                              mDt $9B6
                            > if 0=$9B6
                            >   dw 0
                            > else
7399 : 0738                 >   dw $9B6 - (319*2)
                            > endif
                             
                              mDt $9B6
                            > if 0=$9B6
                            >   dw 0
                            > else
739b : 0738                 >   dw $9B6 - (319*2)
                            > endif
                             
                              mDt $9B6
                            > if 0=$9B6
                            >   dw 0
                            > else
739d : 0738                 >   dw $9B6 - (319*2)
                            > endif
                             
                              mDt $9B6
                            > if 0=$9B6
                            >   dw 0
                            > else
739f : 0738                 >   dw $9B6 - (319*2)
                            > endif
                             
                              mDt $9B6
                            > if 0=$9B6
                            >   dw 0
                            > else
73a1 : 0738                 >   dw $9B6 - (319*2)
                            > endif
                             
                              mDt $9B6
                            > if 0=$9B6
                            >   dw 0
                            > else
73a3 : 0738                 >   dw $9B6 - (319*2)
                            > endif
                             
                              mDt $9B6
                            > if 0=$9B6
                            >   dw 0
                            > else
73a5 : 0738                 >   dw $9B6 - (319*2)
                            > endif
                             
                              mDt $9B6
                            > if 0=$9B6
                            >   dw 0
                            > else
73a7 : 0738                 >   dw $9B6 - (319*2)
                            > endif
                             
                              mDt $87E
                            > if 0=$87E
                            >   dw 0
                            > else
73a9 : 0600                 >   dw $87E - (319*2)
                            > endif
                             
                              mDt $55F
                            > if 0=$55F
                            >   dw 0
                            > else
73ab : 02e1                 >   dw $55F - (319*2)
                            > endif
                             
                              mDt $50E
                            > if 0=$50E
                            >   dw 0
                            > else
73ad : 0290                 >   dw $50E - (319*2)
                            > endif
                             
                              mDt $50E
                            > if 0=$50E
                            >   dw 0
                            > else
73af : 0290                 >   dw $50E - (319*2)
                            > endif
                             
                              mDt $592
                            > if 0=$592
                            >   dw 0
                            > else
73b1 : 0314                 >   dw $592 - (319*2)
                            > endif
                             
                              mDt $5F1
                            > if 0=$5F1
                            >   dw 0
                            > else
73b3 : 0373                 >   dw $5F1 - (319*2)
                            > endif
                             
                              mDt $87E
                            > if 0=$87E
                            >   dw 0
                            > else
73b5 : 0600                 >   dw $87E - (319*2)
                            > endif
                             
                              mDt $55F
                            > if 0=$55F
                            >   dw 0
                            > else
73b7 : 02e1                 >   dw $55F - (319*2)
                            > endif
                             
                              mDt $50E
                            > if 0=$50E
                            >   dw 0
                            > else
73b9 : 0290                 >   dw $50E - (319*2)
                            > endif
                             
                              mDt $50E
                            > if 0=$50E
                            >   dw 0
                            > else
73bb : 0290                 >   dw $50E - (319*2)
                            > endif
                             
                              mDt $87E
                            > if 0=$87E
                            >   dw 0
                            > else
73bd : 0600                 >   dw $87E - (319*2)
                            > endif
                             
                              mDt $8CC
                            > if 0=$8CC
                            >   dw 0
                            > else
73bf : 064e                 >   dw $8CC - (319*2)
                            > endif
                             
                              mDt $8CC
                            > if 0=$8CC
                            >   dw 0
                            > else
73c1 : 064e                 >   dw $8CC - (319*2)
                            > endif
                             
                              mDt $8DA
                            > if 0=$8DA
                            >   dw 0
                            > else
73c3 : 065c                 >   dw $8DA - (319*2)
                            > endif
                             
                              mDt $9B6
                            > if 0=$9B6
                            >   dw 0
                            > else
73c5 : 0738                 >   dw $9B6 - (319*2)
                            > endif
                             
                              mDt $9B6
                            > if 0=$9B6
                            >   dw 0
                            > else
73c7 : 0738                 >   dw $9B6 - (319*2)
                            > endif
                             
                              mDt $9B6
                            > if 0=$9B6
                            >   dw 0
                            > else
73c9 : 0738                 >   dw $9B6 - (319*2)
                            > endif
                             
                              mDt $9B6
                            > if 0=$9B6
                            >   dw 0
                            > else
73cb : 0738                 >   dw $9B6 - (319*2)
                            > endif
                             
                              mDt $87E
                            > if 0=$87E
                            >   dw 0
                            > else
73cd : 0600                 >   dw $87E - (319*2)
                            > endif
                             
                              mDt $592
                            > if 0=$592
                            >   dw 0
                            > else
73cf : 0314                 >   dw $592 - (319*2)
                            > endif
                             
                              mDt $5F1
                            > if 0=$5F1
                            >   dw 0
                            > else
73d1 : 0373                 >   dw $5F1 - (319*2)
                            > endif
                             
                              mDt $87E
                            > if 0=$87E
                            >   dw 0
                            > else
73d3 : 0600                 >   dw $87E - (319*2)
                            > endif
                             
                              mDt $55F
                            > if 0=$55F
                            >   dw 0
                            > else
73d5 : 02e1                 >   dw $55F - (319*2)
                            > endif
                             
                              mDt $508
                            > if 0=$508
                            >   dw 0
                            > else
73d7 : 028a                 >   dw $508 - (319*2)
                            > endif
                             
                              mDt $568
                            > if 0=$568
                            >   dw 0
                            > else
73d9 : 02ea                 >   dw $568 - (319*2)
                            > endif
                             
                              mDt $568
                            > if 0=$568
                            >   dw 0
                            > else
73db : 02ea                 >   dw $568 - (319*2)
                            > endif
                             
                              mDt $87E
                            > if 0=$87E
                            >   dw 0
                            > else
73dd : 0600                 >   dw $87E - (319*2)
                            > endif
                             
                              mDt 0
                            > if 0=0
73df : 0000                 >   dw 0
                            > else
                            >   dw 0 - (319*2)
                            > endif
                             
                             
                              ;Channel 2 track, offset $A0, 139 entries
73e1 :                       TRACK_DATA_CHANNEL2:
                              mDt $65A
                            > if 0=$65A
                            >   dw 0
                            > else
73e1 : 03dc                 >   dw $65A - (319*2)
                            > endif
                             
                              mDt $65A
                            > if 0=$65A
                            >   dw 0
                            > else
73e3 : 03dc                 >   dw $65A - (319*2)
                            > endif
                             
                              mDt $65A
                            > if 0=$65A
                            >   dw 0
                            > else
73e5 : 03dc                 >   dw $65A - (319*2)
                            > endif
                             
                              mDt $65A
                            > if 0=$65A
                            >   dw 0
                            > else
73e7 : 03dc                 >   dw $65A - (319*2)
                            > endif
                             
                              mDt $65A
                            > if 0=$65A
                            >   dw 0
                            > else
73e9 : 03dc                 >   dw $65A - (319*2)
                            > endif
                             
                              mDt $65A
                            > if 0=$65A
                            >   dw 0
                            > else
73eb : 03dc                 >   dw $65A - (319*2)
                            > endif
                             
                              mDt $65A
                            > if 0=$65A
                            >   dw 0
                            > else
73ed : 03dc                 >   dw $65A - (319*2)
                            > endif
                             
                              mDt $65A
                            > if 0=$65A
                            >   dw 0
                            > else
73ef : 03dc                 >   dw $65A - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
73f1 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
73f3 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
73f5 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
73f7 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
73f9 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
73fb : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
73fd : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
73ff : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
7401 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
7403 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
7405 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
7407 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $83F
                            > if 0=$83F
                            >   dw 0
                            > else
7409 : 05c1                 >   dw $83F - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
740b : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
740d : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
740f : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
7411 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
7413 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
7415 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
7417 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
7419 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
741b : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
741d : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
741f : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
7421 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
7423 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
7425 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
7427 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
7429 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $67F
                            > if 0=$67F
                            >   dw 0
                            > else
742b : 0401                 >   dw $67F - (319*2)
                            > endif
                             
                              mDt $67F
                            > if 0=$67F
                            >   dw 0
                            > else
742d : 0401                 >   dw $67F - (319*2)
                            > endif
                             
                              mDt $67F
                            > if 0=$67F
                            >   dw 0
                            > else
742f : 0401                 >   dw $67F - (319*2)
                            > endif
                             
                              mDt $67F
                            > if 0=$67F
                            >   dw 0
                            > else
7431 : 0401                 >   dw $67F - (319*2)
                            > endif
                             
                              mDt $67F
                            > if 0=$67F
                            >   dw 0
                            > else
7433 : 0401                 >   dw $67F - (319*2)
                            > endif
                             
                              mDt $67F
                            > if 0=$67F
                            >   dw 0
                            > else
7435 : 0401                 >   dw $67F - (319*2)
                            > endif
                             
                              mDt $67F
                            > if 0=$67F
                            >   dw 0
                            > else
7437 : 0401                 >   dw $67F - (319*2)
                            > endif
                             
                              mDt $67F
                            > if 0=$67F
                            >   dw 0
                            > else
7439 : 0401                 >   dw $67F - (319*2)
                            > endif
                             
                              mDt $6B5
                            > if 0=$6B5
                            >   dw 0
                            > else
743b : 0437                 >   dw $6B5 - (319*2)
                            > endif
                             
                              mDt $6B5
                            > if 0=$6B5
                            >   dw 0
                            > else
743d : 0437                 >   dw $6B5 - (319*2)
                            > endif
                             
                              mDt $6EA
                            > if 0=$6EA
                            >   dw 0
                            > else
743f : 046c                 >   dw $6EA - (319*2)
                            > endif
                             
                              mDt $6B5
                            > if 0=$6B5
                            >   dw 0
                            > else
7441 : 0437                 >   dw $6B5 - (319*2)
                            > endif
                             
                              mDt $6B5
                            > if 0=$6B5
                            >   dw 0
                            > else
7443 : 0437                 >   dw $6B5 - (319*2)
                            > endif
                             
                              mDt $74B
                            > if 0=$74B
                            >   dw 0
                            > else
7445 : 04cd                 >   dw $74B - (319*2)
                            > endif
                             
                              mDt $74B
                            > if 0=$74B
                            >   dw 0
                            > else
7447 : 04cd                 >   dw $74B - (319*2)
                            > endif
                             
                              mDt $77C
                            > if 0=$77C
                            >   dw 0
                            > else
7449 : 04fe                 >   dw $77C - (319*2)
                            > endif
                             
                              mDt $77C
                            > if 0=$77C
                            >   dw 0
                            > else
744b : 04fe                 >   dw $77C - (319*2)
                            > endif
                             
                              mDt $7AD
                            > if 0=$7AD
                            >   dw 0
                            > else
744d : 052f                 >   dw $7AD - (319*2)
                            > endif
                             
                              mDt $7AD
                            > if 0=$7AD
                            >   dw 0
                            > else
744f : 052f                 >   dw $7AD - (319*2)
                            > endif
                             
                              mDt $77C
                            > if 0=$77C
                            >   dw 0
                            > else
7451 : 04fe                 >   dw $77C - (319*2)
                            > endif
                             
                              mDt $77C
                            > if 0=$77C
                            >   dw 0
                            > else
7453 : 04fe                 >   dw $77C - (319*2)
                            > endif
                             
                              mDt $7DE
                            > if 0=$7DE
                            >   dw 0
                            > else
7455 : 0560                 >   dw $7DE - (319*2)
                            > endif
                             
                              mDt $83F
                            > if 0=$83F
                            >   dw 0
                            > else
7457 : 05c1                 >   dw $83F - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
7459 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
745b : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
745d : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
745f : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
7461 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
7463 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
7465 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
7467 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
7469 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
746b : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
746d : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
746f : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
7471 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
7473 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
7475 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
7477 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $83F
                            > if 0=$83F
                            >   dw 0
                            > else
7479 : 05c1                 >   dw $83F - (319*2)
                            > endif
                             
                              mDt $8F8
                            > if 0=$8F8
                            >   dw 0
                            > else
747b : 067a                 >   dw $8F8 - (319*2)
                            > endif
                             
                              mDt $8F8
                            > if 0=$8F8
                            >   dw 0
                            > else
747d : 067a                 >   dw $8F8 - (319*2)
                            > endif
                             
                              mDt $8F8
                            > if 0=$8F8
                            >   dw 0
                            > else
747f : 067a                 >   dw $8F8 - (319*2)
                            > endif
                             
                              mDt $8F8
                            > if 0=$8F8
                            >   dw 0
                            > else
7481 : 067a                 >   dw $8F8 - (319*2)
                            > endif
                             
                              mDt $8F8
                            > if 0=$8F8
                            >   dw 0
                            > else
7483 : 067a                 >   dw $8F8 - (319*2)
                            > endif
                             
                              mDt $8F8
                            > if 0=$8F8
                            >   dw 0
                            > else
7485 : 067a                 >   dw $8F8 - (319*2)
                            > endif
                             
                              mDt $8F8
                            > if 0=$8F8
                            >   dw 0
                            > else
7487 : 067a                 >   dw $8F8 - (319*2)
                            > endif
                             
                              mDt $8F8
                            > if 0=$8F8
                            >   dw 0
                            > else
7489 : 067a                 >   dw $8F8 - (319*2)
                            > endif
                             
                              mDt $8F8
                            > if 0=$8F8
                            >   dw 0
                            > else
748b : 067a                 >   dw $8F8 - (319*2)
                            > endif
                             
                              mDt $8F8
                            > if 0=$8F8
                            >   dw 0
                            > else
748d : 067a                 >   dw $8F8 - (319*2)
                            > endif
                             
                              mDt $8F8
                            > if 0=$8F8
                            >   dw 0
                            > else
748f : 067a                 >   dw $8F8 - (319*2)
                            > endif
                             
                              mDt $8F8
                            > if 0=$8F8
                            >   dw 0
                            > else
7491 : 067a                 >   dw $8F8 - (319*2)
                            > endif
                             
                              mDt $83F
                            > if 0=$83F
                            >   dw 0
                            > else
7493 : 05c1                 >   dw $83F - (319*2)
                            > endif
                             
                              mDt $67F
                            > if 0=$67F
                            >   dw 0
                            > else
7495 : 0401                 >   dw $67F - (319*2)
                            > endif
                             
                              mDt $67F
                            > if 0=$67F
                            >   dw 0
                            > else
7497 : 0401                 >   dw $67F - (319*2)
                            > endif
                             
                              mDt $67F
                            > if 0=$67F
                            >   dw 0
                            > else
7499 : 0401                 >   dw $67F - (319*2)
                            > endif
                             
                              mDt $67F
                            > if 0=$67F
                            >   dw 0
                            > else
749b : 0401                 >   dw $67F - (319*2)
                            > endif
                             
                              mDt $67F
                            > if 0=$67F
                            >   dw 0
                            > else
749d : 0401                 >   dw $67F - (319*2)
                            > endif
                             
                              mDt $67F
                            > if 0=$67F
                            >   dw 0
                            > else
749f : 0401                 >   dw $67F - (319*2)
                            > endif
                             
                              mDt $67F
                            > if 0=$67F
                            >   dw 0
                            > else
74a1 : 0401                 >   dw $67F - (319*2)
                            > endif
                             
                              mDt $67F
                            > if 0=$67F
                            >   dw 0
                            > else
74a3 : 0401                 >   dw $67F - (319*2)
                            > endif
                             
                              mDt $6B5
                            > if 0=$6B5
                            >   dw 0
                            > else
74a5 : 0437                 >   dw $6B5 - (319*2)
                            > endif
                             
                              mDt $6B5
                            > if 0=$6B5
                            >   dw 0
                            > else
74a7 : 0437                 >   dw $6B5 - (319*2)
                            > endif
                             
                              mDt $6EA
                            > if 0=$6EA
                            >   dw 0
                            > else
74a9 : 046c                 >   dw $6EA - (319*2)
                            > endif
                             
                              mDt $6B5
                            > if 0=$6B5
                            >   dw 0
                            > else
74ab : 0437                 >   dw $6B5 - (319*2)
                            > endif
                             
                              mDt $6B5
                            > if 0=$6B5
                            >   dw 0
                            > else
74ad : 0437                 >   dw $6B5 - (319*2)
                            > endif
                             
                              mDt $74B
                            > if 0=$74B
                            >   dw 0
                            > else
74af : 04cd                 >   dw $74B - (319*2)
                            > endif
                             
                              mDt $74B
                            > if 0=$74B
                            >   dw 0
                            > else
74b1 : 04cd                 >   dw $74B - (319*2)
                            > endif
                             
                              mDt $77C
                            > if 0=$77C
                            >   dw 0
                            > else
74b3 : 04fe                 >   dw $77C - (319*2)
                            > endif
                             
                              mDt $77C
                            > if 0=$77C
                            >   dw 0
                            > else
74b5 : 04fe                 >   dw $77C - (319*2)
                            > endif
                             
                              mDt $7AD
                            > if 0=$7AD
                            >   dw 0
                            > else
74b7 : 052f                 >   dw $7AD - (319*2)
                            > endif
                             
                              mDt $7AD
                            > if 0=$7AD
                            >   dw 0
                            > else
74b9 : 052f                 >   dw $7AD - (319*2)
                            > endif
                             
                              mDt $77C
                            > if 0=$77C
                            >   dw 0
                            > else
74bb : 04fe                 >   dw $77C - (319*2)
                            > endif
                             
                              mDt $77C
                            > if 0=$77C
                            >   dw 0
                            > else
74bd : 04fe                 >   dw $77C - (319*2)
                            > endif
                             
                              mDt $7DE
                            > if 0=$7DE
                            >   dw 0
                            > else
74bf : 0560                 >   dw $7DE - (319*2)
                            > endif
                             
                              mDt $83F
                            > if 0=$83F
                            >   dw 0
                            > else
74c1 : 05c1                 >   dw $83F - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
74c3 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
74c5 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
74c7 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
74c9 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
74cb : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
74cd : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
74cf : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
74d1 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
74d3 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
74d5 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
74d7 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
74d9 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
74db : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
74dd : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
74df : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
74e1 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
74e3 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
74e5 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
74e7 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
74e9 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
74eb : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
74ed : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
74ef : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $624
                            > if 0=$624
                            >   dw 0
                            > else
74f1 : 03a6                 >   dw $624 - (319*2)
                            > endif
                             
                              mDt $83F
                            > if 0=$83F
                            >   dw 0
                            > else
74f3 : 05c1                 >   dw $83F - (319*2)
                            > endif
                             
                              mDt 0
                            > if 0=0
74f5 : 0000                 >   dw 0
                            > else
                            >   dw 0 - (319*2)
                            > endif
                             
                             
                              ;Channel 3 track, offset $2CC, 143 entries
74f7 :                       TRACK_DATA_CHANNEL3:
                              mDt $A76
                            > if 0=$A76
                            >   dw 0
                            > else
74f7 : 07f8                 >   dw $A76 - (319*2)
                            > endif
                             
                              mDt $A76
                            > if 0=$A76
                            >   dw 0
                            > else
74f9 : 07f8                 >   dw $A76 - (319*2)
                            > endif
                             
                              mDt $A76
                            > if 0=$A76
                            >   dw 0
                            > else
74fb : 07f8                 >   dw $A76 - (319*2)
                            > endif
                             
                              mDt $A76
                            > if 0=$A76
                            >   dw 0
                            > else
74fd : 07f8                 >   dw $A76 - (319*2)
                            > endif
                             
                              mDt $A76
                            > if 0=$A76
                            >   dw 0
                            > else
74ff : 07f8                 >   dw $A76 - (319*2)
                            > endif
                             
                              mDt $A76
                            > if 0=$A76
                            >   dw 0
                            > else
7501 : 07f8                 >   dw $A76 - (319*2)
                            > endif
                             
                              mDt $A76
                            > if 0=$A76
                            >   dw 0
                            > else
7503 : 07f8                 >   dw $A76 - (319*2)
                            > endif
                             
                              mDt $A76
                            > if 0=$A76
                            >   dw 0
                            > else
7505 : 07f8                 >   dw $A76 - (319*2)
                            > endif
                             
                              mDt $A76
                            > if 0=$A76
                            >   dw 0
                            > else
7507 : 07f8                 >   dw $A76 - (319*2)
                            > endif
                             
                              mDt $A76
                            > if 0=$A76
                            >   dw 0
                            > else
7509 : 07f8                 >   dw $A76 - (319*2)
                            > endif
                             
                              mDt $A76
                            > if 0=$A76
                            >   dw 0
                            > else
750b : 07f8                 >   dw $A76 - (319*2)
                            > endif
                             
                              mDt $A76
                            > if 0=$A76
                            >   dw 0
                            > else
750d : 07f8                 >   dw $A76 - (319*2)
                            > endif
                             
                              mDt $A76
                            > if 0=$A76
                            >   dw 0
                            > else
750f : 07f8                 >   dw $A76 - (319*2)
                            > endif
                             
                              mDt $A76
                            > if 0=$A76
                            >   dw 0
                            > else
7511 : 07f8                 >   dw $A76 - (319*2)
                            > endif
                             
                              mDt $A76
                            > if 0=$A76
                            >   dw 0
                            > else
7513 : 07f8                 >   dw $A76 - (319*2)
                            > endif
                             
                              mDt $A76
                            > if 0=$A76
                            >   dw 0
                            > else
7515 : 07f8                 >   dw $A76 - (319*2)
                            > endif
                             
                              mDt $A51
                            > if 0=$A51
                            >   dw 0
                            > else
7517 : 07d3                 >   dw $A51 - (319*2)
                            > endif
                             
                              mDt $A51
                            > if 0=$A51
                            >   dw 0
                            > else
7519 : 07d3                 >   dw $A51 - (319*2)
                            > endif
                             
                              mDt $A51
                            > if 0=$A51
                            >   dw 0
                            > else
751b : 07d3                 >   dw $A51 - (319*2)
                            > endif
                             
                              mDt $A51
                            > if 0=$A51
                            >   dw 0
                            > else
751d : 07d3                 >   dw $A51 - (319*2)
                            > endif
                             
                              mDt $8A1
                            > if 0=$8A1
                            >   dw 0
                            > else
751f : 0623                 >   dw $8A1 - (319*2)
                            > endif
                             
                              mDt $9DF
                            > if 0=$9DF
                            >   dw 0
                            > else
7521 : 0761                 >   dw $9DF - (319*2)
                            > endif
                             
                              mDt $A1D
                            > if 0=$A1D
                            >   dw 0
                            > else
7523 : 079f                 >   dw $A1D - (319*2)
                            > endif
                             
                              mDt $A37
                            > if 0=$A37
                            >   dw 0
                            > else
7525 : 07b9                 >   dw $A37 - (319*2)
                            > endif
                             
                              mDt $A03
                            > if 0=$A03
                            >   dw 0
                            > else
7527 : 0785                 >   dw $A03 - (319*2)
                            > endif
                             
                              mDt $9DF
                            > if 0=$9DF
                            >   dw 0
                            > else
7529 : 0761                 >   dw $9DF - (319*2)
                            > endif
                             
                              mDt $A1D
                            > if 0=$A1D
                            >   dw 0
                            > else
752b : 079f                 >   dw $A1D - (319*2)
                            > endif
                             
                              mDt $A37
                            > if 0=$A37
                            >   dw 0
                            > else
752d : 07b9                 >   dw $A37 - (319*2)
                            > endif
                             
                              mDt $A03
                            > if 0=$A03
                            >   dw 0
                            > else
752f : 0785                 >   dw $A03 - (319*2)
                            > endif
                             
                              mDt $9DF
                            > if 0=$9DF
                            >   dw 0
                            > else
7531 : 0761                 >   dw $9DF - (319*2)
                            > endif
                             
                              mDt $A1D
                            > if 0=$A1D
                            >   dw 0
                            > else
7533 : 079f                 >   dw $A1D - (319*2)
                            > endif
                             
                              mDt $A37
                            > if 0=$A37
                            >   dw 0
                            > else
7535 : 07b9                 >   dw $A37 - (319*2)
                            > endif
                             
                              mDt $A03
                            > if 0=$A03
                            >   dw 0
                            > else
7537 : 0785                 >   dw $A03 - (319*2)
                            > endif
                             
                              mDt $9DF
                            > if 0=$9DF
                            >   dw 0
                            > else
7539 : 0761                 >   dw $9DF - (319*2)
                            > endif
                             
                              mDt $A1D
                            > if 0=$A1D
                            >   dw 0
                            > else
753b : 079f                 >   dw $A1D - (319*2)
                            > endif
                             
                              mDt $A37
                            > if 0=$A37
                            >   dw 0
                            > else
753d : 07b9                 >   dw $A37 - (319*2)
                            > endif
                             
                              mDt $A03
                            > if 0=$A03
                            >   dw 0
                            > else
753f : 0785                 >   dw $A03 - (319*2)
                            > endif
                             
                              mDt $A51
                            > if 0=$A51
                            >   dw 0
                            > else
7541 : 07d3                 >   dw $A51 - (319*2)
                            > endif
                             
                              mDt $AE3
                            > if 0=$AE3
                            >   dw 0
                            > else
7543 : 0865                 >   dw $AE3 - (319*2)
                            > endif
                             
                              mDt $A92
                            > if 0=$A92
                            >   dw 0
                            > else
7545 : 0814                 >   dw $A92 - (319*2)
                            > endif
                             
                              mDt $AC8
                            > if 0=$AC8
                            >   dw 0
                            > else
7547 : 084a                 >   dw $AC8 - (319*2)
                            > endif
                             
                              mDt $A51
                            > if 0=$A51
                            >   dw 0
                            > else
7549 : 07d3                 >   dw $A51 - (319*2)
                            > endif
                             
                              mDt $AE3
                            > if 0=$AE3
                            >   dw 0
                            > else
754b : 0865                 >   dw $AE3 - (319*2)
                            > endif
                             
                              mDt $A92
                            > if 0=$A92
                            >   dw 0
                            > else
754d : 0814                 >   dw $A92 - (319*2)
                            > endif
                             
                              mDt $AC8
                            > if 0=$AC8
                            >   dw 0
                            > else
754f : 084a                 >   dw $AC8 - (319*2)
                            > endif
                             
                              mDt $AE3
                            > if 0=$AE3
                            >   dw 0
                            > else
7551 : 0865                 >   dw $AE3 - (319*2)
                            > endif
                             
                              mDt $AE3
                            > if 0=$AE3
                            >   dw 0
                            > else
7553 : 0865                 >   dw $AE3 - (319*2)
                            > endif
                             
                              mDt $AC8
                            > if 0=$AC8
                            >   dw 0
                            > else
7555 : 084a                 >   dw $AC8 - (319*2)
                            > endif
                             
                              mDt $AC8
                            > if 0=$AC8
                            >   dw 0
                            > else
7557 : 084a                 >   dw $AC8 - (319*2)
                            > endif
                             
                              mDt $AAD
                            > if 0=$AAD
                            >   dw 0
                            > else
7559 : 082f                 >   dw $AAD - (319*2)
                            > endif
                             
                              mDt $AAD
                            > if 0=$AAD
                            >   dw 0
                            > else
755b : 082f                 >   dw $AAD - (319*2)
                            > endif
                             
                              mDt $A92
                            > if 0=$A92
                            >   dw 0
                            > else
755d : 0814                 >   dw $A92 - (319*2)
                            > endif
                             
                              mDt $A92
                            > if 0=$A92
                            >   dw 0
                            > else
755f : 0814                 >   dw $A92 - (319*2)
                            > endif
                             
                              mDt $A51
                            > if 0=$A51
                            >   dw 0
                            > else
7561 : 07d3                 >   dw $A51 - (319*2)
                            > endif
                             
                              mDt $A51
                            > if 0=$A51
                            >   dw 0
                            > else
7563 : 07d3                 >   dw $A51 - (319*2)
                            > endif
                             
                              mDt $AC8
                            > if 0=$AC8
                            >   dw 0
                            > else
7565 : 084a                 >   dw $AC8 - (319*2)
                            > endif
                             
                              mDt $AC8
                            > if 0=$AC8
                            >   dw 0
                            > else
7567 : 084a                 >   dw $AC8 - (319*2)
                            > endif
                             
                              mDt $AAD
                            > if 0=$AAD
                            >   dw 0
                            > else
7569 : 082f                 >   dw $AAD - (319*2)
                            > endif
                             
                              mDt $AAD
                            > if 0=$AAD
                            >   dw 0
                            > else
756b : 082f                 >   dw $AAD - (319*2)
                            > endif
                             
                              mDt $A92
                            > if 0=$A92
                            >   dw 0
                            > else
756d : 0814                 >   dw $A92 - (319*2)
                            > endif
                             
                              mDt $A92
                            > if 0=$A92
                            >   dw 0
                            > else
756f : 0814                 >   dw $A92 - (319*2)
                            > endif
                             
                              mDt $8A1
                            > if 0=$8A1
                            >   dw 0
                            > else
7571 : 0623                 >   dw $8A1 - (319*2)
                            > endif
                             
                              mDt $9DF
                            > if 0=$9DF
                            >   dw 0
                            > else
7573 : 0761                 >   dw $9DF - (319*2)
                            > endif
                             
                              mDt $A1D
                            > if 0=$A1D
                            >   dw 0
                            > else
7575 : 079f                 >   dw $A1D - (319*2)
                            > endif
                             
                              mDt $A37
                            > if 0=$A37
                            >   dw 0
                            > else
7577 : 07b9                 >   dw $A37 - (319*2)
                            > endif
                             
                              mDt $A03
                            > if 0=$A03
                            >   dw 0
                            > else
7579 : 0785                 >   dw $A03 - (319*2)
                            > endif
                             
                              mDt $9DF
                            > if 0=$9DF
                            >   dw 0
                            > else
757b : 0761                 >   dw $9DF - (319*2)
                            > endif
                             
                              mDt $A1D
                            > if 0=$A1D
                            >   dw 0
                            > else
757d : 079f                 >   dw $A1D - (319*2)
                            > endif
                             
                              mDt $A37
                            > if 0=$A37
                            >   dw 0
                            > else
757f : 07b9                 >   dw $A37 - (319*2)
                            > endif
                             
                              mDt $A03
                            > if 0=$A03
                            >   dw 0
                            > else
7581 : 0785                 >   dw $A03 - (319*2)
                            > endif
                             
                              mDt $9DF
                            > if 0=$9DF
                            >   dw 0
                            > else
7583 : 0761                 >   dw $9DF - (319*2)
                            > endif
                             
                              mDt $A1D
                            > if 0=$A1D
                            >   dw 0
                            > else
7585 : 079f                 >   dw $A1D - (319*2)
                            > endif
                             
                              mDt $A37
                            > if 0=$A37
                            >   dw 0
                            > else
7587 : 07b9                 >   dw $A37 - (319*2)
                            > endif
                             
                              mDt $A03
                            > if 0=$A03
                            >   dw 0
                            > else
7589 : 0785                 >   dw $A03 - (319*2)
                            > endif
                             
                              mDt $9DF
                            > if 0=$9DF
                            >   dw 0
                            > else
758b : 0761                 >   dw $9DF - (319*2)
                            > endif
                             
                              mDt $A1D
                            > if 0=$A1D
                            >   dw 0
                            > else
758d : 079f                 >   dw $A1D - (319*2)
                            > endif
                             
                              mDt $A37
                            > if 0=$A37
                            >   dw 0
                            > else
758f : 07b9                 >   dw $A37 - (319*2)
                            > endif
                             
                              mDt $A03
                            > if 0=$A03
                            >   dw 0
                            > else
7591 : 0785                 >   dw $A03 - (319*2)
                            > endif
                             
                              mDt $8A1
                            > if 0=$8A1
                            >   dw 0
                            > else
7593 : 0623                 >   dw $8A1 - (319*2)
                            > endif
                             
                              mDt $96C
                            > if 0=$96C
                            >   dw 0
                            > else
7595 : 06ee                 >   dw $96C - (319*2)
                            > endif
                             
                              mDt $96C
                            > if 0=$96C
                            >   dw 0
                            > else
7597 : 06ee                 >   dw $96C - (319*2)
                            > endif
                             
                              mDt $96C
                            > if 0=$96C
                            >   dw 0
                            > else
7599 : 06ee                 >   dw $96C - (319*2)
                            > endif
                             
                              mDt $96C
                            > if 0=$96C
                            >   dw 0
                            > else
759b : 06ee                 >   dw $96C - (319*2)
                            > endif
                             
                              mDt $96C
                            > if 0=$96C
                            >   dw 0
                            > else
759d : 06ee                 >   dw $96C - (319*2)
                            > endif
                             
                              mDt $96C
                            > if 0=$96C
                            >   dw 0
                            > else
759f : 06ee                 >   dw $96C - (319*2)
                            > endif
                             
                              mDt $96C
                            > if 0=$96C
                            >   dw 0
                            > else
75a1 : 06ee                 >   dw $96C - (319*2)
                            > endif
                             
                              mDt $96C
                            > if 0=$96C
                            >   dw 0
                            > else
75a3 : 06ee                 >   dw $96C - (319*2)
                            > endif
                             
                              mDt $96C
                            > if 0=$96C
                            >   dw 0
                            > else
75a5 : 06ee                 >   dw $96C - (319*2)
                            > endif
                             
                              mDt $96C
                            > if 0=$96C
                            >   dw 0
                            > else
75a7 : 06ee                 >   dw $96C - (319*2)
                            > endif
                             
                              mDt $96C
                            > if 0=$96C
                            >   dw 0
                            > else
75a9 : 06ee                 >   dw $96C - (319*2)
                            > endif
                             
                              mDt $96C
                            > if 0=$96C
                            >   dw 0
                            > else
75ab : 06ee                 >   dw $96C - (319*2)
                            > endif
                             
                              mDt $8A1
                            > if 0=$8A1
                            >   dw 0
                            > else
75ad : 0623                 >   dw $8A1 - (319*2)
                            > endif
                             
                              mDt $A51
                            > if 0=$A51
                            >   dw 0
                            > else
75af : 07d3                 >   dw $A51 - (319*2)
                            > endif
                             
                              mDt $AE3
                            > if 0=$AE3
                            >   dw 0
                            > else
75b1 : 0865                 >   dw $AE3 - (319*2)
                            > endif
                             
                              mDt $A92
                            > if 0=$A92
                            >   dw 0
                            > else
75b3 : 0814                 >   dw $A92 - (319*2)
                            > endif
                             
                              mDt $AC8
                            > if 0=$AC8
                            >   dw 0
                            > else
75b5 : 084a                 >   dw $AC8 - (319*2)
                            > endif
                             
                              mDt $A51
                            > if 0=$A51
                            >   dw 0
                            > else
75b7 : 07d3                 >   dw $A51 - (319*2)
                            > endif
                             
                              mDt $AE3
                            > if 0=$AE3
                            >   dw 0
                            > else
75b9 : 0865                 >   dw $AE3 - (319*2)
                            > endif
                             
                              mDt $A92
                            > if 0=$A92
                            >   dw 0
                            > else
75bb : 0814                 >   dw $A92 - (319*2)
                            > endif
                             
                              mDt $AC8
                            > if 0=$AC8
                            >   dw 0
                            > else
75bd : 084a                 >   dw $AC8 - (319*2)
                            > endif
                             
                              mDt $AE3
                            > if 0=$AE3
                            >   dw 0
                            > else
75bf : 0865                 >   dw $AE3 - (319*2)
                            > endif
                             
                              mDt $AE3
                            > if 0=$AE3
                            >   dw 0
                            > else
75c1 : 0865                 >   dw $AE3 - (319*2)
                            > endif
                             
                              mDt $AC8
                            > if 0=$AC8
                            >   dw 0
                            > else
75c3 : 084a                 >   dw $AC8 - (319*2)
                            > endif
                             
                              mDt $AC8
                            > if 0=$AC8
                            >   dw 0
                            > else
75c5 : 084a                 >   dw $AC8 - (319*2)
                            > endif
                             
                              mDt $AAD
                            > if 0=$AAD
                            >   dw 0
                            > else
75c7 : 082f                 >   dw $AAD - (319*2)
                            > endif
                             
                              mDt $AAD
                            > if 0=$AAD
                            >   dw 0
                            > else
75c9 : 082f                 >   dw $AAD - (319*2)
                            > endif
                             
                              mDt $A92
                            > if 0=$A92
                            >   dw 0
                            > else
75cb : 0814                 >   dw $A92 - (319*2)
                            > endif
                             
                              mDt $A92
                            > if 0=$A92
                            >   dw 0
                            > else
75cd : 0814                 >   dw $A92 - (319*2)
                            > endif
                             
                              mDt $A51
                            > if 0=$A51
                            >   dw 0
                            > else
75cf : 07d3                 >   dw $A51 - (319*2)
                            > endif
                             
                              mDt $A51
                            > if 0=$A51
                            >   dw 0
                            > else
75d1 : 07d3                 >   dw $A51 - (319*2)
                            > endif
                             
                              mDt $AC8
                            > if 0=$AC8
                            >   dw 0
                            > else
75d3 : 084a                 >   dw $AC8 - (319*2)
                            > endif
                             
                              mDt $AC8
                            > if 0=$AC8
                            >   dw 0
                            > else
75d5 : 084a                 >   dw $AC8 - (319*2)
                            > endif
                             
                              mDt $AAD
                            > if 0=$AAD
                            >   dw 0
                            > else
75d7 : 082f                 >   dw $AAD - (319*2)
                            > endif
                             
                              mDt $AAD
                            > if 0=$AAD
                            >   dw 0
                            > else
75d9 : 082f                 >   dw $AAD - (319*2)
                            > endif
                             
                              mDt $A92
                            > if 0=$A92
                            >   dw 0
                            > else
75db : 0814                 >   dw $A92 - (319*2)
                            > endif
                             
                              mDt $A92
                            > if 0=$A92
                            >   dw 0
                            > else
75dd : 0814                 >   dw $A92 - (319*2)
                            > endif
                             
                              mDt $8A1
                            > if 0=$8A1
                            >   dw 0
                            > else
75df : 0623                 >   dw $8A1 - (319*2)
                            > endif
                             
                              mDt $9DF
                            > if 0=$9DF
                            >   dw 0
                            > else
75e1 : 0761                 >   dw $9DF - (319*2)
                            > endif
                             
                              mDt $A1D
                            > if 0=$A1D
                            >   dw 0
                            > else
75e3 : 079f                 >   dw $A1D - (319*2)
                            > endif
                             
                              mDt $A37
                            > if 0=$A37
                            >   dw 0
                            > else
75e5 : 07b9                 >   dw $A37 - (319*2)
                            > endif
                             
                              mDt $A03
                            > if 0=$A03
                            >   dw 0
                            > else
75e7 : 0785                 >   dw $A03 - (319*2)
                            > endif
                             
                              mDt $9DF
                            > if 0=$9DF
                            >   dw 0
                            > else
75e9 : 0761                 >   dw $9DF - (319*2)
                            > endif
                             
                              mDt $A1D
                            > if 0=$A1D
                            >   dw 0
                            > else
75eb : 079f                 >   dw $A1D - (319*2)
                            > endif
                             
                              mDt $A37
                            > if 0=$A37
                            >   dw 0
                            > else
75ed : 07b9                 >   dw $A37 - (319*2)
                            > endif
                             
                              mDt $A03
                            > if 0=$A03
                            >   dw 0
                            > else
75ef : 0785                 >   dw $A03 - (319*2)
                            > endif
                             
                              mDt $9DF
                            > if 0=$9DF
                            >   dw 0
                            > else
75f1 : 0761                 >   dw $9DF - (319*2)
                            > endif
                             
                              mDt $A1D
                            > if 0=$A1D
                            >   dw 0
                            > else
75f3 : 079f                 >   dw $A1D - (319*2)
                            > endif
                             
                              mDt $A37
                            > if 0=$A37
                            >   dw 0
                            > else
75f5 : 07b9                 >   dw $A37 - (319*2)
                            > endif
                             
                              mDt $A03
                            > if 0=$A03
                            >   dw 0
                            > else
75f7 : 0785                 >   dw $A03 - (319*2)
                            > endif
                             
                              mDt $9DF
                            > if 0=$9DF
                            >   dw 0
                            > else
75f9 : 0761                 >   dw $9DF - (319*2)
                            > endif
                             
                              mDt $A1D
                            > if 0=$A1D
                            >   dw 0
                            > else
75fb : 079f                 >   dw $A1D - (319*2)
                            > endif
                             
                              mDt $A37
                            > if 0=$A37
                            >   dw 0
                            > else
75fd : 07b9                 >   dw $A37 - (319*2)
                            > endif
                             
                              mDt $A03
                            > if 0=$A03
                            >   dw 0
                            > else
75ff : 0785                 >   dw $A03 - (319*2)
                            > endif
                             
                              mDt $9DF
                            > if 0=$9DF
                            >   dw 0
                            > else
7601 : 0761                 >   dw $9DF - (319*2)
                            > endif
                             
                              mDt $A1D
                            > if 0=$A1D
                            >   dw 0
                            > else
7603 : 079f                 >   dw $A1D - (319*2)
                            > endif
                             
                              mDt $A37
                            > if 0=$A37
                            >   dw 0
                            > else
7605 : 07b9                 >   dw $A37 - (319*2)
                            > endif
                             
                              mDt $A03
                            > if 0=$A03
                            >   dw 0
                            > else
7607 : 0785                 >   dw $A03 - (319*2)
                            > endif
                             
                              mDt $9DF
                            > if 0=$9DF
                            >   dw 0
                            > else
7609 : 0761                 >   dw $9DF - (319*2)
                            > endif
                             
                              mDt $A1D
                            > if 0=$A1D
                            >   dw 0
                            > else
760b : 079f                 >   dw $A1D - (319*2)
                            > endif
                             
                              mDt $A37
                            > if 0=$A37
                            >   dw 0
                            > else
760d : 07b9                 >   dw $A37 - (319*2)
                            > endif
                             
                              mDt $A03
                            > if 0=$A03
                            >   dw 0
                            > else
760f : 0785                 >   dw $A03 - (319*2)
                            > endif
                             
                              mDt $8A1
                            > if 0=$8A1
                            >   dw 0
                            > else
7611 : 0623                 >   dw $8A1 - (319*2)
                            > endif
                             
                              mDt 0
                            > if 0=0
7613 : 0000                 >   dw 0
                            > else
                            >   dw 0 - (319*2)
                            > endif
                             
                             
                              ;Patterns
7615 : c781                   dw $C781
7617 : 87ff                   dw $87FF
7619 : 8087                   dw $8087
761b : c18a                   dw $C18A
761d : 8801                   dw $8801
761f : 0281                   dw $281
7621 : df00                   dw $DF00
7623 : 1104                   dw $1104
7625 : e02d                   dw $E02D
7627 : 2d2d                   dw $2D2D
7629 : 2d34                   dw $2D34
762b : 342d                   dw $342D
762d : 2d30                   dw $2D30
762f : 30e0                   dw $30E0
7631 : 3434                   dw $3434
7633 : 2d2d                   dw $2D2D
7635 : 3434                   dw $3434
7637 : 3737                   dw $3737
7639 : 3737                   dw $3737
763b : e037                   dw $E037
763d : 3735                   dw $3735
763f : 3535                   dw $3535
7641 : 3535                   dw $3535
7643 : 3534                   dw $3534
7645 : 3434                   dw $3434
7647 : 34e0                   dw $34E0
7649 : 3030                   dw $3030
764b : 3030                   dw $3030
764d : 3535                   dw $3535
764f : 2d2d                   dw $2D2D
7651 : 3030                   dw $3030
7653 : 3535                   dw $3535
7655 : e02d                   dw $E02D
7657 : 2d35                   dw $2D35
7659 : 3532                   dw $3532
765b : 3232                   dw $3232
765d : 3232                   dw $3232
765f : 3230                   dw $3230
7661 : 30e0                   dw $30E0
7663 : 3030                   dw $3030
7665 : 3030                   dw $3030
7667 : 3232                   dw $3232
7669 : 3232                   dw $3232
766b : 87c0                   dw $87C0
766d : df00                   dw $DF00
766f : 6102                   dw $6102
7671 : 8801                   dw $8801
7673 : 0283                   dw $283
7675 : e52d                   dw $E52D
7677 : 2fe3                   dw $2FE3
7679 : 30e5                   dw $30E5
767b : 3432                   dw $3432
767d : e330                   dw $E330
767f : e52d                   dw $E52D
7681 : 30e3                   dw $30E3
7683 : 3532                   dw $3532
7685 : 32e1                   dw $32E1
7687 : 30e5                   dw $30E5
7689 : 2f2d                   dw $2F2D
768b : 30e3                   dw $30E3
768d : 34e5                   dw $34E5
768f : 3735                   dw $3735
7691 : e334                   dw $E334
7693 : e530                   dw $E530
7695 : 34e3                   dw $34E3
7697 : 3532                   dw $3532
7699 : 32e1                   dw $32E1
769b : 30e5                   dw $30E5
769d : 2f87                   dw $2F87
769f : c08a                   dw $C08A
76a1 : 8801                   dw $8801
76a3 : 0282                   dw $282
76a5 : df00                   dw $DF00
76a7 : 6102                   dw $6102
76a9 : e180                   dw $E180
76ab : e134                   dw $E134
76ad : e032                   dw $E032
76af : e130                   dw $E130
76b1 : e42d                   dw $E42D
76b3 : e12b                   dw $E12B
76b5 : 2de1                   dw $2DE1
76b7 : 80e1                   dw $80E1
76b9 : 34e0                   dw $34E0
76bb : 32e1                   dw $32E1
76bd : 30e0                   dw $30E0
76bf : 32e3                   dw $32E3
76c1 : 8080                   dw $8080
76c3 : e180                   dw $E180
76c5 : e132                   dw $E132
76c7 : e030                   dw $E030
76c9 : e12f                   dw $E12F
76cb : e430                   dw $E430
76cd : e12f                   dw $E12F
76cf : 2def                   dw $2DEF
76d1 : 2be1                   dw $2BE1
76d3 : 80e1                   dw $80E1
76d5 : 34e0                   dw $34E0
76d7 : 32e1                   dw $32E1
76d9 : 30e4                   dw $30E4
76db : 2de1                   dw $2DE1
76dd : 3034                   dw $3034
76df : e180                   dw $E180
76e1 : e139                   dw $E139
76e3 : e037                   dw $E037
76e5 : e135                   dw $E135
76e7 : e232                   dw $E232
76e9 : e180                   dw $E180
76eb : e380                   dw $E380
76ed : e180                   dw $E180
76ef : e137                   dw $E137
76f1 : e035                   dw $E035
76f3 : e134                   dw $E134
76f5 : e435                   dw $E435
76f7 : e337                   dw $E337
76f9 : e635                   dw $E635
76fb : e834                   dw $E834
76fd : 87c0                   dw $87C0
76ff : 8a88                   dw $8A88
7701 : 0102                   dw $102
7703 : 83df                   dw $83DF
7705 : 00f1                   dw $F1
7707 : 02f7                   dw $2F7
7709 : 32e3                   dw $32E3
770b : 3435                   dw $3435
770d : f730                   dw $F730
770f : e380                   dw $E380
7711 : 80f7                   dw $80F7
7713 : 30e3                   dw $30E3
7715 : 3234                   dw $3234
7717 : ef2f                   dw $EF2F
7719 : efc6                   dw $EFC6
771b : 861d                   dw $861D
771d : c0f7                   dw $C0F7
771f : 30e3                   dw $30E3
7721 : 3435                   dw $3435
7723 : ff34                   dw $FF34
7725 : f735                   dw $F735
7727 : e337                   dw $E337
7729 : 39ef                   dw $39EF
772b : 37ef                   dw $37EF
772d : c686                   dw $C686
772f : 1d87                   dw $1D87
7731 : c0df                   dw $C0DF
7733 : 0011                   dw $11
7735 : 0fe1                   dw $FE1
7737 : 8b89                   dw $8B89
7739 : 1f8d                   dw $1F8D
773b : 00e0                   dw $E0
773d : 8a91                   dw $8A91
773f : 2891                   dw $2891
7741 : 2d8b                   dw $2D8B
7743 : 8907                   dw $8907
7745 : 8d00                   dw $8D00
7747 : 8a91                   dw $8A91
7749 : 3091                   dw $3091
774b : 348b                   dw $348B
774d : 891f                   dw $891F
774f : 8d00                   dw $8D00
7751 : e18d                   dw $E18D
7753 : 00e0                   dw $E0
7755 : 8a91                   dw $8A91
7757 : 2d91                   dw $2D91
7759 : 2d8b                   dw $2D8B
775b : 8907                   dw $8907
775d : 8d00                   dw $8D00
775f : 8a91                   dw $8A91
7761 : 3491                   dw $3491
7763 : 3291                   dw $3291
7765 : 3087                   dw $3087
7767 : c0df                   dw $C0DF
7769 : 0011                   dw $11
776b : 0fe1                   dw $FE1
776d : 8b89                   dw $8B89
776f : 1f8d                   dw $1F8D
7771 : 0080                   dw $80
7773 : e089                   dw $E089
7775 : 078d                   dw $78D
7777 : 0080                   dw $80
7779 : 8089                   dw $8089
777b : 1f8d                   dw $1F8D
777d : 00e1                   dw $E1
777f : 8d00                   dw $8D00
7781 : e080                   dw $E080
7783 : 8089                   dw $8089
7785 : 078d                   dw $78D
7787 : 0080                   dw $80
7789 : 8080                   dw $8080
778b : 87c0                   dw $87C0
778d : df00                   dw $DF00
778f : 110f                   dw $110F
7791 : e18b                   dw $E18B
7793 : 891f                   dw $891F
7795 : 8d00                   dw $8D00
7797 : e08a                   dw $E08A
7799 : 911c                   dw $911C
779b : 911f                   dw $911F
779d : 8b89                   dw $8B89
779f : 078d                   dw $78D
77a1 : 008a                   dw $8A
77a3 : 9124                   dw $9124
77a5 : 9121                   dw $9121
77a7 : 8b89                   dw $8B89
77a9 : 1f8d                   dw $1F8D
77ab : 00e1                   dw $E1
77ad : 8d00                   dw $8D00
77af : e08a                   dw $E08A
77b1 : 911f                   dw $911F
77b3 : 9121                   dw $9121
77b5 : 8b89                   dw $8B89
77b7 : 078d                   dw $78D
77b9 : 008a                   dw $8A
77bb : 9124                   dw $9124
77bd : 9121                   dw $9121
77bf : 911f                   dw $911F
77c1 : 87c2                   dw $87C2
77c3 : df00                   dw $DF00
77c5 : 2108                   dw $2108
77c7 : e18b                   dw $E18B
77c9 : 891f                   dw $891F
77cb : 8d00                   dw $8D00
77cd : e18a                   dw $E18A
77cf : 9129                   dw $9129
77d1 : e08b                   dw $E08B
77d3 : 8907                   dw $8907
77d5 : 8d00                   dw $8D00
77d7 : e18a                   dw $E18A
77d9 : 9129                   dw $9129
77db : e08b                   dw $E08B
77dd : 891f                   dw $891F
77df : 8d00                   dw $8D00
77e1 : e18d                   dw $E18D
77e3 : 00e0                   dw $E0
77e5 : 8a91                   dw $8A91
77e7 : 2991                   dw $2991
77e9 : 1d8b                   dw $1D8B
77eb : 8907                   dw $8907
77ed : 8d00                   dw $8D00
77ef : e18a                   dw $E18A
77f1 : 9129                   dw $9129
77f3 : e091                   dw $E091
77f5 : 2987                   dw $2987
77f7 : c3e1                   dw $C3E1
77f9 : 8b89                   dw $8B89
77fb : 1f8d                   dw $1F8D
77fd : 00e1                   dw $E1
77ff : 8a91                   dw $8A91
7801 : 29e0                   dw $29E0
7803 : 8b89                   dw $8B89
7805 : 078d                   dw $78D
7807 : 00e1                   dw $E1
7809 : 8a91                   dw $8A91
780b : 29e0                   dw $29E0
780d : 8b89                   dw $8B89
780f : 1f8d                   dw $1F8D
7811 : 00e1                   dw $E1
7813 : 8d00                   dw $8D00
7815 : e08a                   dw $E08A
7817 : 9129                   dw $9129
7819 : 911d                   dw $911D
781b : 8b89                   dw $8B89
781d : 078d                   dw $78D
781f : 00e1                   dw $E1
7821 : 8a91                   dw $8A91
7823 : 29e0                   dw $29E0
7825 : 9129                   dw $9129
7827 : c4e1                   dw $C4E1
7829 : 8b89                   dw $8B89
782b : 1f8d                   dw $1F8D
782d : 00e1                   dw $E1
782f : 8a91                   dw $8A91
7831 : 28e0                   dw $28E0
7833 : 8b89                   dw $8B89
7835 : 078d                   dw $78D
7837 : 00e1                   dw $E1
7839 : 8a91                   dw $8A91
783b : 28e0                   dw $28E0
783d : 8b89                   dw $8B89
783f : 1f8d                   dw $1F8D
7841 : 00e1                   dw $E1
7843 : 8d00                   dw $8D00
7845 : e08a                   dw $E08A
7847 : 9128                   dw $9128
7849 : 911c                   dw $911C
784b : 8b89                   dw $8B89
784d : 078d                   dw $78D
784f : 00e1                   dw $E1
7851 : 8a91                   dw $8A91
7853 : 28e0                   dw $28E0
7855 : 9128                   dw $9128
7857 : 87c2                   dw $87C2
7859 : e18b                   dw $E18B
785b : 891f                   dw $891F
785d : 8d00                   dw $8D00
785f : e18a                   dw $E18A
7861 : 912b                   dw $912B
7863 : e08b                   dw $E08B
7865 : 8907                   dw $8907
7867 : 8d00                   dw $8D00
7869 : e18a                   dw $E18A
786b : 912b                   dw $912B
786d : e08b                   dw $E08B
786f : 891f                   dw $891F
7871 : 8d00                   dw $8D00
7873 : e18d                   dw $E18D
7875 : 00e0                   dw $E0
7877 : 8a91                   dw $8A91
7879 : 2b91                   dw $2B91
787b : 1f8b                   dw $1F8B
787d : 8907                   dw $8907
787f : 8d00                   dw $8D00
7881 : e18a                   dw $E18A
7883 : 912b                   dw $912B
7885 : e091                   dw $E091
7887 : 2b87                   dw $2B87
7889 : c4e1                   dw $C4E1
788b : 8b89                   dw $8B89
788d : 1f8d                   dw $1F8D
788f : 00e1                   dw $E1
7891 : 8a91                   dw $8A91
7893 : 2de0                   dw $2DE0
7895 : 8b89                   dw $8B89
7897 : 078d                   dw $78D
7899 : 00e1                   dw $E1
789b : 8a91                   dw $8A91
789d : 2de0                   dw $2DE0
789f : 8b89                   dw $8B89
78a1 : 1f8d                   dw $1F8D
78a3 : 00e1                   dw $E1
78a5 : 8d00                   dw $8D00
78a7 : e08a                   dw $E08A
78a9 : 912d                   dw $912D
78ab : 9121                   dw $9121
78ad : 8b89                   dw $8B89
78af : 078d                   dw $78D
78b1 : 00e1                   dw $E1
78b3 : 8a91                   dw $8A91
78b5 : 2de0                   dw $2DE0
78b7 : 912d                   dw $912D
78b9 : 87c5                   dw $87C5
78bb : e18b                   dw $E18B
78bd : 891f                   dw $891F
78bf : 8d00                   dw $8D00
78c1 : e18a                   dw $E18A
78c3 : 912b                   dw $912B
78c5 : e08b                   dw $E08B
78c7 : 8907                   dw $8907
78c9 : 8d00                   dw $8D00
78cb : e18a                   dw $E18A
78cd : 912b                   dw $912B
78cf : e08b                   dw $E08B
78d1 : 891f                   dw $891F
78d3 : 8d00                   dw $8D00
78d5 : e18d                   dw $E18D
78d7 : 00e0                   dw $E0
78d9 : 8a91                   dw $8A91
78db : 2b91                   dw $2B91
78dd : 1f8b                   dw $1F8B
78df : 8907                   dw $8907
78e1 : 8d00                   dw $8D00
78e3 : e18a                   dw $E18A
78e5 : 912b                   dw $912B
78e7 : e091                   dw $E091
78e9 : 2b87                   dw $2B87
78eb : c3e1                   dw $C3E1
78ed : 8b89                   dw $8B89
78ef : 1f8d                   dw $1F8D
78f1 : 00e1                   dw $E1
78f3 : 8a91                   dw $8A91
78f5 : 30e0                   dw $30E0
78f7 : 8b89                   dw $8B89
78f9 : 078d                   dw $78D
78fb : 00e1                   dw $E1
78fd : 8a91                   dw $8A91
78ff : 30e0                   dw $30E0
7901 : 8b89                   dw $8B89
7903 : 1f8d                   dw $1F8D
7905 : 00e1                   dw $E1
7907 : 8d00                   dw $8D00
7909 : e08a                   dw $E08A
790b : 9130                   dw $9130
790d : 9124                   dw $9124
790f : 8b89                   dw $8B89
7911 : 078d                   dw $78D
7913 : 00e1                   dw $E1
7915 : 8a91                   dw $8A91
7917 : 30e0                   dw $30E0
7919 : 9130                   dw $9130
791b : c4e1                   dw $C4E1
791d : 8b89                   dw $8B89
791f : 1f8d                   dw $1F8D
7921 : 00e1                   dw $E1
7923 : 8a91                   dw $8A91
7925 : 2fe0                   dw $2FE0
7927 : 8b89                   dw $8B89
7929 : 078d                   dw $78D
792b : 00e1                   dw $E1
792d : 8a91                   dw $8A91
792f : 2fe0                   dw $2FE0
7931 : 8b89                   dw $8B89
7933 : 1f8d                   dw $1F8D
7935 : 00e1                   dw $E1
7937 : 8d00                   dw $8D00
7939 : e08a                   dw $E08A
793b : 912f                   dw $912F
793d : 9123                   dw $9123
793f : 8b89                   dw $8B89
7941 : 078d                   dw $78D
7943 : 00e1                   dw $E1
7945 : 8a91                   dw $8A91
7947 : 2fe0                   dw $2FE0
7949 : 912f                   dw $912F
794b : 87e1                   dw $87E1
794d : 8b89                   dw $8B89
794f : 1f8d                   dw $1F8D
7951 : 0089                   dw $89
7953 : 0c8d                   dw $C8D
7955 : 008d                   dw $8D
7957 : 0089                   dw $89
7959 : 1f8d                   dw $1F8D
795b : 00e0                   dw $E0
795d : 8d00                   dw $8D00
795f : 890c                   dw $890C
7961 : 8d00                   dw $8D00
7963 : e18d                   dw $E18D
7965 : 008d                   dw $8D
7967 : 00e0                   dw $E0
7969 : 891f                   dw $891F
796b : 8d00                   dw $8D00
796d : e18d                   dw $E18D
796f : 00e0                   dw $E0
7971 : 890c                   dw $890C
7973 : 8d00                   dw $8D00
7975 : e18d                   dw $E18D
7977 : 008d                   dw $8D
7979 : 008d                   dw $8D
797b : 00e3                   dw $E3
797d : 8d00                   dw $8D00
797f : e089                   dw $E089
7981 : 1f8d                   dw $1F8D
7983 : 008d                   dw $8D
7985 : 008d                   dw $8D
7987 : 008d                   dw $8D
7989 : 0087                   dw $87
798b : c581                   dw $C581
798d : df00                   dw $DF00
798f : 1104                   dw $1104
7991 : e128                   dw $E128
7993 : 2828                   dw $2828
7995 : 28e0                   dw $28E0
7997 : 2828                   dw $2828
7999 : e128                   dw $E128
799b : 28e0                   dw $28E0
799d : 28e1                   dw $28E1
799f : 28e0                   dw $28E0
79a1 : 28e1                   dw $28E1
79a3 : 2828                   dw $2828
79a5 : 28e3                   dw $28E3
79a7 : 28e0                   dw $28E0
79a9 : 3430                   dw $3430
79ab : 2d28                   dw $2D28
79ad : 87df                   dw $87DF
79af : 0061                   dw $61
79b1 : 02e1                   dw $2E1
79b3 : 9115                   dw $9115
79b5 : 9115                   dw $9115
79b7 : 9115                   dw $9115
79b9 : 9115                   dw $9115
79bb : e091                   dw $E091
79bd : 1591                   dw $1591
79bf : 15e1                   dw $15E1
79c1 : 9115                   dw $9115
79c3 : 9115                   dw $9115
79c5 : e091                   dw $E091
79c7 : 15e1                   dw $15E1
79c9 : 15e0                   dw $15E0
79cb : 9115                   dw $9115
79cd : e191                   dw $E191
79cf : 1591                   dw $1591
79d1 : 1591                   dw $1591
79d3 : 15e3                   dw $15E3
79d5 : 9115                   dw $9115
79d7 : 8087                   dw $8087
79d9 : 8ad1                   dw $8AD1
79db : 0111                   dw $111
79dd : f188                   dw $F188
79df : 0606                   dw $606
79e1 : 82c6                   dw $82C6
79e3 : ff86                   dw $FF86
79e5 : 1f87                   dw $1F87
79e7 : ffc0                   dw $FFC0
79e9 : 398f                   dw $398F
79eb : 3c8f                   dw $3C8F
79ed : 3b34                   dw $3B34
79ef : 2d8f                   dw $2D8F
79f1 : 87bd                   dw $87BD
79f3 : 8adf                   dw $8ADF
79f5 : 00f1                   dw $F1
79f7 : 0188                   dw $188
79f9 : 0206                   dw $206
79fb : 82c0                   dw $82C0
79fd : ff21                   dw $FF21
79ff : 241d                   dw $241D
7a01 : 1a18                   dw $1A18
7a03 : 1587                   dw $1587
7a05 : c0df                   dw $C0DF
7a07 : 0011                   dw $11
7a09 : 0fe0                   dw $FE0
7a0b : 8b89                   dw $8B89
7a0d : 1f8d                   dw $1F8D
7a0f : 00e1                   dw $E1
7a11 : 8907                   dw $8907
7a13 : 8d00                   dw $8D00
7a15 : e089                   dw $E089
7a17 : 1f8d                   dw $1F8D
7a19 : 00e1                   dw $E1
7a1b : 8907                   dw $8907
7a1d : 8d00                   dw $8D00
7a1f : e089                   dw $E089
7a21 : 1f8d                   dw $1F8D
7a23 : 008d                   dw $8D
7a25 : 00e0                   dw $E0
7a27 : 8b89                   dw $8B89
7a29 : 1f8d                   dw $1F8D
7a2b : 00e1                   dw $E1
7a2d : 8907                   dw $8907
7a2f : 8d00                   dw $8D00
7a31 : e089                   dw $E089
7a33 : 1f8d                   dw $1F8D
7a35 : 00e1                   dw $E1
7a37 : 8907                   dw $8907
7a39 : 8d00                   dw $8D00
7a3b : e089                   dw $E089
7a3d : 1f8d                   dw $1F8D
7a3f : 008d                   dw $8D
7a41 : 00e0                   dw $E0
7a43 : 8b89                   dw $8B89
7a45 : 1f8d                   dw $1F8D
7a47 : 00e1                   dw $E1
7a49 : 8907                   dw $8907
7a4b : 8d00                   dw $8D00
7a4d : e089                   dw $E089
7a4f : 1f8d                   dw $1F8D
7a51 : 00e1                   dw $E1
7a53 : 8907                   dw $8907
7a55 : 8d00                   dw $8D00
7a57 : e089                   dw $E089
7a59 : 1f8d                   dw $1F8D
7a5b : 008d                   dw $8D
7a5d : 00e0                   dw $E0
7a5f : 8b89                   dw $8B89
7a61 : 1f8d                   dw $1F8D
7a63 : 00e1                   dw $E1
7a65 : 8907                   dw $8907
7a67 : 8d00                   dw $8D00
7a69 : e089                   dw $E089
7a6b : 1f8d                   dw $1F8D
7a6d : 00e1                   dw $E1
7a6f : 8907                   dw $8907
7a71 : 8d00                   dw $8D00
7a73 : e08d                   dw $E08D
7a75 : 008d                   dw $8D
7a77 : 0087                   dw $87
7a79 : c0df                   dw $C0DF
7a7b : 0012                   dw $12
7a7d : 0fe0                   dw $FE0
7a7f : 9121                   dw $9121
7a81 : 9145                   dw $9145
7a83 : 9121                   dw $9121
7a85 : 9121                   dw $9121
7a87 : 9145                   dw $9145
7a89 : 9121                   dw $9121
7a8b : 9121                   dw $9121
7a8d : 9121                   dw $9121
7a8f : e091                   dw $E091
7a91 : 2191                   dw $2191
7a93 : 4591                   dw $4591
7a95 : 2191                   dw $2191
7a97 : 2191                   dw $2191
7a99 : 4591                   dw $4591
7a9b : 2191                   dw $2191
7a9d : 2191                   dw $2191
7a9f : 21e0                   dw $21E0
7aa1 : 9121                   dw $9121
7aa3 : 9145                   dw $9145
7aa5 : 9121                   dw $9121
7aa7 : 9121                   dw $9121
7aa9 : 9145                   dw $9145
7aab : 9121                   dw $9121
7aad : 9121                   dw $9121
7aaf : 9121                   dw $9121
7ab1 : e091                   dw $E091
7ab3 : 2191                   dw $2191
7ab5 : 4591                   dw $4591
7ab7 : 2191                   dw $2191
7ab9 : 2191                   dw $2191
7abb : 4591                   dw $4591
7abd : 2191                   dw $2191
7abf : 4591                   dw $4591
7ac1 : 4587                   dw $4587
7ac3 : df00                   dw $DF00
7ac5 : 210f                   dw $210F
7ac7 : 8a81                   dw $8A81
7ac9 : e1c4                   dw $E1C4
7acb : 9139                   dw $9139
7acd : c0e0                   dw $C0E0
7acf : 9128                   dw $9128
7ad1 : 9034                   dw $9034
7ad3 : 9128                   dw $9128
7ad5 : 9034                   dw $9034
7ad7 : 9124                   dw $9124
7ad9 : 9030                   dw $9030
7adb : e191                   dw $E191
7add : 21c4                   dw $21C4
7adf : 9139                   dw $9139
7ae1 : e0c0                   dw $E0C0
7ae3 : 912b                   dw $912B
7ae5 : 902d                   dw $902D
7ae7 : 9137                   dw $9137
7ae9 : 9039                   dw $9039
7aeb : 878a                   dw $878A
7aed : df00                   dw $DF00
7aef : 4103                   dw $4103
7af1 : c088                   dw $C088
7af3 : 0101                   dw $101
7af5 : 82e0                   dw $82E0
7af7 : 2115                   dw $2115
7af9 : 1f21                   dw $1F21
7afb : e191                   dw $E191
7afd : 8428                   dw $8428
7aff : 0124                   dw $124
7b01 : e121                   dw $E121
7b03 : e021                   dw $E021
7b05 : 151f                   dw $151F
7b07 : 21e1                   dw $21E1
7b09 : 9184                   dw $9184
7b0b : 2801                   dw $2801
7b0d : 2421                   dw $2421
7b0f : 87e0                   dw $87E0
7b11 : 1a0e                   dw $1A0E
7b13 : 181a                   dw $181A
7b15 : e191                   dw $E191
7b17 : 8428                   dw $8428
7b19 : 0124                   dw $124
7b1b : e11a                   dw $E11A
7b1d : e01a                   dw $E01A
7b1f : 0e18                   dw $E18
7b21 : 1ae1                   dw $1AE1
7b23 : 9184                   dw $9184
7b25 : 2801                   dw $2801
7b27 : 241a                   dw $241A
7b29 : 87e0                   dw $87E0
7b2b : 180c                   dw $180C
7b2d : 1718                   dw $1718
7b2f : e191                   dw $E191
7b31 : 8428                   dw $8428
7b33 : 0124                   dw $124
7b35 : e118                   dw $E118
7b37 : e018                   dw $E018
7b39 : 0c17                   dw $C17
7b3b : 18e1                   dw $18E1
7b3d : 9184                   dw $9184
7b3f : 2801                   dw $2801
7b41 : 2418                   dw $2418
7b43 : 87e0                   dw $87E0
7b45 : 1d11                   dw $1D11
7b47 : 1c1d                   dw $1C1D
7b49 : e191                   dw $E191
7b4b : 8428                   dw $8428
7b4d : 0124                   dw $124
7b4f : e11d                   dw $E11D
7b51 : e01d                   dw $E01D
7b53 : 111c                   dw $111C
7b55 : 1de1                   dw $1DE1
7b57 : 9184                   dw $9184
7b59 : 2801                   dw $2801
7b5b : 241d                   dw $241D
7b5d : 878a                   dw $878A
7b5f : df00                   dw $DF00
7b61 : 6102                   dw $6102
7b63 : c088                   dw $C088
7b65 : 0101                   dw $101
7b67 : 82e1                   dw $82E1
7b69 : 9115                   dw $9115
7b6b : 9115                   dw $9115
7b6d : e191                   dw $E191
7b6f : 8428                   dw $8428
7b71 : 0124                   dw $124
7b73 : e080                   dw $E080
7b75 : e091                   dw $E091
7b77 : 15e3                   dw $15E3
7b79 : 9115                   dw $9115
7b7b : e191                   dw $E191
7b7d : 8428                   dw $8428
7b7f : 0124                   dw $124
7b81 : 8087                   dw $8087
7b83 : 8adf                   dw $8ADF
7b85 : 0061                   dw $61
7b87 : 02c0                   dw $2C0
7b89 : 8801                   dw $8801
7b8b : 0182                   dw $182
7b8d : e380                   dw $E380
7b8f : e191                   dw $E191
7b91 : 8428                   dw $8428
7b93 : 0124                   dw $124
7b95 : e580                   dw $E580
7b97 : e191                   dw $E191
7b99 : 8428                   dw $8428
7b9b : 0124                   dw $124
7b9d : 8087                   dw $8087
7b9f : e191                   dw $E191
7ba1 : 1391                   dw $1391
7ba3 : 13e1                   dw $13E1
7ba5 : 9184                   dw $9184
7ba7 : 2801                   dw $2801
7ba9 : 24e0                   dw $24E0
7bab : 80e0                   dw $80E0
7bad : 9113                   dw $9113
7baf : e391                   dw $E391
7bb1 : 13e1                   dw $13E1
7bb3 : 9184                   dw $9184
7bb5 : 2801                   dw $2801
7bb7 : 2480                   dw $2480
7bb9 : 87e1                   dw $87E1
7bbb : 9111                   dw $9111
7bbd : 9111                   dw $9111
7bbf : e191                   dw $E191
7bc1 : 8428                   dw $8428
7bc3 : 0124                   dw $124
7bc5 : e080                   dw $E080
7bc7 : e091                   dw $E091
7bc9 : 11e3                   dw $11E3
7bcb : 9111                   dw $9111
7bcd : e191                   dw $E191
7bcf : 8428                   dw $8428
7bd1 : 0124                   dw $124
7bd3 : 8087                   dw $8087
7bd5 : e191                   dw $E191
7bd7 : 0c91                   dw $C91
7bd9 : 0ce1                   dw $CE1
7bdb : 9184                   dw $9184
7bdd : 2801                   dw $2801
7bdf : 24e0                   dw $24E0
7be1 : 80e0                   dw $80E0
7be3 : 910c                   dw $910C
7be5 : e391                   dw $E391
7be7 : 0ce1                   dw $CE1
7be9 : 9184                   dw $9184
7beb : 2801                   dw $2801
7bed : 2480                   dw $2480
7bef : 87e1                   dw $87E1
7bf1 : 910e                   dw $910E
7bf3 : 910e                   dw $910E
7bf5 : e191                   dw $E191
7bf7 : 8428                   dw $8428
7bf9 : 0124                   dw $124
7bfb : e080                   dw $E080
7bfd : e091                   dw $E091
7bff : 0ee3                   dw $EE3
7c01 : 910e                   dw $910E
7c03 : e191                   dw $E191
7c05 : 8428                   dw $8428
7c07 : 0124                   dw $124
7c09 : 8087                   dw $8087
7c0b : 0000                   dw 0
7c0d : 0000                   dw 0
7c0f : 0000                   dw 0
7c11 : 0000                   dw 0
                             
                             
                             ;---------------------
                             ; READ/WRITE memory, 3*102 + 76 = 382 bytes
                             ;---------------------
                             
7c13 :                       LA5_BASE_ROM:  ;status, read/write
                             ; ds 46  ;$2e
                              ;2e is first offset, 44 the highest
7c13 : ff00                   dw $FF00
7c15 : 0006                   dw 6
7c17 : 0006                   dw 6
7c19 : 0700                   dw $700
7c1b : 0000                   dw 0
7c1d : f800                   dw $F800
7c1f : f000                   dw $F000
7c21 : dd01                   dw $DD01
7c23 : f302                   dw $F302
7c25 : 00ea                   dw $EA
7c27 : 0f0f                   dw $F0F
7c29 : 0f00                   dw $F00
7c2b : 0000                   dw 0
7c2d : 0020                   dw $20
7c2f : ffff                   dw $FFFF
                             
                             
                             ;+ = reset in init
7c31 :                       L0596E6_ROM:  ;channel 1 data, read/write, 102 by
7c31 : 0000                   dw 0   ;0 +
7c33 : 0000                   dw 0   ;2
7c35 : 00000000               dw 0,0   ;4 +
7c39 : 00000000               dw 0,0   ;8 +
7c3d : 00000000               dw 0,0   ;C +
7c41 : 0000                   dw 0
7c43 : 0000                   dw 0
7c45 : 0003                   dw 3
7c47 : 05ca                   dw $5CA
7c49 : 0003                   dw 3
7c4b : 05cb                   dw $5CB
7c4d : 0000                   dw 0
7c4f : 0000                   dw 0
7c51 : 0000                   dw 0
7c53 : 0000                   dw 0
7c55 : 0000                   dw 0
7c57 : 0000                   dw 0
7c59 : 0000                   dw 0  ;$28 +
7c5b : 0000                   dw 0
7c5d : 0002                   dw 2
7c5f : 0000                   dw 0
7c61 : 002b                   dw $2B
7c63 : 0000                   dw 0
7c65 : 0f00                   dw $F00
7c67 : 0000                   dw 0
7c69 : 0000                   dw 0
7c6b : 0000                   dw 0
7c6d : 6100                   dw $6100
7c6f : 0000                   dw 0
7c71 : 0100                   dw $100
7c73 : 0000                   dw 0
7c75 : 0200                   dw $200
7c77 : 0000                   dw 0
7c79 : 0200                   dw $200
7c7b : 0000                   dw 0
7c7d : 0f00                   dw $F00
7c7f : 0000                   dw 0
7c81 : 0002                   dw 2
7c83 : 0000                   dw 0
7c85 : 0001                   dw 1
7c87 : 0000                   dw 0
7c89 : 0003                   dw 3
7c8b : 0000                   dw 0
7c8d : 00                     db 0  ;$5c +
7c8e : 00                     db 0
7c8f : 0000                   dw 0
7c91 : 0000                   dw 0
7c93 : 0000                   dw 0
7c95 : 0900                   dw $900
7c97 :                       L05974C_ROM:  ;channel 2 data, read/write
7c97 : 2100                   dw $2100
7c99 : 0000                   dw 0
7c9b : 0003                   dw 3
7c9d : 0e24                   dw $E24
7c9f : 0003                   dw 3
7ca1 : 0814                   dw $814
7ca3 : 0000                   dw 0
7ca5 : 0098                   dw $98
7ca7 : 0000                   dw 0
7ca9 : 0000                   dw 0
7cab : 0003                   dw 3
7cad : 05ca                   dw $5CA
7caf : 0003                   dw 3
7cb1 : 05cb                   dw $5CB
7cb3 : 0000                   dw 0
7cb5 : 0000                   dw 0
7cb7 : 0000                   dw 0
7cb9 : 0000                   dw 0
7cbb : 0000                   dw 0
7cbd : 0000                   dw 0
7cbf : 0001                   dw 1
7cc1 : 0000                   dw 0
7cc3 : 0001                   dw 1
7cc5 : 0000                   dw 0
7cc7 : 0024                   dw $24
7cc9 : 0000                   dw 0
7ccb : 0f00                   dw $F00
7ccd : 0000                   dw 0
7ccf : 0000                   dw 0
7cd1 : 0000                   dw 0
7cd3 : 1100                   dw $1100
7cd5 : 0000                   dw 0
7cd7 : 1100                   dw $1100
7cd9 : 0000                   dw 0
7cdb : 0f00                   dw $F00
7cdd : 0000                   dw 0
7cdf : 0f00                   dw $F00
7ce1 : 0000                   dw 0
7ce3 : 0f00                   dw $F00
7ce5 : 0000                   dw 0
7ce7 : 0000                   dw 0
7ce9 : 0000                   dw 0
7ceb : 0000                   dw 0
7ced : 0000                   dw 0
7cef : 0000                   dw 0
7cf1 : 0000                   dw 0
7cf3 : 0000                   dw 0
7cf5 : 0000                   dw 0
7cf7 : 0000                   dw 0
7cf9 : 0000                   dw 0
7cfb : 1200                   dw $1200
7cfd :                       L0597B2_ROM:  ;channel 3 data, read/write
7cfd : 2500                   dw $2500
7cff : 0000                   dw 0
7d01 : 0003                   dw 3
7d03 : 11e8                   dw $11E8
7d05 : 0003                   dw 3
7d07 : 0a40                   dw $A40
7d09 : 0000                   dw 0
7d0b : 0098                   dw $98
7d0d : 0118                   dw $118
7d0f : 0000                   dw 0
7d11 : 0003                   dw 3
7d13 : 05ca                   dw $5CA
7d15 : 0003                   dw 3
7d17 : 05cb                   dw $5CB
7d19 : 0028                   dw $28
7d1b : 0000                   dw 0
7d1d : 0001                   dw 1
7d1f : 0000                   dw 0
7d21 : 0000                   dw 0
7d23 : 0000                   dw 0
7d25 : 0001                   dw 1
7d27 : 0000                   dw 0
7d29 : 0002                   dw 2
7d2b : 0000                   dw 0
7d2d : 0024                   dw $24
7d2f : 0000                   dw 0
7d31 : 0f00                   dw $F00
7d33 : 0000                   dw 0
7d35 : 0000                   dw 0
7d37 : 0000                   dw 0
7d39 : 6100                   dw $6100
7d3b : 0000                   dw 0
7d3d : 0100                   dw $100
7d3f : 0000                   dw 0
7d41 : 0200                   dw $200
7d43 : 0000                   dw 0
7d45 : 0200                   dw $200
7d47 : 0000                   dw 0
7d49 : 0f00                   dw $F00
7d4b : 0000                   dw 0
7d4d : 0001                   dw 1
7d4f : 0000                   dw 0
7d51 : 0001                   dw 1
7d53 : 0000                   dw 0
7d55 : 0000                   dw 0
7d57 : 0000                   dw 0
7d59 : 4000                   dw $4000
7d5b : 0000                   dw 0
7d5d : 0000                   dw 0
7d5f : 0000                   dw 0
7d61 : 2400                   dw $2400
                             
                             
                             
                             
                             
                             ;-----------------
                             ;Vectrex RAM section
                               bss
                             
c8a0 =                         org TemporaryArea
                             
c8a0 =                       TitleLogoY: ds 1
c8a1 =                       VolumeTimer: ds 1
                             
c8a2 =                       ScrollInt: ds 1
c8a3 =                       ScrollTextPtr: ds 2
c8a5 =                       SineIndex1: ds 1
c8a6 =                       SineIndex2: ds 1
                             
                               code
                             
                               include "Thrust_Eeprom.asm"
                             ;Thrust EEPROM support
                             ;368 bytes
                             ;todo optimize size:  gör om ds1w_txbyte så att d
                             ;                     load o verify har samma set
                             
                             
                             ;
                             ;
                             ; Example DS2430A code
                             ;
                             ;
                             ; Copyright (c) 2003 Alex Herbert
                             ;
                             ;
                             
                             
                             ; PIA Registers
                             
d000 =                       CNTRL   equ     $d000   ; ORB / IRB - Output Regi
d001 =                       DAC     equ     $d001   ; ORA / IRA - Output Regi
d002 =                       DCNTRL  equ     $d002   ; DDRB      - Data Direct
d003 =                       DDAC    equ     $d003   ; DDRA      - Data Direct
d004 =                       T1LOLC  equ     $d004   ; T1C-L     - Timer 1 Cou
d005 =                       T1HOC   equ     $d005   ; T1C-H     - Timer 1 Cou
d006 =                       T1LOL   equ     $d006   ; T1L-L     - Timer 1 Lat
d007 =                       T1HOL   equ     $d007   ; T1L-H     - Timer 1 Lat
d008 =                       T2LOLC  equ     $d008   ; T2C-L     - Timer 2 Cou
d009 =                       T2HOC   equ     $d009   ; T2C-H     - Timer 2 Cou
d00a =                       SHIFT   equ     $d00a   ; SR        - Shift Regis
d00b =                       ACNTRL  equ     $d00b   ; ACR       - Auxiliary C
d00c =                       PCNTRL  equ     $d00c   ; PCR       - Peripheral 
d00d =                       IFLAG   equ     $d00d   ; IFR       - Interrupt F
d00e =                       IENABL  equ     $d00e   ; IER       - Interrupt E
                             
                             
                             
                             DP_IO macro
                               lda   #0xD0
                               tfr   a,dp
                               endm
                             
                             
                             ; EEPROM constants
0087 =                       EEPROM_CHECKSUM equ     $87     ; any value other
                             
                             
                             ;
                             ;
                             ; DS1W - Dallas Semiconductor 1-Wire Driver
                             ;
                             ;
                             ; Copyright (c) 2002 Alex Herbert
                             ;
                             ;
                             
                             
                             ; 1-Wire Timing constants
2a03 =                       DS1W_RESETDUR   equ     $2a03   ; Reset Pulse dur
                                                             ; $032a = 810 cyc
                             
d002 =                       DS1W_PRESDUR    equ     $d002   ; Presence Pulse 
                                                             ; $02d0 = 720 cyc
                             
0078 =                       DS1W_TSLOTDUR   equ     $78     ; Time Slot durat
                                                             ; $78 = 120cycles
                             
                             
                             ; Note:
                             ;
                             ; For reliability DS1W_RESETDUR and DS1W_TSLOTDUR
                             ; minimums specified by the datasheet. To improve
                             ; closer to the specified minimums may be used.
                             ;
                             ; DS1W_RESETDUR minimum = 480us
                             ; DS1W_TSLOTDUR minimum = 60us
                             
                             
                             
                             
                             ; 1-Wire ROM commands
                             
0033 =                       DS1W_READROM    equ     $33
00cc =                       DS1W_SKIPROM    equ     $cc
                             
0055 =                       DS1W_MATCHROM   equ     $55
00f0 =                       DS1W_SEARCHROM  equ     $f0
                             
                             
                             
                             
                             ; Subroutines
                             
                                     code
                             
                                     direct  CNTRL
                             
                             
                             
                             ; ds1w_open
                             ;
                             ; function:
                             ;       Prepares Vectrex I/O hardware (6522) for 
                             ;
                             ; on entry:
                             ;       dp = $d0
                             ;
                             ; on exit:
                             ;       d  = undefined
7d63 :                       ds1w_open
7d63 : cc8118           [ 3]         ldd     #$8118
7d66 : 9700             [ 4]         sta     CNTRL           ; make sure PB7 i
7d68 : d70b             [ 4]         stb     ACNTRL          ; Disable T1 outp
7d6a : 39               [ 5]         rts
                             
                             
                             
                             
                             ; ds1w_close
                             ;
                             ; function:
                             ;       Restores Vectrex I/O hardware (6522) defa
                             ;
                             ; on entry:
                             ;       dp = $d0
                             ;
                             ; on exit:
                             ;       b  = undefined
7d6b :                       ds1w_close
7d6b : c698             [ 2]         ldb     #$98
7d6d : d70b             [ 4]         stb     ACNTRL          ; Enable T1 outpu
7d6f : 39               [ 5]         rts
                             
                             
                             
                             
                             ; ds1w_reset
                             ;
                             ; function:
                             ;       Reset 1-Wire device(s), and detect if dev
                             ;
                             ; on entry:
                             ;       dp = $d0
                             ;
                             ; on exit:
                             ;       a  = 0 if device is present, -1 if not.
                             ;       b  = undefined
                             ;       cc = z=1 and n=0 if device present,
                             ;            z=0 and n=1 if device not present.
7d70 :                       ds1w_reset
7d70 : cc2a03           [ 3]         ldd     #DS1W_RESETDUR  ; reset pulse dur
7d73 : dd04             [ 5]         std     T1LOLC          ; start timer
                             
                                     ; generate reset pulse
                             
7d75 : 86df             [ 2]         lda     #$df
7d77 : 9702             [ 4]         sta     DCNTRL          ; PB6 direction =
                             
7d79 : c640             [ 2]         ldb     #$40
7d7b :                       dsreset_loop1
7d7b : d50d             [ 4]         bitb    IFLAG
7d7d : 27fc             [ 3]         beq     dsreset_loop1   ; wait for timer
                             
7d7f : 869f             [ 2]         lda     #$9f
7d81 : 9702             [ 4]         sta     DCNTRL          ; PB6 direction =
                             
                                     ; check for presence pulse
                             
7d83 : d500             [ 4]         bitb    CNTRL           ; test PB6
7d85 : 271f             [ 3]         beq     ds1w_notpresent ; PB6 was low too
                             
7d87 : ccd002           [ 3]         ldd     #DS1W_PRESDUR   ; presence pulse 
7d8a : dd04             [ 5]         std     T1LOLC          ; start timer
                             
7d8c : c640             [ 2]         ldb     #$40
7d8e :                       dsreset_loop2
7d8e : d500             [ 4]         bitb    CNTRL           ; test PB6
7d90 : 2706             [ 3]         beq     dsreset_loop3
7d92 : d50d             [ 4]         bitb    IFLAG           ; timeout?
7d94 : 27f8             [ 3]         beq     dsreset_loop2
7d96 : 200e             [ 3]         bra     ds1w_notpresent ; PB6 didn't go l
                             
7d98 :                       dsreset_loop3
7d98 : d50d             [ 4]         bitb    IFLAG
7d9a : 27fc             [ 3]         beq     dsreset_loop3   ; wait for timer
                             
7d9c : d500             [ 4]         bitb    CNTRL
7d9e : 2706             [ 3]         beq     ds1w_notpresent ; PB6 stayed low 
                             
7da0 :                       ds1w_present
7da0 : 8678             [ 2]         lda     #DS1W_TSLOTDUR  ; time slot durat
7da2 : 9704             [ 4]         sta     T1LOLC          ; load timer latc
                             
7da4 : 4f               [ 2]         clra                    ; return "no erro
7da5 : 39               [ 5]         rts
                             
7da6 :                       ds1w_notpresent
7da6 : 86ff             [ 2]         lda     #-1             ; return "device 
7da8 : 39               [ 5]         rts
                             
                             
                             
                             
                             ; ds1w_txbyte
                             ;
                             ; function:
                             ;       Transmit byte to 1-Wire device.
                             ;
                             ; on entry:
                             ;       a  = byte to send
                             ;       dp = $d0
                             ;
                             ; on exit:
                             ;       d  = undefined
7da9 :                       ds1w_txbyte
7da9 : c608             [ 2]         ldb     #$08            ; bits in byte
7dab : e77f             [ 5]         stb     -1,sp           ; put loop counte
                             
7dad :                       ds1w_txbits
7dad : 44               [ 2]         lsra                    ; shift data into
7dae : 2515             [ 3]         bcs     ds1w_txbit1
                             
7db0 :                       ds1w_txbit0
7db0 : 0f05             [ 6]         clr     T1HOC           ; start timer
                             
                                     ; long pulse low  ~~\________/~~
                             
7db2 : c6df             [ 2]         ldb     #$df
7db4 : d702             [ 4]         stb     DCNTRL          ; PB6 direction =
                             
7db6 : c640             [ 2]         ldb     #$40
7db8 :                       dstx0_loop
7db8 : d50d             [ 4]         bitb    IFLAG
7dba : 27fc             [ 3]         beq     dstx0_loop      ; wait for end of
                             
7dbc : c69f             [ 2]         ldb     #$9f
7dbe : d702             [ 4]         stb     DCNTRL          ; PB6 direction =
                             
7dc0 : 6a7f             [ 7]         dec     -1,sp
7dc2 : 26e9             [ 3]         bne     ds1w_txbits
7dc4 : 39               [ 5]         rts
                             
7dc5 :                       ds1w_txbit1
7dc5 : 0f05             [ 6]         clr     T1HOC           ; start timer
                             
                                     ; short pulse low  ~~\_/~~~~~~~~~
                             
7dc7 : c6df             [ 2]         ldb     #$df
7dc9 : d702             [ 4]         stb     DCNTRL          ; PB6 direction =
                             
7dcb : c69f             [ 2]         ldb     #$9f
7dcd : d702             [ 4]         stb     DCNTRL          ; PB6 direction =
                             
7dcf : c640             [ 2]         ldb     #$40
7dd1 :                       dstx1_loop
7dd1 : d50d             [ 4]         bitb    IFLAG
7dd3 : 27fc             [ 3]         beq     dstx1_loop      ; wait for end of
                             
7dd5 : 6a7f             [ 7]         dec     -1,sp
7dd7 : 26d4             [ 3]         bne     ds1w_txbits
7dd9 : 39               [ 5]         rts
                             
                             
                             
                             
                             ; ds1w_rxbyte
                             ;
                             ; function:
                             ;       Receive byte from 1-Wire device.
                             ;
                             ; on entry:
                             ;       dp = $d0
                             ;
                             ; on exit:
                             ;       a  = received byte
                             ;       b  = undefined
7dda :                       ds1w_rxbyte
7dda : c608             [ 2]         ldb     #$08            ; bits in byte
7ddc : e77f             [ 5]         stb     -1,sp           ; put loop counte
                             
7dde :                       ds1w_rxbits
7dde : 0f05             [ 6]         clr     T1HOC           ; start timer
                             
                                     ; short pulse low  ~~\_xxxxxx~~~~
                             
7de0 : c6df             [ 2]         ldb     #$df
7de2 : d702             [ 4]         stb     DCNTRL          ; PB6 direction =
                             
7de4 : c69f             [ 2]         ldb     #$9f
7de6 : d702             [ 4]         stb     DCNTRL          ; PB6 direction =
                             
                                     ; read response
                             
7de8 : 12               [ 2]         nop                     ; timing
                             
7de9 : d600             [ 4]         ldb     CNTRL           ; read PB
7deb : 58               [ 2]         lslb                    ; shift PB6...
7dec : 58               [ 2]         lslb                    ; ...into carry..
7ded : 46               [ 2]         rora                    ; ...and rotate i
                             
7dee : c640             [ 2]         ldb     #$40
7df0 :                       dsrx_loop
7df0 : d50d             [ 4]         bitb    IFLAG
7df2 : 27fc             [ 3]         beq     dsrx_loop       ; wait for end of
                             
7df4 : 6a7f             [ 7]         dec     -1,sp
7df6 : 26e6             [ 3]         bne     ds1w_rxbits
7df8 : 39               [ 5]         rts
                             
                                     direct  -1
                             
                             
                             
                             
                             ; ds2430_verify
                             ;
                             ; function:
                             ;       compare DS2430 EEPROM to RAM
                             ;
                             ; on entry:
                             ;       x = data address
                             ;
                             ; on exit:
                             ;       a = 0 if same,
                             ;           non-zero if different
7df9 :                       ds2430_verify
7df9 : 8620             [ 2]         lda     #$20            ; number of bytes
7dfb : 341e             [10]         pshs    d,dp,x          ; stack used regi
                             
                                     DP_IO                   ; dp = $d0
7dfd : 86d0             [ 2]>  lda   #0xD0
7dff : 1f8b             [ 6]>  tfr   a,dp
                             
                             
7e01 : bd7d63           [ 8]         jsr     ds1w_open       ; open 1-wire por
                             
7e04 : bd7d70           [ 8]         jsr     ds1w_reset      ; reset device
7e07 : 2b15             [ 3]         bmi     dsverify_exit   ; exit if no devi
                             
7e09 : 86cc             [ 2]         lda     #DS1W_SKIPROM   ; no need to acce
7e0b : 8d9c             [ 7]         jsr     ds1w_txbyte     ; send command
                             
7e0d : 86f0             [ 2]         lda     #DS2430_READMEM ; copy eeprom to 
7e0f : 8d98             [ 7]         jsr     ds1w_txbyte     ; send command
                             
7e11 : 4f               [ 2]         clra                    ; address of firs
7e12 : 8d95             [ 7]         jsr     ds1w_txbyte     ; send address
                             
7e14 :                       dsverify_loop
7e14 : 8dc4             [ 7]         jsr     ds1w_rxbyte     ; read byte from 
7e16 : a180             [ 6]         cmpa    ,x+             ; compare to ram
7e18 : 2604             [ 3]         bne     dsverify_exit   ; exit if not sam
7e1a : 6ae4             [ 6]         dec     ,s              ; decrement loop 
7e1c : 26f6             [ 3]         bne     dsverify_loop   ; until all bytes
                             
7e1e :                       dsverify_exit
7e1e : bd7d6b           [ 8]         jsr     ds1w_close      ; close port
7e21 : 359e             [12]         puls    d,dp,x,pc       ; restore registe
                             
                                     direct  -1
                             
                             ; DS2430 Commands
                             
000f =                       DS2430_WRITESP  equ     $0f     ; Write bytes to 
0055 =                       DS2430_COPYSP   equ     $55     ; Copy entire Scr
00aa =                       DS2430_READSP   equ     $aa     ; Read bytes from
00f0 =                       DS2430_READMEM  equ     $f0     ; As READSP, but 
                             
005a =                       DS2430_LOCKAR   equ     $5a     ; Lock Applicatio
0066 =                       DS2430_READSR   equ     $66     ; Read Status Reg
0099 =                       DS2430_WRITEAR  equ     $99     ; Write bytes to 
00c3 =                       DS2430_READAR   equ     $c3     ; Read bytes from
                             
00a5 =                       DS2430_VALKEY   equ     $a5     ; Validation byte
                             
                             
                             
                             ; DS2430 Timings
                             
983a =                       DS2430_COPYDUR  equ     $983a   ; $3a98 = 15000 c
                             
                             
                             
                             
                             
                             ; ds2430_load
                             ;
                             ; function:
                             ;       load DS2430 EEPROM to RAM
                             ;
                             ; on entry:
                             ;       x = load address
                             ;
                             ; on exit:
                             ;       a = 0 if no error,
                             ;           non-zero if error
7e23 :                       ds2430_load
7e23 : 8620             [ 2]         lda     #$20            ; number of bytes
7e25 : 341e             [10]         pshs    d,dp,x          ; stack used regi
                             
                                     DP_IO                   ; dp = $d0
7e27 : 86d0             [ 2]>  lda   #0xD0
7e29 : 1f8b             [ 6]>  tfr   a,dp
                             
                             
7e2b : bd7d63           [ 8]         jsr     ds1w_open       ; open 1-wire por
                             
7e2e : bd7d70           [ 8]         jsr     ds1w_reset      ; reset device
7e31 : 2b16             [ 3]         bmi     dsload_exit     ; exit if no devi
                             
7e33 : 86cc             [ 2]         lda     #DS1W_SKIPROM   ; no need to acce
7e35 : bd7da9           [ 8]         jsr     ds1w_txbyte     ; send command
                             
7e38 : 86f0             [ 2]         lda     #DS2430_READMEM ; copy eeprom to 
7e3a : bd7da9           [ 8]         jsr     ds1w_txbyte     ; send command
                             
7e3d : 4f               [ 2]         clra                    ; address of firs
7e3e : bd7da9           [ 8]         jsr     ds1w_txbyte     ; send address
                             
7e41 :                       dsload_loop
7e41 : 8d97             [ 7]         jsr     ds1w_rxbyte     ; read byte from 
7e43 : a780             [ 6]         sta     ,x+             ; save to ram
7e45 : 6ae4             [ 6]         dec     ,s              ; decrement loop 
7e47 : 26f8             [ 3]         bne     dsload_loop     ; until all bytes
                             
7e49 :                       dsload_exit
7e49 : bd7d6b           [ 8]         jsr     ds1w_close      ; close port
7e4c : 359e             [12]         puls    d,dp,x,pc       ; restore registe
                             
                                     direct  -1
                             
                             
                             
                             
                             ; ds2430_save
                             ;
                             ; function:
                             ;       save RAM to DS2430 EEPROM
                             ;
                             ; on entry:
                             ;       x = address of data to save
                             ;
                             ; on exit:
                             ;       a = 0 if no error,
                             ;           non-zero if error
7e4e :                       ds2430_save
7e4e : 8620             [ 2]         lda     #$20            ; number of bytes
7e50 : 341e             [10]         pshs    d,dp,x          ; stack used regi
                             
                                     DP_IO                   ; dp = $d0
7e52 : 86d0             [ 2]>  lda   #0xD0
7e54 : 1f8b             [ 6]>  tfr   a,dp
                             
                             
7e56 : bd7d63           [ 8]         jsr     ds1w_open       ; open 1-wire por
                             
7e59 : bd7d70           [ 8]         jsr     ds1w_reset      ; reset device
7e5c : 2b36             [ 3]         bmi     dssave_exit     ; exit if no devi
                             
7e5e : 86cc             [ 2]         lda     #DS1W_SKIPROM   ; no need to acce
7e60 : bd7da9           [ 8]         jsr     ds1w_txbyte     ; send command
                             
7e63 : 860f             [ 2]         lda     #DS2430_WRITESP ; write bytes to 
7e65 : bd7da9           [ 8]         jsr     ds1w_txbyte     ; send command
                             
7e68 : 4f               [ 2]         clra                    ; address of firs
7e69 : bd7da9           [ 8]         jsr     ds1w_txbyte     ; send address
                             
7e6c :                       dssave_loop
7e6c : a680             [ 6]         lda     ,x+             ; get byte from r
7e6e : bd7da9           [ 8]         jsr     ds1w_txbyte     ; send byte
7e71 : 6ae4             [ 6]         dec     ,s              ; decrement loop 
7e73 : 26f7             [ 3]         bne     dssave_loop     ; until all bytes
                             
7e75 : bd7d70           [ 8]         jsr     ds1w_reset      ; reset device
                             
7e78 : 86cc             [ 2]         lda     #DS1W_SKIPROM   ; no need to acce
7e7a : bd7da9           [ 8]         jsr     ds1w_txbyte     ; send command
                             
7e7d : 8655             [ 2]         lda     #DS2430_COPYSP  ; copy scratch pa
7e7f : bd7da9           [ 8]         jsr     ds1w_txbyte     ; send command
                             
7e82 : 86a5             [ 2]         lda     #DS2430_VALKEY  ; validation key
7e84 : bd7da9           [ 8]         jsr     ds1w_txbyte     ; send key
                             
7e87 : cc983a           [ 3]         ldd     #DS2430_COPYDUR ; eeprom write (s
7e8a : fdd004           [ 6]         std     T1LOLC          ; start timer
                             
7e8d : c640             [ 2]         ldb     #$40
7e8f :                       dssave_loop2
7e8f : f5d00d           [ 5]         bitb    IFLAG
7e92 : 27fb             [ 3]         beq     dssave_loop2    ; wait for timer
                             
7e94 :                       dssave_exit
7e94 : bd7d6b           [ 8]         jsr     ds1w_close      ; close port
7e97 : 359e             [12]         puls    d,dp,x,pc       ; restore registe
                             
                                     direct  -1
                             
                             
                             
7e99 :                       eeprom_load
7e99 : 8ec880           [ 3]         ldx     #eeprom_buffer          ;
7e9c : 8d85             [ 7]         jsr     ds2430_load             ; load 32
                             
7e9e : cc0020           [ 3]         ldd     #$0020                  ;
7ea1 :                       eeload_loop                             ;
7ea1 : ab80             [ 6]         adda    ,x+                     ; sum the
7ea3 : 5a               [ 2]         decb                            ;
7ea4 : 26fb             [ 3]         bne     eeload_loop             ;
                             
7ea6 : 8187             [ 2]         cmpa    #EEPROM_CHECKSUM        ; equal t
7ea8 : 2608             [ 3]         bne     eeprom_format           ; if not,
                             
7eaa : 39               [ 5]         rts                             ; otherwi
                             
                             
                             ;Init eeprom-buffer with valid data
                             ;Called when eeprom is erased, or eeprom is not p
7eab : 20203130303080        DefaultString: db '  1000',$80
7eb2 :                       eeprom_format
7eb2 : cec880           [ 3]   ldu #eeprom_buffer
                               mCombine d,DefaultButtonConfig,0
7eb5 : ccd800           [ 3]>  ldd #(lo DefaultButtonConfig)<<8 | (lo 0)
                             
                               ;First byte is control, second is bonusgameenab
7eb8 : edc1             [ 8]   std ,u++
7eba : c604             [ 2]   ldb #4
7ebc :                       eeformat_loop
7ebc : 8e7eab           [ 3]   ldx #DefaultString
7ebf : bdf8de           [ 8]   jsr Text_CopyString
7ec2 : 5a               [ 2]   decb
7ec3 : 26f7             [ 3]   bne eeformat_loop
                             
                             
                             ;        ldx     #eeprom_buffer          ;
                             ;        ldu     #eeprom_defaults        ;
                             ;        ldb     #$1f                    ;
                             ;eeformat_loop                           ; copy d
                             ;        pulu    a                       ;
                             ;        sta     ,x+                     ;
                             ;        decb                            ;
                             ;        bne     eeformat_loop           ;
                             
                             
7ec5 :                       eeprom_save
7ec5 : 8ec880           [ 3]         ldx     #eeprom_buffer          ;
7ec8 : cc871f           [ 3]         ldd     #(EEPROM_CHECKSUM<<8)+$1f ;
7ecb :                       eesave_loop                             ;
7ecb : a080             [ 6]         suba    ,x+                     ; create 
7ecd : 5a               [ 2]         decb                            ;
7ece : 26fb             [ 3]         bne     eesave_loop             ;
7ed0 : a784             [ 4]         sta     ,x                      ;
                             
7ed2 : 8ec880           [ 3]         ldx     #eeprom_buffer          ;
7ed5 : bd7df9           [ 8]         jsr     ds2430_verify           ; compare
7ed8 : 4d               [ 2]         tsta                            ;
7ed9 : 1026ff71         [ 6]         bne     ds2430_save             ; if diff
                             
7edd : 39               [ 5]         rts
                             
                             
                             
                             
No errors in pass 2.
Wrote binary from address $0000 through $7edd.
Total size 32478 bytes.
